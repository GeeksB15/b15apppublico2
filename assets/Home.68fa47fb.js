import{_ as q,bd as h,r as p,o as i,p as l,f as o,w as e,G as v,J as z,d as g,k as r,t as n,j as S,e as b,F as m,h as B,i as y,u as $,I as x}from"./index.35e7b382.js";let c=1;const P={components:{},data(){return{animacao:"",atualizou:!1,mensagemBancoBloqueado:"",statusBancos:{}}},methods:{animar(){c++,c===10&&(c=1),c<5?this.animacao="<".repeat(c)+""+">".repeat(c):this.animacao="<".repeat(10-c)+""+">".repeat(10-c)},async atualizar(){if(await this.verificarRedirecionamento())return!0;try{this.$q.loading.show();const t=await h.sincronismo.le();for(const a of t){const u=this.statusBancos[a.bancoDeDados]||{};this.statusBancos[a.bancoDeDados]={bancoDeDados:a.bancoDeDados,status:a.status,percentagem:0,quantidadeRestantePeriodico:0,...u}}this.atualizou=!0}catch(t){this.$q.notifyError("Erro ao atualizar",t)}finally{this.$q.loading.hide()}this.atualizarPeriodico()},async atualizarPeriodico(){this.cotadorInterval=(this.cotadorInterval||0)+1,this.animar();try{const t=this.cotadorInterval%5!==1?await h.sincronismo.le({bancoDeDados:$db.cache.get("bancoDeDados")}):await h.sincronismo.le();for(const a of t){if(a.bancoDeDados===$db.cache.get("bancoDeDados")&&await this.verificarRedirecionamento(a))return!0;const u=this.statusBancos[a.bancoDeDados];u||(this.statusBancos[a.bancoDeDados]={...a}),u.ultimo<a.ultimo&&(this.statusBancos[a.bancoDeDados]={...u,...a})}}catch(t){this.$q.notifyError("Erro ao atualizar",t)}},async atualizarStatusSincronismo(t,a){if(this.animar(),this.statusBancos[t]={...this.statusBancos[t]||{},...a},a.status==="normal"&&await this.verificarRedirecionamento())return!0},async atualizarStatusSincronismoPeriodico(t,a){this.animar(),this.statusBancos[t]&&a&&(this.statusBancos[t].quantidadeRestantePeriodico-=a)},async verificarRedirecionamento(){try{if(this.mensagemBancoBloqueado=await h.sincronismo.verificaBloqueio(),!this.mensagemBancoBloqueado){const t=await $db.permissao.telaInicial();return $utils.gconsole.log("Home","redirecionando para a tela inicial",JSON.stringify(t)),await this.$router.push(t),!0}}catch(t){this.$q.notifyError("Erro ao verificar banco selecionado",t)}return!1}},async created(){},async mounted(){if($db.cache.get("reload")==="1"){$utils.gconsole.log("Home","reload()"),$db.cache.set("reload","0"),window.location.reload();return}if(!$db.app.modoOnline.le()){if($utils.emitter.on("atualizarStatusSincronismo",this.atualizarStatusSincronismo),$utils.emitter.on("atualizarStatusSincronismoPeriodico",this.atualizarStatusSincronismoPeriodico),await this.atualizar())return;this.interval=setInterval(this.atualizarPeriodico,3e4);return}this.atualizou=!0},beforeUnmount(){this.interval&&clearInterval(this.interval),$utils.emitter.off("atualizarStatusSincronismo"),$utils.emitter.off("atualizarStatusSincronismoPeriodico")}},k={id:"home"};function I(t,a,u,E,d,H){const D=p("barraTopo"),f=p("g-label"),w=p("g-col"),_=p("g-row");return i(),l("div",k,[o(v,{elevated:"",class:"bg-transparent text-white"},{default:e(()=>[o(D)]),_:1}),o(x,null,{default:e(()=>[o(z,{class:"u-container"},{default:e(()=>[t.$db.app.modoOnline.le()?b("",!0):(i(),g(_,{key:0,items:"center",justify:"center",minHeight:"calc(100vh - 50px)"},{default:e(()=>[o(w,null,{default:e(()=>[d.mensagemBancoBloqueado?(i(),g(f,{key:0,text:"body1 center medium",bg:"bg-white",class:"q-pa-sm q-mb-md rounded-borders",color:d.mensagemBancoBloqueado==="Aguarde o final do sincronismo"?"text-tertiary":"text-negative"},{default:e(()=>[r(n(d.mensagemBancoBloqueado)+" ",1),o(S,{name:"alarm",color:"white",class:"q-ml-sm"})]),_:1},8,["color"])):b("",!0),d.atualizou?(i(),l(m,{key:1},[o(B,{class:"q-pa-md",color:"none"},{default:e(()=>[o(y,{class:"text-center text-white"},{default:e(()=>[(i(!0),l(m,null,$(d.statusBancos,s=>(i(),l("p",{key:s.bancoDeDados},[s.status?s.status==="sincronismoInicial"?(i(),l(m,{key:1},[r(n(s.bancoDeDados)+" - "+n(t.$filters.numero(s.percentagem,2))+" % ",1)],64)):(i(),l(m,{key:2},[r(n(s.bancoDeDados)+" "+n(t.$filters.dataHora(s.dataHoraServidor))+" - "+n(t.$filters.numero(s.quantidadeRestantePeriodico,0))+" quantidade restante ",1)],64)):(i(),l(m,{key:0},[r(n(s.bancoDeDados)+" - verificando... ",1)],64))]))),128)),o(f,{text:"caption center",class:"q-pt-md"},{default:e(()=>[o(f,null,{default:e(()=>[r(n(d.animacao),1)]),_:1}),a[0]||(a[0]=r(" Sincronizando "))]),_:1})]),_:1})]),_:1}),o(f,{text:"body1 center medium",color:"text-white",class:"border-top q-pa-md",style:{"max-width":"500px"}},{default:e(()=>a[1]||(a[1]=[r(" Voc\xEA pode usar a parte online do sistema enquanto trazemos os dados para seu dispositivo! ")])),_:1})],64)):(i(),g(B,{key:2,class:"q-pa-md",color:"none"},{default:e(()=>[o(y,{class:"text-center text-white",style:{"min-width":"320px"}},{default:e(()=>a[2]||(a[2]=[r(" Atualizando... ")])),_:1})]),_:1}))]),_:1})]),_:1}))]),_:1})]),_:1})])}var Q=q(P,[["render",I]]);export{Q as default};
