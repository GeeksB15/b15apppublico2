import{_,r as v,o as c,p as g,f as d,w as V,d as M,e as B,H as j,P as N,F as Q,x as J,b3 as X}from"./index.0dd4573f.js";import"./xlsx.5ea1e7fc.js";import{L as G}from"./Lista.e49166d9.js";import{F as K}from"./FaturaCard.32a386ca.js";import{F as W}from"./FaturaModal.8814529d.js";import"./emitirNFe.35117289.js";import"./nfePrincipal.8b4cdbf5.js";import"./compactarValidarNFe.b986823e.js";import"./obterItens.cc72e683.js";import"./codigosANP.a6c1a264.js";import"./DocumentosFiscais.f76e7bf2.js";import"./Campo.d69109b6.js";import"./ModalHistoricoStatus.c19f0848.js";import"./VendaCard.9e1786f5.js";import"./EnvelopeCard.3b878e98.js";const Y={components:{Lista:G,FaturaCard:K,FaturaModal:W},data(){return{usuario:"",permissao:{vendedoresDigitadores:!1,outrasEmpresas:!1},carregar:!1,listaLayout:[],lista:[],mostrar:{header:!0,barraTopo:!0,toolbarTitulo:!0,icone:"request_quote",titulo:"Faturas",buscar:!0,filtroAvancado:!0,btnAjuda:!0,btnAtualizar:!0,btnNovo:!1,toolbarAcoes:!0,checkBox:!1,btnRemover:!1,btnRestaurar:!1,centralizaTabs:!1,btnDetalhes:!0,btnExportaXLS:!1,btnMenuMais:!1,toolbarAdicao:!1,bannerMsg:"",conexao:{icone:"hibrido",iconeTamanho:"xs",cor:"grey-5",rotulo:null,dica:"H\xEDbrido",denso:!0,flat:!0,escuro:!1}},busca:"",filtrosOriginal:{},filtros:{cliente:null,idEmpresa:null,idContatoVendedor:null,idContatoDigitador:null,statusEnvio:null,valorTotal:0,tipoData:"Data Emiss\xE3o",data:{ini:"",fim:""},ordenacao:"dataHoraFinalizado",direcao:"desc"},empresaOpcoes:[],vendedoresOpcoes:[],opcoesEnvio:[{value:"Enviados",label:"Enviados"},{value:"N\xE3o Enviados",label:"N\xE3o Enviados"}],opcoesData:[{value:"Data Emiss\xE3o",label:"Data Emiss\xE3o"},{value:"Data Finaliza\xE7\xE3o",label:"Data Finaliza\xE7\xE3o"}],ordenacaoOpcoes:[{value:"dataHoraFinalizado",label:"Data Finalizado"},{value:"dataHoraEmissao",label:"Data de Emiss\xE3o"}],direcaoOpcoes:[{value:"asc",label:"Crescente"},{value:"desc",label:"Decrescente"}],tabSelecionada:{valor:""},tabs:[{valor:"Aberta",rotulo:"Abertas"},{valor:"Finalizada",rotulo:"Finalizadas"},{valor:"",rotulo:"Todas"}],detalhesVisivel:!1,paginacao:{atual:1,maximo:1,total:1,limite:25}}},methods:{async atualizar(o){var t,s,l,a,u,r,p,h,b,e,D,E,L,C,F,y,q,O,w,x,S,z,k,A,I;try{$q.loading.show(),this.carregar=!1,this.qtdeItensCarregados=0,this.lista=[],this.tabSelecionadaAnt!==this.tabSelecionada.valor&&(this.paginacao.atual=1),this.tabSelecionadaAnt=this.tabSelecionada.valor;let{buscarDadosRecentes:U}=o!=null?o:{},i={},f={};U&&(i=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:"FaturaLista_"+((t=this.usuario)==null?void 0:t.id)}),i!=null&&i._id&&(this.tabSelecionada.valor=(i==null?void 0:i.tabSelecionada)||"",this.busca=(i==null?void 0:i.busca)||"",this.filtros={cliente:((s=i==null?void 0:i.filtros)==null?void 0:s.cliente)||null,idEmpresa:((l=i==null?void 0:i.filtros)==null?void 0:l.idEmpresa)||null,idContatoVendedor:((a=i==null?void 0:i.filtros)==null?void 0:a.idContatoVendedor)||null,idContatoDigitador:((u=i==null?void 0:i.filtros)==null?void 0:u.idContatoDigitador)||null,statusEnvio:((r=i==null?void 0:i.filtros)==null?void 0:r.statusEnvio)||null,valorTotal:((p=i==null?void 0:i.filtros)==null?void 0:p.valorTotal)||0,tipoData:((h=i==null?void 0:i.filtros)==null?void 0:h.tipoData)||"Data Emiss\xE3o",data:{ini:((e=(b=i==null?void 0:i.filtros)==null?void 0:b.data)==null?void 0:e.ini)||"",fim:((E=(D=i==null?void 0:i.filtros)==null?void 0:D.data)==null?void 0:E.fim)||""},ordenacao:((L=i==null?void 0:i.filtros)==null?void 0:L.ordenacao)||"dataHoraFinalizado",direcao:((C=i==null?void 0:i.filtros)==null?void 0:C.direcao)||"desc"},this.compareObject(this.filtrosOriginal,this.filtros,["ordenacao","direcao"])&&(this.$refs.faturaLista.filtros=!0))),this.filtros.cliente=(y=(F=this.filtros)==null?void 0:F.cliente)==null?void 0:y.trim(),this.filtros=$utils.eliminarVazios(this.filtros),this.filtros.status=this.tabSelecionada.valor,f=$utils.clonarV2(this.filtros),this.filtros.tipoData==="Data Emiss\xE3o"&&(f.periodo={dataIni:(O=(q=this.filtros)==null?void 0:q.data)==null?void 0:O.ini,dataFim:(x=(w=this.filtros)==null?void 0:w.data)==null?void 0:x.fim}),this.filtros.tipoData==="Data Finaliza\xE7\xE3o"&&(f.finalizado={dataIni:(z=(S=this.filtros)==null?void 0:S.data)==null?void 0:z.ini,dataFim:(A=(k=this.filtros)==null?void 0:k.data)==null?void 0:A.fim}),this.permissao.vendedoresDigitadores||(f.idContatoVendedor=this.usuario.id),delete f.tipoData,delete f.data,this.busca&&(this.paginacao.atual=1,/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/.test(this.busca)?(this.tabSelecionada.valor="",this.filtros.status="",f={status:"",idFatura:this.busca}):f.termoBusca=this.busca);const H=[this.filtros.ordenacao],P=[this.filtros.direcao],n=await $db.fatura.leListaCompleta({filtros:f,page:this.paginacao.atual,limit:this.paginacao.limite,sort:H,dir:P});let T=!0;for(const m of n==null?void 0:n.data)this.listaLayout.hasOwnProperty(m.id)||(this.listaLayout[m.id]={detalhes:!1}),this.listaLayout[m.id].detalhes||(T=!1);this.$refs.faturaLista.detalhes=(I=n==null?void 0:n.data)!=null&&I.length?T:!1,this.lista=n==null?void 0:n.data,this.paginacao.total=n==null?void 0:n.total,this.paginacao.maximo=n==null?void 0:n.totalPages,i={_id:"FaturaLista_"+this.usuario.id,tabSelecionada:this.tabSelecionada.valor,busca:this.busca||"",filtros:$utils.clonarV2(this.filtros)},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:i})}catch{$q.notify({message:"Erro ao carregar faturas.",type:"negative"}),$q.loading.hide()}finally{this.lista.length===0&&$q.loading.hide()}},async executar(o){if(this.$refs.faturaModal.venda.status){for(const t of this.tabs)if(t.valor.indexOf(this.$refs.faturaModal.venda.status)!==-1){this.tabSelecionada.valor=t.valor;break}this.$refs.faturaModal.venda.status==="Or\xE7amento"&&(this.filtros.data="Data Emiss\xE3o")}await this.atualizar()},detalhesClick(){this.detalhesVisivel=!this.detalhesVisivel,this.lista.forEach(o=>{this.$refs[o.id][0].detalhesVisivel=this.detalhesVisivel,this.listaLayout[o.id].detalhes=this.detalhesVisivel})},verificarListaLayout(o){let{id:t,acao:s,estado:l}=o!=null?o:{};if(s="detalhes"){let a=!0;t&&(this.listaLayout[t].detalhes=l!=null?l:!this.listaLayout[t].detalhes);for(const u of this.lista)this.listaLayout[u.id].detalhes&&(this.$refs[u.id][0].detalhesVisivel=!0),this.listaLayout[u.id].detalhes||(a=!1);this.detalhesVisivel=a,this.$refs.faturaLista.detalhes=a}},async limparFiltrosClick(){this.filtros=$utils.clonar(this.filtrosOriginal),await this.atualizar()},async configurarPermissao(){this.permissao={vendedoresDigitadores:await $db.permissao.objeto("Diretiva_RelatorioVenda_VerTodos"),outrasEmpresas:await $db.permissao.objeto("Diretiva_Venda/Fatura_OutrasLojas_VerTodos")}},async configurarVendedores(){const o=(await $db.contato.ler({filtros:{ativo:!0,vendedores:!0}})).data;o==null||o.sort((t,s)=>{var l;return(l=t==null?void 0:t.nome)==null?void 0:l.localeCompare(s==null?void 0:s.nome)}),o.forEach(t=>{this.vendedoresOpcoes.push({label:t.nome,value:t.id})})},async configurarEmpresas(){const o=[];let t=[];if(!this.permissao.outrasEmpresas){t=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;for(const s of t)o.push({label:s.nome,value:s.id})}if(this.permissao.outrasEmpresas){t=await $db.empresa.ler({filtro:{ativo:!0}});for(const s of t)o.push({label:s.nome,value:s.idContato})}this.empresaOpcoes=o==null?void 0:o.sort((s,l)=>{var a;return(a=s==null?void 0:s.label)==null?void 0:a.localeCompare(l==null?void 0:l.label)})},async abrirModalContatos(){const o=await $g.promptContato.show({filtro:{ativo:!0}});!(o!=null&&o.id)||(this.filtros.cliente=o.nome)},compareObject(o,t,s=[]){const l=Object.keys(o);for(const a of l)if(!s.includes(a)){if(typeof o[a]=="object"&&o[a]!==null){if(!this.compareObject(o[a],t[a],s))continue;return!0}else if(o[a]!==t[a])return!0}return!1},async abrirItem(o){this.$router.replace({params:{id:o}}).finally(()=>{this.$refs.faturaModal.mostrar({id:o})})},carregou(){this.qtdeItensCarregados=this.qtdeItensCarregados+1,this.qtdeItensCarregados===this.lista.length&&(this.carregar=!0,this.verificarListaLayout({acao:"detalhes"}),$q.loading.hide())}},async created(){this.usuario=JSON.parse(localStorage.getItem("usuario")),this.filtrosOriginal=$utils.clonar(this.filtros),await this.configurarPermissao(),await this.configurarVendedores(),await this.configurarEmpresas(),this.$route.params.id&&this.$route.params.id.length?(this.abrirItem(this.$route.params.id),this.busca=this.$route.params.id,await this.atualizar()):await this.atualizar({buscarDadosRecentes:!0})}},Z={id:"FaturaLista"};function $(o,t,s,l,a,u){const r=v("campo"),p=v("FaturaCard"),h=v("Lista"),b=v("fatura-modal");return c(),g("div",Z,[d(h,{ref:"faturaLista",busca:a.busca,"onUpdate:busca":t[12]||(t[12]=e=>a.busca=e),onAtualizar:u.atualizar,onLimparFiltrosClick:u.limparFiltrosClick,onDetalhesClick:u.detalhesClick,lista:a.lista,tabSelecionada:a.tabSelecionada,tabs:a.tabs,paginacao:a.paginacao,mostrar:a.mostrar},{filtroCampos:V(()=>[d(r,{modelValue:a.filtros.cliente,"onUpdate:modelValue":t[0]||(t[0]=e=>a.filtros.cliente=e),debounce:500,dense:"",rotulo:"Por cliente ou respons\xE1vel",before:[{icon:"search",handler:u.abrirModalContatos}],somenteLeitura:"",class:"q-mt-sm"},null,8,["modelValue","before"]),d(r,{modelValue:a.filtros.idEmpresa,"onUpdate:modelValue":t[1]||(t[1]=e=>a.filtros.idEmpresa=e),options:a.empresaOpcoes,clearable:"",dense:"",tipo:"seletor",rotulo:"Por empresa",class:"q-mt-lg"},null,8,["modelValue","options"]),a.permissao.vendedoresDigitadores?(c(),M(r,{key:0,modelValue:a.filtros.idContatoVendedor,"onUpdate:modelValue":t[2]||(t[2]=e=>a.filtros.idContatoVendedor=e),options:a.vendedoresOpcoes,clearable:"",dense:"",tipo:"seletor",rotulo:"Vendedor",class:"q-mt-lg"},null,8,["modelValue","options"])):B("",!0),a.permissao.vendedoresDigitadores?(c(),M(r,{key:1,modelValue:a.filtros.idContatoDigitador,"onUpdate:modelValue":t[3]||(t[3]=e=>a.filtros.idContatoDigitador=e),options:a.vendedoresOpcoes,clearable:"",dense:"",tipo:"seletor",rotulo:"Digitador",class:"q-mt-lg"},null,8,["modelValue","options"])):B("",!0),d(r,{modelValue:a.filtros.statusEnvio,"onUpdate:modelValue":t[4]||(t[4]=e=>a.filtros.statusEnvio=e),options:a.opcoesEnvio,clearable:"",dense:"",tipo:"seletor",rotulo:"Status Envio",class:"q-mt-lg"},null,8,["modelValue","options"]),d(r,{modelValue:a.filtros.valorTotal,"onUpdate:modelValue":t[5]||(t[5]=e=>a.filtros.valorTotal=e),debounce:500,dense:"",tipo:"decimal",min:"0",decimals:"4",zerosDireita:"2",rotulo:"Valor total maior que",class:"q-mt-lg"},null,8,["modelValue"]),d(r,{modelValue:a.filtros.tipoData,"onUpdate:modelValue":t[6]||(t[6]=e=>a.filtros.tipoData=e),options:a.opcoesData,tipo:"seletor",dense:"",rotulo:"Selecionar data para filtro",class:"q-mt-xl"},null,8,["modelValue","options"]),d(r,{modelValue:a.filtros.data.ini,"onUpdate:modelValue":t[7]||(t[7]=e=>a.filtros.data.ini=e),clearable:"",dense:"",tipo:"data",rotulo:"Emiss\xE3o de",class:"q-mt-md"},null,8,["modelValue"]),d(r,{modelValue:a.filtros.data.fim,"onUpdate:modelValue":t[8]||(t[8]=e=>a.filtros.data.fim=e),clearable:"",dense:"",tipo:"data",rotulo:"Emiss\xE3o at\xE9",class:"q-mt-xs"},null,8,["modelValue"]),d(r,{modelValue:a.filtros.ordenacao,"onUpdate:modelValue":t[9]||(t[9]=e=>a.filtros.ordenacao=e),options:a.ordenacaoOpcoes,dense:"",rotuloFixo:"Ordenar por",tipo:"seletor",class:"q-mt-xl"},null,8,["modelValue","options"]),d(r,{modelValue:a.filtros.direcao,"onUpdate:modelValue":t[10]||(t[10]=e=>a.filtros.direcao=e),options:a.direcaoOpcoes,dense:"",rotuloFixo:"Dire\xE7\xE3o",tipo:"seletor",class:"q-mt-sm"},null,8,["modelValue","options"]),d(r,{modelValue:a.paginacao.limite,"onUpdate:modelValue":t[11]||(t[11]=e=>a.paginacao.limite=e),tipo:"quantidade",dense:"",rotulo:"Quantidade por p\xE1gina",min:"1",class:"q-mt-xl q-mb-md"},null,8,["modelValue"])]),itemLista:V(()=>[j(d(N,{bordered:"",class:"bg-white q-mb-xs rounded-borders"},{default:V(()=>[(c(!0),g(Q,null,J(a.lista,e=>(c(),g("div",{key:e.id,class:"itemHover"},[d(p,{onExecutar:u.executar,onCarregou:u.carregou,ref_for:!0,ref:e.id,onVerificarListaLayout:u.verificarListaLayout,id:e.id,layout:"lista"},null,8,["onExecutar","onCarregou","onVerificarListaLayout","id"])]))),128))]),_:1},512),[[X,a.carregar]])]),_:1},8,["busca","onAtualizar","onLimparFiltrosClick","onDetalhesClick","lista","tabSelecionada","tabs","paginacao","mostrar"]),d(b,{ref:"faturaModal"},null,512)])}var pa=_(Y,[["render",$]]);export{pa as default};
