import{_ as I,a as O,bu as j,r as D,o as f,p as P,f as e,w as r,H as F,d as v,S as N,T as u,j as w,k as p,N as L,e as C,P as U,F as J,u as X,C as E,U as k,t as S,m as z,Q as q,bg as B,l as T,z as H,h as Q,i as Y,O as Z,E as G,au as W,D as K}from"./index.e29ebbcd.js";import{X as A}from"./xlsx.ba54a6c1.js";import{L as aa}from"./Lista.68a2ff82.js";import{N as oa}from"./Nfse.bb2898c4.js";import{J as ea}from"./JsonViewer.085cea09.js";import"./optionsNfse.12d4a18d.js";const ta={components:{Lista:aa,Nfse:oa,JsonViewer:ea},data(){return{usuario:"",lista:[],mostrar:{barraTopo:!0,toolbarTitulo:!0,icone:"mdi-file-replace-outline",titulo:"NFS-e",buscar:!0,filtroAvancado:!0,btnAjuda:!0,btnAtualizar:!0,btnNovo:!0,toolbarAcoes:!0,checkBox:!1,btnRemover:!1,btnRestaurar:!1,centralizaTabs:!1,btnDetalhes:!0,btnExportaXLS:!1,btnMenuMais:!0,toolbarAdicao:!1,bannerMsg:""},checkBox:!0,busca:"",im:"",tabSelecionada:{valor:"Rascunho"},tabs:[{valor:"Rascunho",rotulo:"Rascunho"},{valor:"Protocolada",rotulo:"Protocoladas"},{valor:"Enviada",rotulo:"Enviadas"},{valor:"Cancelada",rotulo:"Canceladas"},{valor:"Todos",rotulo:"Todos"}],filtrosOriginal:{},filtros:{emitente:null,destinatario:null,numeroRps:null,numeroNfse:null,dataEmissaoNfseDe:null,dataEmissaoNfseAte:null,dataCriacaoRpsDe:null,dataCriacaoRpsAte:null},paginacao:{atual:1,maximo:1,total:1,limite:25,ordenacao:"dataEmissao",direcao:"desc"},dialogoSincronizarLote:{visivel:!1,empresa:null,listaEmpresas:[],periodoInicial:null,periodoFinal:null}}},computed:{ordenacaoOpcoes(){return[{value:"dataEmissao",label:"Data de emiss\xE3o"},{value:"dataHoraCriacao",label:"Data de cria\xE7\xE3o"},{value:"numeroRps",label:"RPS (Recibo provis\xF3rio)"},{value:"numeroNfse",label:"N\xFAmero NFS-e"},{value:"xNomeEmitente",label:"Emitente"},{value:"xNomeDestinatario",label:"Destinat\xE1rio"},{value:"valor",label:"Valor"}]},direcaoOpcoes(){return[{value:"asc",label:"Crescente"},{value:"desc",label:"Decrescente"}]}},methods:{async atualizar(t){var i,n,c,m,d,g,b,h,y,_,R;const o=$utils.logarIni("NfseLista");let l=(t==null?void 0:t.buscarDadosRecentes)||!1,a={};l&&(a=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:"NfseLista_"+((i=this.usuario)==null?void 0:i.id)}),a!=null&&a._id&&(this.tabSelecionada.valor=a==null?void 0:a.tabSelecionada,this.busca=(a==null?void 0:a.busca)||"",this.filtros={emitente:((n=a==null?void 0:a.filtros)==null?void 0:n.emitente)||null,destinatario:((c=a==null?void 0:a.filtros)==null?void 0:c.destinatario)||null,numeroRps:((m=a==null?void 0:a.filtros)==null?void 0:m.numeroRps)||null,numeroNfse:((d=a==null?void 0:a.filtros)==null?void 0:d.numeroNfse)||null,dataEmissaoNfseDe:((g=a==null?void 0:a.filtros)==null?void 0:g.dataEmissaoNfseDe)||null,dataEmissaoNfseAte:((b=a==null?void 0:a.filtros)==null?void 0:b.dataEmissaoNfseAte)||null,dataCriacaoRpsDe:((h=a==null?void 0:a.filtros)==null?void 0:h.dataCriacaoRpsDe)||null,dataCriacaoRpsAte:((y=a==null?void 0:a.filtros)==null?void 0:y.dataCriacaoRpsAte)||null},this.compareObject(this.filtrosOriginal,this.filtros)&&(this.$refs.nfseLista.filtros=!0))),await $tryLoading(async()=>$db.hibrido.isOnline()?this.atualizarOnline(t):this.atualizarOffline(t)),a={_id:"NfseLista_"+this.usuario.id,tabSelecionada:this.tabSelecionada.valor,busca:this.busca,filtros:$utils.clonar(this.filtros)},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:a}),$utils.logarFim(o,(R=(_=this.paginacao)==null?void 0:_.total)!=null?R:1)},async atualizarOffline(t){this.documentos=await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{tipo:"NFSe"}});for(const a of this.documentos){const{rps:i}=JSON.parse(a.json);a.rps=i,a.showPreviewDetail=this.showPreviewDetail}const o=this.paginacao.direcao==="asc"?1:-1,l={numeroRps:(a,i)=>{var n,c;return(Number(((n=a.rps.identificacaoRps)==null?void 0:n.numero)||0)-Number(((c=i.rps.identificacaoRps)==null?void 0:c.numero)||0))*o},numeroNfse:(a,i)=>(Number(a.rps.numero||0)-Number(i.rps.numero||0))*o,valor:(a,i)=>{var n,c,m,d;return(Number(((c=(n=a.rps.servico)==null?void 0:n.valores)==null?void 0:c.valorServicos)||0)-Number(((d=(m=i.rps.servico)==null?void 0:m.valores)==null?void 0:d.valorServicos)||0))*o},dataEmissao:(a,i)=>(new Date(a.rps.dataEmissao||0)-new Date(i.rps.dataEmissao||0))*o,dataHoraCriacao:(a,i)=>(new Date(a.rps.dataHoraCriacao||0)-new Date(i.rps.dataHoraCriacao||0))*o,xNomeEmitente:(a,i)=>String(a.xNomeEmitente).localeCompare(String(i.xNomeEmitente))*o,xNomeDestinatario:(a,i)=>String(a.xNomeDestinatario).localeCompare(String(i.xNomeDestinatario))*o}[this.paginacao.ordenacao];if(this.documentos=this.documentos.sort(l),(t==null?void 0:t.id)&&(t==null?void 0:t.situacaoNfse)==="Enviada"){await this.aplicarFiltrosEPaginacao(t);return}await this.aplicarFiltrosEPaginacao()},async atualizarOnline(t){this.filtros.situacao=this.tabSelecionada.valor==="Todos"?null:this.tabSelecionada.valor;const o={numeroRps:"cast(JSON_VALUE(json, '$.rps.identificacaoRps.numero') as int)",numeroNfse:"cast(JSON_VALUE(json, '$.rps.numero') as int)",dataEmissao:"JSON_VALUE(json, '$.rps.dataEmissao')",dataHoraCriacao:"JSON_VALUE(json, '$.rps.dataHoraCriacao')",valor:"cast(JSON_VALUE(json, '$.rps.servico.valores.valorServicos') as decimal(10,2))"}[this.paginacao.ordenacao]||this.paginacao.ordenacao,l=await $utils.geeksApi({listaNfse:{funcao:"C79B2497-0D9C-4971-8656-2C04FF41F247",where:{...this.filtros,destinatario:this.filtros.destinatario||this.busca,id:t==null?void 0:t.id},limit:this.paginacao.limite,page:this.paginacao.atual,sort:[o],dir:[this.paginacao.direcao]}}),{data:a,total:i,totalPages:n}=l.data.listaNfse;for(const c of a)c.showPreviewDetail=this.showPreviewDetail;this.lista=a,this.paginacao.total=i,this.paginacao.maximo=n},async mostrarNfse(t){this.$router.replace({params:{id:t}}),await this.$refs.modalNfse.show(t)},async selecionarEmpresa(){let t;const o={ativo:!0,empresas:!0},l=await $g.promptContato.show({filtro:o,placeholder:"Selecione"});if(!l)throw new Error("Nenhum contato selecionado");l.nome||(t="\xC9 preciso informar a Raz\xE3o Social do Prestador"),!t&&!l.numeroDocumentoMunicipal&&(t="\xC9 preciso informar a inscri\xE7\xE3o municipal");const a=!l.numeroDocumentoNacional||l.numeroDocumentoNacional.length<14;if(!t&&a&&(t="\xC9 preciso informar o CNPJ do Prestador"),t)throw $q.notifyError(t),new Error(t);return l},async criarRps(){var t;try{const o=await this.selecionarEmpresa(),l=(await $db.empresa.le({idContato:o.id}))[0],a=await $db.contatoEndereco.leEnderecoPrincipal(o.id),i={documento:o.numeroDocumentoNacional.match(/\d+/g).join(""),nome:o.nome,inscricaoMunicipal:o.numeroDocumentoMunicipal,nfseOptanteSimples:(l==null?void 0:l.nfseOptanteSimples)||"",nfseIncentivadorCultural:(l==null?void 0:l.nfseIncentivadorCultural)||"",nfseNaturezaOperacao:(l==null?void 0:l.nfseNaturezaOperacao)||"",nfseRegimeTributario:(l==null?void 0:l.nfseRegimeTributario)||"",nfseDescricaoServico:(l==null?void 0:l.nfseDescricaoServico)||"",nfseCodigoServico:(l==null?void 0:l.nfseCodigoServico)||"",nfseAliquotaIss:l==null?void 0:l.nfseAliquotaIss,nfseItensListaDeServico:JSON.parse(l==null?void 0:l.nfseItensListaDeServico)||"",ibgeCod:(a==null?void 0:a.ibgeCod)||"",cidadeUf:(a==null?void 0:a.municipio)+"-"+(a==null?void 0:a.uf)};this.im=(t=o==null?void 0:o.numeroDocumentoMunicipal)!=null?t:"";const n=await this.obterNFSeRPSMaisRecente();$utils.gconsole.log("NfseLista",{im:this.im,nfseRPSMaisRecente:n}),this.$refs.modalNfse.show(null,i,n)}catch(o){console.log(o.message)}},async obterNFSeRPSMaisRecente(){var t,o;if($db.hibrido.isOnline()){const l=await $utils.geeksApi({listaNfse:{funcao:"C79B2497-0D9C-4971-8656-2C04FF41F247",where:{inscricaoMunicipal:this.im},limit:1,page:1,sort:["JSON_VALUE(json, '$.rps.identificacaoRps.numero')"],dir:["desc"]}}),{data:a}=l.data.listaNfse;return(t=a[0])!=null?t:null}else{let l;l=await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{tipo:"NFSe"}}),this.im&&(l=l.filter(i=>JSON.parse(i.json).rps.inscricaoMunicipal===this.im)),l.sort((i,n)=>{var d,g,b,h,y,_,R,V;const c=Number((h=(b=(g=JSON.parse((d=i.json)!=null?d:null))==null?void 0:g.rps)==null?void 0:b.identificacaoRps)==null?void 0:h.numero),m=Number((V=(R=(_=JSON.parse((y=n.json)!=null?y:null))==null?void 0:_.rps)==null?void 0:R.identificacaoRps)==null?void 0:V.numero);return c>m?-1:1});const a=(o=l[0])!=null?o:null;return a!=null&&a.json&&(a.rps=JSON.parse(a.json).rps),a}},async aplicarFiltrosEPaginacao(t){if(this.aplicarFiltroPelaTab({situacaoNfse:t==null?void 0:t.situacaoNfse}),t!=null&&t.id&&(this.busca=t==null?void 0:t.id),/^[A-F|0-9]{8}-[A-F|0-9]{4}-[A-F|0-9]{4}-[A-F|0-9]{4}-[A-F|0-9]{12}$/.test(this.busca)){this.paginacao.atual=1,this.paginacao.maximo=1,this.paginacao.total=1,this.listaTmp=this.listaTmp.filter(a=>a.id===this.busca),this.lista=this.listaTmp;return}if(this.filtros.emitente){const a=new RegExp(this.filtros.emitente,"i");this.listaTmp=this.listaTmp.filter(i=>a.test(i.xNomeEmitente))}if(this.filtros.destinatario||this.busca){const a=this.busca||this.filtros.destinatario,i=new RegExp(a,"i");this.listaTmp=this.listaTmp.filter(n=>i.test(n.xNomeDestinatario))}if(this.filtros.numeroRps){const a=new RegExp(this.filtros.numeroRps);this.listaTmp=this.listaTmp.filter(i=>a.test(i.rps.identificacaoRps.numero))}if(this.filtros.numeroNfse&&(this.listaTmp=this.listaTmp.filter(a=>a.rps.numero===this.filtros.numeroNfse)),this.filtros.dataEmissaoNfseDe&&this.filtros.dataEmissaoNfseDe.length===10){const a=this.filtros.dataEmissaoNfseDe.split("/"),i=new Date(Number(a[2]),Number(a[1])-1,Number(a[0]));this.listaTmp=this.listaTmp.filter(n=>new Date(new Date(n.rps.dataEmissao).toDateString())>=i)}if(this.filtros.dataEmissaoNfseAte&&this.filtros.dataEmissaoNfseAte.length===10){const a=this.filtros.dataEmissaoNfseAte.split("/"),i=new Date(Number(a[2]),Number(a[1])-1,Number(a[0]));this.listaTmp=this.listaTmp.filter(n=>new Date(new Date(n.rps.dataEmissao).toDateString())<=i)}if(this.filtros.dataCriacaoRpsDe&&this.filtros.dataCriacaoRpsDe.length===10){const a=this.filtros.dataCriacaoRpsDe.split("/"),i=new Date(Number(a[2]),Number(a[1])-1,Number(a[0]));this.listaTmp=this.listaTmp.filter(n=>new Date(new Date(n.rps.dataHoraCriacao).toDateString())>=i)}if(this.filtros.dataCriacaoRpsAte&&this.filtros.dataCriacaoRpsAte.length===10){const a=this.filtros.dataCriacaoRpsAte.split("/"),i=new Date(Number(a[2]),Number(a[1])-1,Number(a[0]));this.listaTmp=this.listaTmp.filter(n=>new Date(new Date(n.rps.dataHoraCriacao).toDateString())<=i)}this.setupPaginacao();const o=this.paginacao.atual*this.paginacao.limite-this.paginacao.limite,l=this.paginacao.atual*this.paginacao.limite;this.lista=this.listaTmp.slice(o,l)},aplicarFiltroPelaTab(t){if(t!=null&&t.situacaoNfse&&(this.tabSelecionada={valor:t.situacaoNfse}),this.tabSelecionada.valor==="Todos"){this.listaTmp=this.documentos;return}const o=this.tabSelecionada.valor;this.listaTmp=this.documentos.filter(l=>l.situacao===o)},setupPaginacao(){const t=Math.ceil(this.listaTmp.length/this.paginacao.limite);this.paginacao.atual=this.paginacao.atual>t?t:this.paginacao.atual,this.paginacao.total=this.listaTmp.length,this.paginacao.maximo=t},async limparFiltrosClick(){this.filtros=$utils.clonar(this.filtrosOriginal),await this.atualizar()},detalhesClick(){this.showPreviewDetail=!this.showPreviewDetail;for(const t of this.lista)t.showPreviewDetail=this.showPreviewDetail},async exportaXLSClick(){try{$q.loading.show();const t=$utils.eliminarVazios(this.filtros);delete t.ativo,this.tabSelecionada.valor==="Ativos"&&(t.ativo=!0),this.tabSelecionada.valor==="Excluidos"&&(t.ativo=!1);const o=await $db.item.leRefatorado({filtros:t,limit:999999,page:1,sort:"descricao"}),l=A.utils.book_new(),a=A.utils.json_to_sheet(o.data,{header:Object.keys(o.data[0])});A.utils.book_append_sheet(l,a,"itens"),A.writeFile(l,"itens.xlsx")}catch(t){$q.notifyError("Erro iniciar",t)}finally{$q.loading.hide()}},abrirModalDeCancelamento(t){$q.dialog({title:"Cancelar NFS-e",message:"Qual o motivo do cancelamento?",prompt:{model:"",isValid:o=>!!o},cancel:!0,persistent:!0}).onOk(async o=>{const{rps:l}=t,a={numero:l.numero,motivoCancelamento:o,inscricaoMunicipal:l.prestador.inscricaoMunicipal,cnpj:l.prestador.documento,codigoMunicipio:l.servico.municipioPrestacaoServico,codigoCancelamento:5};await this.cancelarNfse(a,t)})},async cancelarNfse(t,o){var l,a,i,n,c;this.$q.loading.show();try{if((l=o.rps)!=null&&l.plugNotasConsulta){console.log("cancelamento via plugNotas");const m={motivo:t.motivoCancelamento},d=await $api.plugnotas.nfse.solicitarCancelamentoNFSe((a=o.rps.plugNotasConsulta)==null?void 0:a.id,m);if((d==null?void 0:d.message)==="Cancelamento em processamento"&&((i=d==null?void 0:d.data)==null?void 0:i.protocol))if((await $api.plugnotas.nfse.consultarCancelamentoNFSe((n=d==null?void 0:d.data)==null?void 0:n.protocol)).data.status==="CONCLUIDO"){o.rps.motivoCancelamento=t.motivoCancelamento,o.rps.status="2";const b={...o,situacao:"Cancelada",json:JSON.stringify({rps:o.rps})};await $db.documentoFiscalEletronico.grava({atual:b,original:o});let h={};b.id&&(h=(await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:b.id}}))[0],await $db.documentoFiscalEletronicoXml.grava({atual:{...h,situacao:b.situacao},original:h})),$q.notifyPositive("NFS-e cancelada!")}else $q.notifyError("N\xE3o foi poss\xEDvel realizar o cancelamento, por favor tente novamente!")}if(!((c=o.rps)!=null&&c.plugNotasConsulta))if((await O.post("https://api.b15.com.br/integradorjs/nfse/cancelar",{jsonParaXML:t})).data.xmlPassou){$q.notifyPositive("NFS-e cancelada!"),o.rps.motivoCancelamento=t.motivoCancelamento,o.rps.status="2";const d={...o,situacao:"Cancelada",json:JSON.stringify({rps:o.rps})};await $db.documentoFiscalEletronico.grava({atual:d,original:o});let g={};d.id&&(g=(await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:d.id}}))[0],await $db.documentoFiscalEletronicoXml.grava({atual:{...g,situacao:d.situacao},original:g}))}else $q.notifyError("N\xE3o foi poss\xEDvel realizar o cancelamento, por favor tente novamente!")}catch{$q.notifyError("Falha ao enviar XML")}await this.atualizar(),this.$q.loading.hide()},confirmarExclusaoNfse(t){$q.dialog({title:"Remover NFS-e",message:"Deseja remover esta NFS-e?",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{await $db.documentoFiscalEletronico.remove(t),$q.notifyPositive("NFS-e removida com sucesso")}catch{$q.notifyError("Falha ao remover NFS-e")}await this.atualizar()})},async downloadPDF(t){var a;let o=await $db.hibrido.le({table:"documentoFiscalEletronico",id:t}),l=JSON.parse((a=o==null?void 0:o.json)!=null?a:null);try{$q.loading.show({message:"Solicitando URL...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"}),l.rps.pdf=await $db.nfse.solicitarURLImpressao(t);let i=document.createElement("a");i.href=l.rps.pdf,i.download=`nfse-${l.rps.identificacaoRps.numero}.pdf`,i.click()}catch(i){console.error(i.message)}finally{$q.loading.hide()}},async solicitarURLImpressao(t){var i,n,c;let o=await $db.hibrido.le({table:"documentoFiscalEletronico",id:t}),l=JSON.parse((i=o==null?void 0:o.json)!=null?i:null),a;try{$q.loading.show({message:"Solicitando URL...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"}),a=await $db.nfse.solicitarURLImpressao(t),(n=l==null?void 0:l.rps)!=null&&n.plugNotasConsulta&&window.open("","_blank").document.write(`<iframe width='100%' height='100%' src='${a}'></iframe>`),(c=l==null?void 0:l.rps)!=null&&c.plugNotasConsulta||window.open(a,"_blank"),await this.atualizar()}catch(m){let d=m.message.replace("db.nfse.sincronizarLote: ","");d.length!==m.message&&$q.notifyError(d),d.length===m.message&&console.error(m.message)}finally{$q.loading.hide()}},async solicitarURLImpressaoEmLote(){var o;const t=$utils.clonarV2(this.lista.filter(l=>l.situacao==="Enviada"));t.sort((l,a)=>{var c,m,d,g;const i=(m=(c=l==null?void 0:l.rps)==null?void 0:c.identificacaoRps)==null?void 0:m.numero,n=(g=(d=a==null?void 0:a.rps)==null?void 0:d.identificacaoRps)==null?void 0:g.numero;return i>n?1:-1});for(const l of t)try{let a=await $db.hibrido.le({table:"documentoFiscalEletronico",id:l.id}),i=JSON.parse((o=a==null?void 0:a.json)!=null?o:null),n;n=await $db.nfse.solicitarURLImpressao(l.id)}catch(a){console.log(a.message)}},async baixarXml(t){var a,i;let{xml:o}=t.rps;if((!o||/^https:\/\/.+$/.test(o))&&((i=(a=t.rps)==null?void 0:a.plugNotasConsulta)==null?void 0:i.xml)){const n=t.rps.plugNotasConsulta.xml;o=await $api.plugnotas.nfse.baixarXmlNFSe(n,t)}if(o){const n=document.createElement("a");var l=new Blob([o],{type:"text/plain"});n.setAttribute("href",window.URL.createObjectURL(l)),n.setAttribute("download",`${t.rps.identificacaoRps.numero}.xml`),n.dataset.downloadurl=["text/plain",n.download,n.href].join(":"),n.click()}o||this.$q.notifyError("N\xE3o foi poss\xEDvel recuperar o XML")},async recarregarPDF(t){var i,n,c;let o=await $db.hibrido.le({table:"documentoFiscalEletronico",id:t}),l=$utils.clonarV2(o),a=JSON.parse((i=o==null?void 0:o.json)!=null?i:null);(n=a.rps.plugNotasConsulta)!=null&&n.pdf&&((c=a.rps.plugNotasConsulta)==null||delete c.pdf),a.rps.pdf&&delete a.rps.pdf,o.json=a,await $db.documentoFiscalEletronico.grava({atual:o,original:l}),this.solicitarURLImpressao(t)},async enviarEmailNfse(t){var o,l;try{if(this.$q.loading.show(),!t.cpfCnpjDestinatario||!t.id)return;const a=await $db.hibrido.le({table:"documentoFiscalEletronico",id:t.id});if(!(a!=null&&a.id))return;const n=(await $db.contato.ler({filtros:{termoBusca:a.cpfCnpjDestinatario,ativo:!0}})).data.find(b=>{var h;return((h=b.numeroDocumentoNacional)!=null?h:"").replace(/\D/g,"")===a.cpfCnpjDestinatario}),c=(l=JSON.parse((o=a.json)!=null?o:null))==null?void 0:l.rps;if(!c)return;let m;this.$q.loading.hide();try{m=await new Promise((b,h)=>{var y;$q.dialog({title:"Informe o e-mail",message:"E-mail do destinat\xE1rio",prompt:{model:(y=n==null?void 0:n.email)!=null?y:"",isValid:_=>/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(_.toLowerCase()),type:"text"},cancel:!0,persistent:!1}).onOk(_=>{b(_)}).onCancel(()=>{h("Cancelado pelo usu\xE1rio")}).onDismiss(()=>{h("Cancelado pelo usu\xE1rio")})}).catch(b=>{throw new Error(b)})}catch(b){console.log(b.message);return}this.$q.loading.show();const d=[{name:"nfse.xml",content:c.xml}];c.link&&d.push({name:"nfse.pdf",url:c.link,method:"url2pdf"});const g={host:"smtp.gmail.com",port:587,ssl:!0,auth:{user:"auto@geekssolucoes.com.br",pass:"xpto@9@9"},from:"Geeks Solu\xE7\xF5es <auto@geekssolucoes.com.br>",to:m,subject:`Nota Fiscal Eletr\xF4nica de Servi\xE7os N\xBA ${c.numero}`,text:`Voc\xEA est\xE1 recebendo os arquivos digitais NFS-e (Nota Fiscal Eletr\xF4nica de Servi\xE7os) da empresa ${a.xNomeEmitente}`,attachments:d};await O({baseURL:"https://api.b15.com.br",method:"post",url:"/email/v2",data:g}),this.$q.notifyPositive("E-mail enviado com sucesso")}catch{this.$q.notifyError("Erro ao enviar email")}finally{this.$q.loading.hide()}},async enviarLote(){var t,o;try{$q.loading.show({message:"Preparando envio do lote...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"});const l=$utils.clonarV2(this.lista.filter(a=>a.situacao==="Rascunho"));$utils.gconsole.log("NFSeEnviaLote",`Inicio envio de lote com ${l.length} notas`);for(const a of l){const i=(await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:a.id}}))[0],n=a.rps;n!=null&&n.dataEmissao||(n.dataEmissao=$utils.dataAtual()),$q.loading.show({message:`Enviando...
                <br /><br />
                <strong>Lote</strong> ${n.numeroLote}<br />
                <strong>RPS</strong> ${n.identificacaoRps.numero}<br />
                <strong>S\xE9rie</strong> ${n.identificacaoRps.serie}<br />
                <br />
                ${n.tomador.razaoSocial}`,html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"}),$utils.gconsole.log("NFSeEnviaLote",`rps:${(t=n==null?void 0:n.identificacaoRps)==null?void 0:t.numero} tomador:${n.tomador.razaoSocial}`);const{nfse:c,situacao:m}=await $db.nfse.emitir({nfse:n,aguardarRetorno:!1}),d={id:a.id,tipo:"NFSe",tpAmb:"2",situacao:m,mod:"",serie:"",nNF:"",chNFe:"",vNF:0,dhEmi:j.formatarDataNFe(new Date((o=this.nfse)==null?void 0:o.dataEmissao)),cpfCnpjEmitente:c.prestador.documento,xNomeEmitente:c.prestador.razaoSocial,cpfCnpjDestinatario:c.tomador.documento,xNomeDestinatario:c.tomador.razaoSocial,dataHoraEmissao:c==null?void 0:c.dataEmissao,dataHoraCriacao:a.dataHoraCriacao||$utils.dataAtual(),json:JSON.stringify({rps:c})},g={id:(i==null?void 0:i.id)||$utils.uuid(),tipo:d.tipo,situacao:m,tpAmb:d.tpAmb,dataHoraEnvio:c==null?void 0:c.dataEmissao,cpfCnpjEmitente:c.prestador.documento,xmlEnvio:c.xml,idDocumentoFiscalEletronico:d.id};await $db.documentoFiscalEletronico.grava({atual:d,original:a}),await $db.documentoFiscalEletronicoXml.grava({atual:g,original:i})}await this.atualizar()}catch(l){console.log(l.message)}finally{$q.loading.hide()}},async protocolarLote(){var t;try{$q.loading.show({message:"Preparando envio do lote...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"});const o=$utils.clonarV2(this.lista.filter(l=>l.situacao==="Protocolada"));o.sort((l,a)=>{var c,m,d,g;const i=(m=(c=l==null?void 0:l.rps)==null?void 0:c.identificacaoRps)==null?void 0:m.numero,n=(g=(d=a==null?void 0:a.rps)==null?void 0:d.identificacaoRps)==null?void 0:g.numero;return i>n?1:-1});for(const l of o){const a=(await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:l.id}}))[0],i=l==null?void 0:l.rps;i!=null&&i.dataEmissao||(i.dataEmissao=$utils.dataAtual()),$q.loading.show({message:`Enviando...
                <br /><br />
                <strong>Lote</strong> ${i.numeroLote}<br />
                <strong>RPS</strong> ${i.identificacaoRps.numero}<br />
                <strong>S\xE9rie</strong> ${i.identificacaoRps.serie}<br />
                <br />
                ${i.tomador.razaoSocial}`,html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"});const{nfse:n,situacao:c}=await $db.nfse.emitir({nfse:i,aguardarRetorno:!1}),m={id:l.id,tipo:"NFSe",tpAmb:"2",situacao:c,mod:"",serie:"",nNF:"",chNFe:"",vNF:0,dhEmi:j.formatarDataNFe(new Date((t=this.nfse)==null?void 0:t.dataEmissao)),cpfCnpjEmitente:n.prestador.documento,xNomeEmitente:n.prestador.razaoSocial,cpfCnpjDestinatario:n.tomador.documento,xNomeDestinatario:n.tomador.razaoSocial,dataHoraEmissao:n==null?void 0:n.dataEmissao,dataHoraCriacao:l.dataHoraCriacao||$utils.dataAtual(),json:JSON.stringify({rps:n})},d={id:(a==null?void 0:a.id)||$utils.uuid(),tipo:m.tipo,situacao:c,tpAmb:m.tpAmb,dataHoraEnvio:n==null?void 0:n.dataEmissao,cpfCnpjEmitente:n.prestador.documento,xmlEnvio:n.xml,idDocumentoFiscalEletronico:m.id};await $db.documentoFiscalEletronico.grava({atual:m,original:l}),await $db.documentoFiscalEletronicoXml.grava({atual:d,original:a})}await this.atualizar()}catch(o){console.log(o.message)}finally{$q.loading.hide()}},async abrirDialogoSincronizarLote(){const t=new Date,o=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.dialogoSincronizarLote.listaEmpresas=o.map(l=>({value:l.id,label:l.nome+" - "+l.numeroDocumentoNacional,cnpj:l.numeroDocumentoNacional,inscricaoMunicipal:l.numeroDocumentoMunicipal})),this.dialogoSincronizarLote.empresa=this.dialogoSincronizarLote.listaEmpresas[0],this.dialogoSincronizarLote.periodoInicial=t,this.dialogoSincronizarLote.periodoFinal=t,this.dialogoSincronizarLote.visivel=!0},async sincronizarLote(){try{$q.loading.show({message:"Obtendo dados do servidor...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"}),await $db.nfse.sincronizarLote({inscricaoMunicipal:this.dialogoSincronizarLote.empresa.inscricaoMunicipal,cnpj:this.dialogoSincronizarLote.empresa.cnpj,periodo:{inicial:this.dialogoSincronizarLote.periodoInicial,final:this.dialogoSincronizarLote.periodoFinal}},(t,o)=>$q.loading.show({message:`${o}...
                <br /><br />
                <strong>Lote</strong> ${t.numeroLote}<br />
                <strong>RPS</strong> ${t.identificacaoRps.numero}<br />
                <strong>S\xE9rie</strong> ${t.identificacaoRps.serie}<br />
                <br />
                ${t.tomador.razaoSocial}`,html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"})),this.dialogoSincronizarLote.visivel=!1,await this.atualizar()}catch(t){let o=t.message.replace("db.nfse.sincronizarLote: ","");o.length!==t.message&&$q.notifyError(o),o.length===t.message&&console.error(t.message)}finally{$q.loading.hide()}},async mostrarJsonViewer(){await this.$refs.jsonViewer.show(this)},formatarDocumento(t){const o=t.replace(/\D/g,"");return o.length===11?o.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4"):o.length===14?o.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/,"$1.$2.$3/$4-$5"):o},compareObject(t,o,l=[]){const a=Object.keys(t);for(const i of a)if(!l.includes(i)){if(typeof t[i]=="object"&&t[i]!==null){if(!this.compareObject(t[i],o[i],l))continue;return!0}else if(t[i]!==o[i])return!0}return!1}},async created(){this.usuario=JSON.parse(localStorage.getItem("usuario")),this.filtrosOriginal=$utils.clonar(this.filtros),this.$route.params.id&&this.$route.params.id.length?(await this.atualizar(),this.mostrarNfse(this.$route.params.id)):await this.atualizar({buscarDadosRecentes:!0})}},ia={id:"NfseLista"},sa={class:"mw100 text-center"},la=E("span",{style:{"font-size":"9.5px","margin-left":"3px"}},"RPS",-1),ra=E("span",{style:{"font-size":"9.5px","margin-left":"3px"}},"RPS",-1),na={class:"text-weight-bold"},ca={class:"text-weight-medium"},da={class:"text-weight-medium"},ua={class:"col-12"},ma={class:"col"},pa=E("div",{class:"col-auto",style:{"align-items":"center",display:"flex"}},[E("label",null,"at\xE9")],-1),fa={class:"col"},ha={class:"q-mt-lg text-right"};function ga(t,o,l,a,i,n){const c=D("campo"),m=D("g-label"),d=D("BadgeCopiarUid"),g=D("avatar"),b=D("badge"),h=D("g-col"),y=D("g-row"),_=D("Lista"),R=D("Nfse"),V=D("JsonViewer"),M=D("row");return f(),P("div",ia,[e(_,{ref:"nfseLista",busca:i.busca,"onUpdate:busca":o[16]||(o[16]=s=>i.busca=s),checkBox:i.checkBox,"onUpdate:checkBox":o[17]||(o[17]=s=>i.checkBox=s),onAtualizar:n.atualizar,onCriarClick:n.criarRps,onLimparFiltrosClick:n.limparFiltrosClick,onDetalhesClick:n.detalhesClick,onExportaXLSClick:n.exportaXLSClick,lista:i.lista,permissao:!0,tabSelecionada:i.tabSelecionada,tabs:i.tabs,paginacao:i.paginacao,mostrar:i.mostrar},{menuExtras:r(()=>[F((f(),v(N,{onClick:o[0]||(o[0]=s=>n.enviarLote()),clickable:""},{default:r(()=>[e(u,{avatar:""},{default:r(()=>[e(w,{name:"mdi-file-replace",size:"sm"})]),_:1}),e(u,null,{default:r(()=>[p("Enviar Lote")]),_:1})]),_:1})),[[L]]),F((f(),v(N,{onClick:o[1]||(o[1]=s=>n.protocolarLote()),clickable:""},{default:r(()=>[e(u,{avatar:""},{default:r(()=>[e(w,{name:"mdi-file-replace",size:"sm"})]),_:1}),e(u,null,{default:r(()=>[p("Protocolar Lote")]),_:1})]),_:1})),[[L]]),F((f(),v(N,{onClick:o[2]||(o[2]=s=>n.solicitarURLImpressaoEmLote()),clickable:""},{default:r(()=>[e(u,{avatar:""},{default:r(()=>[e(w,{name:"mdi-file-replace",size:"sm"})]),_:1}),e(u,null,{default:r(()=>[p("Solicitar PDF Lote")]),_:1})]),_:1})),[[L]]),F((f(),v(N,{onClick:o[3]||(o[3]=s=>n.abrirDialogoSincronizarLote()),clickable:""},{default:r(()=>[e(u,{avatar:""},{default:r(()=>[e(w,{name:"mdi-file-replace",size:"sm"})]),_:1}),e(u,null,{default:r(()=>[p("Sincronizar Lote")]),_:1})]),_:1})),[[L]]),t.$db.usuario.desenvolvedor()?F((f(),v(N,{key:0,onClick:o[4]||(o[4]=s=>n.mostrarJsonViewer()),clickable:""},{default:r(()=>[e(u,{avatar:""},{default:r(()=>[e(w,{name:"mdi-file-replace",size:"sm"})]),_:1}),e(u,null,{default:r(()=>[p("Ver Objeto")]),_:1})]),_:1})),[[L]]):C("",!0)]),filtroCampos:r(()=>[e(c,{modelValue:i.filtros.emitente,"onUpdate:modelValue":o[5]||(o[5]=s=>i.filtros.emitente=s),dense:"",rotulo:"Emitente",class:"col-12 q-mt-md"},null,8,["modelValue"]),e(c,{modelValue:i.filtros.destinatario,"onUpdate:modelValue":o[6]||(o[6]=s=>i.filtros.destinatario=s),dense:"",rotulo:"Destinat\xE1rio",class:"col-12 q-mt-lg"},null,8,["modelValue"]),e(c,{modelValue:i.filtros.numeroRps,"onUpdate:modelValue":o[7]||(o[7]=s=>i.filtros.numeroRps=s),rotulo:"RPS (Recibo provis\xF3rio)",dense:"",class:"col-12 q-mt-lg"},null,8,["modelValue"]),e(c,{modelValue:i.filtros.numeroNfse,"onUpdate:modelValue":o[8]||(o[8]=s=>i.filtros.numeroNfse=s),dense:"",rotulo:"N\xFAmero NFS-e",class:"col-12 q-mt-lg"},null,8,["modelValue"]),e(m,{class:"q-mt-xl",caption:""},{default:r(()=>[p("Data de emiss\xE3o")]),_:1}),e(c,{modelValue:i.filtros.dataEmissaoNfseDe,"onUpdate:modelValue":o[9]||(o[9]=s=>i.filtros.dataEmissaoNfseDe=s),dense:"",tipo:"data",mask:"DD/MM/YYYY",rotulo:"De",class:"col-12"},null,8,["modelValue"]),e(c,{modelValue:i.filtros.dataEmissaoNfseAte,"onUpdate:modelValue":o[10]||(o[10]=s=>i.filtros.dataEmissaoNfseAte=s),dense:"",tipo:"data",mask:"DD/MM/YYYY",rotulo:"At\xE9",class:"col-12 q-mt-xs"},null,8,["modelValue"]),e(m,{class:"q-mt-xl",caption:""},{default:r(()=>[p("Data de cria\xE7\xE3o RPS")]),_:1}),e(c,{modelValue:i.filtros.dataCriacaoRpsDe,"onUpdate:modelValue":o[11]||(o[11]=s=>i.filtros.dataCriacaoRpsDe=s),dense:"",tipo:"data",mask:"DD/MM/YYYY",rotulo:"De",class:"col-12"},null,8,["modelValue"]),e(c,{modelValue:i.filtros.dataCriacaoRpsAte,"onUpdate:modelValue":o[12]||(o[12]=s=>i.filtros.dataCriacaoRpsAte=s),dense:"",tipo:"data",mask:"DD/MM/YYYY",rotulo:"At\xE9",class:"col-12 q-mt-xs"},null,8,["modelValue"]),e(c,{modelValue:i.paginacao.ordenacao,"onUpdate:modelValue":o[13]||(o[13]=s=>i.paginacao.ordenacao=s),options:n.ordenacaoOpcoes,dense:"",tipo:"seletor",rotulo:"Ordena\xE7\xE3o",class:"col-12 q-mt-xl"},null,8,["modelValue","options"]),e(c,{modelValue:i.paginacao.direcao,"onUpdate:modelValue":o[14]||(o[14]=s=>i.paginacao.direcao=s),options:n.direcaoOpcoes,dense:"",tipo:"seletor",rotulo:"Dire\xE7\xE3o",class:"col-12 q-mt-xs"},null,8,["modelValue","options"]),e(c,{modelValue:i.paginacao.limite,"onUpdate:modelValue":o[15]||(o[15]=s=>i.paginacao.limite=s),tipo:"quantidade",min:"1",rotulo:"Quantidade por p\xE1gina",class:"col-12 q-mt-xl"},null,8,["modelValue"])]),itemLista:r(()=>[e(U,{bordered:"",class:"bg-white q-mb-xs rounded-borders"},{default:r(()=>[(f(!0),P(J,null,X(i.lista,s=>(f(),P("div",{key:s,class:"itemHover"},[s?(f(),v(N,{key:0,"manual-focus":"",clickable:"",class:"q-py-sm q-px-xs items-center"},{default:r(()=>[e(u,{class:"hideonmobile col-auto q-pr-sm no-margin"},{default:r(()=>[E("div",sa,[s.rps.identificacaoRps.numero?(f(),v(k,{key:0},{default:r(()=>[e(d,{cor:"tertiary",dica:"Recibo provis\xF3rio",numero:String(s.rps.identificacaoRps.numero||0),id:String(s.rps.identificacaoRps.numero||0)},{default:r(()=>[la]),_:2},1032,["numero","id"])]),_:2},1024)):C("",!0),e(k,null,{default:r(()=>[e(d,{numero:String(s.rps.numero),id:s.id,cor:"positive",dica:"N\xBA Nota"},null,8,["numero","id"])]),_:2},1024)])]),_:2},1024),e(u,{class:"col-md col-lg col-xl no-margin"},{default:r(()=>[e(N,{class:"q-pa-none"},{default:r(()=>[e(u,{class:"col-auto items-center"},{default:r(()=>[e(g,{rotulo:s==null?void 0:s.xNomeDestinatario,tamanho:"40",style:{display:"flex","align-self":"center"}},null,8,["rotulo"])]),_:2},1024),e(u,{onClick:x=>n.mostrarNfse(s.id),class:"col"},{default:r(()=>[e(k,{class:"text-weight-bold"},{default:r(()=>[E("span",null,[p(S(s.xNomeDestinatario)+" ",1),e(z,{anchor:"bottom middle",self:"center middle"},{default:r(()=>[p(" Destinat\xE1rio ")]),_:1})])]),_:2},1024),e(k,{caption:""},{default:r(()=>[E("span",null,[p(S(n.formatarDocumento(s.cpfCnpjDestinatario))+" ",1),e(z,{anchor:"bottom middle",self:"center middle"},{default:r(()=>[p(" CPF/CNPJ ")]),_:1})])]),_:2},1024),e(u,{class:"hideondesktop q-mt-sm"},{default:r(()=>[e(k,null,{default:r(()=>[e(d,{cor:"tertiary",dica:"Recibo provis\xF3rio",numero:String(s.rps.identificacaoRps.numero||0),id:String(s.rps.identificacaoRps.numero||0)},{default:r(()=>[ra]),_:2},1032,["numero","id"]),e(d,{numero:String(s.rps.numero),id:s.id,cor:"positive",dica:"N\xBA Nota"},null,8,["numero","id"]),e(b,{rotulo:s.situacao,escuro:"",cor:"tertiary"},null,8,["rotulo"])]),_:2},1024),e(k,{caption:"",class:"q-pt-xs"},{default:r(()=>[e(w,{name:"mdi-calendar-today",size:"xs"}),E("span",na,S(t.$filters.data(s.rps.dataEmissao)),1),p(" "+S(t.$filters.hora(s.rps.dataEmissao)),1)]),_:2},1024),e(N,{class:"q-pa-none",style:{"min-height":"36px!important"}},{default:r(()=>[e(u,{class:"col-shrink no-margin"},{default:r(()=>[s.rps.mensagemDeRetorno?(f(),v(w,{key:0,name:"report",size:"sm",color:"red-7"},{default:r(()=>[e(z,{anchor:"bottom middle",self:"center middle"},{default:r(()=>[p(S(s.rps.mensagemDeRetorno),1)]),_:2},1024)]),_:2},1024)):C("",!0)]),_:2},1024),e(u,{class:"no-margin"},{default:r(()=>[e(k,{class:"text-weight-bold text-right"},{default:r(()=>[p(S(t.$filters.numero(s.rps.servico.valores.valorServicos,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),e(u,{onClick:x=>n.mostrarNfse(s.id),style:{width:"35px"},class:"hideonmobile col-shrink q-pl-sm no-margin"},{default:r(()=>[s.rps.mensagemDeRetorno?(f(),v(w,{key:0,name:"report",size:"md",color:"red-7"},{default:r(()=>[e(z,{anchor:"bottom middle",self:"center middle"},{default:r(()=>[p(S(s.rps.mensagemDeRetorno),1)]),_:2},1024)]),_:2},1024)):C("",!0)]),_:2},1032,["onClick"]),e(u,{onClick:x=>n.mostrarNfse(s.id),class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:r(()=>[e(b,{rotulo:s.situacao,escuro:"",cor:"tertiary",dica:"Situa\xE7\xE3o",class:"col-auto q-mx-auto"},null,8,["rotulo"])]),_:2},1032,["onClick"]),e(u,{onClick:x=>n.mostrarNfse(s.id),class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:r(()=>[e(N,{class:"q-pa-none"},{default:r(()=>[e(u,{side:"",class:"q-pr-xs text-center"},{default:r(()=>[e(w,{name:"mdi-calendar-today",size:"xs"})]),_:1}),e(u,null,{default:r(()=>[e(k,{caption:"",class:"text-weight-bold"},{default:r(()=>[p(S(t.$filters.data(s.rps.dataEmissao)),1)]),_:2},1024),e(k,{caption:""},{default:r(()=>[p(S(t.$filters.hora(s.rps.dataEmissao)),1)]),_:2},1024)]),_:2},1024),e(z,{anchor:"bottom middle",self:"center middle"},{default:r(()=>[p(" Data de emiss\xE3o ")]),_:1})]),_:2},1024)]),_:2},1032,["onClick"]),e(u,{onClick:x=>n.mostrarNfse(s.id),class:"hideonmobile maxw120 q-pl-sm no-margin"},{default:r(()=>[e(k,{caption:"",class:"text-weight-bold text-right"},{default:r(()=>[E("span",null,[p(S(t.$filters.numero(s.rps.servico.valores.valorServicos,2))+" ",1),e(z,{anchor:"bottom middle",self:"center middle"},{default:r(()=>[p(" Valor dos Servi\xE7os ")]),_:1})])]),_:2},1024)]),_:2},1032,["onClick"]),e(u,{class:"col-auto q-pl-sm no-margin"},{default:r(()=>[e(N,{class:"q-pa-none"},{default:r(()=>[e(u,{class:"no-margin hideonmobile",style:{width:"32px"}},{default:r(()=>[e(q,{onClick:x=>s.showPreviewDetail=!(s!=null&&s.showPreviewDetail),icon:s!=null&&s.showPreviewDetail?"keyboard_arrow_up":"keyboard_arrow_down",color:"tertiary",size:"md",flat:"",round:"",dense:""},null,8,["onClick","icon"])]),_:2},1024),e(u,{class:"no-margin hideonmobile",style:{width:"32px"}},{default:r(()=>[e(q,{onClick:x=>n.mostrarNfse(s.id),dense:"",flat:"",round:"",icon:"edit",size:"md",color:"primary"},null,8,["onClick"])]),_:2},1024),s.situacao==="Enviada"||s.situacao==="Rascunho"?(f(),v(u,{key:0,class:"no-margin",style:{width:"32px"}},{default:r(()=>[e(q,{icon:"more_vert",size:"md",dense:"",flat:"",round:""},{default:r(()=>[e(B,null,{default:r(()=>[F((f(),v(U,{link:"","no-border":"",separator:""},{default:r(()=>{var x;return[e(N,{onClick:$=>s.showPreviewDetail=!(s!=null&&s.showPreviewDetail),clickable:"",class:"hideondesktop"},{default:r(()=>[e(u,{avatar:""},{default:r(()=>[e(w,{name:s!=null&&s.showPreviewDetail?"keyboard_arrow_up":"keyboard_arrow_down"},null,8,["name"])]),_:2},1024),e(u,null,{default:r(()=>[p("Ver Detalhes")]),_:1})]),_:2},1032,["onClick"]),e(N,{onClick:$=>n.mostrarNfse(s.id),clickable:"",class:"hideondesktop"},{default:r(()=>[e(u,{avatar:""},{default:r(()=>[e(w,{name:"edit"})]),_:1}),e(u,null,{default:r(()=>[p("Editar")]),_:1})]),_:2},1032,["onClick"]),s.situacao==="Rascunho"?(f(),v(N,{key:0,onClick:$=>n.confirmarExclusaoNfse(s.id),clickable:""},{default:r(()=>[e(u,{avatar:""},{default:r(()=>[e(w,{name:"delete"})]),_:1}),e(u,null,{default:r(()=>[p("Remover")]),_:1})]),_:2},1032,["onClick"])):C("",!0),s.situacao==="Enviada"&&s.id?(f(),v(N,{key:1,onClick:$=>n.solicitarURLImpressao(s.id),clickable:""},{default:r(()=>[e(u,{avatar:""},{default:r(()=>[e(w,{name:"print"})]),_:1}),e(u,null,{default:r(()=>[p("Imprimir")]),_:1})]),_:2},1032,["onClick"])):C("",!0),s.situacao==="Enviada"&&((x=s.rps)==null?void 0:x.plugNotasConsulta)?(f(),v(N,{key:2,onClick:$=>n.downloadPDF(s.id),clickable:""},{default:r(()=>[e(u,{avatar:""},{default:r(()=>[e(w,{name:"download_for_offline"})]),_:1}),e(u,null,{default:r(()=>[p("Download PDF")]),_:1})]),_:2},1032,["onClick"])):C("",!0),s.situacao==="Enviada"&&s.id?(f(),v(N,{key:3,onClick:$=>n.recarregarPDF(s.id),clickable:""},{default:r(()=>[e(u,{avatar:""},{default:r(()=>[e(w,{name:"download_for_offline"})]),_:1}),e(u,null,{default:r(()=>[p("Recarregar PDF")]),_:1})]),_:2},1032,["onClick"])):C("",!0),s.situacao==="Enviada"&&s.rps.numero?(f(),v(N,{key:4,onClick:$=>n.abrirModalDeCancelamento(s),clickable:""},{default:r(()=>[e(u,{avatar:""},{default:r(()=>[e(w,{name:"delete"})]),_:1}),e(u,null,{default:r(()=>[p("Cancelar")]),_:1})]),_:2},1032,["onClick"])):C("",!0),s.situacao==="Enviada"&&s.rps.xml?(f(),v(N,{key:5,onClick:$=>n.baixarXml(s),clickable:""},{default:r(()=>[e(u,{avatar:""},{default:r(()=>[e(w,{name:"mdi-download"})]),_:1}),e(u,null,{default:r(()=>[p("Baixar XML")]),_:1})]),_:2},1032,["onClick"])):C("",!0),s.situacao==="Enviada"&&s.rps.xml?(f(),v(N,{key:6,onClick:$=>n.enviarEmailNfse(s),clickable:""},{default:r(()=>[e(u,{avatar:""},{default:r(()=>[e(w,{name:"mail"})]),_:1}),e(u,null,{default:r(()=>[p("Enviar por email")]),_:1})]),_:2},1032,["onClick"])):C("",!0)]}),_:2},1024)),[[L]])]),_:2},1024)]),_:2},1024)]),_:2},1024)):C("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)):C("",!0),s!=null&&s.showPreviewDetail?(f(),v(T,{key:1,class:"q-mx-sm"})):C("",!0),s!=null&&s.showPreviewDetail?(f(),v(y,{key:2,gutter:"md",items:"center",justify:"center"},{default:r(()=>[e(h,{col:"xs12 md4",bordered:""},{default:r(()=>[e(m,{caption:"",class:"text-tertiary"},{default:r(()=>[p("Emitente")]),_:1}),e(m,{text:"medium"},{default:r(()=>[p(S(s.xNomeEmitente),1)]),_:2},1024)]),_:2},1024),e(h,{col:"xs12 md4",bordered:""},{default:r(()=>[e(y,{items:"center",justify:"center"},{default:r(()=>[e(h,{col:"shrink"},{default:r(()=>[e(w,{name:"event",size:"sm"})]),_:1}),e(h,{col:"grow"},{default:r(()=>[e(m,{caption:""},{default:r(()=>[p("Cria\xE7\xE3o RPS")]),_:1}),e(m,null,{default:r(()=>[E("span",ca,S(t.$filters.data(s.rps.dataHoraCriacao)),1),p(" "+S(t.$filters.hora(s.rps.dataHoraCriacao)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(h,{col:"xs12 md4",bordered:""},{default:r(()=>[e(y,{items:"center",justify:"center"},{default:r(()=>[e(h,{col:"shrink"},{default:r(()=>[e(w,{name:"today",size:"sm"})]),_:1}),e(h,{col:"grow"},{default:r(()=>[e(m,{caption:""},{default:r(()=>[p("Emiss\xE3o NFS-e")]),_:1}),e(m,null,{default:r(()=>[E("span",da,S(t.$filters.data(s.rps.dataEmissao)),1),p(" "+S(t.$filters.hora(s.rps.dataEmissao)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):C("",!0),s?(f(),v(T,{key:3})):C("",!0)]))),128))]),_:1})]),_:1},8,["busca","checkBox","onAtualizar","onCriarClick","onLimparFiltrosClick","onDetalhesClick","onExportaXLSClick","lista","tabSelecionada","tabs","paginacao","mostrar"]),e(R,{onAtualizar:n.atualizar,ref:"modalNfse"},null,8,["onAtualizar"]),e(V,{ref:"jsonViewer"},null,512),e(K,{modelValue:i.dialogoSincronizarLote.visivel,"onUpdate:modelValue":o[21]||(o[21]=s=>i.dialogoSincronizarLote.visivel=s),"content-css":{minWidth:"50vw"}},{default:r(()=>[e(H,null,{default:r(()=>[e(Q,{class:"bg-primary text-white"},{default:r(()=>[e(Y,null,{default:r(()=>[p("Sincronizar Lote")]),_:1}),F(e(q,{dense:"",flat:"",icon:"close",round:""},null,512),[[L]])]),_:1}),e(Z,null,{default:r(()=>[e(G,{onSubmit:n.sincronizarLote},{default:r(()=>[e(M,{class:"q-col-gutter-md"},{default:r(()=>[E("div",ua,[e(W,{modelValue:i.dialogoSincronizarLote.empresa,"onUpdate:modelValue":o[18]||(o[18]=s=>i.dialogoSincronizarLote.empresa=s),label:"Empresa",options:i.dialogoSincronizarLote.listaEmpresas,"option-value":"id","option-label":"label","emit-value":"","map-options":""},null,8,["modelValue","options"])]),E("div",ma,[e(c,{modelValue:i.dialogoSincronizarLote.periodoInicial,"onUpdate:modelValue":o[19]||(o[19]=s=>i.dialogoSincronizarLote.periodoInicial=s),tipo:"data",dense:"",outlined:""},null,8,["modelValue"])]),pa,E("div",fa,[e(c,{modelValue:i.dialogoSincronizarLote.periodoFinal,"onUpdate:modelValue":o[20]||(o[20]=s=>i.dialogoSincronizarLote.periodoFinal=s),tipo:"data",dense:"",outlined:""},null,8,["modelValue"])])]),_:1}),E("div",ha,[F(e(q,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[L]]),e(q,{color:"primary",class:"q-ml-sm no-shadow",unelevated:"",label:"Sincronizar",type:"submit"})])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var Ea=I(ta,[["render",ga]]);export{Ea as default};
