import{_ as J,a5 as ga,r as w,o as I,d as y,w as t,f as a,M as K,G as Z,h as X,i as W,k as g,t as V,m as B,e as S,H as k,Q as F,N as L,I as Y,J as aa,p as U,b0 as ba,b1 as ea,b6 as va,b7 as ta,W as R,b8 as na,d6 as da,d7 as H,K as ia,aW as ca,D as oa,bj as pa,at as x,b5 as M,s as la,bg as G,P as O,S as z,T as D,j as _,U as $,A as Ia,F as A,u as j,C as N,l as ra,aQ as ma,E as Ca,bs as fa,d$ as Va,e0 as ya,av as Da,d8 as Pa,aP as ua}from"./index.35cb5467.js";import{L as wa}from"./Lista.5a0c3522.js";import{S as Ea}from"./SeletorCfop.c26f16d0.js";import{C as Fa}from"./Campo.303db9b8.js";import"./xlsx.14fcc6ee.js";const Sa={components:{SeletorNcm:ga,SeletorCfop:Ea,Campo:Fa},data(){return{abaSelecionada:"tab1",historicoItem:[],tabelaHistoricoItem:{colunas:[{name:"fornecedor",label:"Fornecedor",align:"left"},{name:"dataCompra",label:"Data Compra",align:"right"},{name:"quantidade",label:"Quantidade",align:"right"},{name:"valorCusto",label:"Valor de Custo",align:"right"},{name:"valorTotal",label:"Valor Total (Custo)",align:"right"}],paginacao:{page:1,rowsPerPage:5}},estoqueItem:[],tabelaEstoqueItem:{colunas:[{name:"empresa",label:"Empresa",align:"left"},{name:"tipoEstoque",label:"Tipo estoque",align:"right"},{name:"lote",label:"Lote",align:"right"},{name:"quantidade",label:"Quantidade",align:"right"}],paginacao:{page:1,rowsPerPage:5}},compra:{},cfop:null,cstIcms:"",cstIpi:"",contaEstoque:[],impostoCstIpi:[],impostoIcmsModalidade:[],impostoCstIcms:[],impostoCstIcmsSt:[],documentoItem:{},imposto:{},item:{},visivel:!1,contasOpcoes:[],exibirIcms:!1,exibirIcmsSt:!1,exibirIpi:!1,somenteLeituraIcms:!1,somenteLeituraIcmsSt:!1,exibirHistorico:!1,exibirEstoque:!1,exibeCfop:!1}},emits:["salvar"],methods:{async mostrar(o,e,m){var h,l,f,b,c,C,p,u,E,n;this.compra=m,this.documentoItem=$utils.clonarV2(o),this.item=$utils.clonarV2(e),await this.consultarHistoricoItem(this.item),await this.consultarEstoqueItem(this.item);const s=await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:1}}),r=await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:21}});this.impostoCstIcms=s.concat(r).map(d=>({rotulo:d.numero.trim()+" - "+d.descr,valor:Number(d.numero)})).sort((d,v)=>Number(d.valor)-Number(v.valor)),this.impostoIcmsModalidade=(await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:3}})).map(d=>({rotulo:d.numero.trim()+" - "+d.descr,valor:Number(d.numero)})).sort((d,v)=>Number(d.valor)-Number(v.valor)),this.impostoCstIcmsSt=(await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:4}})).map(d=>({rotulo:d.numero.trim()+" - "+d.descr,valor:Number(d.numero)})).sort((d,v)=>Number(d.valor)-Number(v.valor)),this.impostoCstIpi=(await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:5}})).map(d=>({rotulo:d.numero.trim()+" - "+d.descr,valor:Number(d.numero)})).sort((d,v)=>Number(d.valor)-Number(v.valor)),this.contaEstoque=(await $db.hibrido.lista({table:"financeiroPlanoConta"})).map(d=>{var v,P,q;return{rotulo:(q=(P=(v=d==null?void 0:d.descricao)!=null?v:" - "+(d==null?void 0:d.classificacao))!=null?P:" - "+(d==null?void 0:d.caminho))!=null?q:"",valor:d.id}}).sort((d,v)=>Number(d.valor)-Number(v.valor));let i;(h=this.documentoItem)!=null&&h.idCfop&&(i=await $erp().cfop.where({id:this.documentoItem.idCfop}).first()),i===void 0&&console.log("CFOP inv\xE1lido"),this.documentoItem.cfop=(l=i==null?void 0:i.cfop.toString())!=null?l:"",this.documentoItem.codigoCfop=(f=i==null?void 0:i.codigoCfop)!=null?f:null,this.documentoItem.idCfop=(b=i.id)!=null?b:null,this.documentoItem.valorBaseIcms=(C=(c=this.documentoItem.valorBaseIcms)!=null?c:this.documentoItem.total)!=null?C:0,this.documentoItem.valorBaseIpi=(u=(p=this.documentoItem.valorBaseIpi)!=null?p:this.documentoItem.total)!=null?u:0,this.documentoItem.valorBaseIcmsSt=(n=(E=this.documentoItem.valorBaseIcmsSt)!=null?E:this.documentoItem.total)!=null?n:0,this.calcularImpostos(),this.exibeCfop=!0,this.visivel=!0},async salvar(){try{if(Object.keys(this.documentoItem.cfop).length>0){const o=await $db.hibrido.lista({table:"cfop",where:{cfop:Number(this.documentoItem.cfop)}});this.documentoItem.codigoCfop=o[0].codigoCfop,this.documentoItem.idCfop=o[0].id}this.documentoItem.cfop&&delete this.documentoItem.cfop,this.$emit("salvar",this.documentoItem),this.exibirIcms=!1,this.exibirIcmsSt=!1,this.exibirIpi=!1,this.visivel=!1}catch(o){$q.notifyError("Ocorreu um erro ao salvar o produto: ",o.message)}finally{$q.notifyPositive("Produto salvo com sucesso.")}},calcularImpostos(o){var C,p,u,E,n,d,v,P,q,T;let e=(C=this.documentoItem.valorBaseIcms)!=null?C:0,m=(p=this.documentoItem.valorBaseIpi)!=null?p:0,s=(u=this.documentoItem.valorBaseIcmsSt)!=null?u:0,r=(E=this.documentoItem.percentualIcms)!=null?E:0,i=(n=this.documentoItem.percentualIpi)!=null?n:0,h=(d=this.documentoItem.percentualIVA)!=null?d:0,l=(v=this.documentoItem.percentualIcmsSt)!=null?v:0,f=(P=this.documentoItem.valorIcms)!=null?P:0,b=(q=this.documentoItem.valorIpi)!=null?q:0,c=(T=this.documentoItem.valorIcmsSt)!=null?T:0;["valorBaseIcms","percentualIcms"].includes(o)&&(f=e*r/100),o==="valorIcms"&&(r=f/e*100),["valorBaseIpi","percentualIpi"].includes(o)&&(b=m*i/100),o==="valorIpi"&&(i=b/m*100),o==="valorBaseIcmsSt"&&(h=0,s>0&&e>0&&s>=e&&(h=(s-e)/e*100),c=s*l/100-f),o==="percentualIVA"&&(s=e*(1+h/100),c=s*l/100-f),o==="percentualIcmsSt"&&(c=s*l/100-f),o==="valorIcmsSt"&&(l=c/s*100),this.documentoItem.valorBaseIcmsSt=parseFloat(s.toFixed(2)),this.documentoItem.percentualIcms=parseFloat(r.toFixed(2)),this.documentoItem.percentualIcmsSt=parseFloat(l.toFixed(2)),this.documentoItem.percentualIpi=parseFloat(i.toFixed(2)),this.documentoItem.percentualIVA=parseFloat(h.toFixed(2)),this.documentoItem.valorIcms=parseFloat(f.toFixed(2)),this.documentoItem.valorIcmsSt=parseFloat(c.toFixed(2)),this.documentoItem.valorIpi=parseFloat(b.toFixed(2)),(this.documentoItem.modalidadeBaseCalculo||this.documentoItem.codigoCst||this.documentoItem.percentualIcms>0||this.documentoItem.valorIcms>0)&&(this.exibirIcms=!0),(this.documentoItem.modalidadeBaseCalculoST||this.documentoItem.percentualIcmsSt>0||this.documentoItem.valorIcmsSt>0)&&(this.exibirIcmsSt=!0),(this.documentoItem.codigoCstIpi||this.documentoItem.percentualIpi>0||this.documentoItem.valorIpi>0)&&(this.exibirIpi=!0)},async consultarCFOP(){var m,s;const o=this.documentoItem.cfop,e=await $erp().cfop.where({cfop:Number(o)}).first();e===void 0&&console.log("CFOP inv\xE1lido"),this.documentoItem.idCfop=(m=e==null?void 0:e.id)!=null?m:null,this.documentoItem.codigoCfop=(s=e==null?void 0:e.CodigoCFOP)!=null?s:null},async consultarHistoricoItem(o){const e={};(o==null?void 0:o.atual)&&Object.keys(o.atual).length>0&&(o=o.atual);const s=(await $db.hibrido.lista({table:"documentoItem",where:{idItem:o.id}})).filter(r=>(r.operacao==="Compra"||r.operacao==="Compra de Mercadoria")&&r.status==="Finalizado"&&r.operacaoFator===1&&r.quantidade>0);for(const r of s){const i=await $db.hibrido.le({table:"documento",id:r.idDocumento}),h=await $db.hibrido.le({table:"contato",id:i.idContato});e[r.idItem]||(e[r.idItem]={fornecedores:[]}),e[r.idItem].fornecedores.push({fornecedor:h.apelido||"",dataCompra:i.dataCompra||"",quantidade:r.quantidade||"",valorCusto:r.valorItem||"",valorTotal:r.valorItem*r.quantidade||""})}Object.keys(e).length>0?(this.historicoItem=e,this.historicoItem[o.id].fornecedores.sort((r,i)=>{const h=new Date(r.dataCompra||"1900-01-01");return new Date(i.dataCompra||"1900-01-01")-h})):this.historicoItem[o.id]={fornecedores:[]},this.exibirHistorico=!0},async consultarEstoqueItem(o){const e={};(o==null?void 0:o.atual)&&Object.keys(o.atual).length>0&&(o=o.atual);const m=await $db.hibrido.lista({table:"estoqueSaldoProdutoEmpresa",where:{idItem:o.id},whereFilter:{tipoEstoque:"Dispon\xEDvel"}});for(const s of m){const r=await $db.hibrido.le({table:"contato",id:s.idEmpresa});e[s.idItem]||(e[s.idItem]={estoques:[]}),e[s.idItem].estoques.push({empresa:r.apelido||"",tipoEstoque:s.tipoEstoque||"",lote:s.lote||"-",quantidade:s.saldo||""})}Object.keys(e).length>0?(this.estoqueItem=e,this.estoqueItem[o.id].estoques.sort((s,r)=>{const i=Number(s.quantidade||0);return Number(r.quantidade||0)-i})):this.estoqueItem[o.id]={estoques:[]},this.exibirEstoque=!0},async fechar(){this.documentoItem.cfop&&delete this.documentoItem.cfop,this.exibirIcms=!1,this.exibirIcmsSt=!1,this.exibirIpi=!1}}},ka=["src"],Na={key:0},qa={key:0};function Ta(o,e,m,s,r,i){const h=w("badge"),l=w("g-col"),f=w("g-row"),b=w("campo"),c=w("SeletorNcm"),C=w("SeletorCfop"),p=w("g-label");return I(),y(oa,{modelValue:r.visivel,"onUpdate:modelValue":e[36]||(e[36]=u=>r.visivel=u),persistent:""},{default:t(()=>[a(K,{container:"",view:"hHh Lpr fFf",class:"bg-white",style:{"max-width":"980px"}},{default:t(()=>[a(Z,{class:"bg-primary"},{default:t(()=>[a(X,{class:"bg-primary text-white"},{default:t(()=>[a(W,null,{default:t(()=>[g(V(r.documentoItem.descricaoItem),1)]),_:1}),r.item.referencia?(I(),y(h,{key:0,cor:"tertiary",class:"q-mr-sm"},{default:t(()=>[g(V(r.item.referencia)+" ",1),a(B,null,{default:t(()=>[g(" Refer\xEAncia ")]),_:1})]),_:1})):S("",!0),r.item.codigoItem?(I(),y(h,{key:1,cor:"positive",class:"q-mr-sm"},{default:t(()=>[g(" #"+V(r.item.codigoItem.toString().padStart(4,"0"))+" ",1),a(B,null,{default:t(()=>[g(" C\xF3digo Item ")]),_:1})]),_:1})):S("",!0),k(a(F,{onClick:i.fechar,dense:"",flat:"",icon:"close",round:""},null,8,["onClick"]),[[L]])]),_:1})]),_:1}),a(Y,null,{default:t(()=>[a(aa,null,{default:t(()=>[a(f,{gutter:"md"},{default:t(()=>[a(l,null,{default:t(()=>[a(f,{class:"col-12 text-center"},{default:t(()=>[a(l,null,{default:t(()=>{var u,E,n,d,v,P;return[((u=r.item)==null?void 0:u.imagem)||((n=(E=r.item)==null?void 0:E.atual)==null?void 0:n.imagem)?(I(),U("img",{key:0,src:((d=r.item)==null?void 0:d.imagem)||((P=(v=r.item)==null?void 0:v.atual)==null?void 0:P.imagem),alt:"",style:{"max-width":"33%"}},null,8,ka)):S("",!0)]}),_:1})]),_:1}),a(ba,{modelValue:r.abaSelecionada,"onUpdate:modelValue":e[0]||(e[0]=u=>r.abaSelecionada=u),align:"justify",dense:"","indicator-color":"light-blue-4",class:"text-primary q-px-sm"},{default:t(()=>[a(ea,{default:"",name:"tab1",icon:"info",label:"Detalhes",class:"cinza"}),a(ea,{name:"tab2",icon:"history",label:"Compras",class:"cinza"}),a(ea,{name:"tab3",icon:"compare_arrows",label:"Estoque",class:"cinza"})]),_:1},8,["modelValue"]),a(va,{modelValue:r.abaSelecionada,"onUpdate:modelValue":e[35]||(e[35]=u=>r.abaSelecionada=u),animated:"",class:"text-tertiary"},{default:t(()=>[a(ta,{name:"tab1",class:"q-px-sm"},{default:t(()=>[a(f,null,{default:t(()=>[a(l,null,{default:t(()=>[a(b,{modelValue:r.documentoItem.observacao,"onUpdate:modelValue":e[1]||(e[1]=u=>r.documentoItem.observacao=u),tipo:"textoArea",rotulo:"Observa\xE7\xE3o",dense:"",rows:"4"},null,8,["modelValue"])]),_:1})]),_:1}),a(f,{mg:"lg-t"},{default:t(()=>[a(l,{col:"12"},{default:t(()=>[a(b,{modelValue:r.documentoItem.referenciaFornecedor,"onUpdate:modelValue":e[2]||(e[2]=u=>r.documentoItem.referenciaFornecedor=u),rotulo:"Refer\xEAncia Fornecedor"},null,8,["modelValue"])]),_:1})]),_:1}),a(f,{mg:"lg-t"},{default:t(()=>[a(l,{col:"12"},{default:t(()=>[a(c,{modelValue:r.documentoItem.ncm,"onUpdate:modelValue":e[3]||(e[3]=u=>r.documentoItem.ncm=u),class:"col-12 col-md-6",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),a(f,{mg:"lg-t"},{default:t(()=>[a(l,{col:"12"},{default:t(()=>[a(C,{modelValue:r.documentoItem.cfop,"onUpdate:modelValue":e[4]||(e[4]=u=>r.documentoItem.cfop=u),class:"col-12 col-md-6",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),a(f,{mg:"lg-t"},{default:t(()=>[a(l,null,{default:t(()=>[a(p,{text:"sub1 medium"},{default:t(()=>[g("Estoque")]),_:1})]),_:1})]),_:1}),a(f,{items:"center"},{default:t(()=>[a(l,{col:"12"},{default:t(()=>[a(b,{modelValue:r.documentoItem.idPlanoContaEstoque,"onUpdate:modelValue":e[5]||(e[5]=u=>r.documentoItem.idPlanoContaEstoque=u),opcoes:r.contaEstoque,tipo:"seletor",ajuda:"Plano de Conta de Estoque para Entrada de Mercadoria",dense:"",outlined:"",rotulo:"Conta Estoque"},null,8,["modelValue","opcoes"])]),_:1})]),_:1}),a(f,{mg:"lg-t"},{default:t(()=>[a(l,null,{default:t(()=>[a(p,{text:"sub1 medium"},{default:t(()=>[g("Impostos")]),_:1})]),_:1})]),_:1}),a(f,null,{default:t(()=>[a(R,{label:"ICMS",modelValue:r.exibirIcms,"onUpdate:modelValue":e[6]||(e[6]=u=>r.exibirIcms=u)},null,8,["modelValue"])]),_:1}),r.exibirIcms?(I(),y(f,{key:0,items:"center"},{default:t(()=>[a(l,{col:"12 sm6"},{default:t(()=>[a(b,{modelValue:r.documentoItem.modalidadeBaseCalculo,"onUpdate:modelValue":e[7]||(e[7]=u=>r.documentoItem.modalidadeBaseCalculo=u),opcoes:r.impostoIcmsModalidade,"somente-leitura":r.somenteLeituraIcms,tipo:"seletor",outlined:"",rotulo:"ICMS (Modalidade)"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),a(l,{col:"12 sm6"},{default:t(()=>[a(b,{modelValue:r.documentoItem.codigoCst,"onUpdate:modelValue":e[8]||(e[8]=u=>r.documentoItem.codigoCst=u),opcoes:r.impostoCstIcms,"somente-leitura":r.somenteLeituraIcms,tipo:"seletor",outlined:"",rotulo:"CST ICMS"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),a(l,{col:"12 sm4"},{default:t(()=>[a(b,{modelValue:r.documentoItem.valorBaseIcms,"onUpdate:modelValue":e[9]||(e[9]=u=>r.documentoItem.valorBaseIcms=u),onBlur:e[10]||(e[10]=u=>i.calcularImpostos("valorBaseIcms")),"somente-leitura":r.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base ICMS"},null,8,["modelValue","somente-leitura"])]),_:1}),a(l,{col:"12 sm4"},{default:t(()=>[a(b,{modelValue:r.documentoItem.percentualIcms,"onUpdate:modelValue":e[11]||(e[11]=u=>r.documentoItem.percentualIcms=u),onBlur:e[12]||(e[12]=u=>i.calcularImpostos("percentualIcms")),"somente-leitura":r.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"ICMS %"},null,8,["modelValue","somente-leitura"])]),_:1}),a(l,{col:"12 sm4"},{default:t(()=>[a(b,{modelValue:r.documentoItem.valorIcms,"onUpdate:modelValue":e[13]||(e[13]=u=>r.documentoItem.valorIcms=u),onBlur:e[14]||(e[14]=u=>i.calcularImpostos("valorIcms")),"somente-leitura":r.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor ICMS"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})):S("",!0),a(f,null,{default:t(()=>[a(R,{label:"ICMS ST",modelValue:r.exibirIcmsSt,"onUpdate:modelValue":e[15]||(e[15]=u=>r.exibirIcmsSt=u)},null,8,["modelValue"])]),_:1}),r.exibirIcmsSt?(I(),y(f,{key:1,items:"center"},{default:t(()=>[a(l,{col:"12 sm6"},{default:t(()=>[a(b,{modelValue:r.documentoItem.modalidadeBaseCalculoST,"onUpdate:modelValue":e[16]||(e[16]=u=>r.documentoItem.modalidadeBaseCalculoST=u),opcoes:r.impostoCstIcmsSt,"somente-leitura":r.somenteLeituraIcmsSt,tipo:"seletor",outlined:"",rotulo:"ICMS ST (Modalidade)"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),a(l,{col:"12 sm6"},{default:t(()=>[a(b,{modelValue:r.documentoItem.percentualIVA,"onUpdate:modelValue":e[17]||(e[17]=u=>r.documentoItem.percentualIVA=u),onBlur:e[18]||(e[18]=u=>i.calcularImpostos("percentualIVA")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"IVA (%)"},null,8,["modelValue"])]),_:1}),a(l,{col:"12 sm4"},{default:t(()=>[a(b,{modelValue:r.documentoItem.valorBaseIcmsSt,"onUpdate:modelValue":e[19]||(e[19]=u=>r.documentoItem.valorBaseIcmsSt=u),onBlur:e[20]||(e[20]=u=>i.calcularImpostos("valorBaseIcmsSt")),"somente-leitura":r.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base ICMS ST"},null,8,["modelValue","somente-leitura"])]),_:1}),a(l,{col:"12 sm4"},{default:t(()=>[a(b,{modelValue:r.documentoItem.percentualIcmsSt,"onUpdate:modelValue":e[21]||(e[21]=u=>r.documentoItem.percentualIcmsSt=u),onBlur:e[22]||(e[22]=u=>i.calcularImpostos("percentualIcmsSt")),"somente-leitura":r.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"ICMS ST (%)"},null,8,["modelValue","somente-leitura"])]),_:1}),a(l,{col:"12 sm4"},{default:t(()=>[a(b,{modelValue:r.documentoItem.valorIcmsSt,"onUpdate:modelValue":e[23]||(e[23]=u=>r.documentoItem.valorIcmsSt=u),onBlur:e[24]||(e[24]=u=>i.calcularImpostos("valorIcmsSt")),"somente-leitura":r.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor ICMS ST"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})):S("",!0),a(f,null,{default:t(()=>[a(R,{label:"IPI",modelValue:r.exibirIpi,"onUpdate:modelValue":e[25]||(e[25]=u=>r.exibirIpi=u)},null,8,["modelValue"])]),_:1}),r.exibirIpi?(I(),y(f,{key:2,items:"center"},{default:t(()=>[a(l,{col:"12"},{default:t(()=>[a(b,{modelValue:r.documentoItem.codigoCstIpi,"onUpdate:modelValue":e[26]||(e[26]=u=>r.documentoItem.codigoCstIpi=u),opcoes:r.impostoCstIpi,tipo:"seletor",dense:"",outlined:"",rotulo:"CST IPI"},null,8,["modelValue","opcoes"])]),_:1}),a(l,{col:"12 sm4"},{default:t(()=>[a(b,{modelValue:r.documentoItem.valorBaseIpi,"onUpdate:modelValue":e[27]||(e[27]=u=>r.documentoItem.valorBaseIpi=u),onBlur:e[28]||(e[28]=u=>i.calcularImpostos("valorBaseIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base IPI"},null,8,["modelValue"])]),_:1}),a(l,{col:"12 sm4"},{default:t(()=>[a(b,{modelValue:r.documentoItem.percentualIpi,"onUpdate:modelValue":e[29]||(e[29]=u=>r.documentoItem.percentualIpi=u),onBlur:e[30]||(e[30]=u=>i.calcularImpostos("percentualIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"IPI %"},null,8,["modelValue"])]),_:1}),a(l,{col:"12 sm4"},{default:t(()=>[a(b,{modelValue:r.documentoItem.valorIpi,"onUpdate:modelValue":e[31]||(e[31]=u=>r.documentoItem.valorIpi=u),onBlur:e[32]||(e[32]=u=>i.calcularImpostos("valorIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor IPI"},null,8,["modelValue"])]),_:1})]),_:1})):S("",!0)]),_:1}),a(ta,{name:"tab2",class:"q-px-sm"},{default:t(()=>[r.exibirHistorico?(I(),y(na,{key:0,rows:r.historicoItem[r.documentoItem.idItem].fornecedores,columns:r.tabelaHistoricoItem.colunas,pagination:r.tabelaHistoricoItem.paginacao,"onUpdate:pagination":e[33]||(e[33]=u=>r.tabelaHistoricoItem.paginacao=u),"row-key":"index",class:"no-shadow text-left"},{body:t(u=>[a(da,{props:u},{default:t(()=>[a(H,{key:"fornecedor",props:u},{default:t(()=>[g(V(u.row.fornecedor),1)]),_:2},1032,["props"]),a(H,{key:"dataCompra",props:u},{default:t(()=>[u.row.dataCompra!==""?(I(),U("span",Na,V(o.$filters.data(u.row.dataCompra)),1)):S("",!0)]),_:2},1032,["props"]),a(H,{key:"quantidade",props:u},{default:t(()=>[g(V(u.row.quantidade),1)]),_:2},1032,["props"]),a(H,{key:"valorCusto",props:u},{default:t(()=>[g(V(o.$filters.numero(u.row.valorCusto,2)),1)]),_:2},1032,["props"]),a(H,{key:"valorTotal",props:u},{default:t(()=>[g(V(o.$filters.numero(u.row.valorTotal,2)),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])):S("",!0)]),_:1}),a(ta,{name:"tab3",class:"q-px-sm"},{default:t(()=>[r.exibirEstoque?(I(),y(na,{key:0,rows:r.estoqueItem[r.documentoItem.idItem].estoques,columns:r.tabelaEstoqueItem.colunas,pagination:r.tabelaEstoqueItem.paginacao,"onUpdate:pagination":e[34]||(e[34]=u=>r.tabelaEstoqueItem.paginacao=u),"row-key":"index",class:"no-shadow text-left"},{body:t(u=>[a(da,{props:u},{default:t(()=>[a(H,{key:"empresa",props:u},{default:t(()=>[g(V(u.row.empresa),1)]),_:2},1032,["props"]),a(H,{key:"tipoEstoque",props:u},{default:t(()=>[g(V(u.row.tipoEstoque),1)]),_:2},1032,["props"]),a(H,{key:"lote",props:u},{default:t(()=>[u.row.lote!==""?(I(),U("span",qa,V(u.row.lote),1)):S("",!0)]),_:2},1032,["props"]),a(H,{key:"quantidade",props:u},{default:t(()=>[g(V(u.row.quantidade),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])):S("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),a(ia,{class:"bg-light q-pa-sm",bordered:""},{default:t(()=>[a(X,null,{default:t(()=>[a(ca),k(a(F,{onClick:i.fechar,label:"Cancelar",size:"md",flat:"","no-ripple":"",color:"tertiary",class:"q-mr-sm"},null,8,["onClick"]),[[L]]),a(F,{onClick:i.salvar,label:"Salvar",color:"primary","no-ripple":"",unelevated:""},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var $a=J(Sa,[["render",Ta]]);const _a={components:{ModalEditarProdutoCompras:$a,PromptItemV2:pa},data(){const o={ehOrcamento:!0,adicionar:{modal:{value:!1,name:""}},dataPrevistaEntrega:"",horaPrevistaEntrega:"",contatos:{},produtos:[],formasDePagamento:[],visivel:!1,somenteLeitura:!1,condicaoPagamentoRules:[async()=>{const e=this.compra.condicaoPagamento;return/^[\d/]*$/.test(e)}],formaPagamentoRules:[async()=>{const e=this.compra.formaDePagamento;return/^[^\d\s][a-zA-Z\s]*[^\d\s]$/.test(e)}],erroDesconto:!1,erroFrete:!1,erroSeguro:!1,erroOutrasDespesas:!1,itensImagens:{},exibeInfNota:!1,documentoNovo:!1,valorTotalPagamento:0,sku:0,operacao:"",alterarPrevisaoEntrega:!1};return this.limpaCampos(o),o},emits:["atualizar"],computed:{skus(){return this.compraItens.length>0?`${Number(this.compraItens.length)}`:"0"}},methods:{editarProduto(o){const e=this.produtos[o.idItem],m=this.compra;this.$refs.ModalEditarProdutoCompras.mostrar(o,e,m)},removerItem(o){this.compraItens=this.compraItens.filter(e=>e.id!==o.id),this.calcularTotais()},fecharEdicaoProduto(o){const e=this.compraItens.findIndex(m=>m.id===o.id);this.compraItens[e]=$utils.clonar(o),this.calcularTotaisItem(e)},async atualizar(){var e,m;this.compraOriginal=await $db.hibrido.le({table:"documento",id:this.compra.id}),this.compra=$utils.clonarV2(this.compraOriginal),$utils.verificarErro(!this.compra.id,"Compra n\xE3o encontrada"),this.compraItensOriginal=(await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:this.compra.id}})).sort((s,r)=>new Date(s.dataHoraEmissao||0)-new Date(r.dataHoraEmissao||0)),this.compraItens=$utils.clonarV2(this.compraItensOriginal),this.compraCondicoesDePagamentoOriginal=(await $db.hibrido.lista({table:"documentoCondicaoPagamento",where:{idDocumento:this.compra.id}})).sort((s,r)=>new Date(s.dataVencimento||0)-new Date(r.dataVencimento||0)),this.compraCondicoesDePagamento=$utils.clonarV2(this.compraCondicoesDePagamentoOriginal),this.compraTitulosOriginal=await $db.hibrido.lista({table:"financeiroTitulo",where:{documentoId:this.compra.id}}),this.compraTitulos=$utils.clonarV2(this.compraTitulosOriginal),this.compraMovimentacoesOriginal=await $db.hibrido.lista({table:"financeiroMovimentacao",where:{documentoId:this.compra.id}}),this.compraMovimentacoes=$utils.clonarV2(this.compraMovimentacoesOriginal),this.compra.totalComImposto=!0,this.compra.calcularTributacao=(e=this.compra.calcularTributacao)!=null?e:!0,this.compra.naoGerarFinanceiro=(m=this.compra.naoGerarFinanceiro)!=null?m:!1;const o=[this.compra.idEmpresa,this.compra.idContato,this.compra.idContatoComprador,this.compra.idContatoVendedor,this.compra.idContatoTransportadora].filter(Boolean);this.contatos=(await $db.hibrido.lista({table:"contato",whereIn:{id:o}})).reduce((s,r)=>(s[r.id]=r,s),{}),this.compraItensImagens=$utils.clonar(this.compraItensOriginal),await this.processarImagem(this.compraItensImagens);for(let s in this.compraItens)this.produtos[this.compraItens[s].idItem]=await $db.item.leNew({id:this.compraItens[s].idItem});if(this.valorTotalPagamento===0)for(const s of this.compraCondicoesDePagamento)this.valorTotalPagamento=this.valorTotalPagamento+s.valor;this.compra.dataHoraPrevisto&&(this.dataPrevistaEntrega=this.compra.dataHoraPrevisto.slice(0,10),this.horaPrevistaEntrega=this.compra.dataHoraPrevisto.slice(11,16)),this.exibeInfNota=!0},async salvar_click(){await $tryLoading(async()=>{if(this.compra.idContato||(this.compra.idContato=$db.usuario.logado.id),this.dataPrevistaEntrega){const o=`${this.dataPrevistaEntrega} ${this.horaPrevistaEntrega||"00:00:00"}`;this.compra.dataHoraPrevisto=x.formatDate(o)}await this.salvar(),this.$emit("atualizar",{aba:"Digita\xE7\xE3o"}),this.ocultarModal(),$q.notifyPositive(this.compra.operacao==="Nota de Entrada"?"A Nota de Entrada foi salva com sucesso.":"O Pedido de Compra foi salvo com sucesso.")},{mensagem:"Salvando..."})},async excluir_click(){!await $q.dialogSimNao({title:"Excluir compra",message:`Deseja excluir ${this.compra.operacao==="Pedido de Compra"?`o ${this.compra.operacao}?`:`a ${this.compra.operacao}?`}`})||await $tryLoading(async()=>{this.operacao=this.compra.operacao,this.compra={},this.compraCondicoesDePagamento=[],this.compraItens=[],this.compraMovimentacoes=[],this.compraTitulos=[],await this.salvar(),await this.fechar(),$q.notifyPositive(`${this.operacao} foi excluido com sucesso!`)},{mensagem:"Excluindo..."})},async criar(){await $tryLoading(async()=>{const o=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;if(!(o.length>0)){this.$q.notify({message:"N\xE3o h\xE1 empresa configurada",timeout:0,type:"negative",closeBtn:!0});return}let e=o[0];if(o.length>1){const r={ativo:!0,empresas:!0};if(e=await $g.promptContato.show({filtro:r,placeholder:"Selecione a empresa"}),!e){this.ocultarModal(),this.$q.notifyError("Empresa n\xE3o selecionada");return}}const m=(await $db.hibrido.lista({table:"empresa",where:{idContato:e.id}}))[0];if(!m){this.ocultarModal(),this.$q.notifyError("Erro ao selecionar empresa");return}if(this.contatos[e.id]||(this.contatos[e.id]=await $db.hibrido.le({table:"contato",id:e.id})),this.limpaCampos(this),this.compra={id:$utils.uuid(),tipo:"Compra",operacao:"Pedido de Compra",status:"Digita\xE7\xE3o",descricaoEmpresa:m.nome,numeroDocumentoEmpresa:m.numeroDocumentoNacional,descricaoContato:"",idContatoComprador:null,dataHoraEmissao:$utils.dataAtual(),tipoFrete:"CIF",tipoTransporte:null,idEmpresa:m.idContato,idContato:null,totalDesconto:0,totalPercentualDesconto:0,calcularTributacao:!0,totalComImposto:!0,naoGerarFinanceiro:!1,freteSeparado:!1,dataHoraPrevisto:null,valorBaseIcms:0,valorIcms:0,valorBaseIcmsSt:0,valorIcmsSt:0,valorOutrasDespesas:0},!await this.abrirModalFornecedor()){this.ocultarModal(),this.$q.notifyError("Fornecedor n\xE3o selecionado");return}this.documentoNovo=!0,this.exibeInfNota=!0}),this.visivel=!0},async validaCampos(){try{if($utils.verificarErro(!this.compra.descricaoContato,"N\xE3o \xE9 permitido finalizar a compra sem informar o fornecedor!"),$utils.verificarErro(!this.compraItens.length,"N\xE3o \xE9 permitido finalizar compra sem itens!"),!this.compra.naoGerarFinanceiro){const o=$utils.arredondar(this.compraCondicoesDePagamento.reduce((e,m)=>e+m.valor,0));$utils.verificarErro(!this.compra.formaDePagamento,"N\xE3o \xE9 permitido finalizar a compra sem informar a forma de pagamento!"),$utils.verificarErro(this.compraCondicoesDePagamento.length>0&&this.compra.totalDocumento!==o,"N\xE3o \xE9 permitido finalizar a compra se o valor total difere da soma das parcelas!"),$utils.verificarErro(this.compraCondicoesDePagamento.length===0,'Verifique se a op\xE7\xE3o "N\xE3o gerar financeiro" est\xE1 marcada, ou adicione as parcelas para finalizar a compra!')}return this.compra.operacao==="Nota de Entrada"&&($utils.verificarErro(!this.compra.notaNumero,"N\xE3o \xE9 permitido finalizar a compra sem informar o n\xFAmero da Nota de Entrada!"),$utils.verificarErro(!this.compra.notaSerie,"N\xE3o \xE9 permitido finalizar a compra sem informara s\xE9rie da Nota de Entrada!"),$utils.verificarErro(!this.compra.naturezaOperacao,"N\xE3o \xE9 permitido finalizar a compra sem informar natureza de opera\xE7\xE3o da Nota de Entrada!"),$utils.verificarErro(!this.compra.dataCompra,"N\xE3o \xE9 permitido finalizar a compra sem informar a data de compra da Nota de Entrada!"),$utils.verificarErro(!this.compra.chaveAcesso,"N\xE3o \xE9 permitido finalizar a compra sem informar a chave de acesso da Nota de Entrada!")),!0}catch(o){return $q.notifyError("Ocorreu um erro na valida\xE7\xE3o de campos",o),!1}},async finalizar_click(){if(!await this.validaCampos())return;let o=!1;this.compra.naoGerarFinanceiro||(o=await $q.dialogSimNao({title:"Gerar Financeiro",message:"Deseja gerar as provis\xF5es financeiras?"})),await $tryLoading(async()=>{this.compra.status="Finalizado",this.compra.dataHoraFinalizado=$utils.dataAtual(),this.compra.provisaoCompra=o?1:void 0,await this.finalizarItens(),o&&await this.gerarFinanceiro(),await this.salvar(),this.$emit("atualizar",{aba:"Finalizado"}),this.ocultarModal(),$q.notifyPositive("Compra finalizada com sucesso!"),o&&$q.notifyPositive("Provisionamento gerado com sucesso!")},{memsagem:"Finalizando Compra..."})},finalizarItens(){var i,h;let o=1,e=0,m=0,s=!1;const r=this.compra;if(r.subTotalProduto>0&&(r.tipoFrete==="FOB"&&r.freteSeparado===0&&(e=(r.valorFrete||0)+(r.valorSeguro||0)),o=((r.subTotalProduto||0)+(r.valorOutrasDespesas||0)-(r.totalDesconto||0)+(e||0))/(r.subTotalProduto||1)),m=this.compraItens.reduce((l,f)=>l+f.valorIcmsSt,m),m!==r.valorIcmsSt&&(s=!0),r.operacao==="Nota de Entrada")for(const l of this.compraItens)l.dataCompra=$utils.dataAtual(),s&&(l.valorIcmsSt=r.valorIcmsSt*((l==null?void 0:l.total)||0)/(r.subTotalProduto>0?r.subTotalProduto:1)),l.valorFreteRateado=r.valorFrete*(((l==null?void 0:l.total)||0)/(r.subTotalProduto||1)),l.valorSeguroRateado=r.valorSeguro*(((l==null?void 0:l.total)||0)/(r.subTotalProduto||1)),l.valorOutrasDespesasRateado=(r.valorOutrasDespesas||0)*(((l==null?void 0:l.total)||0)/(r.subTotalProduto||1)),l.descontoTotalRateado=(r.totalDesconto||0)*(((l==null?void 0:l.total)||0)/(r.subTotalProduto||1)),(l==null?void 0:l.valorIcmsSt)-(l==null?void 0:l.valorIcms)>0&&((l==null?void 0:l.valorIcmsSt)||0)-((l==null?void 0:l.valorIcms)||0),l.valorRealTotal=((l==null?void 0:l.total)||0)*o+((l==null?void 0:l.valorIpi)||0)+((l==null?void 0:l.valorIcms)||0),l.valorRealTotalImpostos=((l==null?void 0:l.total)||0)+l.valorFreteRateado+l.valorSeguroRateado+l.valorOutrasDespesasRateado-l.descontoTotalRateado+((l==null?void 0:l.valorIpi)||0)+((l==null?void 0:l.valorIcmsSt)||0),l.valorReal=l.valorRealTotalImpostos/((l==null?void 0:l.quantidade)||1),l.valorCustoReposicao=((i=this.produtos[l.idItem])==null?void 0:i.valorCustoReposicao)||0;if(r.operacao==="Pedido de Compra")for(const l of this.compraItens){s&&(l.valorIcmsSt=$utils.arredondar(r.valorIcmsSt*(l.total||0)/(r.subTotalProduto>0?r.subTotalProduto:1))),l.valorFreteRateado=$utils.arredondar((r.valorFrete||0)*(l.total||0)/(r.subTotalProduto||1),4),l.valorSeguroRateado=$utils.arredondar((r.valorSeguro||0)*(l.total||0)/(r.subTotalProduto||1),4),l.valorOutrasDespesasRateado=$utils.arredondar((r.valorOutrasDespesas||0)*(l.total||0)/(r.subTotalProduto||1),4),l.descontoTotalRateado=$utils.arredondar((r.totalDesconto||0)*(l.total||0)/(r.subTotalProduto||1),4);let f=0;l.valorIcmsSt-l.valorIcms>0&&(f=$utils.arredondar((l.valorIcmsSt||0)-(l.valorIcms||0),2)),l.valorRealTotal=$utils.arredondar((l.total||0)*o+(l.valorIpi||0)+(f>0?f:0),2),l.valorRealTotalImpostos=$utils.arredondar((l.total||0)+l.valorFreteRateado+l.valorSeguroRateado+l.valorOutrasDespesasRateado-l.descontoTotalRateado+(l.valorIpi||0)+(l.valorIcmsSt||0),4),l.valorReal=$utils.arredondar(l.valorRealTotalImpostos/(l.quantidade||1),4),l.valorCustoReposicao=$utils.arredondar(((h=this.produtos[l.idItem])==null?void 0:h.valorCustoReposicao)||0,2)}},async transformarEmNotaDeEntrada_click(){this.compra.operacao==="Pedido de Compra"&&await $tryLoading(async()=>{var m;const o=this.compraItens.map(({idItem:s})=>s).filter(Boolean),e=await $db.hibrido.lista({table:"itemFornecedor",whereIn:{idItem:o},whereFilter:{idContato:this.compra.idContato}});for(const s of this.compraItens)if(!e.some(({idItem:r})=>r===s.idItem)){const r={id:$utils.uuid(),idItem:s.idItem,idContato:this.compra.idContato,referencia:"",descricao:s.descricaoItem};await $db.hibrido.grava("itemFornecedor",{atual:r,original:{}})}for(const s of this.compraTitulos)s.formaDePagamento=(m=this.compra.formaDePagamento)!=null?m:"";this.compra.operacao="Nota de Entrada",this.compra.dataHoraFinalizado="",this.compra.status="Digita\xE7\xE3o",await this.salvar(),this.$emit("atualizar",{aba2:"Nota de Entrada",aba:"Digita\xE7\xE3o"}),this.ocultarModal(),$q.notifyPositive("Nota de Entrada gerada com sucesso!")},{mensagem:"Processando..."})},async mostrar({id:o}){this.visivel=!0;const e=$utils.logarIni("ComprasFicha");await $tryLoading(async()=>{this.compra.id=o,await this.atualizar()}),$utils.logarFim(e,1)},fechar(){this.compra.status==="Finalizado"?this.$emit("atualizar",{aba:"Finalizado"}):this.$emit("atualizar",{aba:"Digita\xE7\xE3o"}),this.ocultarModal(),this.dataPrevistaEntrega="",this.horaPrevistaEntrega="",this.produtos=[],this.limpaCampos(this),this.formasDePagamento=[],this.documentoNovo=!1,this.exibeInfNota=!1,this.valorTotalPagamento=0},ocultarModal(){this.visivel=!1},async abrirModalEmpresa(){const o={ativo:!0,empresas:!0},e=await $g.promptContato.show({filtro:o,placeholder:"Selecione"});if(!e)return;let m=(await $db.hibrido.lista({table:"empresa",where:{idContato:e.id}}))[0];if(!m){this.ocultarModal(),this.$q.notifyError("Erro ao selecionar empresa");return}this.contatos[e.id]||(this.contatos[e.id]=await $db.hibrido.le({table:"contato",id:e.id})),this.compra.descricaoEmpresa=m.nome,this.compra.idEmpresa=m.idContato,this.compra.numeroDocumentoEmpresa=m.numeroDocumentoNacional,this.compra.InscricaoMunicipalEmpresa=m.InscricaoMunicipalEmpresa},async abrirModalComprador(){const o=await this.selecionarContato({placeholder:"Selecione o comprador",filtro:{ativo:!0,compradores:!0}});o.id&&(this.compra.idContatoComprador=o.id),this.contatos[o.id]||(this.contatos[o.id]=await $db.hibrido.le({table:"contato",id:o.id}))},async abrirModalFornecedor(){const o={ativo:!0},e=await $g.promptContato.show({filtro:o,placeholder:"Selecione o fornecedor"});if(!e)return e;const m=await $db.contatoTelefone.le({idContato:e.id}),s=await $db.contatoEndereco.le({idContato:e.id}),r=m.find(l=>l.tipoTelefone==="Principal"||l.tipoTelefone==="WhatsApp")||m[0]||null,i=s.find(l=>l.grupo==="Principal")||s[0]||null;let h;return i&&Object.keys(i).length>0&&(h=`${i.logradouro}, ${i.numero} ${i.complemento} - ${i.bairro} - ${i.municipio}/${i.uf}`),e.id&&(this.compra.idContato=e.id,this.compra.descricaoContato=e.nome,this.compra.numeroDocumentoContato=e.numeroDocumentoNacional,this.compra.emailContato=(e==null?void 0:e.email)||null,this.compra.regimeContato=(e==null?void 0:e.regime)||null,this.compra.telefoneContato=(r==null?void 0:r.telefone)||null,this.compra.descricaoContatoEndereco=h||null),this.contatos[e.id]||(this.contatos[e.id]=await $db.hibrido.le({table:"contato",id:e.id})),e},async abrirModalVendedor(){const o=(await $db.contato.leFilhos(this.compra.idContato)).map(m=>m.id),e=await this.selecionarContato({placeholder:"Selecione o vendedor",filtro:{ativo:!0,usuarios:o}});e.id&&(this.compra.idContatoVendedor=e.id),this.contatos[e.id]||(this.contatos[e.id]=await $db.hibrido.le({table:"contato",id:e.id}))},async abrirModalTransportador(){const o=await this.selecionarContato({placeholder:"Selecione o transportadora",filtro:{ativo:!0,transportadoras:!0}});o.id&&(this.compra.idContatoTransportadora=o.id),this.contatos[o.id]||(this.contatos[o.id]=await $db.hibrido.le({table:"contato",id:o.id}))},async selecionarContato(o){const{placeholder:e,filtro:m}={placeholder:"Selecione o contato",filtro:{ativo:!0},...o},s=await $g.promptContato.show({filtro:m,placeholder:e});if(!s)throw new Error("Contato n\xE3o selecionado");return s},async adicionarItem(){let o={},e=[];for(const m of e)o[m.idItem]={item:await $db.hibrido.le({table:"item",id:m.idItem}),quantidade:m.quantidade};this.adicionar.modal.value=!0,this.adicionar.modal.name="Item"},async selecionarItens(o){var e,m;for(const s in o){let r=await $db.hibrido.lista({table:"estoqueSaldoProdutoEmpresa",whereFilter:{idEmpresa:this.compra.idEmpresa,tipoEstoque:"Dispon\xEDvel",idItem:s}});r=r[0];const i=await $db.configuracoes.porNome("vendas.checaestoque",this.compra.idEmpresa);Number((e=i.find(u=>u.id))==null?void 0:e.valor);const h=o[s].item||{},l=((m=(await $db.hibrido.lista({table:"itemFornecedor",whereFilter:{idItem:h.id}}))[0])==null?void 0:m.referencia)||null,f=o[s].quantidade||0,b=(h==null?void 0:h.valorCustoReposicao)||(r==null?void 0:r.valorCustoMedio)||0;let c=this.compraItens.find(u=>u.idItem===s);const C=(await $erp().cfop.where({cfop:5102}).toArray())[0],p=await $db.financeiroPlanoConta.lePorConfig("financeiro.planocontas.comprageral");if(c)c.quantidade=$utils.arredondar(f,4),c.quantidadeRealizado=$utils.arredondar(f,4),c.subTotal=$utils.arredondar(b,2),c.total=$utils.arredondar(f*b,2);else{const u={dataHoraEmissao:$utils.dataAtual(),dataHoraFinalizado:"",descricaoItem:h.descricao,id:$utils.uuid(),idDocumento:this.compra.id,idItem:h.id,referencia:h.referencia,referenciaFornecedor:l,ncm:h.ncm||null,operacao:"Compra de Mercadoria",operacaoFator:1,idCfop:C==null?void 0:C.id,idPlanoContaEstoque:p==null?void 0:p.id,quantidade:$utils.arredondar(f,4),quantidadeRealizado:$utils.arredondar(f,4),status:"Digita\xE7\xE3o",tipoItem:h.tipo,subTotal:$utils.arredondar(b,2),total:$utils.arredondar(f*b,2),unidade:h.unidade,valorCustoMedio:(r==null?void 0:r.valorCustoMedio)||0,valorItem:b,valorOriginal:b,observacao:""};this.produtos[h.id]=await $db.item.leCompleto({id:h.id}),this.compraItens.push(u),await this.processarImagem(this.compraItens)}this.compra.subTotal=0,this.compra.subTotalProduto=0;for(let u in this.compraItens)this.compra.subTotal+=this.compraItens[u].total,this.compra.subTotalProduto+=this.compraItens[u].total;this.compra.subTotal=$utils.arredondar(this.compra.subTotal,2),this.compra.totalDocumento=this.compra.subTotal}},calcularTotaisItem(o,e){const m=$utils.clonar(this.compraItens[o]),s=m.valorOriginal||0,r=m.quantidade||0;let i=m.valorItem||0,h=m.descontoPercentualItem||0,l=m.descontoItem||0,f=m.subTotal||0,b=m.total||0;e==="descontoPercentualItem"&&((h<0||h>100)&&(h=0),l=i*h/100,f=i-l),e==="descontoItem"&&((l<0||l>i)&&(l=0),h=l/i*100,f=i-l),e==="valorItem"&&(i<s&&(i=s),l>i&&(l=0,h=0),h=l/i*100,f=i-l),e==="subTotal"&&((f<0||f>i)&&(f=i),l=i-f,h=l/i*100),b=r*f,m.valorItem=i,m.descontoItem=l,m.descontoPercentualItem=h,m.subTotal=f,m.total=b,this.compraItens[o]=m,this.calcularTotais("totalDesconto")},calcularTotais(o){const e=$utils.clonar(this.compra);let m=0,s=0,r=0,i=e.totalDesconto||0,h=e.totalPercentualDesconto||0,l=e.valorFrete||0,f=e.valorSeguro||0,b=e.valorOutrasDespesas||0,c=0,C=0,p=0,u=0,E=0;this.erroFrete=!1,this.erroSeguro=!1,this.erroOutrasDespesas=!1;for(const n of this.compraItens)m+=n.total,c+=n.valorBaseIcms||0,C+=n.valorIcms||0,p+=n.valorBaseIcmsSt||0,u+=n.valorIcmsSt||0,E+=n.valorIpi||0;o==="totalPercentualDesconto"&&(this.erroDesconto=!1,(h<0||h>100)&&(this.erroDesconto=!0),i=m*h/100),o==="totalDesconto"&&(this.erroDesconto=!1,(i<0||i>m)&&(this.erroDesconto=!0),h=i/m*100),l<0&&(this.erroFrete=!0),l=e.tipoFrete==="FOB"?l:0,f<0&&(this.erroSeguro=!0),f=e.tipoFrete==="FOB"?f:0,b<0&&(this.erroOutrasDespesas=!0),e.calcularTributacao||(c=0,C=0,p=0,u=0),e.totalComImposto||(E=0),s=m-i+l+f+b,r=s+E,e.valorBaseIcms=$utils.arredondar(c,2),e.valorIcms=$utils.arredondar(C),e.valorBaseIcmsSt=$utils.arredondar(p),e.valorIcmsSt=$utils.arredondar(u),e.valorIpi=$utils.arredondar(E),e.totalDesconto=$utils.arredondar(i),e.totalPercentualDesconto=$utils.arredondar(h),e.subTotalProduto=$utils.arredondar(m),e.totalProduto=$utils.arredondar(m)-$utils.arredondar(i),e.subTotal=$utils.arredondar(s),e.totalDocumento=$utils.arredondar(r),this.compra=e},limpaCampos(o){o.compra={},o.compraOriginal={},o.compraItens=[],o.compraItensOriginal=[],o.compraCondicoesDePagamento=[],o.compraCondicoesDePagamentoOriginal=[],o.compraTitulos=[],o.compraTitulosOriginal=[],o.compraMovimentacoes=[],o.compraMovimentacoesOriginal=[]},async salvar(){this.compra.totalComImposto&&delete this.compra.totalComImposto;for(const o of this.compraItens)o.dataHoraFinalizado=this.compra.dataHoraFinalizado,o.status=this.compra.status;this.compra.id?await $db.hibrido.grava("documento",{atual:this.compra,original:this.compraOriginal}):this.compraOriginal.id&&await $db.hibrido.remove("documento",this.compraOriginal),await $db.hibrido.gravaLista("documentoItem",{atual:this.compraItens,original:this.compraItensOriginal}),await $db.hibrido.gravaLista("documentoCondicaoPagamento",{atual:this.compraCondicoesDePagamento,original:this.compraCondicoesDePagamentoOriginal}),await $db.hibrido.gravaLista("financeiroTitulo",{atual:this.compraTitulos,original:this.compraTitulosOriginal}),await $db.hibrido.gravaLista("financeiroMovimentacao",{atual:this.compraMovimentacoes,original:this.compraMovimentacoesOriginal}),this.compra.totalComImposto=!0,this.calculaKardex()},async calculaKardex(){const o=$utils.logarIni("calculaKardex"),e=this.compraItens.map(({idItem:m})=>m).filter(Boolean);try{e.length&&await $utils.geeksApi({calculaKardex:{funcao:"9913E9FD-24A5-4C0A-9F1E-AACCDC7EAB9D",idsItem:e}})}catch(m){console.error(`Erro ao calcular Kardex
`,m)}$utils.logarFim(o,e.length)},async reabrir_click(){!await $q.dialogSimNao({title:"Reabertura",message:`Deseja reabrir o documento?<br/>${this.compra.naoGerarFinanceiro?"":"<strong>O Financeiro ser\xE1 apagado!</strong>"}`,html:!0})||await $tryLoading(async()=>{await this.retornarParaDigitacao(),await this.salvar(),await this.atualizar(),$q.notifyPositive("Documento reaberto para digita\xE7\xE3o!")},{mensagem:"Reabrindo..."})},async retornarParaDigitacao(){$utils.verificarErro(this.compra.status!=="Finalizado","N\xE3o \xE9 poss\xEDvel realizar esta opera\xE7\xE3o em documento n\xE3o finalizado.");const o=this.compraTitulos.filter(({dataPagamento:e})=>e);$utils.verificarErro(o.length,"N\xE3o \xE9 poss\xEDvel excluir o Financeiro. Parcelas provisionadas j\xE1 pagas!"),this.compra.dataHoraFinalizado="",this.compra.status="Digita\xE7\xE3o",this.compra.operacao==="Pedido de Compra"&&(this.compraTitulos=[],this.compraMovimentacoes=[])},async removerPagamento_click(o){try{this.compraCondicoesDePagamento=this.compraCondicoesDePagamento.filter(e=>e.id!==o.id),this.compraCondicoesDePagamento.sort((e,m)=>{let s=new Date(e.dataVencimento),r=new Date(m.dataVencimento);return s-r}),await this.atualizaValorTotalPagamento({condicao:o,acao:"remover"})}catch(e){console.log(e.message)}},async gerarCondicoesDePagamento_click(){var o;try{let e=this.compra.id,m=this.compra.condicaoPagamento,s=(o=this.compra.notaNumero)!=null?o:null;this.compra.naoGerarFinanceiro||await this.gerarParcelamento(e,m,s),this.compra.naoGerarFinanceiro&&(this.compraCondicoesDePagamento=[])}catch(e){console.log(e.message)}},async gerarParcelamento(o,e,m){var C;this.compraCondicoesDePagamento=[];const s=$utils.clonar(this.compra),r=e.split("/").length,i=!!(s!=null&&s.dataCompra)&&(s==null?void 0:s.dataCompra)!==""?s.dataCompra:!!(s!=null&&s.dataHoraPrevisto)&&(s==null?void 0:s.dataHoraPrevisto)!==""?s.dataHoraPrevisto:!!this.dataPrevistaEntrega&&this.dataPrevistaEntrega!==""?new Date(this.dataPrevistaEntrega):$utils.dataAtual(),h=(s==null?void 0:s.freteSeparado)||0;let l=$utils.arredondar(s==null?void 0:s.totalDocumento,2);const f=((s==null?void 0:s.valorFrete)||0)+((s==null?void 0:s.valorSeguro)||0);if(h&&(s==null?void 0:s.tipoFrete)==="FOB"&&f>0){let p={id:$utils.uuid(),idDocumento:s==null?void 0:s.id,dataVencimento:i,valor:f,observacao:"Valor Frete + Seguro",freteSeparado:!0};this.compraCondicoesDePagamento.push(p),l-=f}let b=0,c=l/r;for(let p in e.split("/")){let u=!!(s!=null&&s.dataCompra)&&(s==null?void 0:s.dataCompra)!==""?s.dataCompra:!!(s!=null&&s.dataHoraPrevisto)&&(s==null?void 0:s.dataHoraPrevisto)!==""?s.dataHoraPrevisto:!!this.dataPrevistaEntrega&&this.dataPrevistaEntrega!==""?new Date(this.dataPrevistaEntrega):$utils.dataAtual();typeof u=="string"&&(u=(C=new Date(u))!=null?C:$utils.dataAtual()),u.setDate(u.getDate()+parseInt(e.split("/")[p])||0);let E={id:$utils.uuid(),idDocumento:s==null?void 0:s.id,dataVencimento:x.formatDate(u),valor:c,observacao:""};this.compraCondicoesDePagamento.push(E),b+=c||0}l!==b&&(this.compraCondicoesDePagamento[0].valor+=(l||0)-(b||0)),this.valorTotalPagamento=h&&(s==null?void 0:s.tipoFrete)==="FOB"?l+f:l},async gerarFinanceiro(){var h,l;const o=await $db.financeiroPlanoConta.lePorConfig("financeiro.planocontas.comprageral"),e=[];for(const f of this.compraItens){if(f.idPlanoContaEstoque===o.id)continue;const b=(f.total||0)-(f.descontoTotalRateado||0),c=e.findIndex(({idPlanoContaEstoque:C})=>C===f.idPlanoContaEstoque);c!==-1?e[c].valor+=b:e.push({idPlanoContaEstoque:f.idPlanoContaEstoque,idPlanoContaDestino:"",valor:b,porcentagem:0})}for(const f of e)f.valor=$utils.arredondar(f.valor),f.porcentagem=$utils.arredondar(f.valor/this.compra.totalDocumento,4);const m=await $db.financeiroPlanoConta.lePorConfig("financeiro.planocontas.freteaquisicao"),s=this.compraTitulos.filter(({dataPagamento:f})=>f);$utils.verificarErro(s.length,"N\xE3o \xE9 poss\xEDvel regerar o Financeiro. Parcelas provisionadas j\xE1 pagas!");const r=x.formatDate(new Date().setHours(0,0,0,0));this.compraTitulos=[];for(const f in this.compraCondicoesDePagamento){const b=this.compraCondicoesDePagamento[f],c=[b.observacao,this.compra.codigoDocumento?`Pedido de Compra: ${this.compra.codigoDocumento}`:"",this.compra.notaNumero?`Nota nro: ${this.compra.notaNumero}`:""].filter(Boolean).join(" | "),C={id:$utils.uuid(),dataEmissao:r,dataCompetencia:r,dataVencimento:x.formatDate(new Date(b.dataVencimento).setHours(0,0,0,0)),dataVencimentoOriginal:x.formatDate(new Date(b.dataVencimento).setHours(0,0,0,0)),valor:$utils.arredondar(b.valor,2),tipoJuros:"dia",valorMulta:0,percentualJuros:0,documentoTipo:this.compra.operacao,parcela:`${Number(f)+1}/${this.compraCondicoesDePagamento.length}`,descricao:this.compra.operacao,observacao:c,formaDePagamento:this.compra.operacao!=="Pedido de Compra"?`Provis\xE3o Pedido - ${(h=this.compra.formaDePagamento)!=null?h:""}`:(l=this.compra.formaDePagamento)!=null?l:"",receberPagar:0,valorOriginal:$utils.arredondar(b.valor,2),documentoVinculado:1,valorTotal:$utils.arredondar(b.valor,2),valorARealizar:$utils.arredondar(b.valor,2),valorDesconto:0,percentualDesconto:0,idEmpresa:this.compra.idEmpresa,idContato:(b==null?void 0:b.freteSeparado)&&!!this.compra.idContatoTransportadora?this.compra.idContatoTransportadora:this.compra.idContato,idFinanceiroPlanoConta:b.observacao==="Valor Frete + Seguro"?m.id:o==null?void 0:o.id,documentoId:this.compra.id,idFinanceiroMovimentacaoAgrupamentoAutomatico:$utils.uuid(),cobrancaAtivo:1};this.compraTitulos.push(C)}const i=$utils.uuid();this.compraMovimentacoes=[];for(const f of e){const b={id:$utils.uuid(),idFinanceiroMovimentacaoN:i,idEmpresa:this.compra.idEmpresa,idFinanceiroPlanoConta:o.id,dataEmissao:r,valorCredito:this.compra.totalDocumento*f.porcentagem,valorDebito:0,descricao:o.descricao.trim(),observacao:"",automatico:0,liquidando:0,dataCompetencia:r,dataVencimento:r,dataMovimento:r,documentoTipo:this.compra.operacao,documentoId:this.compra.id};this.compraMovimentacoes.push(b);const c=await $db.financeiroPlanoConta.leCache({id:f.idPlanoContaEstoque}),C={id:$utils.uuid(),idFinanceiroMovimentacaoN:i,idEmpresa:this.compra.idEmpresa,idFinanceiroPlanoConta:f.idPlanoContaEstoque,dataEmissao:r,valorCredito:0,valorDebito:this.compra.totalDocumento*f.porcentagem,descricao:c.descricao.trim(),observacao:"",automatico:0,liquidando:0,dataCompetencia:r,dataVencimento:r,dataMovimento:r,documentoTipo:this.compra.operacao,documentoId:this.compra.id};this.compraMovimentacoes.push(C)}},async processarImagem(o){if(!!o){for(const e of o)if(!this.itensImagens.hasOwnProperty(e.idItem)){const m=await $db.item.leCompleto({id:e.idItem});Object.keys(m.atual).length>0&&(m.atual.imagem===""||m.atual.imagem)?this.itensImagens[e.idItem]={imagem:m.atual.imagem}:Object.keys(m.original).length>0&&(m.original.imagem===""||m.original.imagem)&&(this.itensImagens[e.idItem]={imagem:m.original.imagem})}}},async atualizaValorTotalPagamento({condicao:o,acao:e}){!o||e==="remover"&&(this.valorTotalPagamento=this.valorTotalPagamento-o.valor)},async ajustarPrevisaoEntrega(o){o==="alterar"&&(this.alterarPrevisaoEntrega=!0),o==="salvar"&&(await $tryLoading(async()=>{const e=`${this.dataPrevistaEntrega} ${this.horaPrevistaEntrega||"00:00:00"}`;$utils.verificarErro(!this.dataPrevistaEntrega&&this.horaPrevistaEntrega,"\xC9 necess\xE1rio preencher uma data em conjunto com a hora."),x.formatDate(e)!==x.formatDate(this.compra.dataHoraPrevisto)?(this.compra.dataHoraPrevisto=x.formatDate(e)||"",await this.salvar(),await this.atualizar(),$q.notifyPositive("A previs\xE3o foi salva com sucesso")):$q.notifyPositive("N\xE3o h\xE1 dados alterados.")}),this.alterarPrevisaoEntrega=!1)}}},za={class:"row items-center"},Ua={class:"col-auto"},Ma={class:"col-auto"},Ba=N("span",{class:"q-px-xs"},"|",-1);function Oa(o,e,m,s,r,i){const h=w("g-label"),l=w("g-col"),f=w("Badge"),b=w("BadgeCopiarUid"),c=w("g-row"),C=w("avatar"),p=w("campo"),u=w("ModalEditarProdutoCompras"),E=w("PromptItemV2");return I(),U(A,null,[a(oa,{modelValue:o.visivel,"onUpdate:modelValue":e[36]||(e[36]=n=>o.visivel=n),persistent:"",maximized:"",onKeyup:fa(i.fechar,["esc"])},{default:t(()=>[a(K,{view:"hHh lpR lFr",container:"",class:"bg-light"},{default:t(()=>[a(Z,null,{default:t(()=>[a(X,null,{default:t(()=>[a(F,{onClick:i.fechar,icon:"arrow_back",flat:"",round:"",dense:""},null,8,["onClick"]),a(W,null,{default:t(()=>[g(V(o.compra.operacao),1)]),_:1}),k(a(F,{onClick:i.salvar_click,label:"Salvar",color:"white","text-color":"primary",unelevated:"",class:"q-ml-sm"},null,8,["onClick"]),[[M,o.compra.status==="Digita\xE7\xE3o"]])]),_:1})]),_:1}),a(Y,{class:"u-container"},{default:t(()=>[a(aa,null,{default:t(()=>[a(c,{gutter:"md",mg:"md",bg:"bg-white"},{default:t(()=>[a(l,{col:"12 sm12 md6"},{default:t(()=>[a(c,{items:"center",justify:"end",class:"hideondesktop",style:{border:"1px solid salmon"}},{default:t(()=>[a(l,{col:"xs-shrink",order:"1 sm0"},{default:t(()=>[k(a(h,{text:"caption",icon:"mdi-calendar-today sm tertiary left",tip:`Emitido \xE1s ${o.$filters.hora(o.compra.dataHoraEmissao)}`},{default:t(()=>[g(V(o.$filters.data(o.compra.dataHoraEmissao)),1)]),_:1},8,["tip"]),[[M,o.compra.dataHoraEmissao]])]),_:1}),a(l,{col:"xs-shrink",order:"1 sm0"},{default:t(()=>[k(a(h,{text:"caption",icon:"mdi-calendar-today sm tertiary left",tip:`Finalizado \xE1s ${o.$filters.hora(o.compra.dataHoraFinalizado)}`},{default:t(()=>[g(V(o.$filters.data(o.compra.dataHoraFinalizado)),1)]),_:1},8,["tip"]),[[M,o.compra.dataHoraFinalizado]])]),_:1}),a(l,{col:"xs12 sm-shrink",order:"0 sm1",text:"right"},{default:t(()=>[a(f,{cor:o.compra.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:o.compra.status!=="Digita\xE7\xE3o",class:"q-ml-sm"},{default:t(()=>[g(V(o.compra.status),1)]),_:1},8,["cor","escuro"]),a(b,{id:o.compra.id,numero:o.compra.numero,cor:"positive",class:"q-ml-sm"},null,8,["id","numero"])]),_:1})]),_:1}),a(c,null,{default:t(()=>[a(l,{col:"12 sm6"},{default:t(()=>[a(c,null,{default:t(()=>[a(l,{col:"xs-shrink"},{default:t(()=>[a(C,{imagem:(o.contatos[o.compra.idContato]||{}).imagem,rotulo:(o.contatos[o.compra.idContato]||{}).apelido,tamanho:"50"},null,8,["imagem","rotulo"])]),_:1}),a(l,{col:"xs"},{default:t(()=>[a(p,{modelValue:(o.contatos[o.compra.idContato]||{}).apelido,"onUpdate:modelValue":e[0]||(e[0]=n=>(o.contatos[o.compra.idContato]||{}).apelido=n),after:[{icon:"edit",handler(){i.abrirModalFornecedor()}}],disable:o.compra.status!=="Digita\xE7\xE3o",rotulo:"Fornecedor",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","after","disable"])]),_:1})]),_:1})]),_:1}),a(l,{col:"12 sm6"},{default:t(()=>[a(p,{modelValue:(o.contatos[o.compra.idContatoVendedor]||{}).apelido,"onUpdate:modelValue":e[1]||(e[1]=n=>(o.contatos[o.compra.idContatoVendedor]||{}).apelido=n),disable:o.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){i.abrirModalVendedor()}}],rotulo:"Vendedor",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]),_:1}),a(l,{col:"12 sm6"},{default:t(()=>[a(p,{modelValue:(o.contatos[o.compra.idEmpresa]||{}).apelido,"onUpdate:modelValue":e[2]||(e[2]=n=>(o.contatos[o.compra.idEmpresa]||{}).apelido=n),after:[{icon:"edit",handler(){i.abrirModalEmpresa()}}],disable:o.compra.status!=="Digita\xE7\xE3o",rotulo:"Empresa",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","after","disable"])]),_:1}),a(l,{col:"12 sm6"},{default:t(()=>[a(p,{modelValue:(o.contatos[o.compra.idContatoComprador]||{}).apelido,"onUpdate:modelValue":e[3]||(e[3]=n=>(o.contatos[o.compra.idContatoComprador]||{}).apelido=n),disable:o.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){i.abrirModalComprador()}}],rotulo:"Comprador",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]),_:1}),a(l,{col:"12 sm6"},{default:t(()=>[a(p,{modelValue:(o.contatos[o.compra.idContatoTransportadora]||{}).apelido,"onUpdate:modelValue":e[4]||(e[4]=n=>(o.contatos[o.compra.idContatoTransportadora]||{}).apelido=n),disable:o.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){i.abrirModalTransportador()}}],rotulo:"Transportadora",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]),_:1}),a(l,{col:"12 sm6"},{default:t(()=>[a(c,null,{default:t(()=>[a(l,{col:"7"},{default:t(()=>[a(la,{modelValue:o.dataPrevistaEntrega,"onUpdate:modelValue":e[5]||(e[5]=n=>o.dataPrevistaEntrega=n),disable:!this.alterarPrevisaoEntrega&&this.compra.status!=="Digita\xE7\xE3o",type:"date",label:"Data Prevista de Entrega",clearable:"",dense:"","stack-label":"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable"])]),_:1}),a(l,{col:"5"},{default:t(()=>[a(la,{modelValue:o.horaPrevistaEntrega,"onUpdate:modelValue":e[6]||(e[6]=n=>o.horaPrevistaEntrega=n),disable:!this.alterarPrevisaoEntrega&&this.compra.status!=="Digita\xE7\xE3o",type:"time",label:"Hora Prevista de Entrega",clearable:"",dense:"","stack-label":"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(l,{col:"12 sm12 md6"},{default:t(()=>[a(c,{justify:"end",items:"center",text:"right",class:"hideonmobile"},{default:t(()=>[a(l,{col:"12"},{default:t(()=>[a(c,{justify:"end",items:"center"},{default:t(()=>[a(f,{cor:o.compra.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:o.compra.status!=="Digita\xE7\xE3o"},{default:t(()=>[g(V(o.compra.status),1)]),_:1},8,["cor","escuro"]),a(b,{id:o.compra.id,numero:o.compra.numero,cor:"positive",class:"q-ml-sm"},null,8,["id","numero"]),a(F,{color:"tertiary",flat:"",icon:"more_vert",round:""},{default:t(()=>[a(G,null,{default:t(()=>[k((I(),y(O,{link:"",separator:""},{default:t(()=>[o.alterarPrevisaoEntrega?(I(),y(z,{key:1,clickable:"",onClick:e[8]||(e[8]=n=>i.ajustarPrevisaoEntrega("salvar"))},{default:t(()=>[a(D,{avatar:""},{default:t(()=>[a(_,{name:"local_shipping"})]),_:1}),a(D,null,{default:t(()=>[a($,null,{default:t(()=>[g("Salvar Previs\xE3o de Entrega")]),_:1})]),_:1})]),_:1})):(I(),y(z,{key:0,disable:o.compra.status==="Digita\xE7\xE3o",clickable:"",onClick:e[7]||(e[7]=n=>i.ajustarPrevisaoEntrega("alterar"))},{default:t(()=>[a(D,{avatar:""},{default:t(()=>[a(_,{name:"local_shipping"})]),_:1}),a(D,null,{default:t(()=>[a($,null,{default:t(()=>[g("Alterar Previs\xE3o de Entrega")]),_:1})]),_:1})]),_:1},8,["disable"]))]),_:1})),[[L]])]),_:1})]),_:1})]),_:1})]),_:1}),a(l,{col:"shrink"},{default:t(()=>[k(a(h,{text:"caption",icon:"mdi-calendar-today sm tertiary left",tip:`Emitido \xE1s ${o.$filters.hora(o.compra.dataHoraEmissao)}`},{default:t(()=>[g(V(o.$filters.data(o.compra.dataHoraEmissao)),1)]),_:1},8,["tip"]),[[M,o.compra.dataHoraEmissao]])]),_:1}),a(l,{col:"shrink"},{default:t(()=>[k(a(h,{text:"caption",icon:"mdi-calendar sm tertiary left",tip:`Finalizado \xE1s ${o.$filters.hora(o.compra.dataHoraFinalizado)}`},{default:t(()=>[g(V(o.$filters.data(o.compra.dataHoraFinalizado)),1)]),_:1},8,["tip"]),[[M,o.compra.dataHoraFinalizado]])]),_:1})]),_:1}),a(c,null,{default:t(()=>[a(l,null,{default:t(()=>[a(p,{modelValue:o.compra.observacao,"onUpdate:modelValue":e[9]||(e[9]=n=>o.compra.observacao=n),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",tipo:"textoArea",rotulo:"Observa\xE7\xE3o",rows:"4"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})]),_:1})]),_:1}),a(c,{gutter:"md",mg:"md",bg:"bg-white"},{default:t(()=>[o.exibeInfNota?(I(),y(Ia,{key:0,"default-opened":o.compra.notaNumero>0||o.documentoNovo,"header-class":"q-px-sm",class:"notaEntrada g-col col-12"},{header:t(()=>[a(D,null,{default:t(()=>[a(h,{text:"sub1 medium",icon:"mdi-file-replace sm tertiary left"},{default:t(()=>[g("Nota de Entrada")]),_:1})]),_:1})]),default:t(()=>[a(l,{col:"12"},{default:t(()=>[a(c,null,{default:t(()=>[a(l,{col:"12 sm6 md3"},{default:t(()=>[a(p,{modelValue:o.compra.notaNumero,"onUpdate:modelValue":e[10]||(e[10]=n=>o.compra.notaNumero=n),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Numero",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),a(l,{col:"12 sm6 md3"},{default:t(()=>[a(p,{modelValue:o.compra.notaSerie,"onUpdate:modelValue":e[11]||(e[11]=n=>o.compra.notaSerie=n),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Serie",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),a(l,{col:"12 sm6 md3"},{default:t(()=>[a(p,{modelValue:o.compra.naturezaOperacao,"onUpdate:modelValue":e[12]||(e[12]=n=>o.compra.naturezaOperacao=n),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Natureza da Opera\xE7\xE3o",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),a(l,{col:"12 sm6 md3"},{default:t(()=>[a(p,{modelValue:o.compra.dataCompra,"onUpdate:modelValue":e[13]||(e[13]=n=>o.compra.dataCompra=n),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Data compra",tipo:"data",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),a(l,{col:"12"},{default:t(()=>[a(p,{modelValue:o.compra.chaveAcesso,"onUpdate:modelValue":e[14]||(e[14]=n=>o.compra.chaveAcesso=n),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Chave",dense:""},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})]),_:1})]),_:1},8,["default-opened"])):S("",!0)]),_:1}),a(c,{gutter:"md",mg:"md",bg:"bg-white"},{default:t(()=>[a(l,{col:"12"},{default:t(()=>[a(h,{text:"sub1 medium",icon:"shopping_cart sm tertiary left"},{default:t(()=>[g("Carrinhos "),a(F,{onClick:e[15]||(e[15]=n=>i.adicionarItem()),disable:o.compra.status!=="Digita\xE7\xE3o",icon:"add",label:"Produto",size:"md",color:"primary",flat:"",dense:"",class:"float-right q-px-sm"},null,8,["disable"])]),_:1})]),_:1}),(I(!0),U(A,null,j(o.compraItens,(n,d)=>(I(),y(l,{col:"12",key:d},{default:t(()=>[a(O,{class:"full-width"},{default:t(()=>[a(z,{class:"q-px-none"},{default:t(()=>{var v;return[a(D,{avatar:"",class:"col-auto"},{default:t(()=>[a(C,{imagem:(o.itensImagens[n.idItem]||{}).imagem,rotulo:n.descricaoItem,tamanho:"50"},null,8,["imagem","rotulo"])]),_:2},1024),a(D,{class:"q-px-none"},{default:t(()=>[a($,null,{default:t(()=>[g(V(n.descricaoItem),1)]),_:2},1024),a($,{caption:""},{default:t(()=>{var P,q;return[g(V((q=(P=o.produtos[n.idItem])==null?void 0:P.marca)!=null?q:""),1)]}),_:2},1024)]),_:2},1024),k(a(D,{avatar:""},{default:t(()=>[a(f,{denso:""},{default:t(()=>{var P,q;return[g(V((q=(P=o.produtos[n.idItem])==null?void 0:P.referencia)!=null?q:""),1)]}),_:2},1024)]),_:2},1536),[[M,(v=o.produtos[n.idItem])==null?void 0:v.referencia]]),a(D,{avatar:""},{default:t(()=>[N("div",za,[N("div",Ua,[a(F,{color:"primary",dense:"",flat:"",icon:"edit",round:"",onClick:P=>i.editarProduto(n),disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["onClick","disable"])]),N("div",Ma,[a(F,{color:"tertiary",dense:"",flat:"",icon:"delete",round:"",onClick:P=>i.removerItem(n),disable:o.compra.status!=="Digita\xE7\xE3o"},{default:t(()=>[a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g("Remover Item")]),_:1})]),_:2},1032,["onClick","disable"])])])]),_:2},1024)]}),_:2},1024)]),_:2},1024),a(c,null,{default:t(()=>[a(l,{col:"4 md"},{default:t(()=>[a(p,{dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"",rotulo:"Valor do produto",modelValue:n.valorItem,"onUpdate:modelValue":v=>n.valorItem=v,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",onBlur:v=>i.calcularTotaisItem(d,"valorItem")},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),_:2},1024),a(l,{col:"4 md"},{default:t(()=>[a(c,{items:"center"},{default:t(()=>[a(l,{col:"shrink"},{default:t(()=>[a(_,{name:"mdi-minus",color:"primary"})]),_:1}),a(l,{col:"xs"},{default:t(()=>[a(p,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",rotulo:"Desconto percentual",modelValue:n.descontoPercentualItem,"onUpdate:modelValue":v=>n.descontoPercentualItem=v,outlined:"",suffix:"%","somente-leitura":o.compra.status!=="Digita\xE7\xE3o",onBlur:v=>i.calcularTotaisItem(d,"descontoPercentualItem")},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(l,{col:"4 md"},{default:t(()=>[a(p,{dense:"",tipo:"decimal",modelValue:n.descontoItem,"onUpdate:modelValue":v=>n.descontoItem=v,decimals:"4",zerosDireita:"2",outlined:"",rotulo:"Desconto em reais",prefix:"R$",onBlur:v=>i.calcularTotaisItem(d,"descontoItem"),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","somente-leitura"])]),_:2},1024),a(l,{col:"6 md"},{default:t(()=>[a(c,{items:"center"},{default:t(()=>[a(l,{col:"shrink",class:"hideonmobile"},{default:t(()=>[a(_,{name:"mdi-equal",color:"primary"})]),_:1}),a(l,{col:"xs"},{default:t(()=>[a(p,{dense:"",outlined:"",opcoes:{maximumValue:10,minimumValue:0},rotulo:"Subtotal",tipo:"decimal",decimals:"4",zerosDireita:"2",modelValue:n.subTotal,"onUpdate:modelValue":v=>n.subTotal=v,onBlur:v=>i.calcularTotaisItem(d,"subTotal"),"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","somente-leitura"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(l,{col:"6 md"},{default:t(()=>[a(c,{items:"center"},{default:t(()=>[a(l,{col:"shrink"},{default:t(()=>[a(_,{name:"mdi-close",color:"primary"})]),_:1}),a(l,{col:"xs"},{default:t(()=>[a(p,{dense:"",max:"100",min:"0",outlined:"",modelValue:n.quantidade,"onUpdate:modelValue":v=>n.quantidade=v,decimals:"4",zerosDireita:"0",tipo:"quantidade",onBlur:v=>i.calcularTotaisItem(d),disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","disable"]),a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g("Quantidade")]),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1024),a(l,{col:"12 md"},{default:t(()=>[a(c,{items:"center"},{default:t(()=>[a(l,{col:"shrink",class:"hideonmobile"},{default:t(()=>[a(_,{name:"mdi-equal",color:"primary"})]),_:1}),a(l,{col:"xs"},{default:t(()=>[a(p,{dense:"",tipo:"decimal",decimals:"2",rotulo:"Total","somente-leitura":!0,modelValue:n.total,"onUpdate:modelValue":v=>n.total=v,outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),a(l,{col:"12"},{default:t(()=>[a(c,{gutter:"md",mg:"md-y",justify:"end",items:"center",bg:"bg-light","rounded-borders":"","min-height":"49px"},{default:t(()=>[a(l,{col:"3 sm2 md-shrink",text:"bold"},{default:t(()=>[g(" Calcular ")]),_:1}),a(l,{col:"9 sm10 md"},{default:t(()=>[a(R,{modelValue:o.compra.calcularTributacao,"onUpdate:modelValue":[e[16]||(e[16]=n=>o.compra.calcularTributacao=n),i.calcularTotais],"checked-icon":"check",color:"green","unchecked-icon":"clear",disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),a(l,{col:"6 md-shrink"},{default:t(()=>[g(" Base ICMS ")]),_:1}),a(l,{col:"6 md",text:"right"},{default:t(()=>[a(p,{dense:"",outlined:"",decimals:"2",zerosDireita:"2",tipo:"decimal",modelValue:o.compra.valorBaseIcms,"onUpdate:modelValue":e[17]||(e[17]=n=>o.compra.valorBaseIcms=n),somenteLeitura:o.compra.calcularTributacao||o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somenteLeitura"])]),_:1}),a(l,{col:"6 md-shrink"},{default:t(()=>[g(" Valor ICMS ")]),_:1}),a(l,{col:"6 md",text:"right"},{default:t(()=>[a(p,{dense:"",outlined:"",modelValue:o.compra.valorIcms,"onUpdate:modelValue":e[18]||(e[18]=n=>o.compra.valorIcms=n),decimals:"2",zerosDireita:"2",tipo:"decimal",somenteLeitura:o.compra.calcularTributacao||o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somenteLeitura"])]),_:1}),a(l,{col:"6 md-shrink"},{default:t(()=>[g(" Base ICMS ST ")]),_:1}),a(l,{col:"6 md",text:"right"},{default:t(()=>[a(p,{dense:"",outlined:"",modelValue:o.compra.valorBaseIcmsSt,"onUpdate:modelValue":e[19]||(e[19]=n=>o.compra.valorBaseIcmsSt=n),decimals:"2",zerosDireita:"2",tipo:"decimal",somenteLeitura:o.compra.calcularTributacao||o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somenteLeitura"])]),_:1}),a(l,{col:"6 md-shrink"},{default:t(()=>[g(" ICMS ST ")]),_:1}),a(l,{col:"6 md",text:"right"},{default:t(()=>[a(p,{dense:"",outlined:"",modelValue:o.compra.valorIcmsSt,"onUpdate:modelValue":e[20]||(e[20]=n=>o.compra.valorIcmsSt=n),decimals:"2",zerosDireita:"2",tipo:"decimal",somenteLeitura:o.compra.calcularTributacao||o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somenteLeitura"])]),_:1})]),_:1}),a(c,{mg:"lg-t",justify:"end"},{default:t(()=>[a(l,{col:"xs12 sm8 md4"},{default:t(()=>[a(c,{items:"center"},{default:t(()=>[a(l,{col:"3",text:"bold"},{default:t(()=>[g(" Subtotal ")]),_:1}),a(l,{col:"xs",text:"right bold"},{default:t(()=>[g(V(o.$filters.numero(o.compra.subTotalProduto,2)),1)]),_:1})]),_:1}),a(ra,{class:"q-mb-md q-mt-xs"}),a(c,{items:"center"},{default:t(()=>[a(l,{col:"xs3"},{default:t(()=>[g(" Desconto ")]),_:1}),a(l,{col:"xs"},{default:t(()=>[a(p,{tipo:"decimal",decimals:"2",modelValue:o.compra.totalPercentualDesconto,"onUpdate:modelValue":e[21]||(e[21]=n=>o.compra.totalPercentualDesconto=n),onBlur:e[22]||(e[22]=n=>i.calcularTotais("totalPercentualDesconto")),suffix:"%",error:o.erroDesconto,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","error","somente-leitura"])]),_:1}),a(l,{col:"xs"},{default:t(()=>[a(p,{tipo:"decimal",decimals:"2",modelValue:o.compra.totalDesconto,"onUpdate:modelValue":e[23]||(e[23]=n=>o.compra.totalDesconto=n),onBlur:e[24]||(e[24]=n=>i.calcularTotais("totalDesconto")),error:o.erroDesconto,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","error","somente-leitura"])]),_:1})]),_:1}),a(c,{items:"center"},{default:t(()=>[a(l,{col:"xs3"},{default:t(()=>[g(" Frete ")]),_:1}),a(l,{col:"xs"},{default:t(()=>[a(ma,{class:"q-mr-md",label:"CIF",val:"CIF",modelValue:o.compra.tipoFrete,"onUpdate:modelValue":[e[25]||(e[25]=n=>o.compra.tipoFrete=n),i.calcularTotais],dense:"",disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"]),a(ma,{label:"FOB",val:"FOB",modelValue:o.compra.tipoFrete,"onUpdate:modelValue":[e[26]||(e[26]=n=>o.compra.tipoFrete=n),i.calcularTotais],dense:"",disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),a(l,{col:"xs"},{default:t(()=>[a(p,{tipo:"decimal",decimals:"2",modelValue:o.compra.valorFrete,"onUpdate:modelValue":e[27]||(e[27]=n=>o.compra.valorFrete=n),onBlur:i.calcularTotais,error:o.erroFrete,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),a(c,{items:"center"},{default:t(()=>[a(l,{col:"xs3"},{default:t(()=>[g(" Seguro ")]),_:1}),a(l,{col:"xs"},{default:t(()=>[a(p,{tipo:"decimal",decimals:"2",modelValue:o.compra.valorSeguro,"onUpdate:modelValue":e[28]||(e[28]=n=>o.compra.valorSeguro=n),onBlur:i.calcularTotais,error:o.erroSeguro,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),a(c,{items:"center"},{default:t(()=>[a(l,{col:"xs5"},{default:t(()=>[g(" Outras despesas ")]),_:1}),a(l,{col:"xs"},{default:t(()=>[a(p,{tipo:"decimal",decimals:"2",modelValue:o.compra.valorOutrasDespesas,"onUpdate:modelValue":e[29]||(e[29]=n=>o.compra.valorOutrasDespesas=n),onBlur:i.calcularTotais,error:o.erroOutrasDespesas,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),a(ra,{class:"q-mt-md q-mb-xs"}),a(c,{items:"center"},{default:t(()=>[a(l,{col:"xs4",text:"bold"},{default:t(()=>[g(" Total ")]),_:1}),a(l,{col:"xs",text:"right bold"},{default:t(()=>[g(V(o.$filters.numero(o.compra.totalProduto,2)),1)]),_:1})]),_:1}),o.compra.totalComImposto?(I(),y(c,{key:0,items:"center"},{default:t(()=>[a(l,{col:"xs4",text:"bold"},{default:t(()=>[g(" Total IPI ")]),_:1}),a(l,{col:"xs",text:"right bold"},{default:t(()=>[g(V(o.$filters.numero(o.compra.valorIpi,2)),1)]),_:1})]),_:1})):S("",!0),a(c,{items:"center"},{default:t(()=>[a(l,{col:"xs5",text:"bold"},{default:t(()=>[g(" Total c/ Impostos ")]),_:1}),a(l,{col:"xs-shrink"},{default:t(()=>[a(R,{disable:o.compra.status!=="Digita\xE7\xE3o",modelValue:o.compra.totalComImposto,"onUpdate:modelValue":[e[30]||(e[30]=n=>o.compra.totalComImposto=n),i.calcularTotais],"checked-icon":"check",color:"green","unchecked-icon":"clear"},null,8,["disable","modelValue","onUpdate:modelValue"])]),_:1}),a(l,{col:"xs",text:"right bold"},{default:t(()=>[g(V(o.$filters.numero(o.compra.totalDocumento,2)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(c,{gutter:"md",mg:"md",bg:"bg-white"},{default:t(()=>[a(l,{col:"12"},{default:t(()=>[a(h,{text:"sub1 medium",icon:"credit_card sm tertiary left"},{default:t(()=>[g("Faturar")]),_:1})]),_:1}),a(l,{col:"12"},{default:t(()=>[a(p,{modelValue:o.compra.observacaoFaturamento,"onUpdate:modelValue":e[31]||(e[31]=n=>o.compra.observacaoFaturamento=n),tipo:"textoArea",rotulo:"Observa\xE7\xE3o faturamento",rows:"5"},null,8,["modelValue"])]),_:1}),a(l,{col:"12"},{default:t(()=>[a(Ca,{ref:"formAdicionarPagamento"},{default:t(()=>[a(c,{mg:"md-y",items:"center"},{default:t(()=>[a(l,{col:"12 sm6 md"},{default:t(()=>[a(p,{modelValue:o.compra.formaDePagamento,"onUpdate:modelValue":e[32]||(e[32]=n=>o.compra.formaDePagamento=n),rules:o.formaPagamentoRules,ajuda:"Exemplo: Boleto","somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Forma de pagamento"},null,8,["modelValue","rules","somente-leitura"])]),_:1}),a(l,{col:"12 sm6 md"},{default:t(()=>[a(p,{modelValue:o.compra.condicaoPagamento,"onUpdate:modelValue":e[33]||(e[33]=n=>o.compra.condicaoPagamento=n),rules:o.condicaoPagamentoRules,ajuda:"Exemplo: 28/56/64","somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Cond. Pag",tipo:"numero"},null,8,["modelValue","rules","somente-leitura"])]),_:1}),a(l,{col:"12 sm4 md",text:"bold",class:"q-my-sm"},{default:t(()=>[g(" Frete Separado "),a(R,{modelValue:o.compra.freteSeparado,"onUpdate:modelValue":[e[34]||(e[34]=n=>o.compra.freteSeparado=n),i.calcularTotais],disable:o.compra.status!=="Digita\xE7\xE3o",dense:"",class:"q-ml-sm"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),a(l,{col:"12 sm4 md",text:"bold",class:"q-my-sm"},{default:t(()=>[g(" N\xE3o gerar financeiro "),a(R,{modelValue:o.compra.naoGerarFinanceiro,"onUpdate:modelValue":[e[35]||(e[35]=n=>o.compra.naoGerarFinanceiro=n),i.calcularTotais],disable:o.compra.status!=="Digita\xE7\xE3o",dense:"",class:"q-ml-sm"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),a(l,{col:"12 sm4 md",text:"center"},{default:t(()=>[a(F,{onClick:i.gerarCondicoesDePagamento_click,disable:o.compra.status!=="Digita\xE7\xE3o",color:"positive",icon:"add",label:"Forma de pagamento",outline:"",size:"sm"},null,8,["onClick","disable"])]),_:1})]),_:1})]),_:1},512)]),_:1}),a(l,{col:"12"},{default:t(()=>[k(a(h,{text:"sub1 medium"},{default:t(()=>[g("Condi\xE7\xF5es de pagamento")]),_:1},512),[[M,o.compraCondicoesDePagamento.length>0]]),(I(!0),U(A,null,j(o.compraCondicoesDePagamento,n=>(I(),y(O,{highlight:"",class:"q-pa-none",key:n.id},{default:t(()=>[a(c,{gutter:"md",mg:"sm-y",items:"center",bordered:"","rounded-borders":""},{default:t(()=>[a(l,{col:"xs6 md-shrink"},{default:t(()=>[a(p,{modelValue:n.dataVencimento,"onUpdate:modelValue":d=>n.dataVencimento=d,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",rotulo:"Data vencimento",tipo:"data",dense:""},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),a(l,{col:"xs6 md2"},{default:t(()=>[a(p,{modelValue:n.valor,"onUpdate:modelValue":d=>n.valor=d,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o",align:"left",rotulo:"Valor",decimals:"2",zerosDireita:"2",tipo:"decimal"},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),a(l,{col:"xs-grow"},{default:t(()=>[a(p,{modelValue:n.observacao,"onUpdate:modelValue":d=>n.observacao=d,"somente-leitura":o.compra.status!=="Digita\xE7\xE3o"||n.observacao==="Valor Frete + Seguro",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),a(l,{col:"xs-shrink",text:"right"},{default:t(()=>[a(F,{onClick:d=>i.removerPagamento_click(n),icon:"delete",round:"",dense:"",flat:"",color:"tertiary",disable:o.compra.status!=="Digita\xE7\xE3o"},null,8,["onClick","disable"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),o.valorTotalPagamento>0?(I(),y(c,{key:0,mg:"sm-t"},{default:t(()=>[a(l,{col:"xs-shrink",text:"bold"},{default:t(()=>[g(" Valor total: "+V(o.$filters.numero(o.valorTotalPagamento,2)),1)]),_:1})]),_:1})):S("",!0)]),_:1})]),_:1}),o.$db.usuario.desenvolvedor()?(I(),y(c,{key:0,gutter:"md",mg:"md",bg:"bg-yellow"},{default:t(()=>[a(l,{col:"12"},{default:t(()=>[a(h,{text:"sub1 medium",icon:"credit_card sm tertiary left"},{default:t(()=>[g("Contabilidade (apenas desenvolvedor)")]),_:1})]),_:1}),a(l,{col:"12"},{default:t(()=>[k(a(h,{text:"sub1 medium"},{default:t(()=>[g("Titulos")]),_:1},512),[[M,o.compraTitulos.length]]),a(O,{highlight:"",class:"q-pa-none"},{default:t(()=>[(I(!0),U(A,null,j(o.compraTitulos,n=>(I(),y(c,{key:n.id,items:"center"},{default:t(()=>[a(l,{col:"sm2"},{default:t(()=>[a(p,{modelValue:n.dataVencimento,"somente-leitura":"",rotulo:"Data vencimento",tipo:"data",dense:""},null,8,["modelValue"])]),_:2},1024),a(l,{col:"sm2"},{default:t(()=>[a(p,{modelValue:n.dataPagamento||"A pagar","somente-leitura":"",rotulo:"Data pagamento",tipo:n.dataPagamento?"data":"texto",dense:""},null,8,["modelValue","tipo"])]),_:2},1024),a(l,{col:"sm2"},{default:t(()=>[a(p,{modelValue:n.valor,"somente-leitura":"",align:"left",rotulo:"Valor",decimals:"2",tipo:"decimal"},null,8,["modelValue"])]),_:2},1024),a(l,{col:"sm2"},{default:t(()=>[a(p,{modelValue:n.parcela,"somente-leitura":"",align:"left",rotulo:"Parcela"},null,8,["modelValue"])]),_:2},1024),a(l,{col:"sm2"},{default:t(()=>[a(p,{modelValue:n.formaDePagamento,"somente-leitura":"",rotulo:"Forma de pagamento"},null,8,["modelValue"])]),_:2},1024),a(l,{col:"sm2"},{default:t(()=>[a(p,{modelValue:n.observacao,"somente-leitura":"",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),a(l,{col:"12"},{default:t(()=>[k(a(h,{text:"sub1 medium"},{default:t(()=>[g("Movimenta\xE7\xF4es")]),_:1},512),[[M,o.compraMovimentacoes.length]]),a(O,{highlight:"",class:"q-pa-none"},{default:t(()=>[(I(!0),U(A,null,j(o.compraMovimentacoes,n=>(I(),y(c,{key:n.id,gutter:"sm",mg:"sm-y",items:"center"},{default:t(()=>[a(l,{col:"xs-grow"},{default:t(()=>[a(p,{modelValue:n.descricao,"somente-leitura":"",rotulo:"Descri\xE7\xE3o"},null,8,["modelValue"])]),_:2},1024),n.valorCredito?(I(),y(l,{key:0,col:"xs6 md2"},{default:t(()=>[a(p,{modelValue:n.valorCredito,"somente-leitura":"",align:"left",rotulo:"Valor Credito",decimals:"2",tipo:"decimal"},null,8,["modelValue"])]),_:2},1024)):S("",!0),n.valorDebito?(I(),y(l,{key:1,col:"xs6 md2"},{default:t(()=>[a(p,{modelValue:n.valorDebito,"somente-leitura":"",align:"left",rotulo:"Valor Debito",decimals:"2",tipo:"decimal"},null,8,["modelValue"])]),_:2},1024)):S("",!0),a(l,{col:"xs6 md-shrink"},{default:t(()=>[a(p,{modelValue:n.dataCompetencia,"somente-leitura":"",rotulo:"Data competencia",tipo:"data",dense:""},null,8,["modelValue"])]),_:2},1024),a(l,{col:"xs-grow"},{default:t(()=>[a(p,{modelValue:n.observacao,"somente-leitura":"",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):S("",!0)]),_:1})]),_:1}),a(ia,{class:"bg-light border-top"},{default:t(()=>[a(X,{class:"bg-light text-tertiary q-px-md u-container"},{default:t(()=>[a(W,{class:"text-subtitle2"},{default:t(()=>[g(" Valor Total: "+V(o.$filters.numero(o.compra.totalDocumento,2))+" ",1),Ba,g(" SKU: "+V(i.skus),1)]),_:1}),a(ca),k(a(F,{onClick:i.excluir_click,type:"submit",class:"q-ml-sm",color:"white","text-color":"negative",flat:"",label:"Excluir"},null,8,["onClick"]),[[M,o.compra.status==="Digita\xE7\xE3o"]]),k(a(F,{onClick:i.finalizar_click,type:"submit",class:"q-ml-sm",color:"primary",unelevated:"",label:"Finalizar"},null,8,["onClick"]),[[M,o.compra.status==="Digita\xE7\xE3o"]]),k(a(F,{onClick:i.reabrir_click,color:"tertiary",flat:"",label:"Reabrir",type:"submit",class:"q-ml-sm"},null,8,["onClick"]),[[M,o.compra.status==="Finalizado"]]),k(a(F,{unelevated:"",onClick:i.transformarEmNotaDeEntrada_click,class:"q-ml-sm",color:"primary",label:"Transformar em Nota de Entrada",type:"submit"},null,8,["onClick"]),[[M,o.compra.status==="Finalizado"&&o.compra.operacao==="Pedido de Compra"]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onKeyup"]),a(u,{ref:"ModalEditarProdutoCompras",onSalvar:i.fecharEdicaoProduto},null,8,["onSalvar"]),a(E,{modelValue:o.adicionar.modal.value,"onUpdate:modelValue":e[37]||(e[37]=n=>o.adicionar.modal.value=n),filtro:{ativo:!0,idEmpresa:o.compra.idEmpresa},ref:"promptItem",habilitarQuantidade:!0,exibirValorVenda:!1,calculaItemCusto:!0,onSelecionarItens:i.selecionarItens},null,8,["modelValue","filtro","onSelecionarItens"])],64)}var La=J(_a,[["render",Oa]]);const Aa={components:{PromptItemV2:pa},data(){return{mostrarItemModal:!1,idxItem:0,compraOriginal:{},compra:{id:$utils.uuid(),codigoDocumento:null,tipo:"Compra",operacao:"Pedido de Compra",status:"Digita\xE7\xE3o",codigoEmpresa:null,descricaoEmpresa:"",numeroDocumentoEmpresa:"",codigoContato:null,descricaoContato:"",codigoContatoComprador:null,codigoContatoVendedor:null,idContatoComprador:null,dataHoraEmissao:new Date,tipoFrete:"CIF",tipoTransporte:null,idEmpresa:null,idContato:null,calcularTributacao:!1,totalComImposto:!1,naoGerarFinanceiro:!1,freteSeparado:!1},compraItens:[],produtos:[],visivel:!1,somenteLeitura:!1,buttonLoading:[]}},emits:["atualizar"],methods:{editarProduto(o,e,m){o.referencia=this.produtos[o.idItem].referencia,this.$refs.ModalEditarProdutoCompras.mostrar(o,e,m)},async atualizar(o,e){try{this.$q.loading.show(),this.compraItens=e;for(const m in this.compraItens)this.buttonLoading[m]=!1;this.visivel=!0,$q.notify({type:"info",message:"Existe produtos da nota de entrada n\xE3o cadastrados no sistema."})}catch(m){console.log(m.message)}finally{this.$q.loading.hide()}},verificarSeAlterouCampos(){return $utils.diferencaObjetos(this.compraOriginal,this.compra)},async mostrar(o,e){this.visivel=!0,o.id&&(this.compraOriginal=await $db.hibrido.le({table:"documento",id:o.id}),this.compra=$utils.clonarV2(this.compraOriginal)),await this.atualizar(o,e)},async fechar(){$q.dialog({title:"Voltar?",message:`Ainda existe <b>${this.compraItens.length}</b> produto(s) n\xE3o cadastrado(s).<br><br>
            Ao <b>Confirmar</b> para voltar, ser\xE1 necess\xE1rio incluir o XML novamente e cadastrar os itens que faltam.
          `,html:!0,cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Confirmar",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(async o=>{this.visivel=!1;try{$q.loading.show(),await $db.compra.remove(this.compra)}catch(e){console.error("Ocorreu um erro ao excluir a compra: ",e)}finally{$q.loading.hide(),this.$emit("atualizar")}}).onCancel(()=>{})},async selecionarItens(o){this.compraItens[this.idxItem].idItem=Object.keys(o)[0],this.compraItens[this.idxItem].itemAssociadoDescricao=o[Object.keys(o)[0]].item.descricao,this.compraItens[this.idxItem].itemCompra.idItem=Object.keys(o)[0];try{const e={id:$utils.uuid(),idItem:this.compraItens[this.idxItem].itemCompra.idItem,idContato:this.compra.idContato,referencia:this.compraItens[this.idxItem].referencia,descricao:this.compraItens[this.idxItem].descricaoItem};await $db.hibrido.grava("itemFornecedor",{original:{},atual:e}),await $db.hibrido.grava("documentoItem",{original:{},atual:this.compraItens[this.idxItem].itemCompra}),this.compraItens.splice(this.idxItem,1)}catch(e){console.log(e.error)}this.mostrarItemModal=!1},async recalcularItem(o){var h;let e=(h=this.compraItens[o].valorPreCusto)!=null?h:0,m=0,s=0,r=0,i=0;this.compraItens[o].ipi>0&&(m=$utils.arredondar(e*(this.compraItens[o].ipi/100),2)),this.compraItens[o].st>0&&(s=$utils.arredondar(e*(this.compraItens[o].st/100),2)),this.compraItens[o].difal>0&&(r=$utils.arredondar(e*(this.compraItens[o].difal/100),2)),this.compraItens[o].valorCustoReposicao=$utils.arredondar(e+m+s+r,2),this.compraItens[o].margemLucro>0&&(i=$utils.arredondar(this.compraItens[o].valorCustoReposicao*(this.compraItens[o].margemLucro/100),2)),this.compraItens[o].percentualMarkup=$utils.arredondar(this.compraItens[o].margemLucro,2),this.compraItens[o].valorVenda=$utils.arredondar(this.compraItens[o].valorCustoReposicao+i,2)},async addNovoItem(o,e){this.buttonLoading[e]=!0;const m={id:$utils.uuid(),descricao:o.descricaoItem,descricaoConcatenada:o.descricaoItem,referencia:o.referencia,marca:(o==null?void 0:o.marca)||null,codigoBarras:o.itemCompra.codigoBarrasItem,ncm:o.itemCompra.ncm,tipo:o.itemCompra.tipoItem,codigoNcm:o.itemCompra.codigoNcm,unidade:o.unidade,valorCustoReposicao:o.valorCustoReposicao,valorVenda:(o==null?void 0:o.valorVenda)||0,percentualMarkup:(o==null?void 0:o.percentualMarkup)||0,codigoOrigem:parseInt(o.codigoOrigem),unidade:o.unidade},s={id:$utils.uuid(),idItem:m.id,idContato:this.compra.idContato,referencia:o.referencia,descricao:o.descricaoItem};try{await $db.hibrido.grava("item",{original:{},atual:m}),await $db.hibrido.grava("itemFornecedor",{original:{},atual:s}),o.itemCompra.idItem=m.id,o.itemCompra.dataHoraEmissao=new Date(o.itemCompra.dataHoraEmissao).toISOString(),await $db.hibrido.grava("documentoItem",{original:{},atual:o.itemCompra}),this.compraItens.splice(e,1),$q.notifyPositive(`Item criado com sucesso: ${m.descricao}`)}catch(r){console.log(r.message),$q.notifyError(`Erro ao cadastrar novo produto: ${r.message}`)}this.buttonLoading[e]=!1},async finalizar_click(){console.log(this.compraItens.length),this.compraItens.length>0?$q.notifyError("Antes de continuar verifique todos os itens!"):(this.mostrarItemModal=!1,this.visivel=!1,this.$router.replace({params:{id:this.compra.id}}),this.$refs.fichaCompra.mostrar({id:this.compra.id}))},async addNovoItemAutomatico(o,e){o.id&&(this.compraOriginal=await $db.hibrido.le({table:"documento",id:o.id}),this.compra=$utils.clonarV2(this.compraOriginal)),this.compraItens=e;for(const m in this.compraItens)this.buttonLoading[m]=!1;for(let m=0;m<this.compraItens.length;m++)await this.addNovoItem(this.compraItens[m],m)}}},Ha={class:"layout-padding q-pa-none q-pb-md"},xa=["id"],ja={class:"col-12"},Ra={class:"col-4 col-md"},Xa={class:"col-4 col-md"},Qa={class:"col-4 col-md"},Ga={class:"col-6 col-md"},Wa={class:"col-12 col-md"},Ja={class:"col-6 col-md"},Ka={class:"col-12 col-md"},Za={class:"col-12"},Ya={class:"col-12 col-md-4"},ao=N("div",{class:"col-12 col-md-auto"},"ou",-1),oo={class:"col-12 col-md-auto q-pl-none"},eo={class:"u-container relative-position"};function to(o,e,m,s,r,i){const h=w("ajuda"),l=w("campo"),f=w("row"),b=w("PromptItemV2");return I(),U(A,null,[a(oa,{modelValue:r.visivel,"onUpdate:modelValue":e[0]||(e[0]=c=>r.visivel=c),persistent:"",maximized:"",onKeyup:fa(i.fechar,["esc"])},{default:t(()=>[a(K,{container:"",view:"hHh LpR fFf",class:"bg-light"},{default:t(()=>[a(Z,null,{default:t(()=>[a(X,null,{default:t(()=>[a(F,{icon:"arrow_back",flat:"",round:"",dense:"",onClick:i.fechar},null,8,["onClick"]),a(W,null,{default:t(()=>[g("Importar XML x Cadastro")]),_:1}),a(h)]),_:1})]),_:1}),a(Y,null,{default:t(()=>[a(aa,null,{default:t(()=>[N("div",Ha,[a(Va,{style:{position:"absolute",top:"0",bottom:"0",left:"0",right:"0",height:"100%",width:"100%"},items:r.compraItens,separator:""},{default:t(({item:c,index:C})=>[N("div",{class:"items-carrinho items-center row q-pa-md bg-white rounded-borders u-container",style:{"margin-top":"12px","margin-bottom":"12px"},id:C},[a(O,{class:"full-width"},{default:t(()=>[a(z,{class:"q-px-none"},{default:t(()=>[a(D,{class:"q-px-none"},{default:t(()=>[a($,null,{default:t(()=>[a(l,{dense:"",align:"left",tipo:"texto",outlined:"",ajuda:"With placeholder",rotulo:"Descri\xE7\xE3o Item",modelValue:c.descricaoItem,"onUpdate:modelValue":p=>c.descricaoItem=p},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),a(D,null,{default:t(()=>[a($,null,{default:t(()=>[a(l,{dense:"",align:"left",tipo:"texto",outlined:"",ajuda:"With placeholder",rotulo:"Marca",modelValue:c.marca,"onUpdate:modelValue":p=>c.marca=p},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),a(D,null,{default:t(()=>[a($,null,{default:t(()=>[a(l,{dense:"",align:"left",tipo:"texto",outlined:"",ajuda:"With placeholder",rotulo:"Referencia",modelValue:c.referencia,"onUpdate:modelValue":p=>c.referencia=p},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),N("div",ja,[a(f,{class:"q-col-gutter-sm"},{default:t(()=>[N("div",Ra,[a(l,{dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"",ajuda:"With placeholder",rotulo:"Valor pr\xE9 custo",modelValue:c.valorPreCusto,"onUpdate:modelValue":p=>c.valorPreCusto=p},null,8,["modelValue","onUpdate:modelValue"])]),N("div",Xa,[a(l,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",ajuda:"With placeholder",rotulo:"IPI",modelValue:c.ipi,"onUpdate:modelValue":p=>c.ipi=p,outlined:"",suffix:"%",onBlur:p=>i.recalcularItem(C)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),N("div",Qa,[a(l,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",ajuda:"With placeholder",rotulo:"ST",modelValue:c.st,"onUpdate:modelValue":p=>c.st=p,outlined:"",suffix:"%",onBlur:p=>i.recalcularItem(C)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),N("div",Ga,[a(l,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",ajuda:"With placeholder",rotulo:"DIFAL",modelValue:c.difal,"onUpdate:modelValue":p=>c.difal=p,outlined:"",suffix:"%",onBlur:p=>i.recalcularItem(C)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),N("div",Wa,[a(l,{dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"",ajuda:"With placeholder",rotulo:"Custo de reposi\xE7\xE3o",modelValue:c.valorCustoReposicao,"onUpdate:modelValue":p=>c.valorCustoReposicao=p},null,8,["modelValue","onUpdate:modelValue"])]),N("div",Ja,[a(l,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",ajuda:"With placeholder",rotulo:"Margem de Lucro",modelValue:c.margemLucro,"onUpdate:modelValue":p=>c.margemLucro=p,outlined:"",suffix:"%",onBlur:p=>i.recalcularItem(C)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),N("div",Ka,[a(l,{dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"",ajuda:"With placeholder",rotulo:"Valor de Venda",modelValue:c.valorVenda,"onUpdate:modelValue":p=>c.valorVenda=p},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1024)]),N("div",Za,[a(f,{class:"q-mt-lg text-right full-width justify-end items-center"},{default:t(()=>[N("div",Ya,[a(la,{debounce:500,modelValue:c.itemAssociadoDescricao,"onUpdate:modelValue":p=>c.itemAssociadoDescricao=p,placeholder:"Vincular produto",standout:"",filled:"",dense:"",clearable:"","clear-icon":"close",class:"items-center"},{append:t(()=>[a(_,{name:"search",onClick:()=>{r.mostrarItemModal=!r.mostrarItemModal,r.idxItem=C},class:"cursor-pointer text-tertiary"},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),ao,N("div",oo,[a(F,{loading:r.buttonLoading[C],class:"q-ml-sm no-shadow",color:"primary",icon:"add",unelevated:"",label:"Novo",type:"submit",onClick:p=>i.addNovoItem(c,C)},null,8,["loading","onClick"])])]),_:2},1024)])],8,xa)]),_:1},8,["items"])])]),_:1})]),_:1}),a(ia,{class:"bg-light no-shadow q-pa-sm text-right u-bordaCima"},{default:t(()=>[N("div",eo,[a(F,{class:"q-ml-sm no-shadow",color:"primary",icon:"send",unelevated:"",label:"Continuar",type:"submit",onClick:i.finalizar_click},null,8,["onClick"])])]),_:1})]),_:1})]),_:1},8,["modelValue","onKeyup"]),a(b,{modelValue:r.mostrarItemModal,"onUpdate:modelValue":e[1]||(e[1]=c=>r.mostrarItemModal=c),habilitarQuantidade:!0,filtro:{ativo:!0,idEmpresa:r.compra.idEmpresa},exibirValorVenda:!1,onSelecionarItens:i.selecionarItens,ref:"promptItem"},null,8,["modelValue","filtro","onSelecionarItens"])],64)}var lo=J(Aa,[["render",to]]);const Q={paginacao:{atual:1,maximo:1,total:1,limite:25},filtros:{numero:"",numeroCompra:null,termoBusca:"",periodoEmissao:{ini:"",fim:""},periodoFinalizado:{ini:"",fim:""},fornecedor:{id:"",nome:""}}},ro={components:{Lista:wa,ComprasFicha:La,ComprasImportacaoXML:lo},data(){return{lista:[],mostrar:{barraTopo:!0,toolbarTitulo:!0,icone:"factory",titulo:"Compras",filtroAvancado:!0,buscar:!0,btnAjuda:!0,btnAtualizar:!0,btnNovo:!0,toolbarAcoes:!0,checkBox:!1,btnRemover:!1,btnRestaurar:!1,centralizaTabs:!1,btnDetalhes:!1,btnExportaXLS:!1,btnMenuMais:!1,toolbarAdicao:!1,bannerMsg:""},resultado:{},busca:"",filtros:$utils.clonarV2(Q.filtros),tabSelecionada:{valor:"Digita\xE7\xE3o"},tabs:[{valor:"Digita\xE7\xE3o",rotulo:"Digita\xE7\xE3o"},{valor:"Finalizado",rotulo:"Finalizado"},{valor:"Todos",rotulo:"Todos"}],tabSelecionada2:{valor:"Pedido de Compra"},tabs2:[{valor:"Pedido de Compra",rotulo:"Pedido de Compra"},{valor:"Nota de Entrada",rotulo:"Nota de Entrada"}],paginacao:$utils.clonarV2(Q.paginacao),xmlDevolucao:!1,xmlEstrangeiro:!1,modalXMLNotaEntrada:!1,xmlNotaEntrada:{},configImpressao:[],abrirNotadeEntrada:null}},methods:{async atualizar(o){var m;const e=$utils.logarIni("ComprasLista");await $tryLoading(async()=>{let{buscarDadosRecentes:s}=o!=null?o:{},r,i,h,l,f=["dataHoraFinalizado","dataHoraEmissao"],b=["desc","desc"];if(o!=null&&o.aba2&&(this.tabSelecionada2.valor=o.aba2),this.tabSelecionada2Anterior&&this.tabSelecionada2Anterior!==this.tabSelecionada2.valor&&(this.setOpcoesTabs(this.tabSelecionada2.valor),this.filtros=$utils.clonarV2(Q.filtros),this.paginacao=$utils.clonarV2(Q.paginacao),this.busca="",s=!0),this.tabSelecionada2Anterior=this.tabSelecionada2.valor,s&&(r=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:this.tabSelecionada2.valor}),r!=null&&r._id&&(this.filtros=r.filtros,this.busca=r.termoBusca,this.paginacao.limite=r.limit,this.paginacao.atual=r.page,f=r.sort,b=r.dir)),o!=null&&o.aba&&(this.tabSelecionada.valor=o.aba),i=$utils.eliminarVazios(this.filtros),h=this.paginacao.limite,l=this.paginacao.atual,i.status=this.tabSelecionada.valor,i.operacao=this.tabSelecionada2.valor,i.termoBusca=this.busca,this.tabSelecionada.valor==="Todos"&&delete i.status,i.operacao==="Nota no SEFAZ"){let c=await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{tipo:"DFe",situacao:i.status}});const C=[];c.forEach(u=>{const E={id:u.id,descricaoContato:u.xNomeEmitente,dataHoraEmissao:u.dataHoraEmissao,dataHoraFinalizado:null,totalDocumento:u.vNF,qtdeContatos:null,status:u.situacao};C.push(E)});const p=(l-1)*h;this.paginacao.total=C.length,this.paginacao.maximo=Math.ceil(this.paginacao.total/h)||1,this.lista=C.splice(p,h),this.configuraImpressao(this.filtros.idEmpresa)}else{const c=await $db.compra.leListaCompleta({filtros:i,limit:h,page:l,sort:f,dir:b});this.paginacao.total=c.total,this.paginacao.maximo=c.totalPages,this.lista=c.data.compras}for(let c in this.lista)this.lista.hasOwnProperty(c)&&(this.lista[c].contato=await $db.contato.le({id:this.lista[c].idContato}));r={_id:this.tabSelecionada2.valor,tabSelecionada:this.tabSelecionada.valor,filtros:$utils.clonarV2(i),termoBusca:this.busca,limit:this.paginacao.limite,page:this.paginacao.atual,sort:f,dir:b},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:r}),this.configuraImpressao(this.filtros.idEmpresa)}),$utils.logarFim(e,((m=this.paginacao)==null?void 0:m.total)||1)},adicionarXml(o){this.xmlNotaEntrada.arquivo=o[0]},async dialogProtocoloSefaz(){return new Promise(o=>{$q.dialog({title:"Aviso importante",message:"O XML que est\xE1 sendo importado n\xE3o foi protocolado pela Sefaz, gostaria de importar o XML sem o protocolo?",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-primary",textColor:"white",flat:!0},persistent:!0}).onOk(()=>{o(!0)}).onCancel(()=>{o(!1)})})},async importarXmlNotaDeEntrada(o){if(!this.xmlNotaEntrada.arquivo)return this.$q.notify({type:"warning",message:"Adicione um arquivo XML antes de enviar!"});try{$q.loading.show();const m=await(p=>new Promise((u,E)=>{const n=new FileReader;n.readAsBinaryString(p),n.onload=()=>u(n.result),n.onerror=d=>E(d)}))(this.xmlNotaEntrada.arquivo),s=new DOMParser,r=new XMLSerializer,i=s.parseFromString(m,"text/xml"),h=r.serializeToString(i),l=this;if(i.documentElement.nodeName==="html")throw new Error("Arquivo inv\xE1lido ou corrompido");const f=new ya.Parser;let b;f.parseString(h,(p,u)=>{p&&console.log(p),b=u});let c=null,C=!0;b&&b.nfeProc&&b.nfeProc.protNFe?c=b.nfeProc.protNFe[0].infProt[0].nProt[0]:c||(C=await this.dialogProtocoloSefaz()),C?(await $db.compra.importaXml({xmlString:h,tela:l,xmlEstrangeiro:!!this.xmlEstrangeiro}),this.$q.notify({type:"positive",message:"Importa\xE7\xE3o realizada com sucesso!"})):this.$q.notify({type:"warning",message:"Opera\xE7\xE3o para importa\xE7\xE3o de XML cancelada!"})}catch(e){this.$q.notifyError(e.message),console.error(e)}finally{delete this.xmlNotaEntrada.arquivo,this.modalXMLNotaEntrada=!1,this.xmlEstrangeiro=!1,await this.atualizar(),$q.loading.hide()}},async fecharXmlNotaDeEntrada(){delete this.xmlNotaEntrada.arquivo},async abrir(o){this.tabSelecionada2.valor!=="Nota no SEFAZ"&&this.$refs.comprasFicha.mostrar({id:o})},criarClick(){this.$refs.comprasFicha.criar()},importarXmlClick(){this.modalXMLNotaEntrada=!0},limparFiltrosClick(){this.filtros=$utils.clonarV2(Q.filtros),this.atualizar()},async consultarSefazClick(){try{let o,e,m,s,r,i,h,l;if(e=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data,!(e.length>0)){this.$q.notify({message:"N\xE3o h\xE1 empresa configurada",timeout:0,type:"negative",closeBtn:!0});return}if(o=e[0],e.length>1){const P={ativo:!0,empresas:!0};if(o=await $g.promptContato.show({filtro:P,placeholder:"Selecione a empresa"}),!o){this.visivel=!1,this.$q.notifyError("Empresa n\xE3o selecionada");return}}if(m=(await $erp().empresa.where({idContato:o.id}).toArray())[0],!m){this.visivel=!1,this.$q.notifyError("Erro ao selecionar empresa");return}m&&(s=await $db.contatoEndereco.leEnderecoPrincipal(o.id),r=await $db.configuracoes.leValorComFiltroEmpresa("compras.sefaz.nsu",m.id),r||(r="0"));const f=m.numeroDocumentoNacional.match(/\d+/g).join("");for(;r.length<15;)r=`0${r}`;const b=`<?xml version="1.0" encoding="utf-8"?><distDFeInt versao="1.01" xmlns="http://www.portalfiscal.inf.br/nfe"><tpAmb>2</tpAmb><cUFAutor>${s.ufCod}</cUFAutor><CNPJ>${f}</CNPJ><distNSU><ultNSU>${r}</ultNSU></distNSU></distDFeInt>`,c={xml:b,cnpj:f,dataHora:new Date},p={id:$utils.uuid(),tipo:"DFe",situacao:"",tpAmb:1,dhEmi:new Date,dataHoraEmissao:new Date,dataHoraCriacao:new Date,cpfCnpjEmitente:f,xNomeEmitente:m.nome,json:JSON.stringify(c)}.json,u=new Headers;u.append("Content-Type","application/json; charset=utf-8"),h=await fetch("https://api.b15.com.br/integradorjs/dfe/consultar",{method:"POST",headers:u,body:JSON.stringify({xml:b})});const E=await h.json();if(!h.ok){let P="Erro desconhecido";/GError:.+/.test(E.error)&&(P=E.error.slice(7)),$q.notifyError(P);return}if(E.cStat!=="100"){$q.notifyError(E.xMotivo);return}const n=h.dfe.retDistDFeInt,d=h.err,v=h.arquivos;if(n!==""&&Number(n==null?void 0:n.ultNSU[0])>Number(r)){const P=await $db.configuracoes.atualizaPorNome("compras.sefaz.nsu",m.id,n.ultNSU[0])}if(v){let P=0;for(let q in v)try{const T=v[q],sa={id:$utils.uuid(),tipo:"DFe",situacao:"N\xE3o Importada",tpAmb:T.nfeProc.NFe[0].infNFe[0].ide[0].tpAmb[0],mod:T.nfeProc.NFe[0].infNFe[0].ide[0].mod[0],serie:T.nfeProc.NFe[0].infNFe[0].ide[0].serie[0],nNF:T.nfeProc.NFe[0].infNFe[0].ide[0].nNF[0],chNFe:T.nfeProc.protNFe[0].infProt[0].chNFe[0],vNF:T.nfeProc.NFe[0].infNFe[0].total[0].ICMSTot[0].vNF[0],dhEmi:T.nfeProc.NFe[0].infNFe[0].ide[0].dhEmi[0],dataHoraEmissao:T.nfeProc.NFe[0].infNFe[0].ide[0].dhEmi[0],dataHoraCriacao:null,dataHoraAlteracao:null,cpfCnpjEmitente:T.nfeProc.NFe[0].infNFe[0].emit[0].CNPJ[0],xNomeEmitente:T.nfeProc.NFe[0].infNFe[0].emit[0].xNome[0],xFantEmitente:T.nfeProc.NFe[0].infNFe[0].emit[0].xNome[0],cpfCnpjDestinatario:T.nfeProc.NFe[0].infNFe[0].dest[0].CNPJ[0],xNomeDestinatario:T.nfeProc.NFe[0].infNFe[0].dest[0].xNome[0],xFantDestinatario:T.nfeProc.NFe[0].infNFe[0].dest[0].xNome[0],json:JSON.stringify({xml:T.xml}),naturezaOperacao:T.nfeProc.NFe[0].infNFe[0].ide[0].natOp[0]};(await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{tipo:"DFe"}})).some(ha=>ha.chNFe===sa.chNFe)||(await $db.documentoFiscalEletronico.grava({atual:sa,original:{}}),P++)}catch(T){console.log(T.message)}this.$q.notify(`Importa\xE7\xE3o via SEFAZ Finalizada, ${P} Notas Importadas`)}}catch(o){console.log(o.message)}},async configuraImpressao(o){const e=await $db.configuracoes.porNome("impressao.compra",o);this.configImpressao=[...e.length?e.map(m=>({texto:"Imprimir Compra",...m})):[{valor:"invoice",texto:"Compras e Estoque"}]]},setOpcoesTabs(o){o!=="Nota no SEFAZ"&&(this.tabSelecionada.valor="Digita\xE7\xE3o",this.tabs=[{valor:"Digita\xE7\xE3o",rotulo:"Digita\xE7\xE3o"},{valor:"Finalizado",rotulo:"Finalizado"},{valor:"Todos",rotulo:"Todos"}]),o==="Nota no SEFAZ"&&(this.tabSelecionada.valor="N\xE3o Importada",this.tabs=[{valor:"N\xE3o Importada",rotulo:"N\xE3o Importada"},{valor:"Importada",rotulo:"Importada"}])},async downloadXmlDFe(o){const e=await $db.hibrido.le({table:"documentoFiscalEletronico",id:o}),m=JSON.parse(e.json).xml;if(m){const s=document.createElement("a"),r=new Blob([m],{type:"text/plain"});s.setAttribute("href",window.URL.createObjectURL(r)),s.setAttribute("download",`${e.chNFe}.xml`),s.dataset.downloadurl=["text/plain",s.download,s.href].join(":"),s.click()}m||this.$q.notifyError("N\xE3o foi poss\xEDvel recuperar o XML")},async importarXmlDFe(o){try{const e=await $db.hibrido.le({table:"documentoFiscalEletronico",id:o}),m=JSON.parse(e.json).xml;if(m){const s=new DOMParser,r=new XMLSerializer,i=s.parseFromString(m,"text/xml"),h=r.serializeToString(i),l=this;await $db.compra.importaXml({xmlString:h,tela:l});const f={original:$utils.clonarV2(e),atual:$utils.clonarV2(e)};f.atual.situacao="Importada",await $db.documentoFiscalEletronico.grava(f),$q.notify("XML Importado para Compras")}}catch(e){console.log(e.message),$q.notifyError("Erro ao importar XML",e)}}},async mounted(){this.tabSelecionada2.valor=this.$route.name,this.atualizar({buscarDadosRecentes:!0})}},io={id:"Compras"},so={class:"mw80 text-center"},no={class:"row q-ma-md"},mo={key:0,class:"row q-ma-md"},uo={class:"certificado-error-messages"};function co(o,e,m,s,r,i){const h=w("campo"),l=w("BadgeCopiarUid"),f=w("avatar"),b=w("badge"),c=w("g-label"),C=w("g-col"),p=w("g-row"),u=w("Lista"),E=w("ComprasFicha"),n=w("ComprasImportacaoXML");return I(),U("div",io,[a(u,{busca:r.busca,"onUpdate:busca":e[8]||(e[8]=d=>r.busca=d),onAtualizar:i.atualizar,onLimparFiltrosClick:i.limparFiltrosClick,onCriarClick:i.criarClick,onConsultarSefazClick:i.consultarSefazClick,lista:r.lista,tabSelecionada:r.tabSelecionada,tabs:r.tabs,tabSelecionada2:r.tabSelecionada2,tabs2:r.tabs2,paginacao:r.paginacao,mostrar:r.mostrar},{botaoNovo:t(()=>[a(F,{label:"Novo",icon:"add",unelevated:"",color:"primary","text-color":"white",class:"hideonmobile"},{default:t(()=>[a(G,null,{default:t(()=>[a(O,{link:"","no-border":"",separator:""},{default:t(()=>[k((I(),y(z,{onClick:i.criarClick,clickable:""},{default:t(()=>[a(D,{avatar:""},{default:t(()=>[a(_,{name:"add"})]),_:1}),a(D,null,{default:t(()=>[a($,null,{default:t(()=>[g("Incluir Manual")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[L]]),k((I(),y(z,{onClick:i.importarXmlClick,clickable:""},{default:t(()=>[a(D,{avatar:""},{default:t(()=>[a(_,{name:"add"})]),_:1}),a(D,null,{default:t(()=>[a($,null,{default:t(()=>[g("Importar XML")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[L]])]),_:1})]),_:1})]),_:1}),a(F,{icon:"add",flat:"",round:"",color:"primary","text-color":"white",class:"hideondesktop"},{default:t(()=>[a(G,null,{default:t(()=>[a(O,{link:"","no-border":"",separator:""},{default:t(()=>[k((I(),y(z,{onClick:i.criarClick,clickable:""},{default:t(()=>[a(D,{avatar:""},{default:t(()=>[a(_,{name:"add"})]),_:1}),a(D,null,{default:t(()=>[a($,null,{default:t(()=>[g("Incluir Manual")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[L]]),k((I(),y(z,{onClick:i.importarXmlClick,clickable:""},{default:t(()=>[a(D,{avatar:""},{default:t(()=>[a(_,{name:"add"})]),_:1}),a(D,null,{default:t(()=>[a($,null,{default:t(()=>[g("Importar XML")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[L]])]),_:1})]),_:1})]),_:1})]),filtroCampos:t(()=>[a(h,{modelValue:r.filtros.numero,"onUpdate:modelValue":e[0]||(e[0]=d=>r.filtros.numero=d),rotulo:"N\xBA Nota",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(h,{modelValue:r.filtros.numeroCompra,"onUpdate:modelValue":e[1]||(e[1]=d=>r.filtros.numeroCompra=d),rotulo:"Ordem de compra",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),a(h,{modelValue:r.filtros.fornecedor.nome,"onUpdate:modelValue":e[2]||(e[2]=d=>r.filtros.fornecedor.nome=d),rotulo:"Fornecedor",dense:"",class:"q-field--with-bottom q-mb-md"},null,8,["modelValue"]),a(h,{modelValue:r.filtros.periodoEmissao.ini,"onUpdate:modelValue":e[3]||(e[3]=d=>r.filtros.periodoEmissao.ini=d),rotulo:"Data Emiss\xE3o",dense:"",tipo:"data",class:"q-mb-x"},null,8,["modelValue"]),a(h,{modelValue:r.filtros.periodoEmissao.fim,"onUpdate:modelValue":e[4]||(e[4]=d=>r.filtros.periodoEmissao.fim=d),rotulo:"at\xE9",dense:"",tipo:"data",class:"q-mb-xl"},null,8,["modelValue"]),a(h,{modelValue:r.filtros.periodoFinalizado.ini,"onUpdate:modelValue":e[5]||(e[5]=d=>r.filtros.periodoFinalizado.ini=d),rotulo:"Data Finalizado",dense:"",tipo:"data",class:"q-mb-xs"},null,8,["modelValue"]),a(h,{modelValue:r.filtros.periodoFinalizado.fim,"onUpdate:modelValue":e[6]||(e[6]=d=>r.filtros.periodoFinalizado.fim=d),rotulo:"at\xE9",dense:"",tipo:"data",class:"q-mb-xl"},null,8,["modelValue"]),a(h,{modelValue:r.paginacao.limite,"onUpdate:modelValue":e[7]||(e[7]=d=>r.paginacao.limite=d),rotulo:"Quantidade por p\xE1gina",dense:"",tipo:"quantidade",min:"1",class:"q-field--with-bottom"},null,8,["modelValue"])]),itemLista:t(()=>[a(O,{bordered:"",class:"bg-white q-mb-xs rounded-borders",style:{"min-height":"calc(100vh - 200px)"}},{default:t(()=>[(I(!0),U(A,null,j(r.lista,d=>(I(),U("div",{key:d.id,class:"itemHover"},[a(z,{"manual-focus":"",class:"q-py-sm q-px-xs items-center"},{default:t(()=>[a(D,{class:"hideonmobile col-auto q-px-sm no-margin"},{default:t(()=>[N("div",so,[a(l,{id:d.id,numero:d.numero,cor:"positive",escuro:""},null,8,["id","numero"])])]),_:2},1024),a(D,{class:"col-md col-lg col-xl no-margin"},{default:t(()=>[a(z,{class:"q-pa-none"},{default:t(()=>[a(D,{onClick:v=>i.abrir(d.id),class:"col-auto items-center"},{default:t(()=>[a(f,{imagem:d.imagem,rotulo:d.descricaoContato,tamanho:"40",style:{display:"flex","align-self":"center"}},null,8,["imagem","rotulo"])]),_:2},1032,["onClick"]),a(D,{class:"col"},{default:t(()=>[a($,{onClick:v=>i.abrir(d.id),lines:"2",class:"text-tertiary text-weight-bold ellipsis-2-lines"},{default:t(()=>[g(V(d.descricaoContato)+" ",1),a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g("Fornecedor")]),_:1})]),_:2},1032,["onClick"]),a(z,{class:"q-pa-none hideonmobile",style:{"min-height":"unset"}},{default:t(()=>[d.notaNumero?(I(),y(b,{key:0,cor:"tertiary",class:"mw50 text-center",escuro:""},{default:t(()=>[g(V(d.notaNumero)+" ",1),a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g("N\xFAmero da Nota")]),_:1})]),_:2},1024)):(I(),y(b,{key:1,cor:"warning",class:"mw50 text-center",escuro:""},{default:t(()=>[g(" S/N "),a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g("N\xFAmero da Nota")]),_:1})]),_:1}))]),_:2},1024),a(D,{class:"hideondesktop q-mt-sm"},{default:t(()=>[a(p,{mg:"xs-b"},{default:t(()=>[d.dataHoraEmissao?(I(),y(C,{key:0,col:"shrink"},{default:t(()=>[a(c,{icon:"mdi-calendar-today xs tertiary left",tip:`Emitido \xE1s ${o.$filters.hora(d.dataHoraEmissao)}`},{default:t(()=>[g(V(o.$filters.data(d.dataHoraEmissao)),1)]),_:2},1032,["tip"])]),_:2},1024)):S("",!0),d.dataHoraFinalizado?(I(),y(C,{key:1,col:"shrink",class:"q-ml-sm"},{default:t(()=>[a(c,{icon:"mdi-calendar xs tertiary left",tip:`Finalizado \xE1s ${o.$filters.hora(d.dataHoraFinalizado)}`},{default:t(()=>[g(V(o.$filters.data(d.dataHoraFinalizado)),1)]),_:2},1032,["tip"])]),_:2},1024)):S("",!0)]),_:2},1024),a(p,{mg:"xs-b"},{default:t(()=>[d.numero?(I(),y(C,{key:0,col:"shrink"},{default:t(()=>[a(b,{rotulo:`#${d.numero.toString().padStart(6,"0")}`,cor:"positive",escuro:""},null,8,["rotulo"])]),_:2},1024)):(I(),y(C,{key:1,col:"shrink"},{default:t(()=>[a(l,{id:d.id,numero:d.id.slice(-8),cor:"tertiary",escuro:""},null,8,["id","numero"])]),_:2},1024)),a(C,{col:"shrink",class:"q-ml-sm"},{default:t(()=>[d.notaNumero?(I(),y(b,{key:0,cor:"tertiary",class:"mw50",escuro:""},{default:t(()=>[g(V(d.notaNumero)+" ",1),a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g("N\xFAmero da Nota")]),_:1})]),_:2},1024)):(I(),y(b,{key:1,cor:"warning",class:"mw50",escuro:""},{default:t(()=>[g(" S/N "),a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g("N\xFAmero da Nota")]),_:1})]),_:1}))]),_:2},1024),a(C,{col:"shrink",class:"q-ml-sm"},{default:t(()=>[a(b,{rotulo:d.status,cor:d.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:d.status!=="Digita\xE7\xE3o"},null,8,["rotulo","cor","escuro"])]),_:2},1024)]),_:2},1024),a(p,null,{default:t(()=>[a(C,{col:"shrink",text:"bold"},{default:t(()=>[g(V(o.$filters.numero(d.totalDocumento,2)),1)]),_:2},1024),k(a(C,{col:"grow",text:"center",class:"q-ml-sm"},{default:t(()=>[g(V(d.qtdeContatos)+" Itens ",1)]),_:2},1536),[[M,d.qtdeContatos>0]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(D,{onClick:v=>i.abrir(d.id),class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:t(()=>[d.dataHoraEmissao?(I(),y($,{key:0,lines:"1",color:"tertiary",class:"ellipsis"},{default:t(()=>[a(_,{name:"mdi-calendar-today"}),g(" "+V(o.$filters.data(d.dataHoraEmissao))+" ",1),a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g(" Emitido \xE1s "+V(o.$filters.hora(d.dataHoraEmissao)),1)]),_:2},1024)]),_:2},1024)):S("",!0),d.dataHoraFinalizado?(I(),y($,{key:1,lines:"1",color:"tertiary",class:"ellipsis"},{default:t(()=>[a(_,{name:"mdi-calendar"}),g(" "+V(o.$filters.data(d.dataHoraFinalizado))+" ",1),a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g(" Finalizado \xE1s "+V(o.$filters.hora(d.dataHoraFinalizado)),1)]),_:2},1024)]),_:2},1024)):S("",!0)]),_:2},1032,["onClick"]),a(D,{onClick:v=>i.abrir(d.id),class:"hideonmobile maxw90 q-pl-sm no-margin"},{default:t(()=>[a(b,{cor:d.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:d.status!=="Digita\xE7\xE3o",class:"col-auto q-mx-auto"},{default:t(()=>[g(V(d.status)+" ",1),a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g(" Status ")]),_:1})]),_:2},1032,["cor","escuro"])]),_:2},1032,["onClick"]),a(D,{onClick:v=>i.abrir(d.id),class:"hideonmobile maxw120 q-pl-sm no-margin"},{default:t(()=>[a($,{class:"text-tertiary text-weight-bold text-right"},{default:t(()=>[g(V(o.$filters.numero(d.totalDocumento,2)),1)]),_:2},1024),k(a($,{class:"text-tertiary text-right"},{default:t(()=>[g(V(d.qtdeContatos)+" Itens ",1)]),_:2},1536),[[M,d.qtdeContatos>0]])]),_:2},1032,["onClick"]),a(D,{class:"hideonmobile col-auto q-pl-sm no-margin"},{default:t(()=>[a(z,{class:"q-pa-none"},{default:t(()=>[r.tabSelecionada2.valor!=="Nota no SEFAZ"?(I(),y(D,{key:0,class:"q-pr-sm no-margin"},{default:t(()=>[a(F,{onClick:v=>i.abrir(d.id),icon:"edit",size:"md",color:"primary",round:"",flat:"",dense:""},null,8,["onClick"])]),_:2},1024)):S("",!0),r.tabSelecionada2.valor==="Nota no SEFAZ"&&r.tabSelecionada.valor==="N\xE3o Importada"?(I(),y(D,{key:1,class:"q-pr-sm no-margin"},{default:t(()=>[a(F,{onClick:v=>i.importarXmlDFe(d.id),flat:"",round:"",dense:"",icon:"mdi-upload",size:"md",color:"tertiary",class:"buttons"},{default:t(()=>[a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g("Importar XML")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):S("",!0),r.tabSelecionada2.valor==="Nota no SEFAZ"?(I(),y(D,{key:2,class:"q-pr-sm no-margin"},{default:t(()=>[a(F,{onClick:v=>i.downloadXmlDFe(d.id),flat:"",round:"",dense:"",icon:"mdi-download",color:"tertiary",size:"md",class:"buttons"},{default:t(()=>[a(B,{anchor:"bottom middle",self:"center middle"},{default:t(()=>[g("Exportar XML")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):S("",!0),a(D,{class:"no-margin"},{default:t(()=>[a(F,{icon:"print",size:"md",color:"tertiary",round:"",flat:"",dense:""},{default:t(()=>[a(G,null,{default:t(()=>[k((I(),y(O,{link:"","no-border":"",separator:""},{default:t(()=>[(I(!0),U(A,null,j(r.configImpressao.filter(v=>v.valor),v=>(I(),y(z,{key:v.valor,onClick:P=>o.$imprimir(v.valor,(d==null?void 0:d.id)||"0"),clickable:""},{default:t(()=>[a(D,{avatar:""},{default:t(()=>[a(_,{name:"print"})]),_:1}),a(D,null,{default:t(()=>[a($,null,{default:t(()=>[g(V(v.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)),[[L]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(D,{class:"hideondesktop col-auto q-pl-sm no-margin"},{default:t(()=>[a(F,{icon:"more_vert",size:"md",color:"tertiary",round:"",flat:"",dense:""},{default:t(()=>[a(G,null,{default:t(()=>[k((I(),y(O,{link:"","no-border":"",separator:""},{default:t(()=>[r.tabSelecionada2.valor!=="Nota no SEFAZ"?(I(),y(z,{key:0,onClick:v=>i.abrir(d.id),clickable:"",class:"itemHover"},{default:t(()=>[a(D,{avatar:""},{default:t(()=>[a(_,{name:"edit"})]),_:1}),a(D,null,{default:t(()=>[a($,null,{default:t(()=>[g(" Editar ")]),_:1})]),_:1})]),_:2},1032,["onClick"])):S("",!0),r.tabSelecionada2.valor==="Nota no SEFAZ"&&r.tabSelecionada.valor==="N\xE3o Importada"?(I(),y(z,{key:1,onClick:v=>i.importarXmlDFe(d.id),clickable:"",class:"itemHover"},{default:t(()=>[a(D,{avatar:""},{default:t(()=>[a(_,{name:"mdi-upload"})]),_:1}),a(D,null,{default:t(()=>[a($,null,{default:t(()=>[g(" Importar XML ")]),_:1})]),_:1})]),_:2},1032,["onClick"])):S("",!0),r.tabSelecionada2.valor==="Nota no SEFAZ"?(I(),y(z,{key:2,onClick:v=>i.downloadXmlDFe(d.id),clickable:"",class:"itemHover"},{default:t(()=>[a(D,{avatar:""},{default:t(()=>[a(_,{name:"mdi-download"})]),_:1}),a(D,null,{default:t(()=>[a($,null,{default:t(()=>[g(" Exportar XML ")]),_:1})]),_:1})]),_:2},1032,["onClick"])):S("",!0),(I(!0),U(A,null,j(r.configImpressao.filter(v=>v.valor),v=>(I(),y(z,{key:v.valor,onClick:P=>o.$imprimir(v.valor,(d==null?void 0:d.id)||"0"),clickable:"",class:"itemHover"},{default:t(()=>[a(D,{avatar:""},{default:t(()=>[a(_,{name:"print"})]),_:1}),a(D,null,{default:t(()=>[a($,null,{default:t(()=>[g(V(v.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)),[[L]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),a(ra)]))),128))]),_:1})]),_:1},8,["busca","onAtualizar","onLimparFiltrosClick","onCriarClick","onConsultarSefazClick","lista","tabSelecionada","tabs","tabSelecionada2","tabs2","paginacao","mostrar"]),a(E,{ref:"comprasFicha",onAtualizar:i.atualizar},null,8,["onAtualizar"]),a(n,{ref:"comprasImportacaoXML",onAtualizar:i.atualizar},null,8,["onAtualizar"]),a(oa,{modelValue:r.modalXMLNotaEntrada,"onUpdate:modelValue":e[12]||(e[12]=d=>r.modalXMLNotaEntrada=d),persistent:""},{default:t(()=>[a(K,{container:"",class:"bg-light",style:{height:"40vh",width:"50vw","max-width":"100vw"}},{default:t(()=>[N("form",{onSubmit:e[11]||(e[11]=Da((...d)=>i.importarXmlNotaDeEntrada&&i.importarXmlNotaDeEntrada(...d),["prevent"]))},[a(Z,null,{default:t(()=>[a(X,null,{default:t(()=>[k(a(F,{onClick:i.fecharXmlNotaDeEntrada,flat:"",round:"",dense:"",icon:"close"},null,8,["onClick"]),[[L]]),a(W,null,{default:t(()=>[g("Importar XML Nota de Entrada")]),_:1}),a(F,{color:"white","text-color":"primary",label:"Enviar",type:"submit",unelevated:""})]),_:1})]),_:1}),a(Y,{class:"u-container"},{default:t(()=>[a(aa,{style:{"min-height":"300px"}},{default:t(()=>{var d,v,P;return[N("div",no,[a(Pa,{class:"col-12","hide-upload-btn":"","auto-upload":"",factory:i.adicionarXml,filter:q=>q.filter(T=>T.type==="text/xml")},null,8,["factory","filter"]),a(ua,{modelValue:r.xmlDevolucao,"onUpdate:modelValue":e[9]||(e[9]=q=>r.xmlDevolucao=q),label:"Devolu\xE7\xE3o"},null,8,["modelValue"]),a(ua,{modelValue:r.xmlEstrangeiro,"onUpdate:modelValue":e[10]||(e[10]=q=>r.xmlEstrangeiro=q),label:"Importa\xE7\xE3o do exterior"},null,8,["modelValue"])]),Object.keys((P=(v=(d=r.xmlNotaEntrada.error)==null?void 0:d.data)==null?void 0:v.fields)!=null?P:{}).length?(I(),U("div",mo,[N("ul",uo,[(I(!0),U(A,null,j(Object.keys(r.xmlNotaEntrada.error.data.fields),q=>(I(),U("li",{key:q},[N("span",null,V(q),1),N("span",null,V(r.xmlNotaEntrada.error.data.fields[q]),1)]))),128))])])):S("",!0)]}),_:1})]),_:1})],32)]),_:1})]),_:1},8,["modelValue"])])}var Io=J(ro,[["render",co]]);export{Io as default};
