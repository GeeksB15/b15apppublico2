import{_ as M,r as v,o as c,p as D,f as a,bJ as W,w as o,h as z,j as w,i as A,k as p,Q as H,G as F,J as I,L as P,F as q,x as Q,d as f,t as h,A as T,e as _,q as G,dR as E,bf as j,H as J,P as Z,S as x,T as S,U as k,N as K,I as U,M as X,as as N,b0 as Y}from"./index.b5cd1564.js";import{O as aa}from"./OSTrocarStatus.54d7192d.js";import{M as oa}from"./ModalHistoricoStatus.1a50eb9e.js";import{B as ea}from"./BoxEnvioWhatsapp.556c44c4.js";import{d as ta}from"./vuedraggable.umd.82375a77.js";import"./open-url.394819c3.js";const ra={components:{OSTrocarStatus:aa,ModalHistoricoStatus:oa,BoxEnvioWhatsapp:ea,draggable:ta},data(){return{sistema:$utils.sistemaPai(),tela:{},listas:{Processando:[],Entregue:[]},filtros:{visivel:!1,termo:"",prazo:{selecionado:null,opcoes:[{value:"bordaVerdeOS",label:"Em dia"},{value:"bordaAmarelaOS",label:"Entrega para esta semana"},{value:"bordaVermelhaOS",label:"Entrega atrasada"}]},empresa:{selecionada:null,opcoes:[]},entregueInicio:$utils.dataAtual(),entregueFim:$utils.dataAtual()},trocarStatus:{visivel:!1,dados:{}},whatsapp:{mensagem:`
            Ol\xE1 *[PrimeiroApelido]*, tudo bem?
            Temos uma \xF3tima not\xEDcia.
            *Sua ordem de servi\xE7o ficou pronta*, pode vir retirar na loja!
            At\xE9 mais \u{1F609}
          `},configImpressaoOrcamento:[]}},methods:{async atualizar(){try{$q.loading.show();const l=await $db.os.leAdmOSOnline({entregueInicio:this.filtros.entregueInicio,entregueFim:this.filtros.entregueFim,empresas:this.filtros.empresa.opcoes.map(t=>t.id)})||[];$utils.verificarAlerta(!l||!l.length,"N\xE3o h\xE1 ordens de servi\xE7o");let e=await $db.configuracoes.le({nome:"vendas.os.status"});e=e.filter(t=>!["Processando","Entregue"].includes(t.texto));const n={Processando:[]};for(const t of $lodash.orderBy(e,"valor","asc").map(s=>s.texto))n[t]=[];n.Entregue=[];for(const t of l){let s="bordaVerdeOS",d="",C="Normal";if(t.status==="Entregue"){if(!!t.dataHoraPrevisto&&!!t.dataHoraFinalizado){const i=new Date(new Date(t.dataHoraPrevisto).toDateString()),u=(new Date(new Date(t.dataHoraFinalizado).toDateString())-i)/(1e3*60*60*24);s=u>=0?"bordaVermelhaOS":u>-7?"bordaAmarelaOS":"bordaVerdeOS",d=u>=0?"negative":u>-7?"warning":"",C=u>=0?"Atrasado":u>-7?"Aten\xE7\xE3o":"Normal"}}else if(t.dataHoraPrevisto){const i=new Date(new Date(t.dataHoraPrevisto).toDateString()),u=(new Date(new Date().toDateString())-i)/(1e3*60*60*24);s=u>=0?"bordaVermelhaOS":u>-7?"bordaAmarelaOS":"bordaVerdeOS",d=u>=0?"negative":u>-7?"warning":"",C=u>=0?"Atrasado":u>-7?"Aten\xE7\xE3o":"Normal"}const V={id:t.id,codigoCompra:t.codigoCompra||"-",codigoContatoResponsavel:t.codigoContatoResponsavel,codigoDocumento:t.codigoDocumento,codigoContato:t.codigoContato,idEmpresa:t.idEmpresa,codigoEmpresa:t.codigoEmpresa,descricaoEmpresa:t.descricaoEmpresa,descricao:t.descricao,corBorda:s,corLabel:d,txtLabel:C,dataHoraEmissao:new Date(t.dataHoraEmissao),dataHoraFinalizado:new Date(t.dataHoraFinalizado),dataHoraRetorno:new Date(t.dataHoraRetorno),dataHoraPrevisto:new Date(t.dataHoraPrevisto),mostra:!0,nomeCliente:t.nomeCliente||"-",nomeResponsavel:t.nomeResponsavel||"-",nomeVendedor:t.nomeVendedor||"-",idVenda:t.idVenda,numeroVenda:t.numeroVenda?String(t.numeroVenda):"-",numeroOS:t.numeroOS?String(t.numeroOS):"-",status:t.status};n[t.status]&&n[t.status].push(V)}this.listas=n,this.filtrar()}catch(l){this.$q.notifyError("Erro na consulta online de oss",l)}finally{$q.loading.hide()}},async eventoEnd(){for(const l in this.listas)for(const e of this.listas[l])if(e.status!==l){this.trocarStatus.dados={codigoContatoResponsavel:e.codigoContatoResponsavel,codigoDocumento:e.codigoDocumento,codigoUsuario:null,nomeCliente:e.nomeCliente,observacao:"",statusAtual:e.status,statusNovo:l},this.trocarStatus.visivel=!0;return}},async eventoConfirmarTroca(l){try{$q.loading.show();let e;$db.usuario.logado.cpf&&(e=(await $db.contato.ler({filtros:{termoBusca:$db.usuario.logado.cpf}})).data.find(t=>{var s;return t.numeroDocumentoNacional.replace(/\D/g,"")===((s=$db.usuario.logado.cpf)==null?void 0:s.replace(/\D/g,""))})),l.cpfUsuario=e==null?void 0:e.numeroDocumentoNacional,await $db.os.trocaStatusOnline(l),this.$q.notifyPositive("Status trocado com sucesso"),await this.atualizar()}catch(e){$q.notifyError("Erro na troca de status",e)}finally{$q.loading.hide()}},async eventoCancelarTroca(l){await this.atualizar()},filtrar(){const l=$utils.removerAcentos(this.filtros.termo.toUpperCase()).split(" ").filter(e=>e!=="");for(const e in this.listas)for(const n of this.listas[e]){const t=$utils.removerAcentos(n.id.toUpperCase()+" "+n.nomeCliente.toUpperCase()+" "+n.nomeResponsavel.toUpperCase()+" "+n.nomeVendedor.toUpperCase()+" "+String(n.numeroVenda)+" "+String(n.numeroOS));let s=!0;for(const d of l)isNaN(Number(d))?s=s&&t.includes(d):s=s&&t.includes(" "+d+" ");this.filtros.empresa.selecionada&&(s=s&&this.filtros.empresa.selecionada.value===n.codigoEmpresa),n.mostra=s}},filtrarDebounce(){$lodash.debounce(this.filtrar,700)()},async empresaOpcoes(){const l=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.filtros.empresa.opcoes=l.map(e=>({id:e.id,value:e.codigoContato,label:e.apelido||e.nome}))},btnFiltros(){this.filtros.visivel=!this.filtros.visivel},async btnAtendimento(l){const e=await $erp().contato.where({codigoContato:l}).first()||{};e.id&&this.$router.push({name:"Atendimento",params:{id:e.id}})},async carregarImpressoes(l){await this.configuraImpressaoOrcamento(l.idEmpresa)},async configuraImpressaoOrcamento(l){const e=await $db.configuracoes.porNome("impressao.venda",l),n=[{valor:"invoice",texto:"Or\xE7amento/Venda (Invoice)"}];this.sistema==="optisoul"&&n.push({valor:"orcamento",texto:"Or\xE7amento (Antigo)"},{valor:"termoGarantia",texto:"Termo de Garantia"}),this.configImpressaoOrcamento=[...e.length?e.map(t=>({texto:"Imprimir Or\xE7amento",...t})):n]},resize(){this.tela={header:$utils.tela("AdmOSHeader").height}}},watch:{async"filtros.entregueInicio"(){await this.atualizar()},async"filtros.entregueFim"(){await this.atualizar()}},async created(){await this.empresaOpcoes(),await this.atualizar()}},sa={id:"AdmOS"};function la(l,e,n,t,s,d){const C=v("barraTopo"),V=v("campo"),i=v("g-col"),g=v("g-row"),u=v("badge"),y=v("g-label"),R=v("draggable"),B=v("OSTrocarStatus"),L=v("ModalHistoricoStatus"),$=v("BoxEnvioWhatsapp");return c(),D("div",sa,[a(W,{onResize:e[0]||(e[0]=m=>d.resize())}),a(F,{id:"AdmOSHeader",class:"bg-gradiente"},{default:o(()=>[a(C),a(z,{class:"q-px-sm"},{default:o(()=>[a(w,{name:"view_week",size:"sm"}),a(A,null,{default:o(()=>e[10]||(e[10]=[p("Adm. OS")])),_:1}),a(H,{onClick:e[1]||(e[1]=m=>d.btnFiltros()),icon:"mdi-filter",round:"",flat:"",dense:""})]),_:1})]),_:1}),a(U,null,{default:o(()=>[a(I,{class:"overflow-hidden no-scroll"},{default:o(()=>[a(g,{id:"container",relative:"",style:P(`height:calc(100vh - ${s.tela.header}px)`)},{default:o(()=>[(c(!0),D(q,null,Q(s.listas,(m,O)=>(c(),f(i,{key:O,id:"coluna"},{default:o(()=>[a(z,null,{default:o(()=>[a(A,null,{default:o(()=>[p(h(O),1)]),_:2},1024)]),_:2},1024),O==="Entregue"?(c(),f(T,{key:0,class:"q-pa-sm q-my-md q-mx-xs shadow-1 bg-white"},{default:o(()=>[a(g,{gutter:"md"},{default:o(()=>[a(i,{col:"12"},{default:o(()=>[a(V,{modelValue:s.filtros.entregueInicio,"onUpdate:modelValue":e[2]||(e[2]=r=>s.filtros.entregueInicio=r),rotulo:"In\xEDcio",tipo:"data"},null,8,["modelValue"])]),_:1}),a(i,{col:"12"},{default:o(()=>[a(V,{modelValue:s.filtros.entregueFim,"onUpdate:modelValue":e[3]||(e[3]=r=>s.filtros.entregueFim=r),rotulo:"Fim",tipo:"data"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):_("",!0),a(R,{list:m,id:O,onEnd:d.eventoEnd,itemKey:"id",delay:"250",group:"osGroup",draggable:".OS",class:"scroll q-px-xs",style:P(`${O==="Entregue"?"height:calc(100vh - "+(s.tela.header+226)+"px);":"height:calc(100vh - "+(s.tela.header+50)+"px);"}`)},{item:o(({element:r})=>[r.mostra&&(s.filtros.prazo.selecionado===null||s.filtros.prazo.selecionado===r.corBorda)?(c(),f(T,{key:0,class:G(`OS q-pa-sm q-my-md shadow-1 bg-white ${r.corBorda}`)},{default:o(()=>[a(g,null,{default:o(()=>[a(i,{col:"6"},{default:o(()=>[r.corLabel?(c(),f(u,{key:0,cor:r.corLabel,rotulo:r.txtLabel,escuro:""},null,8,["cor","rotulo"])):(c(),f(u,{key:1,rotulo:r.txtLabel},null,8,["rotulo"]))]),_:2},1024),a(i,{col:"6",text:"right"},{default:o(()=>[r.numeroVenda&&r.numeroVenda!=="-"?(c(),f(u,{key:0,cor:"light",rotulo:r.numeroVenda,icone:"shopping_cart",class:"q-ml-sm",dica:"N\xBA Venda"},null,8,["rotulo"])):_("",!0),r.numeroOS&&r.numeroOS!=="-"?(c(),f(u,{key:1,rotulo:r.numeroOS,icone:"assignment_turned_in",cor:"tertiary",escuro:"",class:"q-ml-sm",dica:"N\xBA O.S."},null,8,["rotulo"])):_("",!0)]),_:2},1024)]),_:2},1024),a(g,{mg:"md-y"},{default:o(()=>[a(i,{col:"12"},{default:o(()=>[r.nomeCliente?(c(),f(y,{key:0,text:"sub1 medium"},{default:o(()=>[p(h(r.nomeCliente),1)]),_:2},1024)):_("",!0),r.nomeCliente!==r.descricao?(c(),f(y,{key:1,caption:""},{default:o(()=>[p(h(r.descricao),1)]),_:2},1024)):_("",!0)]),_:2},1024)]),_:2},1024),a(g,null,{default:o(()=>[a(i,null,{default:o(()=>[r.descricaoEmpresa&&r.descricaoEmpresa!=="-"?(c(),f(g,{key:0,mg:"sm-b",items:"center"},{default:o(()=>[a(i,{col:"shrink",mg:"xs-r",self:"start"},{default:o(()=>[a(E,{icon:"business",size:"sm",color:"grey-3","text-color":"tertiary"})]),_:1}),a(i,null,{default:o(()=>[a(y,{caption:"",tip:"Empresa"},{default:o(()=>[p(h(r.descricaoEmpresa),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)):_("",!0),r.nomeVendedor&&r.nomeVendedor!=="-"?(c(),f(g,{key:1,mg:"sm-b",items:"center"},{default:o(()=>[a(i,{col:"shrink",mg:"xs-r",self:"start"},{default:o(()=>[a(E,{icon:"person",size:"sm",color:"grey-3","text-color":"tertiary"})]),_:1}),a(i,null,{default:o(()=>[a(y,{caption:"",tip:"Vendedor"},{default:o(()=>[p(h(r.nomeVendedor),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)):_("",!0),r.nomeResponsavel&&r.nomeResponsavel!=="-"?(c(),f(g,{key:2,mg:"sm-b",items:"center"},{default:o(()=>[a(i,{col:"shrink",mg:"xs-r",self:"start"},{default:o(()=>[a(E,{icon:"person",size:"sm",color:"grey-3","text-color":"tertiary"})]),_:1}),a(i,null,{default:o(()=>[a(y,{caption:"",tip:"Respons\xE1vel"},{default:o(()=>[p(h(r.nomeResponsavel),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)):_("",!0),a(g,null,{default:o(()=>[a(i,{col:"shrink",mg:"xs-r",self:"start"},{default:o(()=>[a(E,{icon:"calendar_today",size:"sm",color:"grey-3","text-color":"tertiary"})]),_:1}),a(i,null,{default:o(()=>[a(y,{caption:"",tip:r.dataHoraFinalizado>new Date("1970-01-01T00:00:00.000Z")?"Finalizado em":"Previsto para"},{default:o(()=>[p(h(l.$filters.data(r.dataHoraFinalizado>new Date("1970-01-01T00:00:00.000Z")?r.dataHoraFinalizado:r.dataHoraPrevisto)),1)]),_:2},1032,["tip"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(i,{col:"shrink",self:"end"},{default:o(()=>[a(H,{onClick:b=>d.carregarImpressoes(r),icon:"more_vert",dense:"",round:"",unelevated:""},{default:o(()=>[a(j,null,{default:o(()=>[J((c(),f(Z,{link:"",separator:""},{default:o(()=>[a(x,{onClick:b=>l.$refs.modalHistoricoStatus.mostrar({idDocumento:r.id}),clickable:""},{default:o(()=>[a(S,{avatar:""},{default:o(()=>[a(w,{name:"history"})]),_:1}),a(S,null,{default:o(()=>[a(k,null,{default:o(()=>e[11]||(e[11]=[p("Hist\xF3rico do Status")])),_:1})]),_:1})]),_:2},1032,["onClick"]),a(x,{onClick:b=>d.btnAtendimento(r.codigoContato),clickable:""},{default:o(()=>[a(S,{avatar:""},{default:o(()=>[a(w,{name:"launch"})]),_:1}),a(S,null,{default:o(()=>[a(k,null,{default:o(()=>e[12]||(e[12]=[p("Ir para o Atendimentos")])),_:1})]),_:1})]),_:2},1032,["onClick"]),a(x,{onClick:b=>l.$refs.BoxEnvioWhatsapp.abrir(r.id,r.status),clickable:""},{default:o(()=>[a(S,{avatar:""},{default:o(()=>[a(w,{name:"mdi-whatsapp"})]),_:1}),a(S,null,{default:o(()=>[a(k,null,{default:o(()=>e[13]||(e[13]=[p("Enviar Mensagem")])),_:1}),a(k,{caption:""},{default:o(()=>e[14]||(e[14]=[p("WhatsApp")])),_:1})]),_:1})]),_:2},1032,["onClick"]),(c(!0),D(q,null,Q(s.configImpressaoOrcamento.filter(b=>b.valor),b=>(c(),f(x,{onClick:ia=>l.$imprimir(b.valor,{id:(r==null?void 0:r.idVenda)||"0",Oculto:"0"}),key:b.valor,clickable:""},{default:o(()=>[a(S,{avatar:""},{default:o(()=>[a(w,{name:"print"})]),_:1}),a(S,null,{default:o(()=>[a(k,null,{default:o(()=>[p(h(b.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)),[[K]])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"])):_("",!0)]),_:2},1032,["list","id","onEnd","style"])]),_:2},1024))),128))]),_:1},8,["style"])]),_:1})]),_:1}),a(Y,{modelValue:s.filtros.visivel,"onUpdate:modelValue":e[8]||(e[8]=m=>s.filtros.visivel=m),bordered:"",side:"right",class:"hide-scrollbar"},{default:o(()=>[a(X,{view:"hHh lpR lFr"},{default:o(()=>[a(F,{class:"bg-white"},{default:o(()=>[a(z,{class:"text-tertiary border-bottom"},{default:o(()=>[a(w,{name:"mdi-filter",size:"sm"}),a(A,null,{default:o(()=>e[15]||(e[15]=[p("Filtros Avan\xE7ados")])),_:1}),a(H,{onClick:e[4]||(e[4]=m=>d.btnFiltros()),icon:"close",dense:"",flat:"",round:""})]),_:1})]),_:1}),a(U,null,{default:o(()=>[a(I,{class:"q-pa-md"},{default:o(()=>[a(V,{modelValue:s.filtros.termo,"onUpdate:modelValue":[e[5]||(e[5]=m=>s.filtros.termo=m),d.filtrarDebounce],ajuda:"Buscar por cliente, respons\xE1vel, vendedor, id, n\xBA venda, n\xBA o.s.",dense:"",rotulo:"Filtrar",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue"]),a(N,{modelValue:s.filtros.prazo.selecionado,"onUpdate:modelValue":[e[6]||(e[6]=m=>s.filtros.prazo.selecionado=m),d.filtrar],options:s.filtros.prazo.opcoes,clearable:"",dense:"",label:"Por prazo",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","options"]),a(N,{modelValue:s.filtros.empresa.selecionada,"onUpdate:modelValue":[e[7]||(e[7]=m=>s.filtros.empresa.selecionada=m),d.filtrar],options:s.filtros.empresa.opcoes,clearable:"",dense:"",label:"Por empresa",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(B,{modelValue:s.trocarStatus.visivel,"onUpdate:modelValue":e[9]||(e[9]=m=>s.trocarStatus.visivel=m),dados:s.trocarStatus.dados,onConfirmar:d.eventoConfirmarTroca,onCancelar:d.eventoCancelarTroca},null,8,["modelValue","dados","onConfirmar","onCancelar"]),a(L,{ref:"modalHistoricoStatus"},null,512),a($,{ref:"BoxEnvioWhatsapp",mensagem:s.whatsapp.mensagem},null,8,["mensagem"])])}var fa=M(ra,[["render",la]]);export{fa as default};
