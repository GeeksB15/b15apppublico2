import{_ as me,bd as M,r as q,o as v,d as y,w as m,f as i,M as Pe,G as fe,h as pe,H as he,Q as S,N as be,i as ve,s as Ae,I as ge,J as ke,p as A,P as oe,F as ye,u as Te,S as Ue,T as N,U as ae,k as u,t as P,D as re,e as D,aA as Xe,c5 as Q,bi as we,cu as Ye,e5 as _e,C as e,b1 as Ze,A as L,W as $e,cJ as et,aP as tt}from"./index.3e77a1c7.js";import{M as ot}from"./MonacoEditor.01dfaa09.js";import{V as at}from"./Visualizador.161575a1.js";var E=typeof window!="undefined"?window:null,Ce=E===null,K=Ce?void 0:E.document,x="addEventListener",V="removeEventListener",ce="getBoundingClientRect",J="_a",w="_b",j="_c",ee="horizontal",_=function(){return!1},rt=Ce?"calc":["","-webkit-","-moz-","-o-"].filter(function(o){var t=K.createElement("div");return t.style.cssText="width:"+o+"calc(9px)",!!t.style.length}).shift()+"calc",Fe=function(o){return typeof o=="string"||o instanceof String},je=function(o){if(Fe(o)){var t=K.querySelector(o);if(!t)throw new Error("Selector "+o+" did not match a DOM element");return t}return o},C=function(o,t,d){var p=o[t];return p!==void 0?p:d},te=function(o,t,d,p){if(t){if(p==="end")return 0;if(p==="center")return o/2}else if(d){if(p==="start")return 0;if(p==="center")return o/2}return o},lt=function(o,t){var d=K.createElement("div");return d.className="gutter gutter-"+t,d},it=function(o,t,d){var p={};return Fe(t)?p[o]=t:p[o]=rt+"("+t+"% - "+d+"px)",p},st=function(o,t){var d;return d={},d[o]=t+"px",d},nt=function(o,t){if(t===void 0&&(t={}),Ce)return{};var d=o,p,r,n,z,f,h;Array.from&&(d=Array.from(d));var I=je(d[0]),T=I.parentNode,G=getComputedStyle?getComputedStyle(T):null,W=G?G.flexDirection:null,b=C(t,"sizes")||d.map(function(){return 100/d.length}),le=C(t,"minSize",100),ie=Array.isArray(le)?le:d.map(function(){return le}),se=C(t,"maxSize",1/0),Le=Array.isArray(se)?se:d.map(function(){return se}),Ne=C(t,"expandToMin",!1),H=C(t,"gutterSize",10),X=C(t,"gutterAlign","center"),ne=C(t,"snapOffset",30),Ie=Array.isArray(ne)?ne:d.map(function(){return ne}),de=C(t,"dragInterval",1),R=C(t,"direction",ee),ue=C(t,"cursor",R===ee?"col-resize":"row-resize"),Re=C(t,"gutter",lt),Se=C(t,"elementStyle",it),Me=C(t,"gutterStyle",st);R===ee?(p="width",r="clientX",n="left",z="right",f="clientWidth"):R==="vertical"&&(p="height",r="clientY",n="top",z="bottom",f="clientHeight");function B(s,a,l,c){var k=Se(p,a,l,c);Object.keys(k).forEach(function(g){s.style[g]=k[g]})}function He(s,a,l){var c=Me(p,a,l);Object.keys(c).forEach(function(k){s.style[k]=c[k]})}function Y(){return h.map(function(s){return s.size})}function ze(s){return"touches"in s?s.touches[0][r]:s[r]}function Oe(s){var a=h[this.a],l=h[this.b],c=a.size+l.size;a.size=s/this.size*c,l.size=c-s/this.size*c,B(a.element,a.size,this[w],a.i),B(l.element,l.size,this[j],l.i)}function Be(s){var a,l=h[this.a],c=h[this.b];!this.dragging||(a=ze(s)-this.start+(this[w]-this.dragOffset),de>1&&(a=Math.round(a/de)*de),a<=l.minSize+l.snapOffset+this[w]?a=l.minSize+this[w]:a>=this.size-(c.minSize+c.snapOffset+this[j])&&(a=this.size-(c.minSize+this[j])),a>=l.maxSize-l.snapOffset+this[w]?a=l.maxSize+this[w]:a<=this.size-(c.maxSize-c.snapOffset+this[j])&&(a=this.size-(c.maxSize+this[j])),Oe.call(this,a),C(t,"onDrag",_)(Y()))}function Ee(){var s=h[this.a].element,a=h[this.b].element,l=s[ce](),c=a[ce]();this.size=l[p]+c[p]+this[w]+this[j],this.start=l[n],this.end=l[z]}function Qe(s){if(!getComputedStyle)return null;var a=getComputedStyle(s);if(!a)return null;var l=s[f];return l===0?null:(R===ee?l-=parseFloat(a.paddingLeft)+parseFloat(a.paddingRight):l-=parseFloat(a.paddingTop)+parseFloat(a.paddingBottom),l)}function xe(s){var a=Qe(T);if(a===null||ie.reduce(function(g,O){return g+O},0)>a)return s;var l=0,c=[],k=s.map(function(g,O){var F=a*g/100,Z=te(H,O===0,O===s.length-1,X),$=ie[O]+Z;return F<$?(l+=$-F,c.push(0),$):(c.push(F-$),F)});return l===0?s:k.map(function(g,O){var F=g;if(l>0&&c[O]-l>0){var Z=Math.min(l,c[O]-l);l-=Z,F=g-Z}return F/a*100})}function Je(){var s=this,a=h[s.a].element,l=h[s.b].element;s.dragging&&C(t,"onDragEnd",_)(Y()),s.dragging=!1,E[V]("mouseup",s.stop),E[V]("touchend",s.stop),E[V]("touchcancel",s.stop),E[V]("mousemove",s.move),E[V]("touchmove",s.move),s.stop=null,s.move=null,a[V]("selectstart",_),a[V]("dragstart",_),l[V]("selectstart",_),l[V]("dragstart",_),a.style.userSelect="",a.style.webkitUserSelect="",a.style.MozUserSelect="",a.style.pointerEvents="",l.style.userSelect="",l.style.webkitUserSelect="",l.style.MozUserSelect="",l.style.pointerEvents="",s.gutter.style.cursor="",s.parent.style.cursor="",K.body.style.cursor=""}function Ke(s){if(!("button"in s&&s.button!==0)){var a=this,l=h[a.a].element,c=h[a.b].element;a.dragging||C(t,"onDragStart",_)(Y()),s.preventDefault(),a.dragging=!0,a.move=Be.bind(a),a.stop=Je.bind(a),E[x]("mouseup",a.stop),E[x]("touchend",a.stop),E[x]("touchcancel",a.stop),E[x]("mousemove",a.move),E[x]("touchmove",a.move),l[x]("selectstart",_),l[x]("dragstart",_),c[x]("selectstart",_),c[x]("dragstart",_),l.style.userSelect="none",l.style.webkitUserSelect="none",l.style.MozUserSelect="none",l.style.pointerEvents="none",c.style.userSelect="none",c.style.webkitUserSelect="none",c.style.MozUserSelect="none",c.style.pointerEvents="none",a.gutter.style.cursor=ue,a.parent.style.cursor=ue,K.body.style.cursor=ue,Ee.call(a),a.dragOffset=ze(s)-a.end}}b=xe(b);var U=[];h=d.map(function(s,a){var l={element:je(s),size:b[a],minSize:ie[a],maxSize:Le[a],snapOffset:Ie[a],i:a},c;if(a>0&&(c={a:a-1,b:a,dragging:!1,direction:R,parent:T},c[w]=te(H,a-1===0,!1,X),c[j]=te(H,!1,a===d.length-1,X),W==="row-reverse"||W==="column-reverse")){var k=c.a;c.a=c.b,c.b=k}if(a>0){var g=Re(a,R,l.element);He(g,H,a),c[J]=Ke.bind(c),g[x]("mousedown",c[J]),g[x]("touchstart",c[J]),T.insertBefore(g,l.element),c.gutter=g}return B(l.element,l.size,te(H,a===0,a===d.length-1,X),a),a>0&&U.push(c),l});function Ve(s){var a=s.i===U.length,l=a?U[s.i-1]:U[s.i];Ee.call(l);var c=a?l.size-s.minSize-l[j]:s.minSize+l[w];Oe.call(l,c)}h.forEach(function(s){var a=s.element[ce]()[p];a<s.minSize&&(Ne?Ve(s):s.minSize=a)});function Ge(s){var a=xe(s);a.forEach(function(l,c){if(c>0){var k=U[c-1],g=h[k.a],O=h[k.b];g.size=a[c-1],O.size=l,B(g.element,g.size,k[w],g.i),B(O.element,O.size,k[j],O.i)}})}function We(s,a){U.forEach(function(l){if(a!==!0?l.parent.removeChild(l.gutter):(l.gutter[V]("mousedown",l[J]),l.gutter[V]("touchstart",l[J])),s!==!0){var c=Se(p,l.a.size,l[w]);Object.keys(c).forEach(function(k){h[l.a].element.style[k]="",h[l.b].element.style[k]=""})}})}return{setSizes:Ge,getSizes:Y,collapse:function(a){Ve(h[a])},destroy:We,parent:T,pairs:U}};const qe="Buscar relat\xF3rio",dt={data(){return{carregando:!0,listaFiltrada:[],placeholder:qe,termo:"",visivel:!1}},methods:{filtrar(){let o;if(this.termo){const t=$utils.removerAcentos(this.termo.toUpperCase()).split(" ").filter(d=>d!=="");o=this.listaCompleta.filter(d=>{const p=$utils.removerAcentos(" "+$utils.stringOrEmpty(d.codigoObjeto).toUpperCase()+"  "+$utils.stringOrEmpty(d.nomeObjeto).toUpperCase()+" "+$utils.stringOrEmpty(d.descricao).toUpperCase());let r=!0;for(const n of t)isNaN(Number(n))?r=r&&p.includes(n):r=r&&p.includes(" "+n+" ");return r})}else o=this.listaCompleta;this.listaFiltrada=o.slice(0,100),this.carregando=!1},limpar(){this.listaFiltrada=[],this.placeholder=qe,this.termo=""},onHide(){this.resolve({}),this.limpar()},onShow(){this.$refs.search.focus()},item_click(o={}){this.resolve(o),this.visivel=!1},async show(o){return this.carregando=!0,this.visivel=!0,this.listaCompleta=(await M.objeto.leOnline({colunas:"id codigoObjeto descricao documentacao nomeObjeto tipo",filtros:{tipo:"vue"}})).sort((t,d)=>$utils.stringOrEmpty(t.nomeObjeto).localeCompare($utils.stringOrEmpty(d.nomeObjeto))),this.filtrar(),new Promise((t,d)=>{this.resolve=t})}},mounted(){$g.promptEditorRelatorio={show:this.show}}},ut={key:0,class:"bg-light q-pa-lg q-mt-lg round-borders text-black text-center"},ct={key:1,class:"bg-light q-pa-lg q-mt-lg round-borders text-black text-center"};function mt(o,t,d,p,r,n){const z=q("badge");return v(),y(re,{modelValue:r.visivel,"onUpdate:modelValue":t[1]||(t[1]=f=>r.visivel=f),maximized:"",onHide:t[2]||(t[2]=f=>n.onHide()),onShow:t[3]||(t[3]=f=>n.onShow())},{default:m(()=>[i(Pe,{class:"bg-white",container:""},{default:m(()=>[i(fe,null,{default:m(()=>[i(pe,null,{default:m(()=>[he(i(S,{dense:"",flat:"",icon:"arrow_back",round:""},null,512),[[be]]),i(ve,null,{default:m(()=>[i(Ae,{modelValue:r.termo,"onUpdate:modelValue":[t[0]||(t[0]=f=>r.termo=f),n.filtrar],color:"none",ref:"search",dark:"",placeholder:r.placeholder,debounce:"600",standout:"",filled:"",dense:"",clearable:"","clear-icon":"close"},null,8,["modelValue","placeholder","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1}),i(ge,{class:"u-container"},{default:m(()=>[i(ke,null,{default:m(()=>[r.carregando?(v(),A("div",ut," Carregando... ")):r.listaFiltrada.length?(v(),y(oe,{key:2,link:"","no-border":"",separator:""},{default:m(()=>[(v(!0),A(ye,null,Te(r.listaFiltrada,f=>(v(),y(Ue,{key:f.id,clickable:"",onClick:h=>n.item_click(f),class:"row"},{default:m(()=>[i(N,{class:"col"},{default:m(()=>[i(ae,null,{default:m(()=>[u(P(f.nomeObjeto),1)]),_:2},1024),i(ae,{caption:""},{default:m(()=>[u(P(f.descricao),1)]),_:2},1024)]),_:2},1024),i(N,{class:"col-auto"},{default:m(()=>[i(z,{cor:"primary",escuro:""},{default:m(()=>[u("#"+P(f.codigoObjeto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(v(),A("div",ct," Nenhum resultado encontrado "))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var ft=me(dt,[["render",mt]]);const De="Buscar usuario, obs, publicado...",pt={computed:{usuario(){try{return JSON.parse(localStorage.usuario)}catch{return{}}}},data(){return{carregando:!0,listaFiltrada:[],placeholder:De,termo:"",visivel:!1}},props:{idObjeto:{type:String}},methods:{filtrar(){let o;if(this.termo){const t=$utils.removerAcentos(this.termo.toUpperCase()).split(" ").filter(d=>d!=="");o=this.listaCompleta.filter(d=>{const p=$utils.removerAcentos(" "+$utils.stringOrEmpty(d.obs).toUpperCase()+"  "+(d.publicado?"Publicado":"Salvo").toUpperCase()+"  "+$utils.stringOrEmpty(d.usuario).toUpperCase());let r=!0;for(const n of t)isNaN(Number(n))?r=r&&p.includes(n):r=r&&p.includes(" "+n+" ");return r})}else o=this.listaCompleta;this.listaFiltrada=o.slice(0,100),this.carregando=!1},limpar(){this.listaFiltrada=[],this.placeholder=De,this.termo=""},onHide(){this.resolve({acao:"fechar",dados:{}}),this.limpar()},onShow(){this.$refs.search.focus()},item_click(o={}){this.resolve({acao:"selecionar",dados:o}),this.visivel=!1},comparar_click(o={}){this.resolve({acao:"comparar",dados:o}),this.visivel=!1},async show(o){return this.carregando=!0,this.visivel=!0,this.listaCompleta=(await M.objetoVersao.leOnline({colunas:"id idObjeto idUsuario dataHora obs publicado usuario",filtros:{idObjeto:this.idObjeto}})).sort((t,d)=>-$utils.stringOrEmpty(t.dataHora).localeCompare($utils.stringOrEmpty(d.dataHora))),this.filtrar(),new Promise((t,d)=>{this.resolve=t})}},mounted(){$g.promptEditorRelatorioVersao={show:this.show}}},ht={key:0,class:"bg-light q-pa-lg q-mt-lg round-borders text-black text-center"},bt={key:1,class:"bg-light q-pa-lg q-mt-lg round-borders text-black text-center"};function vt(o,t,d,p,r,n){const z=q("badge");return v(),y(re,{modelValue:r.visivel,"onUpdate:modelValue":t[1]||(t[1]=f=>r.visivel=f),maximized:"",onHide:t[2]||(t[2]=f=>n.onHide()),onShow:t[3]||(t[3]=f=>n.onShow())},{default:m(()=>[i(Pe,{class:"bg-white",container:""},{default:m(()=>[i(fe,null,{default:m(()=>[i(pe,null,{default:m(()=>[he(i(S,{dense:"",flat:"",icon:"arrow_back",round:""},null,512),[[be]]),i(ve,null,{default:m(()=>[i(Ae,{modelValue:r.termo,"onUpdate:modelValue":[t[0]||(t[0]=f=>r.termo=f),n.filtrar],color:"none",ref:"search",dark:"",placeholder:r.placeholder,debounce:"600",standout:"",filled:"",dense:"",clearable:"","clear-icon":"close"},null,8,["modelValue","placeholder","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1}),i(ge,{class:"u-container"},{default:m(()=>[i(ke,null,{default:m(()=>[r.carregando?(v(),A("div",ht," Carregando... ")):r.listaFiltrada.length?(v(),y(oe,{key:2,link:"","no-border":"",separator:""},{default:m(()=>[(v(!0),A(ye,null,Te(r.listaFiltrada,f=>(v(),y(Ue,{key:f.id,clickable:"",onClick:h=>n.item_click(f),class:"row"},{default:m(()=>[i(N,{class:"col"},{default:m(()=>[f.obs?(v(),y(ae,{key:0},{default:m(()=>[u(P(f.obs),1)]),_:2},1024)):D("",!0),f.dataHora?(v(),y(ae,{key:1,caption:""},{default:m(()=>[u(P(f.publicado?"Publicado":"Salvo")+" em "+P(o.$filters.dataHora(f.dataHora)),1)]),_:2},1024)):D("",!0)]),_:2},1024),i(N,{class:"col-auto"},{default:m(()=>[f.usuario?(v(),y(z,{key:0,cor:f.idUsuario===n.usuario.id?"primary":"grey",class:"q-mr-sm",denso:"",escuro:""},{default:m(()=>[u(P(f.usuario),1)]),_:2},1032,["cor"])):D("",!0)]),_:2},1024),i(N,{class:"col-auto"},{default:m(()=>[i(z,{cor:f.publicado?"positive":"grey",denso:"",escuro:""},{default:m(()=>[u(P(f.id),1)]),_:2},1032,["cor"])]),_:2},1024),i(N,{class:"col-auto"},{default:m(()=>[i(S,{class:"q-px-sm q-mr-sm",dense:"",label:"Comparar",onClick:h=>n.comparar_click(f)},null,8,["onClick"])]),_:2},1024),i(N,{class:"col-auto"},{default:m(()=>[i(S,{class:"q-px-sm",color:"primary",dense:"",label:"Abrir",onClick:h=>n.item_click(f)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(v(),A("div",bt," Nenhum resultado encontrado "))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var gt=me(pt,[["render",vt]]);const kt={components:{MonacoEditor:ot,Visualizador:at,promptEditorRelatorio:ft,promptEditorRelatorioVersao:gt},data(){return{alterarConteudo:null,alterouConteudo:!1,areaConfiguracoes:!0,atualizarAutomaticamente:!!parseInt(localStorage.editorAtualizar),campoObservacao:"",campos:{codigoObjeto:"",descricao:"",documentacao:"",nomeObjeto:""},componenteEditor:{parametro:"",estilo:"",script:"",template:""},componenteVisualizador:{},componenteDiff:{},chaveDiff:0,modalBoasVindas:!1,modalPublicar:!1,modoDiff:!1,publicando:!1,salvando:!1}},computed:{editorOptions(){return{automaticLayout:!0,lineNumbersMinChars:2}},idObjetoValido(){return String(this.id).length===36},id(){return this.$route.params.id},temId(){return this.id!==void 0&&this.id!==""},parametroBase64(){return Xe.encodeToUrl(this.componenteEditor.parametro||"")},rotaImprimir(){return{name:"Imprimir",params:{nome:this.campos.nomeObjeto||"x",parametro:this.parametroBase64||void 0}}},usuario(){try{return JSON.parse(localStorage.usuario)}catch{return{}}},versao(){return this.$route.params.versao}},methods:{abrirConfiguracoes(){this.areaConfiguracoes=!0},async abrirPromptBuscar(){try{const o=await $g.promptEditorRelatorio.show({});o&&String(o.id).length===36&&this.confirmarSaida().onOk(()=>{this.$router.push({params:{id:o.id,versao:""}})})}catch(o){$q.notifyError("Erro ao abrir tela de buscar relat\xF3rio",o)}},async abrirPromptHistorico(){try{const o=await $g.promptEditorRelatorioVersao.show({});o&&o.dados&&String(o.dados.id).length===36&&this.confirmarSaida().onOk(()=>{o.acao==="selecionar"?this.$router.push({params:{id:this.id,versao:o.dados.id}}):o.acao==="comparar"&&(this.componenteDiff=JSON.parse(atob(o.dados.codigoPersonalizado)),this.modoDiff=!0,this.chaveDiff++)})}catch(o){$q.notifyError("Erro ao buscar vers\xE3o relat\xF3rio",o)}},aoIniciarEditor(o){o.onKeyDown(t=>{const d=t.browserEvent||{};(d.ctrlKey||d.metaKey)&&d.which===13&&(t.stopPropagation(),this.atualizarVisualizador())})},atualizarVisualizador(){if(this.atualizarAutomaticamente)return null;$utils.gconsole.log("editor","atualizarVisualizador"),this.componenteVisualizador=Q(this.componenteEditor)},atualizarComponente(o){typeof o=="string"&&(o=JSON.parse(atob(o))),this.componenteEditor={parametro:o.parametro||"",estilo:o.estilo||"",script:o.script||"",template:o.template||""},$utils.gconsole.log("editor","atualizarComponente"),this.componenteVisualizador=Q(this.componenteEditor),this.alterouConteudo=!1},async carregarObjeto(o){try{const t=String(o).length!==36?null:(await M.objeto.leOnline({colunas:"id codigoObjeto codigoPersonalizado descricao documentacao nomeObjeto tipo",filtros:{id:o}}))[0];if(!t)return $q.notify("Objeto inexistente.");this.campos.codigoObjeto=t.codigoObjeto,this.campos.nomeObjeto=t.nomeObjeto,this.campos.descricao=t.descricao,this.campos.documentacao=t.documentacao||"",this.atualizarComponente(t.codigoPersonalizado),this.abrirConfiguracoes(),this.fecharDiff()}catch(t){throw $q.notify("N\xE3o foi poss\xEDvel carregar o objeto."),t}},async carregarVersao(o){try{const t=String(o).length!==36?null:(await M.objetoVersao.leOnline({colunas:"id idObjeto idUsuario codigoPersonalizado dataHora obs publicado usuario",filtros:{id:o}}))[0];if(!t)return $q.notify("Vers\xE3o inexistente.");this.campos.documentacao=t.documentacao||"",this.atualizarComponente(t.codigoPersonalizado),this.fecharDiff()}catch(t){throw $q.notify("N\xE3o foi poss\xEDvel carregar vers\xE3o."),t}},compararVersao(o){this.componenteDiff=JSON.parse(atob(o.codigoPersonalizado)),this.modoDiff=!0,this.chaveDiff++,this.fecharModalHistorico()},confirmarSaida(){return this.alterouConteudo?$q.dialog({title:"Sair sem salvar?",message:"Parece que existem modifica\xE7\xF5es que n\xE3o foram salvas. Deseja continuar?",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}):{onOk(o){o()}}},fecharDiff(){!this.modoDiff||(this.modoDiff=!1,this.chaveDiff++)},async publicar(){this.publicando=!0;try{const o=await this.gravar(this.id,!0,this.campoObservacao);$q.notifyPositive("Publicado!"),this.campoObservacao="",this.modalPublicar=!1,this.$router.push({params:{versao:o}})}catch{$q.notifyError("Erro ao publicar.")}finally{this.publicando=!1}},redefinirCampos(){this.campos.codigoObjeto="",this.campos.descricao="",this.campos.nomeObjeto=""},redefinirComponente(){this.componenteEditor={parametro:"{}",estilo:`.foo {
  color: green;
}`,script:`vue = {
  data: () => ({
    foo: 'Solu\xE7\xF5es'
  })
}`,template:`<div class="foo">
  Geeks {{ foo }}
</div>`},$utils.gconsole.log("editor","redefinirComponente"),this.componenteVisualizador=Q(this.componenteEditor),this.alterouConteudo=!1},async incluir(){this.confirmarSaida().onOk(()=>{(this.id===0||this.id==="0")&&(this.redefinirCampos(),this.redefinirComponente()),this.$router.push({params:{id:"0",versao:""}})})},async gravar(o,t,d){const p=we(),r=btoa(JSON.stringify(this.componenteEditor));(t||!this.idObjetoValido)&&await M.objeto.grava({...this.campos,id:o,tipo:"vue",codigoPersonalizado:r});try{const z=await fetch("http://localhost:8002/gravar",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({codigoPersonalizado:"aa"})})}catch{}const n={id:p,idObjeto:o,idUsuario:this.usuario.id,codigoPersonalizado:r,dataHora:Ye(new Date).replace(/'/g,""),documentacao:this.campos.documentacao||"",publicado:t?1:0,usuario:this.usuario.nome};return d&&(n.obs=d),await M.objetoVersao.grava(n),p},async salvar(){if(this.campos.nomeObjeto==="")return $q.notify("O identificador \xE9 obrigat\xF3rio."),this.abrirConfiguracoes(),setTimeout(()=>this.$refs.campoNomeObjeto.focus(),1),!1;this.salvando=!0;try{$q.loading.show();const o=this.idObjetoValido?this.id:we(),t=await this.gravar(o);this.alterouConteudo=!1,this.$router.push({params:{id:o,versao:t}}),$q.notifyPositive("Salvo com sucesso!")}catch(o){throw $q.notify("Erro ao salvar."),o}finally{this.salvando=!1,$q.loading.hide()}},teclas(o){if(!!o&&(o.ctrlKey||o.metaKey))switch(o.which){case 13:o.preventDefault(),o.stopImmediatePropagation(),o.stopPropagation(),this.atualizarVisualizador();break;case 79:o.preventDefault(),this.abrirPromptBuscar();break;case 83:o.preventDefault(),this.salvar();break}},async lerArquivo(){try{const t=await(await fetch("http://localhost:8002/ler",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({codigoPersonalizado:"aa"})})).text();let d="";const p={ignoreAttributes:!1,allowBooleanAttributes:!0,preserveOrder:!0,unpairedTags:["hr","br","link","meta"],stopNodes:["*.pre","*.script"],processEntities:!0,htmlEntities:!0},n=new _e.XMLParser(p).parse(t);console.log("json",n);const z={ignoreAttributes:!1,format:!0,preserveOrder:!0,unpairedTags:["hr","br","link","meta"],stopNodes:["*.pre","*.script"]},h=new _e.XMLBuilder(z).build(n);await fetch("http://localhost:8002/gravar",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({conteudo:h,arquivoNome:""})})}catch{}}},async created(){if(this.redefinirComponente(),this.idObjetoValido)try{$q.loading.show(),await this.carregarObjeto(this.id),this.versao&&await this.carregarVersao(this.versao)}finally{$q.loading.hide()}else this.temId||(this.modalBoasVindas=!0);document.addEventListener("keydown",this.teclas),this.alterarConteudo=$lodash.debounce(()=>{this.alterouConteudo=!0,this.atualizarAutomaticamente&&($utils.gconsole.log("editor","created"),this.componenteVisualizador=Q(this.componenteEditor))},500)},mounted(){globalThis.tela=this,this.divisor=new nt(["#editor","#visualizador"],{minSize:[300,20]})},beforeUnmount(){document.removeEventListener("keydown",this.teclas),this.divisor&&this.divisor.destroy()},watch:{async id(o){o&&o!=="0"?this.carregarObjeto(o):(this.redefinirCampos(),this.redefinirComponente())},atualizarAutomaticamente(o){o||($utils.gconsole.log("editor","atualizarAutomaticamente"),this.componenteVisualizador=Q(this.componenteEditor)),localStorage.setItem("editorAtualizar",o?1:0)}}},yt={id:"Editor"},Ct={class:"q-px-sm"},St={class:"Editor-codigo u-alturaConteudo row"},zt={id:"editor",class:"u-alturaConteudo bg-dark text-white col col-lg-6"},Ot={class:"bg-grey-10 q-pb-md q-pt-sm q-px-md"},Et={id:"visualizador",class:"Editor-visualizador u-alturaConteudo col col-lg-6"},xt={class:"layout-padding bg-white q-pa-xl"},Vt={class:"q-mt-lg"},wt={class:"layout-padding bg-white q-pa-xl"},_t={class:"q-mt-lg"};function jt(o,t,d,p,r,n){const z=q("barra-topo"),f=q("badge"),h=q("campo"),I=q("monaco-editor"),T=q("visualizador"),G=q("promptEditorRelatorio"),W=q("promptEditorRelatorioVersao");return v(),A("div",yt,[i(fe,null,{default:m(()=>[i(z),i(pe,null,{default:m(()=>[i(ve,{onClick:n.abrirConfiguracoes,class:"flex items-center"},{default:m(()=>[n.idObjetoValido?(v(),y(f,{key:0,rotulo:r.campos.codigoObjeto,cor:"positive"},null,8,["rotulo"])):D("",!0),e("span",Ct,P(r.campos.nomeObjeto||"Editor"),1),n.idObjetoValido?D("",!0):(v(),y(f,{key:1,rotulo:"Rascunho",cor:"negative"}))]),_:1},8,["onClick"]),r.modoDiff?(v(),y(S,{key:0,class:"q-mr-sm",color:"negative",icon:"close",label:"Fechar Diff",onClick:n.fecharDiff},null,8,["onClick"])):D("",!0),i(Ze,{class:"q-mr-sm"},{default:m(()=>[r.atualizarAutomaticamente?D("",!0):(v(),y(S,{key:0,onClick:n.atualizarVisualizador,icon:"refresh",label:"Atualizar",color:"teal-5"},null,8,["onClick"])),n.idObjetoValido&&n.id?(v(),y(S,{key:1,to:n.rotaImprimir,color:"teal-5",icon:"remove_red_eye",target:"_blank"},null,8,["to"])):D("",!0)]),_:1}),i(S,{color:"white",class:"q-ml-sm",label:"Novo",icon:"add","text-color":"dark",onClick:n.incluir},null,8,["onClick"]),i(S,{color:"white",class:"q-ml-sm",label:"Abrir",icon:"search","text-color":"dark",onClick:n.abrirPromptBuscar},null,8,["onClick"]),i(S,{color:"yellow",class:"q-ml-sm",disabled:r.salvando,label:r.salvando?"Salvando...":"Salvar",icon:"save","text-color":"dark",onClick:n.salvar},null,8,["disabled","label","onClick"]),n.idObjetoValido?(v(),A(ye,{key:1},[i(S,{color:"white",class:"q-ml-sm",label:"Hist\xF3rico",icon:"history","text-color":"dark",onClick:n.abrirPromptHistorico},null,8,["onClick"]),i(S,{color:"yellow",class:"q-ml-sm",label:"Publicar",icon:"publish","text-color":"dark",onClick:t[0]||(t[0]=b=>r.modalPublicar=!0)})],64)):D("",!0)]),_:1})]),_:1}),i(ge,null,{default:m(()=>[i(ke,null,{default:m(()=>[e("div",St,[e("div",zt,[i(oe,{class:"q-pb-none","no-border":""},{default:m(()=>[i(L,{modelValue:r.areaConfiguracoes,"onUpdate:modelValue":t[5]||(t[5]=b=>r.areaConfiguracoes=b),class:"Editor-editorItem",group:"editor",icon:"settings",label:"Configura\xE7\xF5es"},{default:m(()=>[e("div",Ot,[i(h,{modelValue:r.campos.nomeObjeto,"onUpdate:modelValue":t[1]||(t[1]=b=>r.campos.nomeObjeto=b),ref:"campoNomeObjeto",dark:"",rotulo:"Identificador"},null,8,["modelValue"]),i(h,{modelValue:r.campos.descricao,"onUpdate:modelValue":t[2]||(t[2]=b=>r.campos.descricao=b),dark:"",rotulo:"Descri\xE7\xE3o"},null,8,["modelValue"]),i(h,{modelValue:r.componenteEditor.parametro,"onUpdate:modelValue":t[3]||(t[3]=b=>r.componenteEditor.parametro=b),dark:"",ajuda:n.parametroBase64,rotulo:"Par\xE2metro",tipo:"textoArea"},null,8,["modelValue","ajuda"]),i($e,{modelValue:r.atualizarAutomaticamente,"onUpdate:modelValue":t[4]||(t[4]=b=>r.atualizarAutomaticamente=b),class:"q-mt-lg",label:"Atualizar pr\xE9-visualiza\xE7\xE3o ao digitar?"},null,8,["modelValue"]),i(oe,{class:"q-mt-lg q-pa-none",dark:"",separator:""},{default:m(()=>[i(L,{group:"configuracoes",label:"Atalhos da ferramenta"},{default:m(()=>t[13]||(t[13]=[e("table",{class:"TabelaEscura text-caption q-mb-md q-mx-md"},[e("thead",null,[e("tr",null,[e("th",null,"Atalho"),e("th",null,"Windows"),e("th",null,"Linux"),e("th",null,"macOS")])]),e("tbody",null,[e("tr",null,[e("td",null,"Abrir documento"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"O")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"O")])]),e("tr",null,[e("td",null,"Salvar documento"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"S")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"S")])]),e("tr",null,[e("td",null,"Atualizar componente"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"ENTER")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"ENTER")])])])],-1)])),_:1}),i(L,{group:"configuracoes",label:"Atalhos do editor"},{default:m(()=>t[14]||(t[14]=[e("table",{class:"TabelaEscura text-caption q-mb-md q-mx-md"},[e("thead",null,[e("tr",null,[e("th",null,"Atalho"),e("th",null,"Windows"),e("th",null,"Linux"),e("th",null,"macOS")])]),e("tbody",null,[e("tr",null,[e("td",null,"Paleta de comandos"),e("td",{class:"text-center",colspan:"3"},[e("kbd",null,"F1")])]),e("tr",null,[e("td",null,"Colapsar tudo"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"K"),u(" | "),e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"0")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"K"),u(" | "),e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"0")])]),e("tr",null,[e("td",null,"Comentar"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"/")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"/")])]),e("tr",null,[e("td",null,"Expandir tudo"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"K"),u(" | "),e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"J")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"K"),u(" | "),e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"J")])]),e("tr",null,[e("td",null,"Formatar sele\xE7\xE3o"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"K"),u(" | "),e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"F")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"K"),u(" | "),e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"F")])]),e("tr",null,[e("td",null,"Formatar tudo"),e("td",{class:"text-center"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"SHIFT"),u(" + "),e("kbd",null,"F")]),e("td",{class:"text-center"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"SHIFT"),u(" + "),e("kbd",null,"F")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"SHIFT"),u(" + "),e("kbd",null,"F")])]),e("tr",null,[e("td",null,"Localizar"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"F")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"F")])]),e("tr",null,[e("td",null,"M\xFAltiplos cursores"),e("td",{class:"text-center"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"ALT"),u(" + "),e("kbd",null,"SHIFT"),u(" + "),e("kbd",null,"\u2191\u2193")]),e("td",{class:"text-center"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"SHIFT"),u(" + "),e("kbd",null,"\u2191\u2193")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"SHIFT"),u(" + "),e("kbd",null,"\u2191\u2193")])]),e("tr",null,[e("td",null,"Selecionar tudo"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"A")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"A")])]),e("tr",null,[e("td",null,"Substituir"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"H")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"H")])])])],-1)])),_:1})]),_:1})])]),_:1},8,["modelValue"]),i(L,{class:"Editor-editorItem",group:"editor",icon:"dashboard",label:"Template (HTML)"},{default:m(()=>[(v(),y(I,{key:r.chaveDiff,class:"Editor-editor",modelValue:r.componenteEditor.template,"onUpdate:modelValue":t[6]||(t[6]=b=>r.componenteEditor.template=b),language:"html",diffEditor:r.modoDiff,original:r.componenteDiff.template,options:n.editorOptions,theme:"vs-dark",onEditorDidMount:n.aoIniciarEditor,onChange:r.alterarConteudo},null,8,["modelValue","diffEditor","original","options","onEditorDidMount","onChange"]))]),_:1}),i(L,{class:"Editor-editorItem",group:"editor",icon:"code",label:"JavaScript (Vue)","default-opened":""},{default:m(()=>[(v(),y(I,{key:r.chaveDiff+1,class:"Editor-editor",modelValue:r.componenteEditor.script,"onUpdate:modelValue":t[7]||(t[7]=b=>r.componenteEditor.script=b),language:"javascript",diffEditor:r.modoDiff,original:r.componenteDiff.script,options:n.editorOptions,theme:"vs-dark",onEditorDidMount:n.aoIniciarEditor,onChange:r.alterarConteudo},null,8,["modelValue","diffEditor","original","options","onEditorDidMount","onChange"]))]),_:1}),i(L,{class:"Editor-editorItem",group:"editor",icon:"format_paint",label:"Estilos (CSS)"},{default:m(()=>[(v(),y(I,{key:r.chaveDiff+2,class:"Editor-editor",modelValue:r.componenteEditor.estilo,"onUpdate:modelValue":t[8]||(t[8]=b=>r.componenteEditor.estilo=b),language:"css",diffEditor:r.modoDiff,original:r.componenteDiff.estilo,options:n.editorOptions,theme:"vs-dark",onEditorDidMount:n.aoIniciarEditor,onChange:r.alterarConteudo},null,8,["modelValue","diffEditor","original","options","onEditorDidMount","onChange"]))]),_:1}),i(L,{class:"Editor-editorItem",group:"editor",icon:"speaker_notes",label:"Documenta\xE7\xE3o (Markdown)"},{default:m(()=>[i(I,{class:"Editor-editor",modelValue:r.campos.documentacao,"onUpdate:modelValue":t[9]||(t[9]=b=>r.campos.documentacao=b),language:"markdown",options:n.editorOptions,theme:"vs-dark",onEditorDidMount:n.aoIniciarEditor,onChange:r.alterarConteudo},null,8,["modelValue","options","onEditorDidMount","onChange"])]),_:1})]),_:1})]),e("div",Et,[i(T,{class:"",componente:r.componenteVisualizador},null,8,["componente"])])]),i(re,{modelValue:r.modalBoasVindas,"onUpdate:modelValue":t[10]||(t[10]=b=>r.modalBoasVindas=b),"no-backdrop-dismiss":"","no-esc-dismiss":""},{default:m(()=>[e("div",xt,[t[15]||(t[15]=e("h4",{class:"q-mb-sm q-mt-none"},"Bem-vindo ao Editor.",-1)),t[16]||(t[16]=e("p",null,"Atrav\xE9s desta interface \xE9 poss\xEDvel criar ou editar objetos do sistema.",-1)),e("div",Vt,[i(S,{color:"primary",label:"Novo",icon:"add",onClick:n.incluir},null,8,["onClick"]),i(S,{color:"primary",class:"q-ml-sm",label:"Abrir",icon:"search",onClick:n.abrirPromptBuscar},null,8,["onClick"])])])]),_:1},8,["modelValue"]),i(re,{modelValue:r.modalPublicar,"onUpdate:modelValue":t[12]||(t[12]=b=>r.modalPublicar=b),"no-backdrop-dismiss":"","no-esc-dismiss":""},{default:m(()=>[e("div",wt,[t[17]||(t[17]=e("h4",{class:"q-mb-sm q-mt-none"},"Publicar",-1)),t[18]||(t[18]=e("p",null,"Deixe uma mensagem para recordar o que h\xE1 de novo nesta vers\xE3o.",-1)),i(h,{modelValue:r.campoObservacao,"onUpdate:modelValue":t[11]||(t[11]=b=>r.campoObservacao=b),rotulo:"Mensagem",placeholder:"Escreva a sua mensagem...",tipo:"textoArea"},null,8,["modelValue"]),e("div",_t,[he(i(S,{label:"Cancelar",color:"tertiary",flat:""},null,512),[[be]]),i(S,{color:"primary",unelevated:"",class:"q-ml-sm",label:"Publicar",icon:"publish",onClick:n.publicar},null,8,["onClick"])])]),i(et,{visible:r.modalPublicar&&r.publicando},{default:m(()=>[i(tt,{size:"50px",color:"primary"})]),_:1},8,["visible"])]),_:1},8,["modelValue"]),i(G),i(W,{idObjeto:n.id},null,8,["idObjeto"])]),_:1})]),_:1})])}var At=me(kt,[["render",jt]]);export{At as default};
