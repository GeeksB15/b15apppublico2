import{_ as v,bf as h,r as _,o as e,p as r,f as s,w as i,G as g,J as z,F as d,d as p,z as q,O as S,C as m,t as n,j as $,e as B,h as y,i as D,u as w,k as f,I as x}from"./index.05370f25.js";let c=1;const P={components:{},data(){return{animacao:"",atualizou:!1,mensagemBancoBloqueado:"",statusBancos:{}}},methods:{animar(){c++,c===10&&(c=1),c<5?this.animacao="<".repeat(c)+""+">".repeat(c):this.animacao="<".repeat(10-c)+""+">".repeat(10-c)},async atualizar(){if(await this.verificarRedirecionamento())return!0;try{this.$q.loading.show();const a=await h.sincronismo.le();for(const t of a){const l=this.statusBancos[t.bancoDeDados]||{};this.statusBancos[t.bancoDeDados]={bancoDeDados:t.bancoDeDados,status:t.status,percentagem:0,quantidadeRestantePeriodico:0,...l}}this.atualizou=!0}catch(a){this.$q.notifyError("Erro ao atualizar",a)}finally{this.$q.loading.hide()}this.atualizarPeriodico()},async atualizarPeriodico(){this.cotadorInterval=(this.cotadorInterval||0)+1,this.animar();try{const a=this.cotadorInterval%5!==1?await h.sincronismo.le({bancoDeDados:$db.cache.get("bancoDeDados")}):await h.sincronismo.le();for(const t of a){if(t.bancoDeDados===$db.cache.get("bancoDeDados")&&await this.verificarRedirecionamento(t))return!0;const l=this.statusBancos[t.bancoDeDados];l||(this.statusBancos[t.bancoDeDados]={...t}),l.ultimo<t.ultimo&&(this.statusBancos[t.bancoDeDados]={...l,...t})}}catch(a){this.$q.notifyError("Erro ao atualizar",a)}},async atualizarStatusSincronismo(a,t){if(this.animar(),this.statusBancos[a]={...this.statusBancos[a]||{},...t},t.status==="normal"&&await this.verificarRedirecionamento())return!0},async atualizarStatusSincronismoPeriodico(a,t){this.animar(),this.statusBancos[a]&&t&&(this.statusBancos[a].quantidadeRestantePeriodico-=t)},async verificarRedirecionamento(){try{if(this.mensagemBancoBloqueado=await h.sincronismo.verificaBloqueio(),!this.mensagemBancoBloqueado){const a=await $db.permissao.telaInicial();return $utils.gconsole.log("Home","redirecionando para a tela inicial",JSON.stringify(a)),await this.$router.push(a),!0}}catch(a){this.$q.notifyError("Erro ao verificar banco selecionado",a)}return!1}},async created(){},async mounted(){if($db.cache.get("reload")==="1"){$utils.gconsole.log("Home","reload()"),$db.cache.set("reload","0"),window.location.reload();return}if(!$db.app.modoOnline.le()){if($utils.emitter.on("atualizarStatusSincronismo",this.atualizarStatusSincronismo),$utils.emitter.on("atualizarStatusSincronismoPeriodico",this.atualizarStatusSincronismoPeriodico),await this.atualizar())return;this.interval=setInterval(this.atualizarPeriodico,3e4);return}this.atualizou=!0},beforeUnmount(){this.interval&&clearInterval(this.interval),$utils.emitter.off("atualizarStatusSincronismo"),$utils.emitter.off("atualizarStatusSincronismoPeriodico")}},k={id:"home"},I={class:"text-body1 q-mr-sm"},Q={class:"text-caption"},C=m("div",{class:"text-body1 q-mt-md text-white text-center q-px-md"}," Voc\xEA pode usar a parte online do sistema enquanto trazemos os dados para seu dispositivo! ",-1),E=m("div",{class:"text-caption"}," Atualizando ... ",-1);function R(a,t,l,H,u,T){const b=_("barraTopo");return e(),r("div",k,[s(g,{elevated:"",class:"bg-transparent text-white"},{default:i(()=>[s(b)]),_:1}),s(x,null,{default:i(()=>[s(z,{class:"u-container"},{default:i(()=>[a.$db.app.modoOnline.le()?B("",!0):(e(),r(d,{key:0},[u.mensagemBancoBloqueado?(e(),p(q,{key:0,color:"negative",class:"q-mb-md"},{default:i(()=>[s(S,{class:"q-py-xs"},{default:i(()=>[m("span",I,n(u.mensagemBancoBloqueado),1),s($,{name:"alarm",color:"white"})]),_:1})]),_:1})):B("",!0),u.atualizou?(e(),r(d,{key:1},[s(y,{class:"q-py-sm",color:"none"},{default:i(()=>[s(D,{class:"text-center text-white"},{default:i(()=>[(e(!0),r(d,null,w(u.statusBancos,o=>(e(),r("p",{key:o.bancoDeDados},[o.status?o.status==="sincronismoInicial"?(e(),r(d,{key:1},[f(n(o.bancoDeDados)+" - "+n(a.$filters.numero(o.percentagem,2))+" % ",1)],64)):(e(),r(d,{key:2},[f(n(o.bancoDeDados)+" "+n(a.$filters.dataHora(o.dataHoraServidor))+" - "+n(a.$filters.numero(o.quantidadeRestantePeriodico,0))+" quantidade restante ",1)],64)):(e(),r(d,{key:0},[f(n(o.bancoDeDados)+" - verificando ... ",1)],64))]))),128)),m("div",Q,[m("div",null,n(u.animacao),1),f(" Sincronizando ")])]),_:1})]),_:1}),C],64)):(e(),p(y,{key:2,class:"q-py-sm",color:"none"},{default:i(()=>[s(D,{class:"text-center"},{default:i(()=>[E]),_:1})]),_:1}))],64))]),_:1})]),_:1})])}var V=v(P,[["render",R]]);export{V as default};
