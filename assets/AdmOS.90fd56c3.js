import{_ as M,r as b,o as u,p as D,f as o,bJ as W,w as a,h as z,j as C,i as A,k as m,Q as H,G as F,J as I,L as P,F as q,x as Q,d as f,t as S,A as T,e as h,q as j,dR as E,bf as G,H as J,P as Z,S as x,T as y,U as k,N as K,I as B,M as X,as as R,b0 as Y}from"./index.37f29987.js";import{O as oo}from"./OSTrocarStatus.31efe12a.js";import{M as ao}from"./ModalHistoricoStatus.04234a7c.js";import{B as eo}from"./BoxEnvioWhatsapp.e998e3ad.js";import{d as to}from"./vuedraggable.umd.607404d0.js";import"./open-url.1bc646cf.js";const ro={components:{OSTrocarStatus:oo,ModalHistoricoStatus:ao,BoxEnvioWhatsapp:eo,draggable:to},data(){return{sistema:$utils.sistemaPai(),tela:{},listas:{Processando:[],Entregue:[]},filtros:{visivel:!1,termo:"",prazo:{selecionado:null,opcoes:[{value:"bordaVerdeOS",label:"Em dia"},{value:"bordaAmarelaOS",label:"Entrega para esta semana"},{value:"bordaVermelhaOS",label:"Entrega atrasada"}]},empresa:{selecionada:null,opcoes:[]},entregueInicio:$utils.dataAtual(),entregueFim:$utils.dataAtual()},trocarStatus:{visivel:!1,dados:{}},whatsapp:{mensagem:`
            Ol\xE1 *[PrimeiroApelido]*, tudo bem?
            Temos uma \xF3tima not\xEDcia.
            *Sua ordem de servi\xE7o ficou pronta*, pode vir retirar na loja!
            At\xE9 mais \u{1F609}
          `},configImpressaoOrcamento:[]}},methods:{async atualizar(){try{$q.loading.show();const l=await $db.os.leAdmOSOnline({entregueInicio:this.filtros.entregueInicio,entregueFim:this.filtros.entregueFim,empresas:this.filtros.empresa.opcoes.map(r=>r.id)})||[];$utils.verificarAlerta(!l||!l.length,"N\xE3o h\xE1 ordens de servi\xE7o");let e=await $db.configuracoes.le({nome:"vendas.os.status"});e=e.filter(r=>!["Processando","Entregue"].includes(r.texto));const g={Processando:[]};for(const r of $lodash.orderBy(e,"valor","asc").map(t=>t.texto))g[r]=[];g.Entregue=[];for(const r of l){let t="bordaVerdeOS",d="",w="Normal";if(r.status==="Entregue"){if(!!r.dataHoraPrevisto&&!!r.dataHoraFinalizado){const i=new Date(new Date(r.dataHoraPrevisto).toDateString()),n=(new Date(new Date(r.dataHoraFinalizado).toDateString())-i)/(1e3*60*60*24);t=n>=0?"bordaVermelhaOS":n>-7?"bordaAmarelaOS":"bordaVerdeOS",d=n>=0?"negative":n>-7?"warning":"",w=n>=0?"Atrasado":n>-7?"Aten\xE7\xE3o":"Normal"}}else if(r.dataHoraPrevisto){const i=new Date(new Date(r.dataHoraPrevisto).toDateString()),n=(new Date(new Date().toDateString())-i)/(1e3*60*60*24);t=n>=0?"bordaVermelhaOS":n>-7?"bordaAmarelaOS":"bordaVerdeOS",d=n>=0?"negative":n>-7?"warning":"",w=n>=0?"Atrasado":n>-7?"Aten\xE7\xE3o":"Normal"}const p={id:r.id,codigoCompra:r.codigoCompra||"-",codigoContatoResponsavel:r.codigoContatoResponsavel,codigoDocumento:r.codigoDocumento,codigoContato:r.codigoContato,idEmpresa:r.idEmpresa,codigoEmpresa:r.codigoEmpresa,descricaoEmpresa:r.descricaoEmpresa,descricao:r.descricao,corBorda:t,corLabel:d,txtLabel:w,dataHoraEmissao:new Date(r.dataHoraEmissao),dataHoraFinalizado:new Date(r.dataHoraFinalizado),dataHoraRetorno:new Date(r.dataHoraRetorno),dataHoraPrevisto:new Date(r.dataHoraPrevisto),mostra:!0,nomeCliente:r.nomeCliente||"-",nomeResponsavel:r.nomeResponsavel||"-",nomeVendedor:r.nomeVendedor||"-",idVenda:r.idVenda,numeroVenda:r.numeroVenda?String(r.numeroVenda):"-",numeroOS:r.numeroOS?String(r.numeroOS):"-",status:r.status};g[r.status]&&g[r.status].push(p)}this.listas=g,this.filtrar()}catch(l){this.$q.notifyError("Erro na consulta online de oss",l)}finally{$q.loading.hide()}},async eventoEnd(){for(const l in this.listas)for(const e of this.listas[l])if(e.status!==l){this.trocarStatus.dados={codigoContatoResponsavel:e.codigoContatoResponsavel,codigoDocumento:e.codigoDocumento,codigoUsuario:null,nomeCliente:e.nomeCliente,observacao:"",statusAtual:e.status,statusNovo:l},this.trocarStatus.visivel=!0;return}},async eventoConfirmarTroca(l){try{$q.loading.show();let e;$db.usuario.logado.cpf&&(e=(await $db.contato.ler({filtros:{termoBusca:$db.usuario.logado.cpf}})).data.find(r=>{var t;return r.numeroDocumentoNacional.replace(/\D/g,"")===((t=$db.usuario.logado.cpf)==null?void 0:t.replace(/\D/g,""))})),l.cpfUsuario=e==null?void 0:e.numeroDocumentoNacional,await $db.os.trocaStatusOnline(l),this.$q.notifyPositive("Status trocado com sucesso"),await this.atualizar()}catch(e){$q.notifyError("Erro na troca de status",e)}finally{$q.loading.hide()}},async eventoCancelarTroca(l){await this.atualizar()},filtrar(){const l=$utils.removerAcentos(this.filtros.termo.toUpperCase()).split(" ").filter(Boolean),e=l.filter(r=>r.match(/^\d+$/)),g=l.filter(r=>!r.match(/^\d+$/));for(const r in this.listas)for(const t of this.listas[r]){const d=$utils.removerAcentos([t==null?void 0:t.id,t==null?void 0:t.nomeCliente,t==null?void 0:t.nomeResponsavel,t==null?void 0:t.nomeVendedor].join(" ").toUpperCase()),w=[t==null?void 0:t.numeroVenda,t==null?void 0:t.numeroOS].map(String);let p=!0;for(const i of e)p=p&&w.includes(i);for(const i of g)p=p&&d.includes(i);this.filtros.empresa.selecionada&&(p=p&&this.filtros.empresa.selecionada.value===t.codigoEmpresa),t.mostra=p}},filtrarDebounce(){$lodash.debounce(this.filtrar,700)()},async empresaOpcoes(){const l=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.filtros.empresa.opcoes=l.map(e=>({id:e.id,value:e.codigoContato,label:e.apelido||e.nome}))},btnFiltros(){this.filtros.visivel=!this.filtros.visivel},async btnAtendimento(l){const e=await $erp().contato.where({codigoContato:l}).first()||{};e.id&&this.$router.push({name:"Atendimento",params:{id:e.id}})},async carregarImpressoes(l){await this.configuraImpressaoOrcamento(l.idEmpresa)},async configuraImpressaoOrcamento(l){const e=await $db.configuracoes.porNome("impressao.venda",l),g=[{valor:"invoice",texto:"Or\xE7amento/Venda (Invoice)"}];this.sistema==="optisoul"&&g.push({valor:"orcamento",texto:"Or\xE7amento (Antigo)"},{valor:"termoGarantia",texto:"Termo de Garantia"}),this.configImpressaoOrcamento=[...e.length?e.map(r=>({texto:"Imprimir Or\xE7amento",...r})):g]},resize(){this.tela={header:$utils.tela("AdmOSHeader").height}}},watch:{async"filtros.entregueInicio"(){await this.atualizar()},async"filtros.entregueFim"(){await this.atualizar()}},async created(){await this.empresaOpcoes(),await this.atualizar()}},so={id:"AdmOS"};function lo(l,e,g,r,t,d){const w=b("barraTopo"),p=b("campo"),i=b("g-col"),v=b("g-row"),n=b("badge"),V=b("g-label"),U=b("draggable"),N=b("OSTrocarStatus"),$=b("ModalHistoricoStatus"),L=b("BoxEnvioWhatsapp");return u(),D("div",so,[o(W,{onResize:e[0]||(e[0]=c=>d.resize())}),o(F,{id:"AdmOSHeader",class:"bg-gradiente"},{default:a(()=>[o(w),o(z,{class:"q-px-sm"},{default:a(()=>[o(C,{name:"view_week",size:"sm"}),o(A,null,{default:a(()=>e[10]||(e[10]=[m("Adm. OS")])),_:1}),o(H,{onClick:e[1]||(e[1]=c=>d.btnFiltros()),icon:"mdi-filter",round:"",flat:"",dense:""})]),_:1})]),_:1}),o(B,null,{default:a(()=>[o(I,{class:"overflow-hidden no-scroll"},{default:a(()=>[o(v,{id:"container",relative:"",style:P(`height:calc(100vh - ${t.tela.header}px)`)},{default:a(()=>[(u(!0),D(q,null,Q(t.listas,(c,O)=>(u(),f(i,{key:O,id:"coluna"},{default:a(()=>[o(z,null,{default:a(()=>[o(A,null,{default:a(()=>[m(S(O),1)]),_:2},1024)]),_:2},1024),O==="Entregue"?(u(),f(T,{key:0,class:"q-pa-sm q-my-md q-mx-xs shadow-1 bg-white"},{default:a(()=>[o(v,{gutter:"md"},{default:a(()=>[o(i,{col:"12"},{default:a(()=>[o(p,{modelValue:t.filtros.entregueInicio,"onUpdate:modelValue":e[2]||(e[2]=s=>t.filtros.entregueInicio=s),rotulo:"In\xEDcio",tipo:"data"},null,8,["modelValue"])]),_:1}),o(i,{col:"12"},{default:a(()=>[o(p,{modelValue:t.filtros.entregueFim,"onUpdate:modelValue":e[3]||(e[3]=s=>t.filtros.entregueFim=s),rotulo:"Fim",tipo:"data"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):h("",!0),o(U,{list:c,id:O,onEnd:d.eventoEnd,itemKey:"id",delay:"250",group:"osGroup",draggable:".OS",class:"scroll q-px-xs",style:P(`${O==="Entregue"?"height:calc(100vh - "+(t.tela.header+226)+"px);":"height:calc(100vh - "+(t.tela.header+50)+"px);"}`)},{item:a(({element:s})=>[s.mostra&&(t.filtros.prazo.selecionado===null||t.filtros.prazo.selecionado===s.corBorda)?(u(),f(T,{key:0,class:j(`OS q-pa-sm q-my-md shadow-1 bg-white ${s.corBorda}`)},{default:a(()=>[o(v,null,{default:a(()=>[o(i,{col:"6"},{default:a(()=>[s.corLabel?(u(),f(n,{key:0,cor:s.corLabel,rotulo:s.txtLabel,escuro:""},null,8,["cor","rotulo"])):(u(),f(n,{key:1,rotulo:s.txtLabel},null,8,["rotulo"]))]),_:2},1024),o(i,{col:"6",text:"right"},{default:a(()=>[s.numeroVenda&&s.numeroVenda!=="-"?(u(),f(n,{key:0,cor:"light",rotulo:s.numeroVenda,icone:"shopping_cart",class:"q-ml-sm",dica:"N\xBA Venda"},null,8,["rotulo"])):h("",!0),s.numeroOS&&s.numeroOS!=="-"?(u(),f(n,{key:1,rotulo:s.numeroOS,icone:"assignment_turned_in",cor:"tertiary",escuro:"",class:"q-ml-sm",dica:"N\xBA O.S."},null,8,["rotulo"])):h("",!0)]),_:2},1024)]),_:2},1024),o(v,{mg:"md-y"},{default:a(()=>[o(i,{col:"12"},{default:a(()=>[s.nomeCliente?(u(),f(V,{key:0,text:"sub1 medium"},{default:a(()=>[m(S(s.nomeCliente),1)]),_:2},1024)):h("",!0),s.nomeCliente!==s.descricao?(u(),f(V,{key:1,caption:""},{default:a(()=>[m(S(s.descricao),1)]),_:2},1024)):h("",!0)]),_:2},1024)]),_:2},1024),o(v,null,{default:a(()=>[o(i,null,{default:a(()=>[s.descricaoEmpresa&&s.descricaoEmpresa!=="-"?(u(),f(v,{key:0,mg:"sm-b",items:"center"},{default:a(()=>[o(i,{col:"shrink",mg:"xs-r",self:"start"},{default:a(()=>[o(E,{icon:"business",size:"sm",color:"grey-3","text-color":"tertiary"})]),_:1}),o(i,null,{default:a(()=>[o(V,{caption:"",tip:"Empresa"},{default:a(()=>[m(S(s.descricaoEmpresa),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)):h("",!0),s.nomeVendedor&&s.nomeVendedor!=="-"?(u(),f(v,{key:1,mg:"sm-b",items:"center"},{default:a(()=>[o(i,{col:"shrink",mg:"xs-r",self:"start"},{default:a(()=>[o(E,{icon:"person",size:"sm",color:"grey-3","text-color":"tertiary"})]),_:1}),o(i,null,{default:a(()=>[o(V,{caption:"",tip:"Vendedor"},{default:a(()=>[m(S(s.nomeVendedor),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)):h("",!0),s.nomeResponsavel&&s.nomeResponsavel!=="-"?(u(),f(v,{key:2,mg:"sm-b",items:"center"},{default:a(()=>[o(i,{col:"shrink",mg:"xs-r",self:"start"},{default:a(()=>[o(E,{icon:"person",size:"sm",color:"grey-3","text-color":"tertiary"})]),_:1}),o(i,null,{default:a(()=>[o(V,{caption:"",tip:"Respons\xE1vel"},{default:a(()=>[m(S(s.nomeResponsavel),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)):h("",!0),o(v,null,{default:a(()=>[o(i,{col:"shrink",mg:"xs-r",self:"start"},{default:a(()=>[o(E,{icon:"calendar_today",size:"sm",color:"grey-3","text-color":"tertiary"})]),_:1}),o(i,null,{default:a(()=>[o(V,{caption:"",tip:s.dataHoraFinalizado>new Date("1970-01-01T00:00:00.000Z")?"Finalizado em":"Previsto para"},{default:a(()=>[m(S(l.$filters.data(s.dataHoraFinalizado>new Date("1970-01-01T00:00:00.000Z")?s.dataHoraFinalizado:s.dataHoraPrevisto)),1)]),_:2},1032,["tip"])]),_:2},1024)]),_:2},1024)]),_:2},1024),o(i,{col:"shrink",self:"end"},{default:a(()=>[o(H,{onClick:_=>d.carregarImpressoes(s),icon:"more_vert",dense:"",round:"",unelevated:""},{default:a(()=>[o(G,null,{default:a(()=>[J((u(),f(Z,{link:"",separator:""},{default:a(()=>[o(x,{onClick:_=>l.$refs.modalHistoricoStatus.mostrar({idDocumento:s.id}),clickable:""},{default:a(()=>[o(y,{avatar:""},{default:a(()=>[o(C,{name:"history"})]),_:1}),o(y,null,{default:a(()=>[o(k,null,{default:a(()=>e[11]||(e[11]=[m("Hist\xF3rico do Status")])),_:1})]),_:1})]),_:2},1032,["onClick"]),o(x,{onClick:_=>d.btnAtendimento(s.codigoContato),clickable:""},{default:a(()=>[o(y,{avatar:""},{default:a(()=>[o(C,{name:"launch"})]),_:1}),o(y,null,{default:a(()=>[o(k,null,{default:a(()=>e[12]||(e[12]=[m("Ir para o Atendimentos")])),_:1})]),_:1})]),_:2},1032,["onClick"]),o(x,{onClick:_=>l.$refs.BoxEnvioWhatsapp.abrir(s.id,s.status),clickable:""},{default:a(()=>[o(y,{avatar:""},{default:a(()=>[o(C,{name:"mdi-whatsapp"})]),_:1}),o(y,null,{default:a(()=>[o(k,null,{default:a(()=>e[13]||(e[13]=[m("Enviar Mensagem")])),_:1}),o(k,{caption:""},{default:a(()=>e[14]||(e[14]=[m("WhatsApp")])),_:1})]),_:1})]),_:2},1032,["onClick"]),(u(!0),D(q,null,Q(t.configImpressaoOrcamento.filter(_=>_.valor),_=>(u(),f(x,{onClick:io=>l.$imprimir(_.valor,{id:(s==null?void 0:s.idVenda)||"0",Oculto:"0"}),key:_.valor,clickable:""},{default:a(()=>[o(y,{avatar:""},{default:a(()=>[o(C,{name:"print"})]),_:1}),o(y,null,{default:a(()=>[o(k,null,{default:a(()=>[m(S(_.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)),[[K]])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"])):h("",!0)]),_:2},1032,["list","id","onEnd","style"])]),_:2},1024))),128))]),_:1},8,["style"])]),_:1})]),_:1}),o(Y,{modelValue:t.filtros.visivel,"onUpdate:modelValue":e[8]||(e[8]=c=>t.filtros.visivel=c),bordered:"",side:"right",class:"hide-scrollbar"},{default:a(()=>[o(X,{view:"hHh lpR lFr"},{default:a(()=>[o(F,{class:"bg-white"},{default:a(()=>[o(z,{class:"text-tertiary border-bottom"},{default:a(()=>[o(C,{name:"mdi-filter",size:"sm"}),o(A,null,{default:a(()=>e[15]||(e[15]=[m("Filtros Avan\xE7ados")])),_:1}),o(H,{onClick:e[4]||(e[4]=c=>d.btnFiltros()),icon:"close",dense:"",flat:"",round:""})]),_:1})]),_:1}),o(B,null,{default:a(()=>[o(I,{class:"q-pa-md"},{default:a(()=>[o(p,{modelValue:t.filtros.termo,"onUpdate:modelValue":[e[5]||(e[5]=c=>t.filtros.termo=c),d.filtrarDebounce],ajuda:"Buscar por cliente, respons\xE1vel, vendedor, id, n\xBA venda, n\xBA o.s.",dense:"",rotulo:"Filtrar",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue"]),o(R,{modelValue:t.filtros.prazo.selecionado,"onUpdate:modelValue":[e[6]||(e[6]=c=>t.filtros.prazo.selecionado=c),d.filtrar],options:t.filtros.prazo.opcoes,clearable:"",dense:"",label:"Por prazo",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","options"]),o(R,{modelValue:t.filtros.empresa.selecionada,"onUpdate:modelValue":[e[7]||(e[7]=c=>t.filtros.empresa.selecionada=c),d.filtrar],options:t.filtros.empresa.opcoes,clearable:"",dense:"",label:"Por empresa",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(N,{modelValue:t.trocarStatus.visivel,"onUpdate:modelValue":e[9]||(e[9]=c=>t.trocarStatus.visivel=c),dados:t.trocarStatus.dados,onConfirmar:d.eventoConfirmarTroca,onCancelar:d.eventoCancelarTroca},null,8,["modelValue","dados","onConfirmar","onCancelar"]),o($,{ref:"modalHistoricoStatus"},null,512),o(L,{ref:"BoxEnvioWhatsapp",mensagem:t.whatsapp.mensagem},null,8,["mensagem"])])}var go=M(ro,[["render",lo]]);export{go as default};
