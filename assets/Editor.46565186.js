import{_ as fe,bd as R,r as j,o as g,d as k,w as s,f as l,M as De,G as pe,h as he,H as be,Q as C,N as ge,i as ve,v as Pe,j as Te,I as ke,J as ye,p as L,P as ie,F as Ae,x as Ue,S as Fe,T as H,U as B,k as u,t as A,D as se,C as e,e as q,e5 as Ve,m as T,l as ae,B as I,W as Ye,cJ as Ze,aP as $e}from"./index.82e1f7f9.js";import{M as et}from"./MonacoEditor.8ca6107a.js";import{V as tt}from"./Visualizador.1e10f168.js";var E=typeof window!="undefined"?window:null,Se=E===null,X=Se?void 0:E.document,w="addEventListener",x="removeEventListener",me="getBoundingClientRect",W="_a",V="_b",D="_c",re="horizontal",_=function(){return!1},ot=Se?"calc":["","-webkit-","-moz-","-o-"].filter(function(o){var t=X.createElement("div");return t.style.cssText="width:"+o+"calc(9px)",!!t.style.length}).shift()+"calc",Ie=function(o){return typeof o=="string"||o instanceof String},_e=function(o){if(Ie(o)){var t=X.querySelector(o);if(!t)throw new Error("Selector "+o+" did not match a DOM element");return t}return o},S=function(o,t,c){var p=o[t];return p!==void 0?p:c},le=function(o,t,c,p){if(t){if(p==="end")return 0;if(p==="center")return o/2}else if(c){if(p==="start")return 0;if(p==="center")return o/2}return o},at=function(o,t){var c=X.createElement("div");return c.className="gutter gutter-"+t,c},rt=function(o,t,c){var p={};return Ie(t)?p[o]=t:p[o]=ot+"("+t+"% - "+c+"px)",p},lt=function(o,t){var c;return c={},c[o]=t+"px",c},it=function(o,t){if(t===void 0&&(t={}),Se)return{};var c=o,p,r,d,z,f,h;Array.from&&(c=Array.from(c));var M=_e(c[0]),P=M.parentNode,Y=getComputedStyle?getComputedStyle(P):null,Z=Y?Y.flexDirection:null,Q=S(t,"sizes")||c.map(function(){return 100/c.length}),J=S(t,"minSize",100),b=Array.isArray(J)?J:c.map(function(){return J}),ne=S(t,"maxSize",1/0),Le=Array.isArray(ne)?ne:c.map(function(){return ne}),Me=S(t,"expandToMin",!1),K=S(t,"gutterSize",10),$=S(t,"gutterAlign","center"),de=S(t,"snapOffset",30),Ne=Array.isArray(de)?de:c.map(function(){return de}),ue=S(t,"dragInterval",1),N=S(t,"direction",re),ce=S(t,"cursor",N===re?"col-resize":"row-resize"),Re=S(t,"gutter",at),Ce=S(t,"elementStyle",rt),He=S(t,"gutterStyle",lt);N===re?(p="width",r="clientX",d="left",z="right",f="clientWidth"):N==="vertical"&&(p="height",r="clientY",d="top",z="bottom",f="clientHeight");function G(n,a,i,m){var y=Ce(p,a,i,m);Object.keys(y).forEach(function(v){n.style[v]=y[v]})}function Be(n,a,i){var m=He(p,a,i);Object.keys(m).forEach(function(y){n.style[y]=m[y]})}function ee(){return h.map(function(n){return n.size})}function ze(n){return"touches"in n?n.touches[0][r]:n[r]}function Oe(n){var a=h[this.a],i=h[this.b],m=a.size+i.size;a.size=n/this.size*m,i.size=m-n/this.size*m,G(a.element,a.size,this[V],a.i),G(i.element,i.size,this[D],i.i)}function Qe(n){var a,i=h[this.a],m=h[this.b];!this.dragging||(a=ze(n)-this.start+(this[V]-this.dragOffset),ue>1&&(a=Math.round(a/ue)*ue),a<=i.minSize+i.snapOffset+this[V]?a=i.minSize+this[V]:a>=this.size-(m.minSize+m.snapOffset+this[D])&&(a=this.size-(m.minSize+this[D])),a>=i.maxSize-i.snapOffset+this[V]?a=i.maxSize+this[V]:a<=this.size-(m.maxSize-m.snapOffset+this[D])&&(a=this.size-(m.maxSize+this[D])),Oe.call(this,a),S(t,"onDrag",_)(ee()))}function Ee(){var n=h[this.a].element,a=h[this.b].element,i=n[me](),m=a[me]();this.size=i[p]+m[p]+this[V]+this[D],this.start=i[d],this.end=i[z]}function Je(n){if(!getComputedStyle)return null;var a=getComputedStyle(n);if(!a)return null;var i=n[f];return i===0?null:(N===re?i-=parseFloat(a.paddingLeft)+parseFloat(a.paddingRight):i-=parseFloat(a.paddingTop)+parseFloat(a.paddingBottom),i)}function we(n){var a=Je(P);if(a===null||b.reduce(function(v,O){return v+O},0)>a)return n;var i=0,m=[],y=n.map(function(v,O){var F=a*v/100,te=le(K,O===0,O===n.length-1,$),oe=b[O]+te;return F<oe?(i+=oe-F,m.push(0),oe):(m.push(F-oe),F)});return i===0?n:y.map(function(v,O){var F=v;if(i>0&&m[O]-i>0){var te=Math.min(i,m[O]-i);i-=te,F=v-te}return F/a*100})}function Ke(){var n=this,a=h[n.a].element,i=h[n.b].element;n.dragging&&S(t,"onDragEnd",_)(ee()),n.dragging=!1,E[x]("mouseup",n.stop),E[x]("touchend",n.stop),E[x]("touchcancel",n.stop),E[x]("mousemove",n.move),E[x]("touchmove",n.move),n.stop=null,n.move=null,a[x]("selectstart",_),a[x]("dragstart",_),i[x]("selectstart",_),i[x]("dragstart",_),a.style.userSelect="",a.style.webkitUserSelect="",a.style.MozUserSelect="",a.style.pointerEvents="",i.style.userSelect="",i.style.webkitUserSelect="",i.style.MozUserSelect="",i.style.pointerEvents="",n.gutter.style.cursor="",n.parent.style.cursor="",X.body.style.cursor=""}function Ge(n){if(!("button"in n&&n.button!==0)){var a=this,i=h[a.a].element,m=h[a.b].element;a.dragging||S(t,"onDragStart",_)(ee()),n.preventDefault(),a.dragging=!0,a.move=Qe.bind(a),a.stop=Ke.bind(a),E[w]("mouseup",a.stop),E[w]("touchend",a.stop),E[w]("touchcancel",a.stop),E[w]("mousemove",a.move),E[w]("touchmove",a.move),i[w]("selectstart",_),i[w]("dragstart",_),m[w]("selectstart",_),m[w]("dragstart",_),i.style.userSelect="none",i.style.webkitUserSelect="none",i.style.MozUserSelect="none",i.style.pointerEvents="none",m.style.userSelect="none",m.style.webkitUserSelect="none",m.style.MozUserSelect="none",m.style.pointerEvents="none",a.gutter.style.cursor=ce,a.parent.style.cursor=ce,X.body.style.cursor=ce,Ee.call(a),a.dragOffset=ze(n)-a.end}}Q=we(Q);var U=[];h=c.map(function(n,a){var i={element:_e(n),size:Q[a],minSize:b[a],maxSize:Le[a],snapOffset:Ne[a],i:a},m;if(a>0&&(m={a:a-1,b:a,dragging:!1,direction:N,parent:P},m[V]=le(K,a-1===0,!1,$),m[D]=le(K,!1,a===c.length-1,$),Z==="row-reverse"||Z==="column-reverse")){var y=m.a;m.a=m.b,m.b=y}if(a>0){var v=Re(a,N,i.element);Be(v,K,a),m[W]=Ge.bind(m),v[w]("mousedown",m[W]),v[w]("touchstart",m[W]),P.insertBefore(v,i.element),m.gutter=v}return G(i.element,i.size,le(K,a===0,a===c.length-1,$),a),a>0&&U.push(m),i});function xe(n){var a=n.i===U.length,i=a?U[n.i-1]:U[n.i];Ee.call(i);var m=a?i.size-n.minSize-i[D]:n.minSize+i[V];Oe.call(i,m)}h.forEach(function(n){var a=n.element[me]()[p];a<n.minSize&&(Me?xe(n):n.minSize=a)});function We(n){var a=we(n);a.forEach(function(i,m){if(m>0){var y=U[m-1],v=h[y.a],O=h[y.b];v.size=a[m-1],O.size=i,G(v.element,v.size,y[V],v.i),G(O.element,O.size,y[D],O.i)}})}function Xe(n,a){U.forEach(function(i){if(a!==!0?i.parent.removeChild(i.gutter):(i.gutter[x]("mousedown",i[W]),i.gutter[x]("touchstart",i[W])),n!==!0){var m=Ce(p,i.a.size,i[V]);Object.keys(m).forEach(function(y){h[i.a].element.style[y]="",h[i.b].element.style[y]=""})}})}return{setSizes:We,getSizes:ee,collapse:function(a){xe(h[a])},destroy:Xe,parent:P,pairs:U}};const je="Buscar relat\xF3rio",st={data(){return{carregando:!0,listaFiltrada:[],placeholder:je,termo:"",visivel:!1}},methods:{filtrar(){let o;if(this.termo){const t=$utils.removerAcentos(this.termo.toUpperCase()).split(" ").filter(c=>c!=="");o=this.listaCompleta.filter(c=>{const p=$utils.removerAcentos(" "+$utils.stringOrEmpty(c.codigoObjeto).toUpperCase()+"  "+$utils.stringOrEmpty(c.nomeObjeto).toUpperCase()+" "+$utils.stringOrEmpty(c.descricao).toUpperCase());let r=!0;for(const d of t)isNaN(Number(d))?r=r&&p.includes(d):r=r&&p.includes(" "+d+" ");return r})}else o=this.listaCompleta;this.listaFiltrada=o.slice(0,100),this.carregando=!1},limpar(){this.listaFiltrada=[],this.placeholder=je,this.termo=""},onHide(){this.resolve({}),this.limpar()},onShow(){this.$refs.search.focus()},item_click(o={}){this.resolve(o),this.visivel=!1},async show(o){return this.carregando=!0,this.visivel=!0,this.listaCompleta=(await R.objeto.leOnline({colunas:"id codigoObjeto descricao documentacao nomeObjeto tipo",filtros:{tipo:"vue"}})).sort((t,c)=>$utils.stringOrEmpty(t.nomeObjeto).localeCompare($utils.stringOrEmpty(c.nomeObjeto))),this.filtrar(),new Promise((t,c)=>{this.resolve=t})}},mounted(){$g.promptEditorRelatorio={show:this.show}}},nt={key:0,class:"bg-light q-pa-lg q-mt-lg round-borders text-black text-center"},dt={key:1,class:"bg-light q-pa-lg q-mt-lg round-borders text-black text-center"};function ut(o,t,c,p,r,d){const z=j("badge");return g(),k(se,{modelValue:r.visivel,"onUpdate:modelValue":t[1]||(t[1]=f=>r.visivel=f),maximized:"",onHide:t[2]||(t[2]=f=>d.onHide()),onShow:t[3]||(t[3]=f=>d.onShow())},{default:s(()=>[l(De,{class:"bg-light",container:""},{default:s(()=>[l(pe,null,{default:s(()=>[l(he,null,{default:s(()=>[be(l(C,{icon:"arrow_back",flat:"",round:"",dense:""},null,512),[[ge]]),l(ve,null,{default:s(()=>[l(Pe,{modelValue:r.termo,"onUpdate:modelValue":[t[0]||(t[0]=f=>r.termo=f),d.filtrar],placeholder:r.placeholder,clearable:"",filled:"",standout:"",dark:"",dense:"","clear-icon":"close",debounce:"700",ref:"search",style:{"max-width":"600px",background:"rgba(255,255,255,.13)"},class:"q-mx-auto"},{prepend:s(()=>[l(Te,{name:"mdi-filter",color:"white",class:"showScreenIcon"})]),_:1},8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1})]),_:1})]),_:1}),l(ke,null,{default:s(()=>[l(ye,{class:"u-container q-pa-md bg-white"},{default:s(()=>[r.carregando?(g(),L("div",nt," Carregando... ")):r.listaFiltrada.length?(g(),k(ie,{key:2,link:"",separator:""},{default:s(()=>[(g(!0),L(Ae,null,Ue(r.listaFiltrada,f=>(g(),k(Fe,{key:f.id,clickable:"",onClick:h=>d.item_click(f),class:"row"},{default:s(()=>[l(H,{class:"col"},{default:s(()=>[l(B,null,{default:s(()=>[u(A(f.nomeObjeto),1)]),_:2},1024),l(B,{caption:""},{default:s(()=>[u(A(f.descricao),1)]),_:2},1024)]),_:2},1024),l(H,{class:"col-auto"},{default:s(()=>[l(z,{cor:"primary",escuro:""},{default:s(()=>[u("#"+A(f.codigoObjeto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(g(),L("div",dt," Nenhum resultado encontrado "))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var ct=fe(st,[["render",ut]]);const qe="Buscar usuario, obs, publicado...",mt={computed:{usuario(){try{return JSON.parse(localStorage.usuario)}catch{return{}}}},data(){return{carregando:!0,listaFiltrada:[],placeholder:qe,termo:"",visivel:!1}},props:{idObjeto:{type:String}},methods:{filtrar(){let o;if(this.termo){const t=$utils.removerAcentos(this.termo.toUpperCase()).split(" ").filter(c=>c!=="");o=this.listaCompleta.filter(c=>{const p=$utils.removerAcentos(" "+$utils.stringOrEmpty(c.obs).toUpperCase()+"  "+(c.publicado?"Publicado":"Salvo").toUpperCase()+"  "+$utils.stringOrEmpty(c.usuario).toUpperCase());let r=!0;for(const d of t)isNaN(Number(d))?r=r&&p.includes(d):r=r&&p.includes(" "+d+" ");return r})}else o=this.listaCompleta;this.listaFiltrada=o.slice(0,100),this.carregando=!1},limpar(){this.listaFiltrada=[],this.placeholder=qe,this.termo=""},onHide(){this.resolve({acao:"fechar",dados:{}}),this.limpar()},onShow(){this.$refs.search.focus()},item_click(o={}){this.resolve({acao:"selecionar",dados:o}),this.visivel=!1},comparar_click(o={}){this.resolve({acao:"comparar",dados:o}),this.visivel=!1},async show(o){return this.carregando=!0,this.visivel=!0,this.listaCompleta=(await R.objetoVersao.leOnline({colunas:"id idObjeto idUsuario dataHora obs publicado usuario",filtros:{idObjeto:this.idObjeto}})).sort((t,c)=>-$utils.stringOrEmpty(t.dataHora).localeCompare($utils.stringOrEmpty(c.dataHora))),this.filtrar(),new Promise((t,c)=>{this.resolve=t})}},mounted(){$g.promptEditorRelatorioVersao={show:this.show}}},ft={key:0,class:"bg-light q-pa-lg q-mt-lg round-borders text-black text-center"},pt={key:1,class:"bg-light q-pa-lg q-mt-lg round-borders text-black text-center"},ht={class:"text-weight-medium"};function bt(o,t,c,p,r,d){const z=j("badge");return g(),k(se,{modelValue:r.visivel,"onUpdate:modelValue":t[1]||(t[1]=f=>r.visivel=f),maximized:"",onHide:t[2]||(t[2]=f=>d.onHide()),onShow:t[3]||(t[3]=f=>d.onShow())},{default:s(()=>[l(De,{container:"",class:"bg-light"},{default:s(()=>[l(pe,null,{default:s(()=>[l(he,null,{default:s(()=>[be(l(C,{icon:"arrow_back",flat:"",round:"",dense:""},null,512),[[ge]]),l(ve,null,{default:s(()=>[l(Pe,{modelValue:r.termo,"onUpdate:modelValue":[t[0]||(t[0]=f=>r.termo=f),d.filtrar],placeholder:r.placeholder,clearable:"",filled:"",standout:"",dark:"",dense:"","clear-icon":"close",debounce:"1500",ref:"search",style:{"max-width":"600px",background:"rgba(255,255,255,.13)"},class:"q-mx-auto"},{prepend:s(()=>[l(Te,{name:"mdi-filter",color:"white",class:"showScreenIcon"})]),_:1},8,["modelValue","onUpdate:modelValue","placeholder"])]),_:1})]),_:1})]),_:1}),l(ke,null,{default:s(()=>[l(ye,{class:"u-container q-pa-md bg-white"},{default:s(()=>[r.carregando?(g(),L("div",ft," Carregando... ")):r.listaFiltrada.length?(g(),k(ie,{key:2,link:"",separator:""},{default:s(()=>[(g(!0),L(Ae,null,Ue(r.listaFiltrada,f=>(g(),k(Fe,{key:f.id,clickable:"",onClick:h=>d.item_click(f),class:"row"},{default:s(()=>[l(H,{class:"col"},{default:s(()=>[l(B,null,{default:s(()=>[u(A(f.obs||"Sem observa\xE7\xF5es..."),1)]),_:2},1024),f.dataHora?(g(),k(B,{key:0,caption:""},{default:s(()=>[u(A(f.publicado?"Publicado":"Salvo")+" em: ",1),e("span",ht,A(o.$filters.dataHora(f.dataHora)),1)]),_:2},1024)):q("",!0)]),_:2},1024),l(H,{class:"maxw240 q-pl-sm no-margin"},{default:s(()=>[l(B,null,{default:s(()=>[f.usuario?(g(),k(z,{key:0,rotulo:f.usuario,denso:"",escuro:"",cor:f.idUsuario===d.usuario.id?"primary":"grey"},null,8,["rotulo","cor"])):q("",!0)]),_:2},1024),l(B,null,{default:s(()=>[l(z,{rotulo:f.id,denso:"",escuro:"",cor:f.publicado?"positive":"grey"},null,8,["rotulo","cor"])]),_:2},1024)]),_:2},1024),l(H,{class:"maxw100 q-pl-sm no-margin"},{default:s(()=>[l(C,{onClick:h=>d.comparar_click(f),unelevated:"",label:"Comparar",color:"secondary",class:"q-px-sm"},null,8,["onClick"])]),_:2},1024),l(H,{class:"maxw100 q-pl-sm no-margin"},{default:s(()=>[l(C,{onClick:h=>d.item_click(f),unelevated:"",label:"Abrir",color:"primary",class:"q-px-sm"},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(g(),L("div",pt," Nenhum resultado encontrado "))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var gt=fe(mt,[["render",bt]]);const vt={components:{MonacoEditor:et,Visualizador:tt,promptEditorRelatorio:ct,promptEditorRelatorioVersao:gt},data(){return{alterarConteudo:null,alterouConteudo:!1,areaConfiguracoes:!0,atualizarAutomaticamente:!!parseInt(localStorage.editorAtualizar),campoObservacao:"",campos:{codigoObjeto:"",descricao:"",documentacao:"",nomeObjeto:""},componenteEditor:{parametro:"",estilo:"",script:"",template:""},componenteVisualizador:{},componenteDiff:{},chaveDiff:0,modalBoasVindas:!1,modalPublicar:!1,modoDiff:!1,publicando:!1,salvando:!1}},computed:{editorOptions(){return{automaticLayout:!0,lineNumbersMinChars:2}},idObjetoValido(){return String(this.id).length===36},id(){return this.$route.params.id},temId(){return this.id!==void 0&&this.id!==""},parametroBase64(){return $utils.base64.encodeToUrl(this.componenteEditor.parametro||"")},rotaImprimir(){return{name:"Imprimir",params:{nome:this.campos.nomeObjeto||"x",parametro:this.parametroBase64||void 0}}},usuario(){try{return JSON.parse(localStorage.usuario)}catch{return{}}},versao(){return this.$route.params.versao}},methods:{abrirConfiguracoes(){this.areaConfiguracoes=!0},async abrirPromptBuscar(){try{const o=await $g.promptEditorRelatorio.show({});o&&String(o.id).length===36&&this.confirmarSaida().onOk(()=>{this.$router.push({params:{id:o.id,versao:""}})})}catch(o){$q.notifyError("Erro ao abrir tela de buscar relat\xF3rio",o)}},async abrirPromptHistorico(){try{const o=await $g.promptEditorRelatorioVersao.show({});o&&o.dados&&String(o.dados.id).length===36&&this.confirmarSaida().onOk(()=>{o.acao==="selecionar"?this.$router.push({params:{id:this.id,versao:o.dados.id}}):o.acao==="comparar"&&(this.componenteDiff=JSON.parse(atob(o.dados.codigoPersonalizado)),this.modoDiff=!0,this.chaveDiff++)})}catch(o){$q.notifyError("Erro ao buscar vers\xE3o relat\xF3rio",o)}},aoIniciarEditor(o){o.onKeyDown(t=>{const c=t.browserEvent||{};(c.ctrlKey||c.metaKey)&&c.which===13&&(t.stopPropagation(),this.atualizarVisualizador())})},atualizarVisualizador(){if(this.atualizarAutomaticamente)return null;$utils.gconsole.log("editor","atualizarVisualizador"),this.componenteVisualizador=$utils.clonar(this.componenteEditor)},atualizarComponente(o){typeof o=="string"&&(o=JSON.parse(atob(o))),this.componenteEditor={parametro:o.parametro||"",estilo:o.estilo||"",script:o.script||"",template:o.template||""},$utils.gconsole.log("editor","atualizarComponente"),this.componenteVisualizador=$utils.clonar(this.componenteEditor),this.alterouConteudo=!1},async carregarObjeto(o){try{const t=String(o).length!==36?null:(await R.objeto.leOnline({colunas:"id codigoObjeto codigoPersonalizado descricao documentacao nomeObjeto tipo",filtros:{id:o}}))[0];if(!t)return $q.notify("Objeto inexistente.");this.campos.codigoObjeto=t.codigoObjeto,this.campos.nomeObjeto=t.nomeObjeto,this.campos.descricao=t.descricao,this.campos.documentacao=t.documentacao||"",this.atualizarComponente(t.codigoPersonalizado),this.abrirConfiguracoes(),this.fecharDiff()}catch(t){throw $q.notify("N\xE3o foi poss\xEDvel carregar o objeto."),t}},async carregarVersao(o){try{const t=String(o).length!==36?null:(await R.objetoVersao.leOnline({colunas:"id idObjeto idUsuario codigoPersonalizado dataHora obs publicado usuario",filtros:{id:o}}))[0];if(!t)return $q.notify("Vers\xE3o inexistente.");this.campos.documentacao=t.documentacao||"",this.atualizarComponente(t.codigoPersonalizado),this.fecharDiff()}catch(t){throw $q.notify("N\xE3o foi poss\xEDvel carregar vers\xE3o."),t}},compararVersao(o){this.componenteDiff=JSON.parse(atob(o.codigoPersonalizado)),this.modoDiff=!0,this.chaveDiff++,this.fecharModalHistorico()},confirmarSaida(){return this.alterouConteudo?$q.dialog({title:"Sair sem salvar?",message:"Parece que existem modifica\xE7\xF5es que n\xE3o foram salvas. Deseja continuar?",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}):{onOk(o){o()}}},fecharDiff(){!this.modoDiff||(this.modoDiff=!1,this.chaveDiff++)},async publicar(){this.publicando=!0;try{const o=await this.gravar(this.id,!0,this.campoObservacao);$q.notifyPositive("Publicado!"),this.campoObservacao="",this.modalPublicar=!1,this.$router.push({params:{versao:o}})}catch{$q.notifyError("Erro ao publicar.")}finally{this.publicando=!1}},redefinirCampos(){this.campos.codigoObjeto="",this.campos.descricao="",this.campos.nomeObjeto=""},redefinirComponente(){this.componenteEditor={parametro:"{}",estilo:`.foo {
  color: green;
}`,script:`vue = {
  data: () => ({
    foo: 'Solu\xE7\xF5es'
  })
}`,template:`<div class="foo">
  Geeks {{ foo }}
</div>`},$utils.gconsole.log("editor","redefinirComponente"),this.componenteVisualizador=$utils.clonar(this.componenteEditor),this.alterouConteudo=!1},async incluir(){this.confirmarSaida().onOk(()=>{(this.id===0||this.id==="0")&&(this.redefinirCampos(),this.redefinirComponente()),this.$router.push({params:{id:"0",versao:""}})})},async gravar(o,t,c){const p=$utils.uuid(),r=btoa(JSON.stringify(this.componenteEditor));(t||!this.idObjetoValido)&&await R.objeto.grava({...this.campos,id:o,tipo:"vue",codigoPersonalizado:r});try{const z=await fetch("http://localhost:8002/gravar",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({codigoPersonalizado:"aa"})})}catch{}const d={id:p,idObjeto:o,idUsuario:this.usuario.id,codigoPersonalizado:r,dataHora:$utils.sqlData(new Date).replace(/'/g,""),documentacao:this.campos.documentacao||"",publicado:t?1:0,usuario:this.usuario.nome};return c&&(d.obs=c),await R.objetoVersao.grava(d),p},async salvar(){if(this.campos.nomeObjeto==="")return $q.notify("O identificador \xE9 obrigat\xF3rio."),this.abrirConfiguracoes(),setTimeout(()=>this.$refs.campoNomeObjeto.focus(),1),!1;this.salvando=!0;try{$q.loading.show();const o=this.idObjetoValido?this.id:$utils.uuid(),t=await this.gravar(o);this.alterouConteudo=!1,this.$router.push({params:{id:o,versao:t}}),$q.notifyPositive("Salvo com sucesso!")}catch(o){throw $q.notify("Erro ao salvar."),o}finally{this.salvando=!1,$q.loading.hide()}},teclas(o){if(!!o&&(o.ctrlKey||o.metaKey))switch(o.which){case 13:o.preventDefault(),o.stopImmediatePropagation(),o.stopPropagation(),this.atualizarVisualizador();break;case 79:o.preventDefault(),this.abrirPromptBuscar();break;case 83:o.preventDefault(),this.salvar();break}},async lerArquivo(){try{const t=await(await fetch("http://localhost:8002/ler",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({codigoPersonalizado:"aa"})})).text();let c="";const p={ignoreAttributes:!1,allowBooleanAttributes:!0,preserveOrder:!0,unpairedTags:["hr","br","link","meta"],stopNodes:["*.pre","*.script"],processEntities:!0,htmlEntities:!0},d=new Ve.XMLParser(p).parse(t);console.log("json",d);const z={ignoreAttributes:!1,format:!0,preserveOrder:!0,unpairedTags:["hr","br","link","meta"],stopNodes:["*.pre","*.script"]},h=new Ve.XMLBuilder(z).build(d);await fetch("http://localhost:8002/gravar",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({conteudo:h,arquivoNome:""})})}catch{}}},async created(){if(this.redefinirComponente(),this.idObjetoValido)try{$q.loading.show(),await this.carregarObjeto(this.id),this.versao&&await this.carregarVersao(this.versao)}finally{$q.loading.hide()}else this.temId||(this.modalBoasVindas=!0);document.addEventListener("keydown",this.teclas),this.alterarConteudo=$lodash.debounce(()=>{this.alterouConteudo=!0,this.atualizarAutomaticamente&&($utils.gconsole.log("editor","created"),this.componenteVisualizador=$utils.clonar(this.componenteEditor))},500)},mounted(){globalThis.tela=this,this.divisor=new it(["#editor","#visualizador"],{minSize:[300,20]})},beforeUnmount(){document.removeEventListener("keydown",this.teclas),this.divisor&&this.divisor.destroy()},watch:{async id(o){o&&o!=="0"?this.carregarObjeto(o):(this.redefinirCampos(),this.redefinirComponente())},atualizarAutomaticamente(o){o||($utils.gconsole.log("editor","atualizarAutomaticamente"),this.componenteVisualizador=$utils.clonar(this.componenteEditor)),localStorage.setItem("editorAtualizar",o?1:0)}}},kt={id:"Editor"},yt={class:"q-px-sm"},St={class:"bg-grey-10 q-pb-md q-pt-sm q-px-md"},Ct={class:"layout-padding bg-white q-pa-xl"},zt={class:"q-mt-lg"},Ot={class:"layout-padding bg-white q-pa-xl"},Et={class:"q-mt-lg"};function wt(o,t,c,p,r,d){const z=j("barra-topo"),f=j("badge"),h=j("campo"),M=j("MonacoEditor"),P=j("g-col"),Y=j("visualizador"),Z=j("g-row"),Q=j("promptEditorRelatorio"),J=j("promptEditorRelatorioVersao");return g(),L("div",kt,[l(pe,null,{default:s(()=>[l(z),l(he,null,{default:s(()=>[l(ve,{onClick:d.abrirConfiguracoes,class:"flex items-center"},{default:s(()=>[d.idObjetoValido?(g(),k(f,{key:0,rotulo:r.campos.codigoObjeto,cor:"positive"},null,8,["rotulo"])):q("",!0),e("span",yt,A(r.campos.nomeObjeto||"Editor"),1),d.idObjetoValido?q("",!0):(g(),k(f,{key:1,rotulo:"Rascunho",cor:"negative"}))]),_:1},8,["onClick"]),r.modoDiff?(g(),k(C,{key:0,onClick:d.fecharDiff,icon:"close",color:"negative"},{default:s(()=>[l(T,{anchor:"bottom middle",self:"center middle"},{default:s(()=>t[13]||(t[13]=[u(" Fechar Diff ")])),_:1})]),_:1},8,["onClick"])):q("",!0),r.modoDiff?(g(),k(ae,{key:1,vertical:"",color:"grey-5",class:"q-ma-sm"})):q("",!0),r.atualizarAutomaticamente?q("",!0):(g(),k(C,{key:2,onClick:d.atualizarVisualizador,flat:"",round:"",icon:"refresh",color:"white"},{default:s(()=>[l(T,{anchor:"bottom middle",self:"center middle"},{default:s(()=>t[14]||(t[14]=[u(" Atualizar ")])),_:1})]),_:1},8,["onClick"])),d.idObjetoValido&&d.id?(g(),k(C,{key:3,to:d.rotaImprimir,flat:"",round:"",icon:"remove_red_eye",color:"white",target:"_blank"},{default:s(()=>[l(T,{anchor:"bottom middle",self:"center middle"},{default:s(()=>t[15]||(t[15]=[u(" Visualizar ")])),_:1})]),_:1},8,["to"])):q("",!0),l(ae,{vertical:"",color:"grey-5",class:"q-ma-sm"}),l(C,{onClick:d.incluir,icon:"add",color:"white",flat:"",round:""},{default:s(()=>[l(T,{anchor:"bottom middle",self:"center middle"},{default:s(()=>t[16]||(t[16]=[u(" Novo ")])),_:1})]),_:1},8,["onClick"]),l(C,{onClick:d.abrirPromptBuscar,icon:"search",color:"white",flat:"",round:""},{default:s(()=>[l(T,{anchor:"bottom middle",self:"center middle"},{default:s(()=>t[17]||(t[17]=[u(" Buscar ")])),_:1})]),_:1},8,["onClick"]),l(ae,{vertical:"",color:"grey-5",class:"q-ma-sm"}),l(C,{onClick:d.salvar,disabled:r.salvando,flat:"",round:"",icon:"save",color:"white"},{default:s(()=>[l(T,{anchor:"bottom middle",self:"center middle"},{default:s(()=>[u(A(r.salvando?"Salvando...":"Salvar"),1)]),_:1})]),_:1},8,["onClick","disabled"]),d.idObjetoValido?(g(),k(C,{key:4,onClick:t[0]||(t[0]=b=>r.modalPublicar=!0),flat:"",round:"",color:"white",icon:"publish"},{default:s(()=>[l(T,{anchor:"bottom middle",self:"center middle"},{default:s(()=>t[18]||(t[18]=[u(" Publicar ")])),_:1})]),_:1})):q("",!0),l(ae,{vertical:"",color:"grey-5",class:"q-ma-sm"}),d.idObjetoValido?(g(),k(C,{key:5,onClick:d.abrirPromptHistorico,icon:"history",color:"white",flat:"",round:""},{default:s(()=>[l(T,{anchor:"bottom middle",self:"center middle"},{default:s(()=>t[19]||(t[19]=[u(" Hist\xF3rico ")])),_:1})]),_:1},8,["onClick"])):q("",!0)]),_:1})]),_:1}),l(ke,null,{default:s(()=>[l(ye,null,{default:s(()=>[l(Z,{width:"100%",height:"100%",class:"Codigos",style:{position:"absolute"}},{default:s(()=>[l(P,{col:"xs12 sm6",bg:"bg-dark",color:"text-white",id:"editor"},{default:s(()=>[l(ie,{class:"q-pb-none"},{default:s(()=>[l(I,{modelValue:r.areaConfiguracoes,"onUpdate:modelValue":t[5]||(t[5]=b=>r.areaConfiguracoes=b),label:"Configura\xE7\xF5es",group:"editor",icon:"settings",class:"EditorItem"},{default:s(()=>[e("div",St,[l(h,{modelValue:r.campos.nomeObjeto,"onUpdate:modelValue":t[1]||(t[1]=b=>r.campos.nomeObjeto=b),dark:"",ref:"campoNomeObjeto",rotulo:"Identificador"},null,8,["modelValue"]),l(h,{modelValue:r.campos.descricao,"onUpdate:modelValue":t[2]||(t[2]=b=>r.campos.descricao=b),dark:"",rotulo:"Descri\xE7\xE3o"},null,8,["modelValue"]),l(h,{modelValue:r.componenteEditor.parametro,"onUpdate:modelValue":t[3]||(t[3]=b=>r.componenteEditor.parametro=b),ajuda:d.parametroBase64,dark:"",rotulo:"Par\xE2metro",tipo:"textoArea"},null,8,["modelValue","ajuda"]),l(Ye,{modelValue:r.atualizarAutomaticamente,"onUpdate:modelValue":t[4]||(t[4]=b=>r.atualizarAutomaticamente=b),class:"q-mt-lg",label:"Atualizar pr\xE9-visualiza\xE7\xE3o ao digitar?"},null,8,["modelValue"]),l(ie,{class:"q-mt-lg q-pa-none",dark:"",separator:""},{default:s(()=>[l(I,{group:"configuracoes",label:"Atalhos da ferramenta"},{default:s(()=>t[20]||(t[20]=[e("table",{class:"TabelaEscura text-caption q-mb-md q-mx-md"},[e("thead",null,[e("tr",null,[e("th",null,"Atalho"),e("th",null,"Windows"),e("th",null,"Linux"),e("th",null,"macOS")])]),e("tbody",null,[e("tr",null,[e("td",null,"Abrir documento"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"O")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"O")])]),e("tr",null,[e("td",null,"Salvar documento"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"S")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"S")])]),e("tr",null,[e("td",null,"Atualizar componente"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"ENTER")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"ENTER")])])])],-1)])),_:1}),l(I,{group:"configuracoes",label:"Atalhos do editor"},{default:s(()=>t[21]||(t[21]=[e("table",{class:"TabelaEscura text-caption q-mb-md q-mx-md"},[e("thead",null,[e("tr",null,[e("th",null,"Atalho"),e("th",null,"Windows"),e("th",null,"Linux"),e("th",null,"macOS")])]),e("tbody",null,[e("tr",null,[e("td",null,"Paleta de comandos"),e("td",{class:"text-center",colspan:"3"},[e("kbd",null,"F1")])]),e("tr",null,[e("td",null,"Colapsar tudo"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"K"),u(" | "),e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"0")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"K"),u(" | "),e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"0")])]),e("tr",null,[e("td",null,"Comentar"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"/")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"/")])]),e("tr",null,[e("td",null,"Expandir tudo"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"K"),u(" | "),e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"J")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"K"),u(" | "),e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"J")])]),e("tr",null,[e("td",null,"Formatar sele\xE7\xE3o"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"K"),u(" | "),e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"F")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"K"),u(" | "),e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"F")])]),e("tr",null,[e("td",null,"Formatar tudo"),e("td",{class:"text-center"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"SHIFT"),u(" + "),e("kbd",null,"F")]),e("td",{class:"text-center"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"SHIFT"),u(" + "),e("kbd",null,"F")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"SHIFT"),u(" + "),e("kbd",null,"F")])]),e("tr",null,[e("td",null,"Localizar"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"F")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"F")])]),e("tr",null,[e("td",null,"M\xFAltiplos cursores"),e("td",{class:"text-center"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"ALT"),u(" + "),e("kbd",null,"SHIFT"),u(" + "),e("kbd",null,"\u2191\u2193")]),e("td",{class:"text-center"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"SHIFT"),u(" + "),e("kbd",null,"\u2191\u2193")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"SHIFT"),u(" + "),e("kbd",null,"\u2191\u2193")])]),e("tr",null,[e("td",null,"Selecionar tudo"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"A")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"A")])]),e("tr",null,[e("td",null,"Substituir"),e("td",{class:"text-center",colspan:"2"},[e("kbd",null,"CTRL"),u(" + "),e("kbd",null,"H")]),e("td",{class:"text-center"},[e("kbd",null,"\u2318"),u(" + "),e("kbd",null,"H")])])])],-1)])),_:1})]),_:1})])]),_:1},8,["modelValue"]),l(I,{label:"Template (HTML)",group:"editor",icon:"dashboard",class:"EditorItem"},{default:s(()=>[(g(),k(M,{modelValue:r.componenteEditor.template,"onUpdate:modelValue":t[6]||(t[6]=b=>r.componenteEditor.template=b),onChange:r.alterarConteudo,onEditorDidMount:d.aoIniciarEditor,key:r.chaveDiff,diffEditor:r.modoDiff,original:r.componenteDiff.template,options:d.editorOptions,language:"html",theme:"vs-dark",class:"MonacoEditor"},null,8,["modelValue","onChange","onEditorDidMount","diffEditor","original","options"]))]),_:1}),l(I,{label:"JavaScript (Vue)","default-opened":"",group:"editor",icon:"code",class:"EditorItem"},{default:s(()=>[(g(),k(M,{modelValue:r.componenteEditor.script,"onUpdate:modelValue":t[7]||(t[7]=b=>r.componenteEditor.script=b),onEditorDidMount:d.aoIniciarEditor,onChange:r.alterarConteudo,key:r.chaveDiff+1,diffEditor:r.modoDiff,original:r.componenteDiff.script,options:d.editorOptions,language:"javascript",theme:"vs-dark",class:"MonacoEditor"},null,8,["modelValue","onEditorDidMount","onChange","diffEditor","original","options"]))]),_:1}),l(I,{label:"Estilos (CSS)",group:"editor",icon:"format_paint",class:"EditorItem"},{default:s(()=>[(g(),k(M,{modelValue:r.componenteEditor.estilo,"onUpdate:modelValue":t[8]||(t[8]=b=>r.componenteEditor.estilo=b),onEditorDidMount:d.aoIniciarEditor,onChange:r.alterarConteudo,key:r.chaveDiff+2,diffEditor:r.modoDiff,original:r.componenteDiff.estilo,options:d.editorOptions,language:"css",theme:"vs-dark",class:"MonacoEditor"},null,8,["modelValue","onEditorDidMount","onChange","diffEditor","original","options"]))]),_:1}),l(I,{class:"EditorItem",group:"editor",icon:"speaker_notes",label:"Documenta\xE7\xE3o (Markdown)"},{default:s(()=>[l(M,{modelValue:r.campos.documentacao,"onUpdate:modelValue":t[9]||(t[9]=b=>r.campos.documentacao=b),onEditorDidMount:d.aoIniciarEditor,onChange:r.alterarConteudo,options:d.editorOptions,theme:"vs-dark",language:"markdown",class:"MonacoEditor"},null,8,["modelValue","onEditorDidMount","onChange","options"])]),_:1})]),_:1})]),_:1}),l(P,{col:"xs12 sm6",bg:"bg-white",id:"visualizador"},{default:s(()=>[l(Y,{componente:r.componenteVisualizador},null,8,["componente"])]),_:1})]),_:1})]),_:1})]),_:1}),l(se,{modelValue:r.modalBoasVindas,"onUpdate:modelValue":t[10]||(t[10]=b=>r.modalBoasVindas=b),"no-backdrop-dismiss":"","no-esc-dismiss":""},{default:s(()=>[e("div",Ct,[t[22]||(t[22]=e("h4",{class:"q-mb-sm q-mt-none"},"Bem-vindo ao Editor.",-1)),t[23]||(t[23]=e("p",null,"Atrav\xE9s desta interface \xE9 poss\xEDvel criar ou editar objetos do sistema.",-1)),e("div",zt,[l(C,{color:"primary",label:"Novo",icon:"add",onClick:d.incluir},null,8,["onClick"]),l(C,{color:"primary",class:"q-ml-sm",label:"Abrir",icon:"search",onClick:d.abrirPromptBuscar},null,8,["onClick"])])])]),_:1},8,["modelValue"]),l(se,{modelValue:r.modalPublicar,"onUpdate:modelValue":t[12]||(t[12]=b=>r.modalPublicar=b),"no-backdrop-dismiss":"","no-esc-dismiss":""},{default:s(()=>[e("div",Ot,[t[24]||(t[24]=e("h4",{class:"q-mb-sm q-mt-none"},"Publicar",-1)),t[25]||(t[25]=e("p",null,"Deixe uma mensagem para recordar o que h\xE1 de novo nesta vers\xE3o.",-1)),l(h,{modelValue:r.campoObservacao,"onUpdate:modelValue":t[11]||(t[11]=b=>r.campoObservacao=b),rotulo:"Mensagem",placeholder:"Escreva a sua mensagem...",tipo:"textoArea"},null,8,["modelValue"]),e("div",Et,[be(l(C,{label:"Cancelar",color:"tertiary",flat:""},null,512),[[ge]]),l(C,{color:"primary",unelevated:"",class:"q-ml-sm",label:"Publicar",icon:"publish",onClick:d.publicar},null,8,["onClick"])])]),l(Ze,{visible:r.modalPublicar&&r.publicando},{default:s(()=>[l($e,{size:"50px",color:"primary"})]),_:1},8,["visible"])]),_:1},8,["modelValue"]),l(Q),l(J,{idObjeto:d.id},null,8,["idObjeto"])])}var jt=fe(vt,[["render",wt]]);export{jt as default};
