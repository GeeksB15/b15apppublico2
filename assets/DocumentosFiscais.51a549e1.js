import{_ as R,cA as H,cR as J,r as D,au as oe,o as f,d as v,w as r,f as i,A as K,C as Y,at as ie,h as Z,H as A,Q as y,N as z,i as ee,k as d,O as ae,p as I,F as S,aM as re,v as ne,e as $,D as te,a1 as se,ax as P,x as k,bD as le,by as C,bt as j,bs as O,bc as w,bE as me,aw as ce,bA as F,bz as _,ay as Q,bB as ue,bk as de,bx as x,cS as L,bJ as pe,S as E,q as U,T as u,U as h,t as b,m as M,bf as X,P as T,j as q}from"./index.92f60ec7.js";import{C as fe}from"./Campo.b1ceaf9e.js";import{c as W,a as V}from"./compactarValidarNFe.d7a1459b.js";import{a as Ce,g as he,b as ge,o as be,d as ve,e as Ne,c as we,f as Fe,h as Ee,i as Pe,t as ye}from"./obterItens.74b1449e.js";const _e={components:{Campo:fe},data(){return{cpfCnpjErro:!1,cpfCnpjInvalido:"",tipoCaixa:""}},emits:["confirmar","update:modelValue"],methods:{eventoConfirmar(){if(!this.dados.incluirCpfCnpjNoCupom)this.dados.cpfCnpj="",this.dados.nomeCliente="";else if(!!this.dados.cpfCnpj&&!H(this.dados.cpfCnpj)){this.cpfCnpjErro=!0,this.cpfCnpjInvalido="CPF / CNPJ Inv\xE1lido!";return}this.eventoInput(!1),this.$emit("confirmar",this.dados)},eventoInput(e){this.$emit("update:modelValue",e)},validaCpfCnpj(){if(!!this.dados.cpfCnpj&&!H(this.dados.cpfCnpj)){this.cpfCnpjErro=!0,this.cpfCnpjInvalido="CPF / CNPJ Inv\xE1lido!";return}}},watch:{async modelValue(){let e;!this.modelValue||(e=this.dados.tipoCaixa,e==="SAT"&&(e=await J.hwDest(this.dados.idEmpresa)),this.tipoCaixa=e,this.cpfCnpjErro=!1,this.cpfCnpjInvalido="")}},props:{modelValue:{required:!0,type:Boolean},dados:{required:!0,type:Object}}};function xe(e,t,o,s,a,n){const m=D("campo"),c=D("g-col"),p=D("g-row"),N=oe("mask");return f(),v(te,{"model-value":o.modelValue,"onUpdate:modelValue":n.eventoInput},{default:r(()=>[i(K,{class:"bg-white",style:{width:"450px"}},{default:r(()=>[Y("form",{onSubmit:t[4]||(t[4]=ie((...l)=>n.eventoConfirmar&&n.eventoConfirmar(...l),["prevent"]))},[i(Z,{class:"bg-primary text-white q-pa-sm"},{default:r(()=>[A(i(y,{icon:"arrow_back",round:"",flat:"",dense:""},null,512),[[z]]),i(ee,null,{default:r(()=>t[5]||(t[5]=[d("CPF/CNPJ no Cupom")])),_:1}),i(y,{type:"submit",label:`Emitir ${a.tipoCaixa}`,color:"white","text-color":"primary",unelevated:""},null,8,["label"])]),_:1}),i(ae,{class:"no-padding"},{default:r(()=>[i(p,{gutter:"md",mg:"xl-y"},{default:r(()=>[i(c,{col:"12"},{default:r(()=>[i(m,{modelValue:o.dados.incluirCpfCnpjNoCupom,"onUpdate:modelValue":t[0]||(t[0]=l=>o.dados.incluirCpfCnpjNoCupom=l),tipo:"logico",rotulo:"Incluir CPF/CNPJ no cupom"},null,8,["modelValue"])]),_:1}),o.dados.incluirCpfCnpjNoCupom?(f(),I(S,{key:0},[i(c,{col:"12"},{default:r(()=>[i(re,{error:a.cpfCnpjErro,"error-label":"CPF/CNPJ inv\xE1lido"},{default:r(()=>[A(i(ne,{modelValue:o.dados.cpfCnpj,"onUpdate:modelValue":[t[1]||(t[1]=l=>o.dados.cpfCnpj=l),t[2]||(t[2]=l=>a.cpfCnpjErro=!1)],label:"CPF / CNPJ",class:"hide-bottom-space",onChange:n.validaCpfCnpj},null,8,["modelValue","onChange"]),[[N,["###.###.###-##","##.###.###/####-##"]]])]),_:1},8,["error"])]),_:1}),i(c,{col:"12"},{default:r(()=>[i(m,{modelValue:o.dados.nomeCliente,"onUpdate:modelValue":t[3]||(t[3]=l=>o.dados.nomeCliente=l),rotulo:"Nome"},null,8,["modelValue"])]),_:1})],64)):$("",!0)]),_:1})]),_:1})],32)]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"])}var $e=R(_e,[["render",xe]]);const Ie={components:{SeletorCest:se},computed:{campos(){return this.modal.campos}},data(){return{itens:[]}},emits:["confirmar"],methods:{async atualizar(){try{this.$lodash.get(this.campos,"ids.length")?(this.itens=await P().item.where("id").anyOf(this.campos.ids).toArray(),this.itensOriginal=this.$utils.clonarV2(this.itens)):this.itens=[]}catch(e){this.$q.notifyError("Erro ao carregar os dados",e)}},async confirmar(){this.$utils.gconsole.log("ItemTrocarCest","confirmar",this.itens);for(const e in this.itens)!!this.itens[e].cest&&this.itens[e].cest!==this.itensOriginal[e].cest&&$db.item.gravaItem({atual:this.itens[e],original:this.itensOriginal[e]});this.modal.visivel=!1,this.$emit("confirmar")}},props:{modal:{required:!0,type:Object}},watch:{"modal.visivel"(e){e&&this.atualizar()}},mounted(){this.atualizar()}},De={class:"bg-white q-mx-md q-pa-md"};function Se(e,t,o,s,a,n){const m=D("campo"),c=D("SeletorCest");return f(),v(te,{modelValue:o.modal.visivel,"onUpdate:modelValue":t[1]||(t[1]=p=>o.modal.visivel=p),maximized:""},{default:r(()=>[i(K,null,{default:r(()=>[i(Z,{class:"bg-primary text-white"},{default:r(()=>[A(i(y,{flat:"",round:"",dense:"",icon:"arrow_back"},null,512),[[z]]),i(ee,{class:"q-mx-sm"},{default:r(()=>t[2]||(t[2]=[d("Selecionar CEST para os itens")])),_:1}),i(y,{class:"q-ml-sm no-shadow",color:"white","text-color":"primary",label:"Salvar",onClick:t[0]||(t[0]=p=>e.tryLoading(n.confirmar,{erro:"Ocorreu erro ao salvar CEST"}))})]),_:1}),i(ae,{class:"text-body1 q-mx-lg q-my-sm"},{default:r(()=>[Y("div",De,[(f(!0),I(S,null,k(a.itens,p=>(f(),I("div",{key:p.id,class:"q-col-gutter-x-sm items-baseline row"},[i(m,{"model-value":p.descricao,rotulo:"Descri\xE7\xE3o",class:"col-12 col-md-6","apenas-leitura":""},null,8,["model-value"]),i(m,{"model-value":p.ncm,rotulo:"NCM",class:"col-12 col-md-3","apenas-leitura":""},null,8,["model-value"]),i(c,{modelValue:p.cest,"onUpdate:modelValue":N=>p.cest=N,class:"col-12 col-md-3",ncm:p.ncm},null,8,["modelValue","onUpdate:modelValue","ncm"])]))),128))])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var qe=R(Ie,[["render",Se]]),G={tipo:"NFCe",serie:"nfce.padrao.serie",homologacao:"nfce.homologacao",usadesconto:"nfce.usadesconto",gerarAutorizacaoDownload:Ce,gerarConfiguracaoImposto:he,gerarNumeroNFe:ge,obterConfiguracaoImpostoV2:be,obterObservacoesFigurasFiscais:ve,obterValoresAproximadosTributos:Ne,obterFatura:we,obterFormasPagamento:Fe,obterFrete:Ee,obterItens:Pe,async gerarJson(e,t,o){const s=le("gerarJsonNFCe",e,t,o);try{C(!e,"Fatura n\xE3o fornecida");const a=j.iniciarCampos({idDocumento:e,cpfCnpjCliente:t,nomeCliente:o,totalDesconto:0,totalDevolucao:0,totalProdutos:0,totalServicos:0,alertas:[],erros:[],cache:{},outrosNFe:{},infNFe:W.executa(O.infNFe,{},"NFCe")},"gerarNFCeFatura");w.log("gerarJsonNFCeD","iniciarCampos",a),await this.acertoInicial(a),await this.obterFatura(a),await this.obterEmitente(a),await this.obterDestinatario(a,t,o);const n=[];if(await this.obterItens(a,n),n.length)throw $utils.emitter.emit("confrontarFigurasFiscais",n),new Error("Figura fiscal n\xE3o encontrada");return await this.obterFormasPagamento(a),await this.obterFrete(a),await this.gerarNumeroNFe(a.infNFe,a.outrosNFe.idContatoEmitente),await this.gerarAutorizacaoDownload(a.infNFe,a.outrosNFe.idContatoEmitente),ye.calculaTotais(a.infNFe,a.outrosNFe,O),this.obterObservacoesNFe(a),this.obterValoresAproximadosTributos(a),this.obterObservacoesFigurasFiscais(a),await j.acertarDadosNFe(a.infNFe,a.outrosNFe,"NFCe"),a.infNFe=V.executa(O.infNFe,a.infNFe),a.erros=V.erros,w.log("gerarJsonNFCeD","infNFe",a.infNFe),w.log("gerarJsonNFCeD","compactarValidarNFe.erros",V.erros),a}finally{me(s,1)}},async acertoInicial(e){var a;w.log("gerarJsonNFeD","acertoInicial"),e.infNFe.ide.tpNF="1",e.infNFe.ide.finNFe="1",e.infNFe.ide.tpAmb=await ce.configuracoes.leValorNumerico(this.homologacao)===1?"2":"1",e.infNFe.ide.mod="65",e.infNFe.ide.tpImp="4",e.infNFe.ide.dhEmi=j.formatarDataNFe(new Date),C(!e.idDocumento,"Ops! N\xE3o foi encontrado o c\xF3digo do documento (venda/fatura).");const t=await $db.hibrido.le({table:"documento",id:e.idDocumento});let o=[];t.tipo==="Venda"&&o.push(t),t.tipo==="Fatura"&&(o=await $db.hibrido.lista({table:"documento",where:{idFatura:e.idDocumento}}));let s;for(const n of o){const m=Number(n==null?void 0:n.codigoDocumentoOperacao);if(Number.isInteger(m)&&m>0){const c=await $db.hibrido.lista({table:"documentoOperacao",where:{codigoDocumentoOperacao:m}});s||(s=c[0]),C((s==null?void 0:s.finalidade)!==((a=c[0])==null?void 0:a.finalidade),"Vendas possuem opera\xE7\xF5es com finalidades diferentes.")}}e.idCfopVenda=s==null?void 0:s.idCfop,C(!e.idCfopVenda,"Erro na configura\xE7\xE3o do sistema. Sem defini\xE7\xE3o do CFOP de venda.")},async gerarJsonCancelamento(e){const t={infEvento:{cOrgao:e.infNFe.ide.cUF,tpAmb:e.infNFe.ide.tpAmb,escolhas:{valor_escolha:e.infNFe.emit.escolhas.valor_escolha,CNPJ:e.infNFe.emit.escolhas.CNPJ,CPF:e.infNFe.emit.escolhas.CPF},chNFe:e.outrosNFe.chNFe,dhEvento:j.formatarDataNFe(new Date),nSeqEvento:"1",detEvento:{nProt:e.outrosNFe.nProt_emissao,xJust:"Nota cancelada devido divergencia de informacoes"}}};return t.infEvento=W.executa(O.infEvento,t.infEvento,"NFCe"),t.infEvento=V.executa(O.infEvento,t.infEvento),e.erros=V.erros,w.log("gerarJsonNFCeD","infNFe",e.infNFe),w.log("gerarJsonNFCeD","compactarValidarNFe.erros",V.erros),t.infEvento},obterObservacoesNFe(e){if(e.outrosNFe.dadosAdicionaisEmitente="",e.empresa.observacaoNFE){let t=F(e.empresa.observacaoNFE);t=`[${t}]`,e.outrosNFe.dadosAdicionaisEmitente+=t}},async obterConfiguracaoImposto(e){w.log("gerarJsonNFCeD","obterConfiguracaoImposto");const t=`Produto '${e.documentoItem.descricaoItem||""}'`;C(!e.item.ncm,`${t} sem cadastro de NCM`);const o=await P()._ncm.where("ncm").equals(e.item.ncm).first();C(!o,`${t} com NCM '${e.item.ncm||""}' inv\xE1lido`),e.documentoItem.idCfop||(e.documentoItem.idCfop=e.idCfopVenda);const s=await P().cfop.get(e.documentoItem.idCfop);C(!s,`${t} com CFOP inv\xE1lido`),w.log("gerarJsonNFCeD",`dadosNcm.id: ${o.id} dadosCfop.id: ${s.id} dados.empresa.id: ${e.empresa.id}`);const a=await P().impostoConfiguracao.where("idNcm").equals(o.id).filter(p=>p.idCfop===s.id&&p.idEmitente===e.empresa.id&&p.ufOrigem===e.empresa.enderecoPrincipal.uf&&p.ufDestino===e.empresa.enderecoPrincipal.uf).first();w.log("gerarJsonNFCeD","impostoConfiguracao",a);const n=`Verifique a configura\xE7\xE3o do imposto para NCM: ${e.item.ncm||""}, CFOP: ${s.cfop||""}, CNPJ: ${e.empresa.numeroDocumentoNacional||""}, UF origem: ${e.empresa.enderecoPrincipal.uf||""}, UF destino: ${e.empresa.enderecoPrincipal.uf||""}.`;C(!a,`${t} sem configura\xE7\xE3o de imposto. ${n}`);const m=e.det.prod,c=e.det.imposto;try{if(m.CFOP=(s.cfop||0).toString(),c.noXml_orig=await this.obterImpostoParametro(e,a.idOrigem),c.noXml_CST=c.noXml_CSOSN=await this.obterImpostoParametro(e,a.idCst),c.noXml_pICMS=a.aliqIcmsUFOrigem||a.aliqIcms||0,c.noXml_pRedBC=a.percRedBcIcms||0,c.noXml_pFCP=a.aliqFcp||0,c.noXml_CSTPis=await this.obterImpostoParametro(e,a.idTipoTribPis),c.noXml_pPIS=a.aliqPis||0,c.noXml_CSTCofins=await this.obterImpostoParametro(e,a.idTipoTribCofins),c.noXml_pCOFINS=a.aliqCofins||0,a.idCest){const p=await this.obterImpostoParametro(e,a.idCest);p&&(m.opcional.visivel=!0,m.opcional.CEST=_(p))}}catch(p){console.error(p),C(!0,`${t} com erro na configura\xE7\xE3o de imposto. ${n}`)}},async obterDestinatario(e,t,o){var m;if(e.destinatario={},!t){e.infNFe.dest.visivel=!1;return}const s=e.documentoFatura.idContato;s&&(e.destinatario=await P().contato.get(s),e.destinatario&&(e.destinatario.enderecos=await P().contatoEndereco.where("idContato").equals(s).toArray(),e.destinatario.enderecoPrincipal=e.destinatario.enderecos.find(c=>c.grupo==="Principal"),e.destinatario.enderecoPrincipal||(e.destinatario.enderecoPrincipal=e.destinatario.enderecos[0]||{}),e.destinatario.telefones=await P().contatoTelefone.where("idContato").equals(s).toArray(),e.destinatario.telefonePrincipal=e.destinatario.telefones.find(c=>c.grupo==="Principal"),e.destinatario.telefonePrincipal||(e.destinatario.telefonePrincipal=e.destinatario.telefones[0]||{}),w.log("gerarJsonNFCeD","dados.destinatario",e.destinatario)));const a=e.infNFe.dest;a.visivel=!0;const n=_(t);n.length===11?(a.escolhas.valor_escolha="CPF",a.escolhas.CPF=n,a.indIEDest="9"):n.length===14?(a.escolhas.valor_escolha="CNPJ",a.escolhas.CNPJ=n,a.indIEDest="9"):C(!0,"Destinatario com CPF/CNPJ inv\xE1lido"),n===_(e.destinatario.numeroDocumentoNacional)&&(a.escolhas.valor_escolha==="CNPJ"&&!!e.destinatario.numeroDocumentoEstadual&&(a.IE=_(e.destinatario.numeroDocumentoEstadual)),a.xNome=F(o||e.destinatario.nome),!(!e.destinatario.enderecoPrincipal.uf||!e.destinatario.enderecoPrincipal.ibgeCod)&&(a.enderDest.visivel=!0,a.email=(e.destinatario.emailNfe||e.destinatario.email||"").trim(),a.enderDest.fone=_(e.destinatario.telefonePrincipal.telefone||""),a.enderDest.xLgr=F(e.destinatario.enderecoPrincipal.logradouro),a.enderDest.nro=(e.destinatario.enderecoPrincipal.numero||"SN").trim(),a.enderDest.xCpl=F(e.destinatario.enderecoPrincipal.complemento),a.enderDest.xBairro=F(e.destinatario.enderecoPrincipal.bairro),a.enderDest.cMun=String(e.destinatario.enderecoPrincipal.ibgeCod||"").trim(),a.enderDest.xMun=F(e.destinatario.enderecoPrincipal.municipio),a.enderDest.UF=(e.destinatario.enderecoPrincipal.uf||"").trim(),a.enderDest.CEP=_(e.destinatario.enderecoPrincipal.cep||""),a.enderDest.cPais=String((m=e.destinatario.enderecoPrincipal.codigoPais)!=null?m:"")||"1058",a.enderDest.xPais=(e.destinatario.enderecoPrincipal.pais||"").trim()||"Brasil"))},async obterEmitente(e){var s;w.log("gerarJsonNFCeD","obterEmitente");const t=e.documentoFatura.idEmpresa;if(C(!t,"Fatura sem empresa emitente"),e.empresa=await P().contato.get(t),C(!e.empresa,"N\xE3o foi poss\xEDvel carregar a empresa emitente"),e.outrosNFe.idContatoEmitente=t,e.empresaPlat=await Q.empresa.where({idContato:t}).first(),!e.empresaPlat){const a=JSON.parse(localStorage.getItem("clienteSistema"));e.empresaPlat=await Q.empresa.where({codigoContato:e.empresa.codigoContato}).filter(n=>n.codigoClienteSistema===a.codigoClienteSistema).first()}C(!e.empresaPlat,"N\xE3o foi poss\xEDvel carregar a empresa emitente"),e.infNFe.ide.tpAmb==="1"?(C(!e.empresaPlat.hashCSCProducao,"Empresa emitente sem hashCSC de produ\xE7\xE3o cadastrado"),C(!e.empresaPlat.tokenCSCProducao,"Empresa emitente sem tokenCSC de produ\xE7\xE3o cadastrado"),e.empresaPlat.hashCSC=e.empresaPlat.hashCSCProducao,e.empresaPlat.tokenCSC=e.empresaPlat.tokenCSCProducao):(C(!e.empresaPlat.hashCSCHomologacao,"Empresa emitente sem hashCSC de homologa\xE7\xE3o cadastrado"),C(!e.empresaPlat.tokenCSCHomologacao,"Empresa emitente sem tokenCSC de homologa\xE7\xE3o cadastrado"),e.empresaPlat.hashCSC=e.empresaPlat.hashCSCHomologacao,e.empresaPlat.tokenCSC=e.empresaPlat.tokenCSCHomologacao),e.empresa.enderecos=await P().contatoEndereco.where("idContato").equals(t).toArray(),C(!e.empresa.enderecos||e.empresa.enderecos.length===0,"N\xE3o foi poss\xEDvel carregar o endere\xE7o da empresa emitente"),e.empresa.enderecoPrincipal=e.empresa.enderecos.find(a=>a.grupo==="Principal"),e.empresa.enderecoPrincipal||(e.empresa.enderecoPrincipal=e.empresa.enderecos[0]||{}),e.empresa.telefones=await P().contatoTelefone.where("idContato").equals(t).toArray()||[],e.empresa.telefonePrincipal=e.empresa.telefones.find(a=>a.grupo==="Principal"),e.empresa.telefonePrincipal||(e.empresa.telefonePrincipal=e.empresa.telefones[0]||{}),w.log("gerarJsonNFCeD","dados.empresa",e.empresa),C(!e.empresa.numeroDocumentoNacional,"Empresa emitente sem CNPJ cadastrado"),C(!e.empresa.numeroDocumentoEstadual,"Empresa emitente sem Inscri\xE7\xE3o Estadual cadastrado"),C(!e.empresa.nome,"Empresa emitente sem Raz\xE3o Social (nome) cadastrado"),C(!e.empresa.enderecoPrincipal.uf,"Empresa emitente sem UF cadastrado"),C(!e.empresa.enderecoPrincipal.ibgeCod,"Empresa emitente sem c\xF3digo do munic\xEDpio cadastrado"),C(!e.empresa.regime,"Empresa emitente sem regime cadastrado");const o=e.infNFe.emit;o.escolhas.CNPJ=_(e.empresa.numeroDocumentoNacional),o.IE=_(e.empresa.numeroDocumentoEstadual),o.CRT=e.empresa.regime==="SimplesNacional"?"1":e.empresa.regime==="MEI"?"4":"3",o.xNome=F(e.empresa.nome),o.xFant=F(e.empresa.apelido),o.email=(e.empresa.email||"").trim(),o.enderEmit.fone=_(e.empresa.telefonePrincipal.telefone),o.enderEmit.xLgr=F(e.empresa.enderecoPrincipal.logradouro),o.enderEmit.nro=(e.empresa.enderecoPrincipal.numero||"SN").trim(),o.enderEmit.xCpl=F(e.empresa.enderecoPrincipal.complemento),o.enderEmit.xBairro=F(e.empresa.enderecoPrincipal.bairro),o.enderEmit.cMun=String(e.empresa.enderecoPrincipal.ibgeCod||"").trim(),o.enderEmit.xMun=F(e.empresa.enderecoPrincipal.municipio),o.enderEmit.UF=(e.empresa.enderecoPrincipal.uf||"").trim(),o.enderEmit.CEP=_(e.empresa.enderecoPrincipal.cep),o.enderEmit.cPais=String((s=e.empresa.enderecoPrincipal.codigoPais)!=null?s:"")||"1058",o.enderEmit.xPais=F(e.empresa.enderecoPrincipal.pais||"Brasil"),e.infNFe.ide.cMunFG=o.enderEmit.cMun,e.infNFe.ide.cUF=String(ue[o.enderEmit.UF])},async obterImpostoParametro(e,t){C(!t,"Configura\xE7\xE3o de imposto sem informa\xE7\xE3o completa");let o=e.cache[t];if(!o){const s=await P().impostoParametro.get(t);o=s?s.numero.trim():void 0,e.cache[t]=o}return C(!o,"Configura\xE7\xE3o de imposto inv\xE1lida"),o},async obterMeioPagamento(e,t){w.log("gerarJsonNFCeD","obterMeioPagamento",t),C(!t,"Forma de pagamento inv\xE1lida");let o=e.cache[t];if(o)return o;const s=await P().formaPagamento.get(t);C(!s||!s.descricao,"N\xE3o foi poss\xEDvel carregar a forma de pagamento");const a=s.descricao.toLowerCase();return o=a.includes("dinheiro")?"01":a.includes("d\xE9bito")?"04":a.includes("cr\xE9dito de clientes")?"01":a.includes("cr\xE9dito")?"03":a.includes("pix")?"17":a.includes("cart\xE3o")&&Number(s.parcelamentoMaximo||0)===1?"04":a.includes("cart\xE3o")&&Number(s.parcelamentoMaximo||0)>1?"03":"99",e.cache[t]=o,console.log("codigoMeioPagamento: ",o),o},async obterAliquotasTributosIbpt(e,t){w.log("gerarJsonNFCeD","obterValorAproxTributos",t);const o=await P().nfeIbpt.where("codigo").equals(Number(t.prod.NCM)).toArray();if(this.verificarAlerta(!o||o.length===0,`N\xE3o encontrado al\xEDquotas para calculo do valor aproximado de tributos do NCM: ${t.prod.NCM}. Atualize sua tabela IBPT.`,e))return;const s=o.filter(m=>m.idContato===e.empresa.id),n=(s.length?s:o).reduce((m,c)=>!m||m.vigenciaFim<c.vigenciaFim?c:m,null);this.verificarAlerta(n.vigenciaFim<de(),`Informa\xE7\xF5es vencidas para para o calculo do valor aproximado de tributos do NCM: ${t.prod.NCM}. Atualize sua tabela IBPT.`,e),t.imposto.noXml_pTribImp=Number(n.importadosFederal||0),t.imposto.noXml_pTribFed=Number(n.nacionalFederal||0),t.imposto.noXml_pTribEst=Number(n.estadual||0),t.imposto.noXml_pTribMun=Number(n.municipal||0)},verificarAlerta(e,t,o){return e&&(o.alertas||(o.alertas=[]),o.alertas.push(t),console.warn(t)),e}};const ke={components:{CpfCnpjNoCupom:$e,ItemTrocarCest:qe},computed:{config(){return $db.configuracoes.valores}},data(){return{width:0,configImpressaoNFe:[],configImpressosWhatsapp:[],configImpressosEmail:[],documentosSat:[],documentosFiscais:[],documentosNFe:[],hwDest:"",modalItemTrocarCest:{visivel:!1,campos:{}},cpfCnpjNoCupom:{visivel:!1,incluirCpfCnpjNoCupom:!1,idEmpresa:"",cpfCnpj:"",nomeCliente:""},quantidadeDocumentos:0}},props:{idFatura:{required:!1,type:String},idVenda:{required:!1,type:String}},methods:{abrirNFe(e){$utils.emitter.emit("abrirNFe",e)},async atualiza(e){const t=this.idFatura||this.idVenda;if(e&&e!==t)return;if(t){const s=await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{idDocumento:t}});this.documentosFiscais=s.sort((a,n)=>Number(n.nNF)-Number(a.nNF)),this.documentosSat=await $db.documentoSat.lista(t)}const o=await $db.hibrido.le({table:"documento",id:t});await this.configuraImpressao(o==null?void 0:o.idEmpresa),await this.configuraImpressosWhatsapp(o==null?void 0:o.idEmpresa),await this.configuraImpressosEmail(o==null?void 0:o.idEmpresa),this.hwDest=await J.hwDest(o==null?void 0:o.idEmpresa)},async cancelarSat(e){try{await new Promise((o,s)=>{$q.dialog({title:"Tem certeza?",message:"Ao continuar voc\xEA ir\xE1 cancelar este cupom",cancel:{label:"CANCELAR",push:!0,color:"tertiary",flat:!0},ok:{label:"CONFIRMAR",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(()=>{o()}).onCancel(()=>{s()})})}catch{return}let t="Erro no cupom";try{$q.loading.show({message:"Cancelando o cupom...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"amber"});const o=this.documentosSat.find(m=>m.id===e),s={NumeroPDV:1,ChaveAcessoCFe:o.chaveCupom,CPF_CNPJ:"",Total:o.valorTotal};t="Ocorreu um erro ao cancelar o cupom";const a=await $db.hibrido.le({table:"documento",id:o.idDocumento}),n=await x.cancelarSat(JSON.stringify(s),a);$utils.verificarErro(n.status==="Erro",n.mensagem),$q.notifyPositive(n.mensagem),t="Ocorreu um erro ao gravar os dados do cancelamento do cupom",await J.salvarRetornoCancelamento(this.idFatura,n.chaveCFe,n.xml),(n==null?void 0:n.versaoIntegrador)==="V2"&&await x.imprimirCancelamentoSat(n.xml,o.idEmpresa)}catch(o){$q.notifyError(t,o)}finally{$q.loading.hide(),this.atualiza()}},async cancelarNFCe(e){try{await new Promise((o,s)=>{$q.dialog({title:"Tem certeza?",message:"Ao continuar voc\xEA ir\xE1 cancelar este cupom",cancel:{label:"CANCELAR",push:!0,color:"tertiary",flat:!0},ok:{label:"CONFIRMAR",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(()=>{o()}).onCancel(()=>{s()})})}catch{return}let t="Erro no NFCe";try{$q.loading.show({message:"Selecionando Certificado e Cancelando NFCe",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"amber"});const o=JSON.parse(this.documentosFiscais.find(a=>a.id===e).json);if(o.infEvento=await G.gerarJsonCancelamento(o),$utils.verificarErro(!o.infEvento,t),o.erros.length){$g.modalAlerta.show({titulo:"Erro de valida\xE7\xE3o",erros:o.erros});return}t="Ocorreu um erro ao cancelar o NFCe";const s=await x.cancelarNFCe(o);if(s.status==="Erro"){const a=[...(s.mensagem||"").split(`
`),...(s.complemento||"").split(`
`)];$g.modalAlerta.show({titulo:s.status,erros:a});return}$q.notifyPositive(s.mensagem)}catch(o){$q.notifyError(t,o)}finally{$q.loading.hide(),this.atualiza()}},async configuraImpressao(e){const t=await $db.configuracoes.porNome("impressao.nfe",e);this.configImpressaoNFe=t.length?t.map(o=>({texto:"Imprimir DANFE",...o})):[{valor:"nfe-danfe",texto:"DANFE"},{valor:"nfe-danfe-simplificado",texto:"DANFE Simplificado"},{valor:"duplicata-mercantil",texto:"Duplicata Mercantil"}]},async configuraImpressosWhatsapp(e){let t=await $db.configuracoes.le({prefixoNome:"nfce.whatsapp.enviar."});this.configImpressosWhatsapp=t.filter(o=>o.idEmpresa===e||!o.idEmpresa)},async configuraImpressosEmail(e){let t=await $db.configuracoes.le({prefixoNome:"nfce.email.enviar."});this.configImpressosEmail=t.filter(o=>o.idEmpresa===e||!o.idEmpresa)},async enviarImpresso(e,t,o){try{const s=await $db.hibrido.le({table:"documento",id:o.idDocumento}),a=await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:o.id,status:"Sucesso",situacao:"Emitido"}}),n=new L.XMLParser({parseTagValue:!1,ignoreAttributes:!1}),m={idEmpresa:s==null?void 0:s.idEmpresa,idContato:s==null?void 0:s.idContato,...n.parse(a[0].xmlProt)};e==="whatsapp"&&await $utils.enviarWhatsapp({configuracao:$utils.clonar(t),documento:m,loading:!0,dialog:!0}),e==="email"&&await $utils.enviarEmail({configuracao:$utils.clonar(t),documento:m,loading:!0,dialog:!0})}catch(s){console.error("Erro ao enviar documentos fiscais. ",s)}},async emitirCupom(e,t){try{const o=await $db.hibrido.le({table:"documento",id:e});$utils.verificarErro(!o||!o.status,"Erro ao emitir cupom. Falha na consulta da fatura."),$utils.verificarErro(o.status!=="Finalizada","Cupom n\xE3o emitido. A Fatura n\xE3o foi finalizada.");const s=(await $db.financeiroTitulo.le({documentoId:e}))[0];if(!s)return;let a;if(s.idDocumentoCaixa){const n=await $db.hibrido.le({table:"documento",id:s.idDocumentoCaixa});$utils.verificarErro(!n||!n.idCaixa,"Erro ao emitir cupom. Falha na consulta do documento Caixa.");const m=await $db.caixa.le({id:n.idCaixa});$utils.verificarErro(!m||!m.tipo,"Erro ao emitir cupom. Falha na consulta do Caixa."),a=m.tipo}else{const n=await $db.configuracoes.porNome("vendas.tipoPDV",o.idEmpresa);a=parseInt(((n||[]).find(m=>m.valor)||{}).valor)||4}if(a=$db.caixa.tiposCaixa[a],$utils.verificarErro(!["SAT","NFCe"].includes(a),`Cupom n\xE3o emitido. Caixa configurado para ${a}.`),a==="SAT"){let n;try{n=(await $utils.geeksApi({listaHibrido:{funcao:"FCC75497-9CAD-4D28-AB39-F669142BE8A9",table:"documentoSat",where:{idDocumento:e}}})).data.listaHibrido}catch{$utils.verificarErro(!0,"Erro ao emitir cupom. Falha na consulta dos documentos.")}for(const N of await $erp().documentoSat.where({idDocumento:e}).toArray())n.some(l=>l.id===N.id)||n.push(N);const m=n.filter(N=>N.cancelamento).map(N=>N.chaveCupomCancelado),p=n.filter(N=>!m.includes(N.chaveCupom)).filter(N=>!N.cancelamento);$utils.verificarErro(p.length>0,"Cupom j\xE1 emitido para a fatura")}else if(a==="NFCe"){const n=await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{idDocumento:e,situacao:"Emitido"}});$utils.verificarErro(!n,"Erro ao emitir cupom. Falha na consulta dos dados."),$utils.verificarErro(n.length>0,"Cupom j\xE1 emitido para a fatura")}await $utils.atualizarCfop(e),t&&(this.cpfCnpjNoCupom={visivel:!1,incluirCpfCnpjNoCupom:!1,idEmpresa:o.idEmpresa,cpfCnpj:o.numeroDocumentoContato,nomeCliente:o.descricaoContato,idFatura:e,tipoCaixa:a,concluir:null},await this.emitirCupomConfirma(this.cpfCnpjNoCupom)),t||(this.cpfCnpjNoCupom={visivel:!0,incluirCpfCnpjNoCupom:!1,idEmpresa:o.idEmpresa,cpfCnpj:o.numeroDocumentoContato,nomeCliente:o.descricaoContato,idFatura:e,tipoCaixa:a,concluir:null},await new Promise((n,m)=>{this.cpfCnpjNoCupom.concluir=n}),await $utils.dormir(500),this.modalItemTrocarCest.visivel&&await new Promise((n,m)=>{this.concluirItemTrocarCest=n}))}catch(o){$q.notifyError("Erro ao emitir cupom",o)}},async emitirCupomConfirma(e){return{SAT:this.emitirCupomSatConfirma,NFCe:this.emitirCupomNFCeConfirma}[e.tipoCaixa](e)},async emitirCupomSatConfirma(e){var o,s;let t="Erro desconhecido";try{$q.loading.show({message:"Emitindo cupom...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"amber"}),e.incluirCpfCnpjNoCupom||(e.idEmpresa="",e.cpfCnpj="",e.nomeCliente=""),t="Ocorreu um erro ao gerar o cupom";const{objetoJson:a,dados:n}=await J.gerar(e.idFatura,1,e.cpfCnpj,e.nomeCliente);$utils.verificarErro(!a,t);for(const p of n.alertas)$q.notify({message:p,textColor:"black",type:"warning"});t="Ocorreu um erro ao emitir o cupom";const m=[(o=n==null?void 0:n.documentoFatura)!=null?o:{},...(s=n==null?void 0:n.documentosVendas)!=null?s:[]].find(p=>p.id===n.idDocumento),c=await x.emitirSat(JSON.stringify(a),m);$utils.verificarErro(c.status==="Erro",c.mensagem),$q.notifyPositive(c.mensagem),t="Ocorreu um erro ao gravar os dados do cupom",await J.salvarRetornoEmissao(n,c.chaveCFe,c.xml),(c==null?void 0:c.versaoIntegrador)==="V2"&&await x.imprimirSat(c.xml,n.empresa.id)}catch(a){$q.notifyError(t,a)}finally{!this.modalItemTrocarCest.visivel&&this.concluirItemTrocarCest&&(this.concluirItemTrocarCest(),this.concluirItemTrocarCest=null),await this.atualiza(),$q.loading.hide()}},async emitirCupomNFCeConfirma(e){let t="Erro ao emitir Cupom NFCe",o,s;try{if($q.loading.show({message:"Selecionando Certificado e Emitindo o Cupom NFCe",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"amber"}),e.incluirCpfCnpjNoCupom||(e.idEmpresa="",e.cpfCnpj="",e.nomeCliente=""),t="Ocorreu um erro ao gerar o Cupom NFCe",s=await G.gerarJson(e.idFatura,e.cpfCnpj,e.nomeCliente),$utils.verificarErro(!s,t),s.erros.length){$g.modalAlerta.show({titulo:"Erro de valida\xE7\xE3o",erros:s.erros});return}if(await this.verificarCestEmST(s))return;for(const a of s.alertas)$q.notify({message:a,textColor:"black",type:"warning"});if(t="Ocorreu um erro ao emitir o Cupom NFCe",o=await x.emitirNFCe(s,s.empresaPlat.hashCSC,s.empresaPlat.tokenCSC),o.status==="Erro"){const a=[...(o.mensagem||"").split(`
`),...(o.complemento||"").split(`
`)];$g.modalAlerta.show({titulo:o.status,erros:a});return}if(e!=null&&e.idFatura){const a=await $db.hibrido.le({table:"documento",id:e==null?void 0:e.idFatura});if(a!=null&&a.id){const n=(await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{idDocumento:a==null?void 0:a.id,situacao:"Emitido",tipo:"NFCe"}}))[0];if(n!=null&&n.id){const m=(await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:n==null?void 0:n.id}}))[0];if(m!=null&&m.xmlProt){const c=new L.XMLParser({parseTagValue:!1,ignoreAttributes:!1}),p={idEmpresa:a==null?void 0:a.idEmpresa,idContato:a==null?void 0:a.idContato,...c.parse(m==null?void 0:m.xmlProt)};$utils.enviarWhatsapp({configuracao:"nfce",documento:p,loading:!0}),$utils.enviarEmail({configuracao:"nfce",documento:p,loading:!0})}}}}$q.notifyPositive(o.mensagem)}catch(a){$q.notifyError(t,a);return}finally{$q.loading.hide(),!this.modalItemTrocarCest.visivel&&this.concluirItemTrocarCest&&(this.concluirItemTrocarCest(),this.concluirItemTrocarCest=null),$utils.emitter.emit("atualizarDocumentosFiscais",e.idFatura)}try{const a=await x.imprimirNFCe(o.xml,s.outrosNFe.idContatoEmitente);a.status==="Erro"&&console.error(`Erro ao imprimir NFCe
`,a.mensagem)}catch(a){console.error(`Erro ao imprimir NFCe
`,a.toString())}},async reimprimirSat(e){try{$q.loading.show({message:"Imprimindo cupom...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"amber"});const t=this.documentosSat.find(s=>s.id===e),o=t.cancelamento?await x.imprimirCancelamentoSat(t.xml,t.idEmpresa):await x.imprimirSat(t.xml,t.idEmpresa);$utils.verificarErro(o.status==="Erro",o.mensagem),$q.notifyPositive(o.mensagem)}catch(t){$q.notifyError("Ocorreu um erro ao imprimir o cupom",t)}finally{$q.loading.hide()}},async reimprimirNFCe(e){try{$q.loading.show({message:"Imprimindo NFCe...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"amber"});const t=await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:e,status:"Sucesso",situacao:"Emitido"}});$utils.verificarErro(!t||!t.length||!t[0].xmlProt,"Ocorreu um erro ao carregar o xml da NFCe");const o=JSON.parse(t[0].json),s=await x.imprimirNFCe(t[0].xmlProt,o.outrosNFe.idContatoEmitente);$utils.verificarErro(s.status==="Erro",s.mensagem),s.mensagem&&$q.notifyPositive(s.mensagem)}catch(t){$q.notifyError("Ocorreu um erro ao imprimir o NFCe",t)}finally{$q.loading.hide()}},async verificarCestEmST(e){if(await $db.configuracoes.leValorNumerico("imposto.versao")!==2)return!1;const o=[];for(const s of e.infNFe.det){const a=$lodash.get(s,"prod.noXml_id"),n=$lodash.get(s,"prod.opcional.CEST"),m=$lodash.get(s,"imposto.noXml_CSOSN")||$lodash.get(s,"imposto.noXml_CST");["10","20","60","70","201","202","500"].includes(m)&&!n&&o.push(a)}return o.length===0?!1:(this.modalItemTrocarCest={visivel:!0,campos:{ids:o}},!0)},verNoSefaz(e){window.open(e,"_blank")},onResize(){this.width=window.innerWidth}},watch:{idFatura(){this.atualiza()},"cpfCnpjNoCupom.visivel"(e){!e&&this.cpfCnpjNoCupom.concluir&&(this.cpfCnpjNoCupom.concluir(),this.cpfCnpjNoCupom.concluir=null)},"modalItemTrocarCest.visivel"(e){!e&&this.concluirItemTrocarCest&&(this.concluirItemTrocarCest(),this.concluirItemTrocarCest=null)}},async mounted(){$utils.emitter.on("atualizarDocumentosFiscais",this.atualiza),await this.atualiza(),this.quantidadeDocumentos=this.documentosSat.length+this.documentosFiscais.length+this.documentosNFe.length||0},beforeUnmount(){$utils.emitter.off("atualizarDocumentosFiscais",this.atualiza)}},Te={id:"DocumentosFiscais"};function Ve(e,t,o,s,a,n){const m=D("g-label"),c=D("badge"),p=D("CpfCnpjNoCupom"),N=D("ItemTrocarCest");return f(),I("div",Te,[i(pe,{onResize:n.onResize},null,8,["onResize"]),!!a.documentosSat.length||!!a.documentosFiscais.length||!!a.documentosNFe.length?(f(),v(m,{key:0,icon:`account_balance ${a.width<=992?"13px":"xs"} tertiary left`,text:"sub2 medium",class:"q-mb-sm"},{default:r(()=>t[2]||(t[2]=[d(" Documentos fiscais ")])),_:1},8,["icon"])):$("",!0),a.documentosSat.length?(f(),v(T,{key:1},{default:r(()=>[(f(!0),I(S,null,k(a.documentosSat,l=>(f(),v(E,{key:l.id,class:U([`${a.quantidadeDocumentos>1?"border-bottom":""}`,"q-px-sm q-py-none q-mb-md"])},{default:r(()=>[i(u,null,{default:r(()=>[i(h,{class:"text-weight-medium",caption:a.width<=992},{default:r(()=>[d(b(a.hwDest),1)]),_:1},8,["caption"]),i(h,{caption:a.width<=992},{default:r(()=>[i(c,{rotulo:"#"+l.numeroCupom,cor:"tertiary",escuro:"",class:"col-auto q-ml-auto q-mr-sm"},null,8,["rotulo"]),i(c,{rotulo:l.cancelamento?"Cancelado":"Emitido",cor:l.cancelamento?"tertiary":"positive",escuro:"",class:"col-auto q-mx-auto"},null,8,["rotulo","cor"])]),_:2},1032,["caption"]),i(u,{class:"hideondesktop"},{default:r(()=>[i(h,{caption:"",class:"text-weight-medium q-pt-sm"},{default:r(()=>[d(b(e.$filters.dataHora(l.dataHoraEmissao)),1)]),_:2},1024),i(h,{class:"text-weight-medium",caption:a.width<=992},{default:r(()=>[d(b(e.$filters.numero(l.valorTotal,2)),1)]),_:2},1032,["caption"])]),_:2},1024)]),_:2},1024),i(u,{class:"maxw100 hideonmobile"},{default:r(()=>[i(h,{class:"text-weight-medium",caption:a.width<=992},{default:r(()=>[d(b(e.$filters.data(l.dataHoraEmissao)),1)]),_:2},1032,["caption"]),i(h,{caption:""},{default:r(()=>[d(b(e.$filters.hora(l.dataHoraEmissao)),1)]),_:2},1024)]),_:2},1024),i(u,{class:"maxw120 hideonmobile"},{default:r(()=>[i(h,{class:"text-weight-bold text-right",caption:a.width<=992},{default:r(()=>[d(b(e.$filters.numero(l.valorTotal,2)),1)]),_:2},1032,["caption"])]),_:2},1024),i(u,{class:"col-auto"},{default:r(()=>[i(E,{class:"q-pa-none"},{default:r(()=>[i(u,{class:"no-margin",style:{"min-width":"36.6px"}},{default:r(()=>[l.cancelamento?$("",!0):(f(),v(y,{key:0,onClick:g=>n.cancelarSat(l.id),icon:"cancel",color:"primary",round:"",dense:"",flat:""},{default:r(()=>[i(M,{anchor:"bottom middle",self:"center middle"},{default:r(()=>[d(" Cancelar "+b(a.hwDest),1)]),_:1})]),_:2},1032,["onClick"]))]),_:2},1024),i(u,{class:"no-margin"},{default:r(()=>[i(y,{icon:"more_vert",flat:"",round:"",dense:""},{default:r(()=>[i(X,null,{default:r(()=>[A((f(),v(T,{link:"",separator:""},{default:r(()=>[i(E,{onClick:g=>n.reimprimirSat(l.id),clickable:""},{default:r(()=>[i(u,{avatar:""},{default:r(()=>[i(q,{name:"mdi-printer"})]),_:1}),i(u,null,{default:r(()=>[i(h,null,{default:r(()=>t[3]||(t[3]=[d("Enviar para impressora")])),_:1})]),_:1})]),_:2},1032,["onClick"]),i(E,{clickable:"",onClick:g=>e.$imprimir(`${l.cancelamento?"cfe-extrato-cancelamento":"cfe-extrato"}`,l.id)},{default:r(()=>[i(u,{avatar:""},{default:r(()=>[i(q,{name:"mdi-printer"})]),_:1}),i(u,null,{default:r(()=>[i(h,null,{default:r(()=>t[4]||(t[4]=[d("Visualizar no navegador")])),_:1})]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[z]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})):$("",!0),a.documentosFiscais.length?(f(),v(T,{key:2},{default:r(()=>[(f(!0),I(S,null,k(a.documentosFiscais,l=>(f(),v(E,{key:l.id,class:U([`${a.quantidadeDocumentos>1?"border-bottom":""}`,"q-px-sm q-py-none q-mb-md"])},{default:r(()=>[i(u,null,{default:r(()=>[i(h,{class:"text-weight-medium",caption:a.width<=992},{default:r(()=>[d(b(l.tipo),1)]),_:2},1032,["caption"]),i(h,{caption:a.width<=992},{default:r(()=>[i(c,{rotulo:"#"+l.nNF,cor:"tertiary",escuro:"",class:"col-auto q-ml-auto q-mr-sm"},null,8,["rotulo"]),d(" "+b(l.situacao)+" "+b(l.tpAmb==="2"?"em Homologa\xE7\xE3o":"")+" "+b(l.operacao?" - "+l.operacao:""),1)]),_:2},1032,["caption"]),i(u,{class:"hideondesktop"},{default:r(()=>[i(h,{caption:"",class:"text-weight-medium q-pt-sm"},{default:r(()=>[d(b(e.$filters.dataHora(l.dataHoraEmissao)),1)]),_:2},1024),i(h,{class:"text-weight-medium",caption:a.width<=992},{default:r(()=>[d(b(e.$filters.numero(l.vNF,2)),1)]),_:2},1032,["caption"])]),_:2},1024)]),_:2},1024),i(u,{class:"maxw100 hideonmobile"},{default:r(()=>[i(h,{class:"text-weight-medium",caption:a.width<=992},{default:r(()=>[d(b(e.$filters.data(l.dataHoraEmissao)),1)]),_:2},1032,["caption"]),i(h,{caption:""},{default:r(()=>[d(b(e.$filters.hora(l.dataHoraEmissao)),1)]),_:2},1024)]),_:2},1024),i(u,{class:"maxw120 hideonmobile"},{default:r(()=>[i(h,{class:"text-weight-bold text-right",caption:a.width<=992},{default:r(()=>[d(b(e.$filters.numero(l.vNF,2)),1)]),_:2},1032,["caption"])]),_:2},1024),i(u,{class:"col-auto"},{default:r(()=>[l.tipo==="NFCe"?(f(),v(E,{key:0,class:"q-pa-none items-center"},{default:r(()=>[i(u,{class:"no-margin",style:{"min-width":"36.6px"}},{default:r(()=>[l.situacao==="Emitido"?(f(),v(y,{key:0,flat:"",round:"",dense:"",onClick:g=>n.cancelarNFCe(l.id),color:"primary",icon:"cancel"},{default:r(()=>[i(M,{anchor:"bottom middle",self:"center middle"},{default:r(()=>t[5]||(t[5]=[d(" Cancelar ")])),_:1})]),_:2},1032,["onClick"])):$("",!0)]),_:2},1024),i(u,{class:"no-margin",style:{"min-width":"36.6px"}},{default:r(()=>[i(y,{onClick:g=>n.verNoSefaz(l.qrCode),dense:"",flat:"",round:"",icon:"open_in_browser",color:"primary"},{default:r(()=>[i(M,{anchor:"bottom middle",self:"center middle"},{default:r(()=>t[6]||(t[6]=[d(" Ver no Sefaz ")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024),i(u,{class:"no-margin",style:{"min-width":"36.6px"}},{default:r(()=>[l.situacao==="Emitido"?(f(),v(y,{key:0,icon:"more_vert",flat:"",round:"",dense:""},{default:r(()=>[i(X,null,{default:r(()=>[A((f(),v(T,{link:"",separator:""},{default:r(()=>[i(E,{onClick:g=>n.reimprimirNFCe(l.id),clickable:""},{default:r(()=>[i(u,{avatar:""},{default:r(()=>[i(q,{name:"mdi-printer"})]),_:1}),i(u,null,{default:r(()=>[i(h,null,{default:r(()=>t[7]||(t[7]=[d("Enviar para impressora")])),_:1})]),_:1})]),_:2},1032,["onClick"]),i(E,{onClick:g=>e.$imprimir("nfce-danfe",l.id),clickable:""},{default:r(()=>[i(u,{avatar:""},{default:r(()=>[i(q,{name:"mdi-printer"})]),_:1}),i(u,null,{default:r(()=>[i(h,null,{default:r(()=>t[8]||(t[8]=[d("Visualizar no navegador")])),_:1})]),_:1})]),_:2},1032,["onClick"]),(f(!0),I(S,null,k(a.configImpressosWhatsapp.filter(g=>g.valor),g=>(f(),v(E,{key:g.valor,onClick:B=>n.enviarImpresso("whatsapp",g,l),clickable:""},{default:r(()=>[i(u,{avatar:""},{default:r(()=>[i(q,{name:"mdi-whatsapp"})]),_:1}),i(u,null,{default:r(()=>[d(b(g.valor),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),(f(!0),I(S,null,k(a.configImpressosEmail.filter(g=>g.valor),g=>(f(),v(E,{key:g.valor,onClick:B=>n.enviarImpresso("email",g,l),clickable:""},{default:r(()=>[i(u,{avatar:""},{default:r(()=>[i(q,{name:"mail"})]),_:1}),i(u,null,{default:r(()=>[d(b(g.valor),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)),[[z]])]),_:2},1024)]),_:2},1024)):$("",!0)]),_:2},1024)]),_:2},1024)):l.tipo==="NFe"?(f(),v(E,{key:1,class:"q-pa-none items-center"},{default:r(()=>[i(u,{class:"no-margin"},{default:r(()=>[i(y,{onClick:g=>n.abrirNFe(l.id),icon:"edit",color:"primary",flat:"",round:"",dense:""},{default:r(()=>[i(M,{anchor:"bottom middle",self:"center middle"},{default:r(()=>t[9]||(t[9]=[d(" Abrir ")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024),i(u,{class:"no-margin"},{default:r(()=>[i(y,{icon:"more_vert",flat:"",round:"",dense:""},{default:r(()=>[i(X,null,{default:r(()=>[A((f(),v(T,{link:"",separator:""},{default:r(()=>[(f(!0),I(S,null,k(a.configImpressaoNFe,g=>(f(),v(E,{key:g.valor,onClick:B=>e.$imprimir(g.valor,l.id),clickable:""},{default:r(()=>[i(u,{avatar:""},{default:r(()=>[i(q,{name:"mdi-printer"})]),_:1}),i(u,null,{default:r(()=>[i(h,null,{default:r(()=>[d(b(g.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)),[[z]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):$("",!0)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})):$("",!0),a.documentosNFe.length?(f(),v(T,{key:3},{default:r(()=>[(f(!0),I(S,null,k(a.documentosNFe,(l,g)=>(f(),v(E,{key:g,class:U([`${a.quantidadeDocumentos>1?"border-bottom":""}`,"q-px-sm q-py-none q-mb-md"])},{default:r(()=>[i(u,null,{default:r(()=>[i(h,{class:"text-weight-medium"},{default:r(()=>t[10]||(t[10]=[d(" NFe ")])),_:1}),i(h,null,{default:r(()=>[i(c,{rotulo:"#"+l.noNota,cor:"tertiary",escuro:"",class:"col-auto q-ml-auto q-mr-sm"},null,8,["rotulo"]),i(c,{rotulo:l.nfeCanceladaEvento?"Cancelado":"Emitido",cor:l.nfeCanceladaEvento?"tertiary":"positive",escuro:"",class:"col-auto q-mx-auto"},null,8,["rotulo","cor"])]),_:2},1024),i(u,{class:"hideondesktop"},{default:r(()=>[i(h,{caption:"",class:"text-weight-medium q-pt-sm"},{default:r(()=>[d(b(e.$filters.dataHora(l.horaSaidaEntrada)),1)]),_:2},1024),i(h,{class:"text-weight-medium"},{default:r(()=>[d(b(e.$filters.numero(l.valTotNota,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),i(u,{class:"maxw100 hideonmobile"},{default:r(()=>[i(h,{class:"text-weight-medium"},{default:r(()=>[d(b(e.$filters.data(l.horaSaidaEntrada)),1)]),_:2},1024),i(h,{caption:""},{default:r(()=>[d(b(e.$filters.hora(l.horaSaidaEntrada)),1)]),_:2},1024)]),_:2},1024),i(u,{class:"maxw120 hideonmobile"},{default:r(()=>[i(h,{class:"text-weight-bold text-right"},{default:r(()=>[d(b(e.$filters.numero(l.valTotNota,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})):$("",!0),!a.documentosSat.length&&!a.documentosFiscais.length&&!a.documentosNFe.length?(f(),v(m,{key:4,icon:`account_balance ${a.width<=992?"15px":"xs"} tertiary left`,text:"sub2 medium"},{default:r(()=>t[11]||(t[11]=[d(" N\xE3o h\xE1 documentos emitidos ")])),_:1},8,["icon"])):$("",!0),i(p,{modelValue:a.cpfCnpjNoCupom.visivel,"onUpdate:modelValue":t[0]||(t[0]=l=>a.cpfCnpjNoCupom.visivel=l),onConfirmar:n.emitirCupomConfirma,dados:a.cpfCnpjNoCupom},null,8,["modelValue","onConfirmar","dados"]),i(N,{modal:a.modalItemTrocarCest,onConfirmar:t[1]||(t[1]=l=>n.emitirCupomConfirma(a.cpfCnpjNoCupom))},null,8,["modal"])])}var je=R(ke,[["render",Ve]]);export{$e as C,je as D};
