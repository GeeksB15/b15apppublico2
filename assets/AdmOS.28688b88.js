import{_ as L,aX as H,r as h,o as d,p as v,f as a,w as s,h as k,j as w,i as q,k as u,Q as z,G as P,J as I,C as p,F as Q,x as T,t as b,e as S,d as C,A as W,q as j,O as U,dQ as A,m as F,be as G,H as X,P as Z,S as V,T as _,U as x,N as $,I as B,M as J,as as N,b0 as K}from"./index.82e1f7f9.js";import{O as Y}from"./OSTrocarStatus.755b489e.js";import{M as oo}from"./ModalHistoricoStatus.0d372c2e.js";import{B as ao}from"./BoxEnvioWhatsapp.9deb64fe.js";import{d as eo}from"./vuedraggable.umd.726ff047.js";import"./Campo.45d02aca.js";import"./open-url.d41f4bab.js";const to={components:{OSTrocarStatus:Y,ModalHistoricoStatus:oo,draggable:eo,BoxEnvioWhatsapp:ao},data(){return{listas:{Processando:[],Entregue:[]},trocarStatusDados:{},trocarStatusModal:!1,mensagem:`Ol\xE1 *[PrimeiroApelido]*, tudo bem?
        Temos uma \xF3tima not\xEDcia.
        *Sua ordem de servi\xE7o ficou pronta*, pode vir retirar na loja!
        At\xE9 mais \u{1F609}
        `,entregueInicio:$utils.dataAtual(),entregueFim:$utils.dataAtual(),filtros:!1,fraseFiltro:"",empresaSelecionada:null,empresaOpcoes:[],periodoSelecionado:0,periodoOpcoes:[{value:0,label:"Hoje"},{value:7,label:"Uma semana"},{value:30,label:"Um m\xEAs"}],prazoSelecionado:null,prazoOpcoes:[{value:"bordaVerdeOS",label:"Em dia"},{value:"bordaAmarelaOS",label:"Entrega para esta semana"},{value:"bordaVermelhaOS",label:"Entrega atrasada"}],configImpressaoOrcamento:[]}},methods:{async atualizar(){try{const i=await $db.os.leAdmOSOnline({entregueInicio:this.entregueInicio,entregueFim:this.entregueFim,empresas:this.empresaOpcoes.map(e=>e.id)});$utils.verificarAlerta(!i||!i.length,"N\xE3o h\xE1 ordens de servi\xE7o");let o=await $db.configuracoes.le({nome:"vendas.os.status"});o=o.filter(e=>!["Processando","Entregue"].includes(e.texto));const l={Processando:[]};for(const e of H.exports.orderBy(o,"valor","asc").map(t=>t.texto))l[e]=[];l.Entregue=[];for(const e of i){let t="bordaVerdeOS",n="",O="Normal";if(e.status==="Entregue"){if(!!e.dataHoraPrevisto&&!!e.dataHoraFinalizado){const g=new Date(new Date(e.dataHoraPrevisto).toDateString()),c=(new Date(new Date(e.dataHoraFinalizado).toDateString())-g)/(1e3*60*60*24);t=c>=0?"bordaVermelhaOS":c>-7?"bordaAmarelaOS":"bordaVerdeOS",n=c>=0?"negative":c>-7?"warning":"",O=c>=0?"Atrasado":c>-7?"Aten\xE7\xE3o":"Normal"}}else if(e.dataHoraPrevisto){const g=new Date(new Date(e.dataHoraPrevisto).toDateString()),c=(new Date(new Date().toDateString())-g)/(1e3*60*60*24);t=c>=0?"bordaVermelhaOS":c>-7?"bordaAmarelaOS":"bordaVerdeOS",n=c>=0?"negative":c>-7?"warning":"",O=c>=0?"Atrasado":c>-7?"Aten\xE7\xE3o":"Normal"}const y={id:e.id,codigoCompra:e.codigoCompra||"-",codigoContatoResponsavel:e.codigoContatoResponsavel,codigoDocumento:e.codigoDocumento,codigoContato:e.codigoContato,idEmpresa:e.idEmpresa,codigoEmpresa:e.codigoEmpresa,descricaoEmpresa:e.descricaoEmpresa,descricao:e.descricao,corBorda:t,corLabel:n,txtLabel:O,dataHoraEmissao:new Date(e.dataHoraEmissao),dataHoraFinalizado:new Date(e.dataHoraFinalizado),dataHoraRetorno:new Date(e.dataHoraRetorno),dataHoraPrevisto:new Date(e.dataHoraPrevisto),mostra:!0,nomeCliente:e.nomeCliente||"-",nomeResponsavel:e.nomeResponsavel||"-",idVenda:e.idVenda,numeroVenda:e.numeroVenda?String(e.numeroVenda):"-",numeroOS:e.numeroOS?String(e.numeroOS):"-",status:e.status};l[e.status]&&l[e.status].push(y)}this.listas=l,this.refazFiltro()}catch(i){this.$q.notifyError("Erro na consulta online de oss",i)}},async eventoEnd(){for(const i in this.listas)for(const o of this.listas[i])if(o.status!==i){console.log("AdmOS","eventoEnd De:",o.status,"Para:",i,"codigo:",o.codigoDocumento),this.trocarStatusDados={codigoContatoResponsavel:o.codigoContatoResponsavel,codigoDocumento:o.codigoDocumento,codigoUsuario:null,nomeCliente:o.nomeCliente,observacao:"",statusAtual:o.status,statusNovo:i},this.trocarStatusModal=!0;return}},async eventoConfirmarTroca(i){console.log("AdmOS","eventoConfirmaTroca",{...i}),this.$q.loading.show();try{let o;$db.usuario.logado.cpf&&(o=(await $db.contato.ler({filtros:{termoBusca:$db.usuario.logado.cpf}})).data.find(e=>{var t;return e.numeroDocumentoNacional.replace(/\D/g,"")===((t=$db.usuario.logado.cpf)==null?void 0:t.replace(/\D/g,""))})),i.cpfUsuario=o==null?void 0:o.numeroDocumentoNacional,await $db.os.trocaStatusOnline(i),this.$q.notifyPositive("Status trocado com sucesso"),this.atualizar()}catch(o){this.$q.notifyError("Erro na troca de status",o)}finally{this.$q.loading.hide()}},eventoCancelarTroca(i){console.log("AdmOS","eventoCancelarTroca",i),this.atualizar()},async empresaOpcoesCarregar(){const i=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.empresaOpcoes=i.map(o=>({id:o.id,value:o.codigoContato,label:o.apelido||o.nome}))},filtraDebounce(){H.exports.debounce(this.refazFiltro,700)()},refazFiltro(){const i=$utils.removerAcentos(this.fraseFiltro.toUpperCase()).split(" ").filter(o=>o!=="");for(const o in this.listas)for(const l of this.listas[o]){const e=$utils.removerAcentos(l.id.toUpperCase()+l.nomeCliente.toUpperCase()+l.nomeResponsavel.toUpperCase()+" "+String(l.numeroVenda)+"  "+String(l.numeroOS)+" ");let t=!0;for(const n of i)isNaN(Number(n))?t=t&&e.includes(n):t=t&&e.includes(" "+n+" ");this.empresaSelecionada&&(t=t&&this.empresaSelecionada.value===l.codigoEmpresa),l.mostra=t}},async irParaAtendimento(i){const o=await $erp().contato.where({codigoContato:i}).first()||{};o.id&&this.$router.push({name:"Atendimento",params:{id:o.id}})},async carregarImpressoes(i){await this.configuraImpressaoOrcamento(i.idEmpresa)},async configuraImpressaoOrcamento(i){const o=await $db.configuracoes.porNome("impressao.venda",i),l=[{valor:"invoice",texto:"Or\xE7amento/Venda (Invoice)"}];this.sistemaPai==="optisoul"&&l.push({valor:"orcamento",texto:"Or\xE7amento (Antigo)"},{valor:"termoGarantia",texto:"Termo de Garantia"}),this.configImpressaoOrcamento=[...o.length?o.map(e=>({texto:"Imprimir Or\xE7amento",...e})):l]}},watch:{async entregueInicio(){await this.atualizar()},async entregueFim(){await this.atualizar()}},async created(){await this.empresaOpcoesCarregar(),await this.atualizar()}},so={id:"AdmOS"},ro={class:"row overflowXOS filterfalse"},io={class:"q-pa-none"},lo={key:0,class:"row"},no={class:"col-12"},co={class:"q-pa-md"},uo={class:"row q-mt-xs"},mo={class:"col-6"},po={class:"col-6 justify-end q-pr-xs",style:{display:"flex"}},fo={key:0,class:"text-subtitle1 text-weight-medium"},vo={key:1,class:"text-caption"},go={class:"col-12"},bo={key:0,class:"text-caption q-mb-xs"},So={key:1,class:"text-caption q-mb-xs"},_o={class:"text-caption"};function ho(i,o,l,e,t,n){const O=h("barraTopo"),y=h("campo"),g=h("badge"),D=h("draggable"),c=h("OSTrocarStatus"),R=h("ModalHistoricoStatus"),M=h("BoxEnvioWhatsapp");return d(),v("div",so,[a(P,{elevated:"",class:"bg-gradiente text-white"},{default:s(()=>[a(O),a(k,{class:"q-px-sm"},{default:s(()=>[a(w,{name:"view_week",size:"sm"}),a(q,null,{default:s(()=>o[9]||(o[9]=[u("Adm. OS")])),_:1}),a(z,{onClick:o[0]||(o[0]=m=>t.filtros=!t.filtros),icon:"mdi-filter",round:"",dense:"",flat:""})]),_:1})]),_:1}),a(B,null,{default:s(()=>[a(I,null,{default:s(()=>[p("div",ro,[(d(!0),v(Q,null,T(t.listas,(m,E)=>(d(),v("div",{key:E,class:"no-shadow col q-px-none coluna"},[p("div",io,[a(k,{class:"no-shadow q-py-none q-px-sm text-white"},{default:s(()=>[a(q,null,{default:s(()=>[u(b(E),1)]),_:2},1024)]),_:2},1024),E==="Entregue"?(d(),v("div",lo,[p("div",no,[p("div",co,[a(y,{modelValue:t.entregueInicio,"onUpdate:modelValue":o[1]||(o[1]=r=>t.entregueInicio=r),rotulo:"In\xEDcio",tipo:"data",class:"q-field--with-bottom"},null,8,["modelValue"]),a(y,{modelValue:t.entregueFim,"onUpdate:modelValue":o[2]||(o[2]=r=>t.entregueFim=r),rotulo:"Fim",tipo:"data",class:"q-field--with-bottom"},null,8,["modelValue"])])])])):S("",!0),a(D,{onEnd:n.eventoEnd,list:m,draggable:".extratoOS",delay:"250",group:"osGroup",itemKey:"id",class:"dragAreaOS"},{item:s(({element:r})=>[r.mostra&&(t.prazoSelecionado===null||t.prazoSelecionado===r.corBorda)?(d(),C(W,{key:0,class:j([r.corBorda,"q-pa-sm q-pb-md q-my-sm q-mb-md shadow-1 extratoOS bg-white"])},{default:s(()=>[p("div",uo,[p("div",mo,[r.corLabel?(d(),C(g,{key:0,cor:r.corLabel,rotulo:r.txtLabel,escuro:"",class:"q-mx-xs"},null,8,["cor","rotulo"])):(d(),C(g,{key:1,rotulo:r.txtLabel,class:"q-mx-xs"},null,8,["rotulo"]))]),p("div",po,[r.numeroVenda&&r.numeroVenda!=="-"?(d(),C(g,{key:0,cor:"light",rotulo:r.numeroVenda,icone:"shopping_cart",class:"q-mx-sm"},null,8,["rotulo"])):S("",!0),r.numeroOS&&r.numeroOS!=="-"?(d(),C(g,{key:1,escuro:"",rotulo:r.numeroOS,icone:"assignment_turned_in",cor:"tertiary"},null,8,["rotulo"])):S("",!0)])]),a(U,{class:"q-pa-xs q-mb-sm"},{default:s(()=>[r.nomeCliente?(d(),v("div",fo,b(r.nomeCliente),1)):S("",!0),r.nomeCliente!==r.descricao?(d(),v("div",vo,b(r.descricao),1)):S("",!0)]),_:2},1024),a(U,{class:"row q-pa-xs q-pb-none"},{default:s(()=>[p("div",go,[r.descricaoEmpresa&&r.descricaoEmpresa!=="-"?(d(),v("div",bo,[p("span",null,[a(A,{icon:"business",size:"sm",color:"grey-3","text-color":"tertiary"}),u(" "+b(r.descricaoEmpresa)+" ",1),a(F,{anchor:"bottom middle",self:"center middle"},{default:s(()=>o[10]||(o[10]=[u(" Empresa ")])),_:1})])])):S("",!0),r.nomeResponsavel&&r.nomeResponsavel!=="-"?(d(),v("div",So,[p("span",null,[a(A,{icon:"person",size:"sm",color:"grey-3","text-color":"tertiary"}),u(" "+b(r.nomeResponsavel)+" ",1),a(F,{anchor:"bottom middle",self:"center middle"},{default:s(()=>o[11]||(o[11]=[u(" Respons\xE1vel ")])),_:1})])])):S("",!0),p("div",_o,[p("span",null,[a(A,{icon:"calendar_today",size:"sm",color:"grey-3","text-color":"tertiary"}),u(" "+b(i.$filters.data(r.dataHoraFinalizado>new Date("1970-01-01T00:00:00.000Z")?r.dataHoraFinalizado:r.dataHoraPrevisto))+" ",1),a(F,{anchor:"bottom middle",self:"center middle"},{default:s(()=>[u(b(r.dataHoraFinalizado>new Date("1970-01-01T00:00:00.000Z")?"Finalizado em":"Previsto para"),1)]),_:2},1024)])]),a(z,{onClick:f=>n.carregarImpressoes(r),dense:"",round:"",unelevated:"",color:"white",icon:"more_vert","text-color":"tertiary",class:"botaoVerMaisVert"},{default:s(()=>[a(G,null,{default:s(()=>[X((d(),C(Z,{link:"",separator:""},{default:s(()=>[a(V,{onClick:f=>i.$refs.modalHistoricoStatus.mostrar({idDocumento:r.id}),clickable:""},{default:s(()=>[a(_,{avatar:""},{default:s(()=>[a(w,{name:"history"})]),_:1}),a(_,null,{default:s(()=>[a(x,null,{default:s(()=>o[12]||(o[12]=[u("Hist\xF3rico do Status")])),_:1})]),_:1})]),_:2},1032,["onClick"]),a(V,{onClick:f=>n.irParaAtendimento(r.codigoContato),clickable:""},{default:s(()=>[a(_,{avatar:""},{default:s(()=>[a(w,{name:"launch"})]),_:1}),a(_,null,{default:s(()=>[a(x,null,{default:s(()=>o[13]||(o[13]=[u("Ir para o Atendimentos")])),_:1})]),_:1})]),_:2},1032,["onClick"]),a(V,{onClick:f=>i.$refs.BoxEnvioWhatsapp.abrir(r.id,r.status),clickable:""},{default:s(()=>[a(_,{avatar:""},{default:s(()=>[a(w,{name:"mdi-whatsapp"})]),_:1}),a(_,null,{default:s(()=>[a(x,null,{default:s(()=>o[14]||(o[14]=[u("Enviar Mensagem")])),_:1}),a(x,{caption:""},{default:s(()=>o[15]||(o[15]=[u("WhatsApp")])),_:1})]),_:1})]),_:2},1032,["onClick"]),(d(!0),v(Q,null,T(t.configImpressaoOrcamento.filter(f=>f.valor),f=>(d(),C(V,{onClick:Co=>i.$imprimir(f.valor,{id:(r==null?void 0:r.idVenda)||"0",Oculto:"0"}),key:f.valor,clickable:""},{default:s(()=>[a(_,{avatar:""},{default:s(()=>[a(w,{name:"print"})]),_:1}),a(_,null,{default:s(()=>[a(x,null,{default:s(()=>[u(b(f.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)),[[$]])]),_:2},1024)]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1032,["class"])):S("",!0)]),_:2},1032,["onEnd","list"])])]))),128))])]),_:1})]),_:1}),a(K,{modelValue:t.filtros,"onUpdate:modelValue":o[7]||(o[7]=m=>t.filtros=m),bordered:"",side:"right",class:"hide-scrollbar"},{default:s(()=>[a(J,{view:"hHh lpR lFr"},{default:s(()=>[a(P,{class:"bg-white"},{default:s(()=>[a(k,{class:"text-tertiary border-bottom"},{default:s(()=>[a(w,{name:"mdi-filter",size:"sm",color:"tertiary"}),a(q,null,{default:s(()=>o[16]||(o[16]=[u("Filtros")])),_:1}),a(z,{onClick:o[3]||(o[3]=m=>t.filtros=!t.filtros),dense:"",flat:"",round:"",icon:"close"})]),_:1})]),_:1}),a(B,null,{default:s(()=>[a(I,{class:"q-pa-md"},{default:s(()=>[a(y,{modelValue:t.fraseFiltro,"onUpdate:modelValue":[o[4]||(o[4]=m=>t.fraseFiltro=m),n.filtraDebounce],rotulo:"Filtrar",ajuda:"Por cliente, respons\xE1vel, id, n\xBA venda, n\xBA ordem servi\xE7o",dense:"",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue"]),a(N,{modelValue:t.prazoSelecionado,"onUpdate:modelValue":[o[5]||(o[5]=m=>t.prazoSelecionado=m),n.refazFiltro],clearable:"",dense:"",options:t.prazoOpcoes,label:"Por prazo",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","options"]),a(N,{modelValue:t.empresaSelecionada,"onUpdate:modelValue":[o[6]||(o[6]=m=>t.empresaSelecionada=m),n.refazFiltro],clearable:"",dense:"",options:t.empresaOpcoes,label:"Por empresa",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(c,{modelValue:t.trocarStatusModal,"onUpdate:modelValue":o[8]||(o[8]=m=>t.trocarStatusModal=m),dados:t.trocarStatusDados,onConfirmar:n.eventoConfirmarTroca,onCancelar:n.eventoCancelarTroca},null,8,["modelValue","dados","onConfirmar","onCancelar"]),a(R,{ref:"modalHistoricoStatus"},null,512),a(M,{ref:"BoxEnvioWhatsapp",mensagem:t.mensagem},null,8,["mensagem"])])}var ko=L(to,[["render",ho]]);export{ko as default};
