import{_ as z,$ as T,Z as A,r as y,o as r,p as k,d as f,w as a,f as e,T as m,C as b,U as E,k as c,t as p,j as C,m as Q,Q as V,bf as S,P as w,F,x,S as N,H,N as L,e as v,l as P,aY as B,aX as j,bT as M,A as R,h as O,a_ as W,a$ as I,b6 as U,b5 as X}from"./index.a7098747.js";import{a as Y,n as Z}from"./nfePrincipal.86f028a1.js";import"./compactarValidarNFe.c6436f4e.js";import"./obterItens.e2e1c1cb.js";import"./codigosANP.a6c1a264.js";const G={components:{BadgeCopiarUid:T,Badge:A},data(){return{detalhesVisivel:!1,configImpressaoNFe:[]}},methods:{abrirNFe(){$utils.emitter.emit("abrirNFe",this.nota.id)},async configuraImpressao(d){const o=await $db.configuracoes.porNome("impressao.nfe",d);this.configImpressaoNFe=o.length?o.map(l=>({texto:"Imprimir DANFE",...l})):[{valor:"nfe-danfe",texto:"DANFE"},{valor:"nfe-danfe-simplificado",texto:"DANFE Simplificado"},{valor:"duplicata-mercantil",texto:"Duplicata Mercantil"}]}},mixins:[Y],props:{nota:{required:!0,type:Object}},async created(){var h,t,s;const d=(h=this.nota)==null?void 0:h.idDocumento,o=(s=(t=this.nota)==null?void 0:t.cpfCnpjEmitente)==null?void 0:s.replace(/\D/g,"");let l;if(d){const u=await $db.hibrido.le({table:"documento",id:d});l=u==null?void 0:u.idEmpresa}if(!l&&o){const g=(await $erp().empresa.toArray()).find(_=>{var n;return((n=_.numeroDocumentoNacional)==null?void 0:n.replace(/\D/g,""))===o});l=g==null?void 0:g.idContato}await this.configuraImpressao(l)}},J={class:"col-12"},K={class:"col-12"},$={class:"text-tertiary q-col-gutter-xs"};function ee(d,o,l,h,t,s){const u=y("BadgeCopiarUid"),g=y("badge"),_=y("row");return r(),k(F,null,[l.nota.id?(r(),f(N,{key:0,"manual-focus":"",clickable:"",class:"items-center d-flex q-pa-xs"},{default:a(()=>[e(m,{avatar:"",center:"",class:"mw120"},{default:a(()=>[e(u,{id:l.nota.id,numero:l.nota.nNF,class:"q-mr-sm",cor:"positive"},null,8,["id","numero"])]),_:1}),e(m,{clickable:""},{default:a(()=>[e(_,{class:"items-center q-col-gutter-x-sm"},{default:a(()=>[b("div",{class:"col",onClick:o[0]||(o[0]=(...n)=>s.abrirNFe&&s.abrirNFe(...n))},[e(E,{class:"text-tertiary text-weight-bold"},{default:a(()=>[c(p(l.nota.xNomeDestinatario||"Destinat\xE1rio n\xE3o preenchido"),1)]),_:1}),e(_,{class:"hideondesktop items-center q-my-sm"},{default:a(()=>[b("div",J,[e(E,{caption:"",class:"text-tertiary"},{default:a(()=>[e(C,{name:"event"}),c(" "+p(d.$filters.data(l.nota.dataHoraEmissao)),1)]),_:1}),e(g,{cor:"tertiary",escuro:""},{default:a(()=>[c(p(l.nota.situacao)+p(l.nota.tpAmb==="2"?" - Homologa\xE7\xE3o":""),1)]),_:1})]),b("div",K,[e(E,{caption:"",class:"text-tertiary text-weight-bold q-mt-sm"},{default:a(()=>[c(p(d.$filters.numero(l.nota.vNF,2))+" ",1),e(Q,null,{default:a(()=>o[3]||(o[3]=[c("Valor da nota")])),_:1})]),_:1})])]),_:1})])]),_:1})]),_:1}),e(m,{onClick:s.abrirNFe,avatar:"",class:"mw100 hideonmobile"},{default:a(()=>[e(E,{class:"text-tertiary"},{default:a(()=>[e(C,{name:"event"}),c(" "+p(d.$filters.data(l.nota.dataHoraEmissao)),1)]),_:1})]),_:1},8,["onClick"]),e(m,{onClick:s.abrirNFe,avatar:"",class:"mw100 hideonmobile"},{default:a(()=>[e(g,{cor:"tertiary",escuro:""},{default:a(()=>[c(p(l.nota.situacao)+p(l.nota.tpAmb==="2"?" - Homologa\xE7\xE3o":""),1)]),_:1})]),_:1},8,["onClick"]),e(m,{onClick:s.abrirNFe,class:"hideonmobile"},{default:a(()=>[e(E,{caption:"",class:"text-right text-tertiary text-weight-bold"},{default:a(()=>[c(p(d.$filters.numero(l.nota.vNF,2))+" ",1),e(Q,null,{default:a(()=>o[4]||(o[4]=[c("Valor da nota")])),_:1})]),_:1})]),_:1},8,["onClick"]),e(m,{side:"",top:""},{default:a(()=>[b("div",$,[e(V,{rounded:"",dense:"",flat:"",icon:d.emDigitacao?"edit":"remove_red_eye",color:"tertiary",class:"no-shadow q-ma-xs hideonmobile",size:"md",onClick:s.abrirNFe,style:{float:"right"}},null,8,["icon","onClick"]),e(V,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",class:"no-shadow q-ma-xs hideonmobile",size:"md",style:{float:"right"}},{default:a(()=>[e(S,null,{default:a(()=>[e(w,{link:"",separator:""},{default:a(()=>[(r(!0),k(F,null,x(t.configImpressaoNFe,n=>(r(),f(N,{clickable:"",key:n.valor,onClick:q=>{var i,D;return d.$imprimir(n.valor,(D=(i=l.nota)==null?void 0:i.id)!=null?D:"0")}},{default:a(()=>[e(m,{avatar:""},{default:a(()=>[e(C,{name:"mdi-printer"})]),_:1}),e(m,null,{default:a(()=>[e(E,null,{default:a(()=>[c(p(n.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}),e(V,{rounded:"",dense:"",flat:"",icon:t.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down",size:"md",class:"no-shadow q-ma-xs hideonmobile",color:"tertiary",style:{float:"right"},onClick:o[1]||(o[1]=n=>t.detalhesVisivel=!t.detalhesVisivel)},null,8,["icon"]),e(V,{dense:"",flat:"",icon:"more_vert",round:"",size:"md",class:"hideondesktop"},{default:a(()=>[e(S,null,{default:a(()=>[H((r(),f(w,{link:"","no-border":"",separator:""},{default:a(()=>[e(N,{class:"hideondesktop",clickable:"",onClick:s.abrirNFe},{default:a(()=>[e(m,{avatar:""},{default:a(()=>[e(C,{name:d.emDigitacao?"edit":"remove_red_eye"},null,8,["name"])]),_:1}),e(m,null,{default:a(()=>[c(p(d.emDigitacao?"Editar":"Consultar"),1)]),_:1})]),_:1},8,["onClick"]),(r(!0),k(F,null,x(t.configImpressaoNFe,n=>(r(),f(N,{class:"hideondesktop",clickable:"",key:n.valor,onClick:q=>{var i,D;return d.$imprimir(n.valor,(D=(i=l.nota)==null?void 0:i.id)!=null?D:"0")}},{default:a(()=>[e(m,{avatar:""},{default:a(()=>[e(C,{name:"mdi-printer"})]),_:1}),e(m,null,{default:a(()=>[e(E,null,{default:a(()=>[c(p(n.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),e(N,{class:"hideondesktop",clickable:"",onClick:o[2]||(o[2]=n=>t.detalhesVisivel=!t.detalhesVisivel)},{default:a(()=>[e(m,{avatar:""},{default:a(()=>[e(C,{name:t.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down"},null,8,["name"])]),_:1}),e(m,null,{default:a(()=>o[5]||(o[5]=[c(" Detalhes ")])),_:1})]),_:1})]),_:1})),[[L]])]),_:1})]),_:1})])]),_:1})]),_:1})):v("",!0),t.detalhesVisivel?(r(),f(N,{key:1,class:"q-px-xs"},{default:a(()=>[e(m,{class:"q-px-none fullWidth"},{default:a(()=>[e(C,{name:"business"}),c(" "+p(l.nota.xFantEmitente||l.nota.xNomeEmitente),1)]),_:1})]),_:1})):v("",!0),e(P)],64)}var ae=z(G,[["render",ee]]);const te={components:{nfeCard:ae,nfePrincipal:Z},data(){return{dataFim:null,dataIni:null,grupos:[],notasEmDigitacao:[],notasEmitidas:[],notasOutras:[],tabSelecionada:""}},methods:{async atualizar(){let d=new Date,o=new Date;try{this.$q.loading.show(),this.dataIni&&this.dataFim&&(d=new Date(this.dataIni).setHours(0,0,0,0),o=new Date(this.dataFim).setHours(23,59,59,0));const l={filtros:{periodo:{dataIni:new Date(d).toLocaleDateString("pt-BR"),dataFim:new Date(o).toLocaleDateString("pt-BR")}}};let h=(await $db.documentoFiscalEletronico.leListaNFeCompletaOnline(l)).data;if(this.grupos.length){const s=this.grupos.map(u=>B(u.label).toUpperCase());h=h.filter(u=>{const g=B(u.chNFe.toUpperCase()+u.xNomeEmitente.toUpperCase()+u.xFantEmitente.toUpperCase()+u.cpfCnpjDestinatario.toUpperCase()+u.xNomeDestinatario.toUpperCase()+" "+String(u.nNF)+" ");let _=!0;for(const n of s)n.length>9||isNaN(Number(n))?_=_&&g.includes(n):_=_&&g.includes(" "+n+" ");return _})}h=j.exports.orderBy(h,["dataHoraEmissao"],["desc"]),this.notasEmDigitacao=h.filter(s=>["Em digita\xE7\xE3o"].includes(s.situacao)).slice(0,30),this.notasEmitidas=h.filter(s=>["Emitido","Carta de Corre\xE7\xE3o"].includes(s.situacao)).slice(0,30),this.notasOutras=h.filter(s=>!["Em digita\xE7\xE3o","Carta de Corre\xE7\xE3o","Emitido"].includes(s.situacao)).slice(0,30);let t=this.notasEmDigitacao.length?"notasEmDigitacao":"";t||(t=this.notasEmitidas.length?"notasEmitidas":""),t||(t=this.notasOutras.length?"notasEmitidas":""),this.tabSelecionada=t}catch(l){this.$q.notifyError("Erro ao carregar notas",l)}finally{this.$q.loading.hide()}},fechouNFe(d){d&&this.atualizar()},limparFiltro(){this.grupos=[],this.dataFim=new Date,this.dataIni=new Date(M().add(-7,"days"))}},created(){},mounted(){this.limparFiltro(),this.atualizar()}},oe={class:"NFeLista q-pb-md q-px-none"},le={class:"col-12 col-md-6"},ie={class:"col"},se={class:"col"},ne={key:1,class:"q-pa-lg text-center"};function re(d,o,l,h,t,s){const u=y("gchips"),g=y("campo"),_=y("row"),n=y("nfeCard"),q=y("nfePrincipal");return r(),k("div",oe,[e(O,{class:"bg-light"},{default:a(()=>[e(R,{class:"no-shadow bg-light full-width"},{default:a(()=>[e(_,{class:"items-center"},{default:a(()=>[b("div",le,[e(u,{modelValue:t.grupos,"onUpdate:modelValue":[o[0]||(o[0]=i=>t.grupos=i),s.atualizar],placeholder:t.grupos.length?"":"Filtre por Empresa, Destinat\xE1rio, N\xFAmero...",before:[{icon:"mdi-filter",handler(){d.filtrar()}}]},null,8,["modelValue","onUpdate:modelValue","placeholder","before"])]),b("div",ie,[e(g,{modelValue:t.dataIni,"onUpdate:modelValue":[o[1]||(o[1]=i=>t.dataIni=i),s.atualizar],tipo:"data",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),o[5]||(o[5]=b("div",{class:"col-auto",style:{"align-items":"center",display:"flex"}},[b("label",null,"at\xE9")],-1)),b("div",se,[e(g,{modelValue:t.dataFim,"onUpdate:modelValue":[o[2]||(o[2]=i=>t.dataFim=i),s.atualizar],tipo:"data",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])])]),_:1})]),_:1})]),_:1}),t.tabSelecionada?(r(),k(F,{key:0},[e(O,{class:"bg-light q-px-sm"},{default:a(()=>[e(W,{modelValue:t.tabSelecionada,"onUpdate:modelValue":o[3]||(o[3]=i=>t.tabSelecionada=i),class:"text-primary",align:"left",style:{"border-bottom":"1px solid #0000001f"}},{default:a(()=>[t.notasEmDigitacao.length?(r(),f(I,{key:0,label:"Em digita\xE7\xE3o",name:"notasEmDigitacao",active:""})):v("",!0),t.notasEmitidas.length?(r(),f(I,{key:1,label:"Emitidas",name:"notasEmitidas"})):v("",!0),t.notasOutras.length?(r(),f(I,{key:2,label:"Outras",name:"notasOutras"})):v("",!0)]),_:1},8,["modelValue"])]),_:1}),e(X,{modelValue:t.tabSelecionada,"onUpdate:modelValue":o[4]||(o[4]=i=>t.tabSelecionada=i),animated:"",class:"transparent q-pa-none"},{default:a(()=>[t.notasEmDigitacao.length?(r(),f(U,{key:0,name:"notasEmDigitacao",class:"q-pa-none transparent"},{default:a(()=>[e(w,{class:"rounded-borders"},{default:a(()=>[(r(!0),k(F,null,x(t.notasEmDigitacao,i=>(r(),f(n,{key:i.id,nota:i},null,8,["nota"]))),128))]),_:1})]),_:1})):v("",!0),t.notasEmitidas.length?(r(),f(U,{key:1,name:"notasEmitidas",class:"q-pa-none transparent"},{default:a(()=>[e(w,{class:"rounded-borders"},{default:a(()=>[(r(!0),k(F,null,x(t.notasEmitidas,i=>(r(),f(n,{key:i.id,nota:i},null,8,["nota"]))),128))]),_:1})]),_:1})):v("",!0),t.notasOutras.length?(r(),f(U,{key:2,name:"notasOutras",class:"q-pa-none transparent"},{default:a(()=>[e(w,{class:"rounded-borders"},{default:a(()=>[(r(!0),k(F,null,x(t.notasOutras,i=>(r(),f(n,{key:i.id,nota:i},null,8,["nota"]))),128))]),_:1})]),_:1})):v("",!0)]),_:1},8,["modelValue"])],64)):(r(),k("div",ne,o[6]||(o[6]=[b("p",null,[b("small",null,"N\xE3o h\xE1 notas com o filtro selecionado")],-1)]))),e(q,{onFechar:s.fechouNFe},null,8,["onFechar"])])}var pe=z(te,[["render",re]]);export{pe as default};
