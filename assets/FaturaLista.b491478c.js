import{_ as I,r as b,o as f,p as g,f as n,w as v,d as A,e as T,H as U,P as _,F as B,u as M,b5 as j}from"./index.828e7912.js";import"./xlsx.3efd898e.js";import{L as N}from"./Lista.4038e52f.js";import{F as P}from"./FaturaCard.fe312b81.js";import{F as H}from"./FaturaModal.5c89408b.js";import"./emitirNFe.35117289.js";import"./nfePrincipal.bbf39465.js";import"./compactarValidarNFe.a27c0c55.js";import"./obterItens.ff311c4f.js";import"./codigosANP.a6c1a264.js";import"./DocumentosFiscais.cc0f43d6.js";import"./Campo.b3837f72.js";import"./ModalHistoricoStatus.bcacc410.js";import"./VendaCard.56a5e351.js";import"./EnvelopeCard.1fe2970b.js";const Q={components:{Lista:N,FaturaCard:P,FaturaModal:H},data(){return{carregar:!1,itens:[],usuario:"",permissao:{vendedoresDigitadores:!1,outrasEmpresas:!1},lista:[],mostrar:{barraTopo:!0,toolbarTitulo:!0,icone:"request_quote",titulo:"Faturas",buscar:!0,filtroAvancado:!0,btnAjuda:!0,btnAtualizar:!0,btnNovo:!1,toolbarAcoes:!0,checkBox:!1,btnRemover:!1,btnRestaurar:!1,centralizaTabs:!1,btnDetalhes:!0,btnExportaXLS:!1,btnMenuMais:!1,toolbarAdicao:!1,bannerMsg:""},busca:"",detalhesVisivel:!1,tabSelecionada:{valor:""},tabs:[{valor:"Aberta",rotulo:"Abertas"},{valor:"Finalizada",rotulo:"Finalizado"},{valor:"",rotulo:"Todas"}],filtrosOriginal:{},filtros:{cliente:null,idEmpresa:null,idContatoVendedor:null,idContatoDigitador:null,statusEnvio:null,tipoData:"Data Emiss\xE3o",data:{ini:"",fim:""},valorTotal:0},empresaOpcoes:[],vendedoresOpcoes:[],opcoesEnvio:[{value:"Enviados",label:"Enviados"},{value:"N\xE3o Enviados",label:"N\xE3o Enviados"}],opcoesData:[{value:"Data Emiss\xE3o",label:"Data Emiss\xE3o"},{value:"Data Finaliza\xE7\xE3o",label:"Data Finaliza\xE7\xE3o"}],paginacao:{atual:1,maximo:1,total:1,limite:25}}},methods:{async atualizar(o){var i,e,r,a,m,l,c,p,h,s,V,D,E,F,C,y,q,w,k,z,O,S,x;try{$q.loading.show(),this.carregar=!1,this.itens=[];let{buscarDadosRecentes:L}=o!=null?o:{},t={},u={};L&&(t=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:"FaturaLista_"+((i=this.usuario)==null?void 0:i.id)}),t!=null&&t._id&&(this.tabSelecionada.valor=t==null?void 0:t.tabSelecionada,this.busca=(t==null?void 0:t.busca)||"",this.filtros={cliente:((e=t==null?void 0:t.filtros)==null?void 0:e.cliente)||null,idEmpresa:((r=t==null?void 0:t.filtros)==null?void 0:r.idEmpresa)||null,idContatoVendedor:((a=t==null?void 0:t.filtros)==null?void 0:a.idContatoVendedor)||null,idContatoDigitador:((m=t==null?void 0:t.filtros)==null?void 0:m.idContatoDigitador)||null,statusEnvio:((l=t==null?void 0:t.filtros)==null?void 0:l.statusEnvio)||null,tipoData:((c=t==null?void 0:t.filtros)==null?void 0:c.tipoData)||"Data Emiss\xE3o",data:{ini:((h=(p=t==null?void 0:t.filtros)==null?void 0:p.data)==null?void 0:h.ini)||"",fim:((V=(s=t==null?void 0:t.filtros)==null?void 0:s.data)==null?void 0:V.fim)||""},valorTotal:((D=t==null?void 0:t.filtros)==null?void 0:D.valorTotal)||0},this.paginacao.atual=(t==null?void 0:t.page)||1,this.paginacao.limite=(t==null?void 0:t.limit)||25,this.compareObject(this.filtrosOriginal,this.filtros)&&(this.$refs.faturaLista.filtros=!0))),this.busca=((E=this.busca)==null?void 0:E.trim())||"",this.filtros.termoBusca=this.busca,this.filtros.cliente=(C=(F=this.filtros)==null?void 0:F.cliente)==null?void 0:C.trim(),this.filtros=$utils.eliminarVazios(this.filtros),this.filtros.status=this.tabSelecionada.valor,u=$utils.clonarV2(this.filtros),this.filtros.tipoData==="Data Emiss\xE3o"&&(u.periodo={dataIni:(q=(y=this.filtros)==null?void 0:y.data)==null?void 0:q.ini,dataFim:(k=(w=this.filtros)==null?void 0:w.data)==null?void 0:k.fim}),this.filtros.tipoData==="Data Finaliza\xE7\xE3o"&&(u.finalizado={dataIni:(O=(z=this.filtros)==null?void 0:z.data)==null?void 0:O.ini,dataFim:(x=(S=this.filtros)==null?void 0:S.data)==null?void 0:x.fim}),this.permissao.vendedoresDigitadores||(u.idContatoVendedor=this.usuario.id),delete u.tipoData,delete u.data,/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/.test(this.busca)&&(delete u.termoBusca,this.tabSelecionada.valor="",this.filtros.status="",u.status="",u.idFatura=this.busca);const d=await $db.fatura.leListaCompleta({filtros:u,page:this.paginacao.atual,limit:this.paginacao.limite,sort:["dataHoraFinalizado","dataHoraEmissao"],dir:["desc","desc"]});this.lista=d==null?void 0:d.data,this.paginacao.total=d==null?void 0:d.total,this.paginacao.maximo=d==null?void 0:d.totalPages,t={_id:"FaturaLista_"+this.usuario.id,tabSelecionada:this.tabSelecionada.valor,busca:this.filtros.termoBusca,filtros:$utils.clonarV2(this.filtros),page:this.paginacao.atual,limit:this.paginacao.limite},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:t})}catch{$q.notify({message:"Erro ao carregar faturas.",type:"negative"}),$q.loading.hide()}finally{if(this.lista.length===0){this.carregar=!0,$q.loading.hide();return}this.carregar||setTimeout(async()=>{this.carregar=!0,$q.loading.hide()},2e3)}},async executar(o){if(this.$refs.faturaModal.venda.status){for(const i of this.tabs)if(i.valor.indexOf(this.$refs.faturaModal.venda.status)!==-1){this.tabSelecionada.valor=i.valor;break}this.$refs.faturaModal.venda.status==="Or\xE7amento"&&(this.filtros.data="Data Emiss\xE3o")}await this.atualizar()},detalhesClick(){this.detalhesVisivel=!this.detalhesVisivel,this.lista.forEach(o=>{this.$refs[o.id][0].detalhesVisivel=this.detalhesVisivel})},async limparFiltrosClick(){this.filtros=$utils.clonar(this.filtrosOriginal),await this.atualizar()},async configurarPermissao(){this.permissao={vendedoresDigitadores:await $db.permissao.objeto("Diretiva_RelatorioVenda_VerTodos"),outrasEmpresas:await $db.permissao.objeto("Diretiva_Venda/Fatura_OutrasLojas_VerTodos")}},async configurarVendedores(){const o=(await $db.contato.ler({filtros:{ativo:!0,vendedores:!0}})).data;o==null||o.sort((i,e)=>{var r;return(r=i==null?void 0:i.nome)==null?void 0:r.localeCompare(e==null?void 0:e.nome)}),o.forEach(i=>{this.vendedoresOpcoes.push({label:i.nome,value:i.id})})},async configurarEmpresas(){const o=[];let i=[];if(!this.permissao.outrasEmpresas){i=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;for(const e of i)o.push({label:e.nome,value:e.id})}if(this.permissao.outrasEmpresas){i=await $db.empresa.ler({filtro:{ativo:!0}});for(const e of i)o.push({label:e.nome,value:e.idContato})}this.empresaOpcoes=o==null?void 0:o.sort((e,r)=>{var a;return(a=e==null?void 0:e.label)==null?void 0:a.localeCompare(r==null?void 0:r.label)})},async abrirItem(o){this.$router.replace({params:{id:o}}).finally(()=>{this.$refs.faturaModal.mostrar({id:o})})},compareObject(o,i,e=[]){const r=Object.keys(o);for(const a of r)if(!e.includes(a)){if(typeof o[a]=="object"&&o[a]!==null){if(!this.compareObject(o[a],i[a],e))continue;return!0}else if(o[a]!==i[a])return!0}return!1},async carregou(o){if(this.itens.push({id:o}),this.itens.length>=25||this.itens.length===this.lista.length){this.carregar=!0,$q.loading.hide();return}}},async created(){this.usuario=JSON.parse(localStorage.getItem("usuario")),this.filtrosOriginal=$utils.clonar(this.filtros),await this.configurarPermissao(),await this.configurarVendedores(),await this.configurarEmpresas(),this.$route.params.id&&this.$route.params.id.length?(this.abrirItem(this.$route.params.id),this.busca=this.$route.params.id,await this.atualizar()):await this.atualizar({buscarDadosRecentes:!0})}},J={id:"FaturaLista"};function X(o,i,e,r,a,m){const l=b("campo"),c=b("FaturaCard"),p=b("Lista"),h=b("fatura-modal");return f(),g("div",J,[n(p,{ref:"faturaLista",busca:a.busca,"onUpdate:busca":i[10]||(i[10]=s=>a.busca=s),onAtualizar:m.atualizar,onLimparFiltrosClick:m.limparFiltrosClick,onDetalhesClick:m.detalhesClick,lista:a.lista,tabSelecionada:a.tabSelecionada,tabs:a.tabs,paginacao:a.paginacao,mostrar:a.mostrar},{filtroCampos:v(()=>[n(l,{modelValue:a.filtros.cliente,"onUpdate:modelValue":i[0]||(i[0]=s=>a.filtros.cliente=s),debounce:500,before:[{icon:"search"}],dense:"",rotulo:"Por cliente ou respons\xE1vel",class:"col-12 q-mt-md"},null,8,["modelValue"]),n(l,{modelValue:a.filtros.idEmpresa,"onUpdate:modelValue":i[1]||(i[1]=s=>a.filtros.idEmpresa=s),options:a.empresaOpcoes,clearable:"",dense:"",tipo:"seletor",rotulo:"Por empresa",class:"col-12 q-mt-lg"},null,8,["modelValue","options"]),a.permissao.vendedoresDigitadores?(f(),A(l,{key:0,modelValue:a.filtros.idContatoVendedor,"onUpdate:modelValue":i[2]||(i[2]=s=>a.filtros.idContatoVendedor=s),options:a.vendedoresOpcoes,clearable:"",dense:"",tipo:"seletor",rotulo:"Vendedor",class:"col-12 q-mt-lg"},null,8,["modelValue","options"])):T("",!0),a.permissao.vendedoresDigitadores?(f(),A(l,{key:1,modelValue:a.filtros.idContatoDigitador,"onUpdate:modelValue":i[3]||(i[3]=s=>a.filtros.idContatoDigitador=s),options:a.vendedoresOpcoes,clearable:"",dense:"",tipo:"seletor",rotulo:"Digitador",class:"col-12 q-mt-lg"},null,8,["modelValue","options"])):T("",!0),n(l,{modelValue:a.filtros.statusEnvio,"onUpdate:modelValue":i[4]||(i[4]=s=>a.filtros.statusEnvio=s),options:a.opcoesEnvio,clearable:"",dense:"",tipo:"seletor",rotulo:"Status Envio",class:"col-12 q-mt-lg"},null,8,["modelValue","options"]),n(l,{modelValue:a.filtros.tipoData,"onUpdate:modelValue":i[5]||(i[5]=s=>a.filtros.tipoData=s),options:a.opcoesData,tipo:"seletor",dense:"",rotulo:"Selecionar data para filtro",class:"col-12 q-mt-xl"},null,8,["modelValue","options"]),n(l,{modelValue:a.filtros.data.ini,"onUpdate:modelValue":i[6]||(i[6]=s=>a.filtros.data.ini=s),clearable:"",dense:"",tipo:"data",rotulo:"Emiss\xE3o de",class:"col-12 q-mt-md"},null,8,["modelValue"]),n(l,{modelValue:a.filtros.data.fim,"onUpdate:modelValue":i[7]||(i[7]=s=>a.filtros.data.fim=s),clearable:"",dense:"",tipo:"data",rotulo:"Emiss\xE3o at\xE9",class:"col-12 q-mt-xs"},null,8,["modelValue"]),n(l,{modelValue:a.filtros.valorTotal,"onUpdate:modelValue":i[8]||(i[8]=s=>a.filtros.valorTotal=s),debounce:500,dense:"",tipo:"decimal",min:"0",decimals:"4",zerosDireita:"2",rotulo:"Valor total maior que",class:"col-12 q-mt-xl"},null,8,["modelValue"]),n(l,{modelValue:a.paginacao.limite,"onUpdate:modelValue":i[9]||(i[9]=s=>a.paginacao.limite=s),tipo:"quantidade",dense:"",rotulo:"Quantidade por p\xE1gina",min:"1",class:"col-12 q-mt-xl"},null,8,["modelValue"])]),itemLista:v(()=>[U(n(_,{bordered:"",class:"bg-white q-mb-xs rounded-borders"},{default:v(()=>[(f(!0),g(B,null,M(a.lista,s=>(f(),g("div",{key:s.id,class:"itemHover"},[n(c,{onExecutar:m.executar,onCarregou:m.carregou,ref_for:!0,ref:s.id,id:s.id,layout:"lista"},null,8,["onExecutar","onCarregou","id"])]))),128))]),_:1},512),[[j,a.carregar]])]),_:1},8,["busca","onAtualizar","onLimparFiltrosClick","onDetalhesClick","lista","tabSelecionada","tabs","paginacao","mostrar"]),n(h,{ref:"faturaModal"},null,512)])}var da=I(Q,[["render",X]]);export{da as default};
