import{_ as I,a as P,bs as T,r as L,o as g,p as O,f as t,w as s,H as F,d as b,S as N,T as m,j as w,k as f,N as R,e as C,P as U,F as J,u as X,C as S,U as $,Q as _,m as V,t as y,be as B,l as H,z as Q,h as Y,i as Z,O as G,E as W,as as K,D as aa}from"./index.3e77a1c7.js";import{X as A}from"./xlsx.7dff5201.js";import{L as oa}from"./Lista.b2535a07.js";import{N as ta}from"./Nfse.0fdf2f7b.js";import{J as ea}from"./JsonViewer.121260d1.js";import"./optionsNfse.12d4a18d.js";const ia={components:{Lista:oa,Nfse:ta,JsonViewer:ea},data(){return{usuario:"",listaLayout:[],lista:[],mostrar:{header:!0,barraTopo:!0,toolbarTitulo:!0,icone:"mdi-file-replace-outline",titulo:"NFS-e",buscar:!0,filtroAvancado:!0,btnAjuda:!0,btnAtualizar:!0,btnNovo:!0,toolbarAcoes:!0,checkBox:!1,btnRemover:!1,btnRestaurar:!1,centralizaTabs:!1,btnDetalhes:!0,btnExportaXLS:!1,btnMenuMais:!0,toolbarAdicao:!1,bannerMsg:""},busca:"",im:"",filtrosOriginal:{},filtros:{emitente:null,destinatario:null,numeroRps:null,numeroNfse:null,dataEmissaoNfseDe:null,dataEmissaoNfseAte:null,dataCriacaoRpsDe:null,dataCriacaoRpsAte:null},tabSelecionada:{valor:"Rascunho"},tabs:[{valor:"Rascunho",rotulo:"Rascunho"},{valor:"Protocolada",rotulo:"Protocoladas"},{valor:"Enviada",rotulo:"Enviadas"},{valor:"Cancelada",rotulo:"Canceladas"},{valor:"Todos",rotulo:"Todos"}],detalhes:!0,paginacao:{atual:1,maximo:1,total:1,limite:25,ordenacao:"dataEmissao",direcao:"desc"},dialogoSincronizarLote:{visivel:!1,empresa:null,listaEmpresas:[],periodoInicial:null,periodoFinal:null}}},computed:{ordenacaoOpcoes(){return[{value:"dataEmissao",label:"Data de emiss\xE3o"},{value:"dataHoraCriacao",label:"Data de cria\xE7\xE3o"},{value:"numeroRps",label:"RPS (Recibo provis\xF3rio)"},{value:"numeroNfse",label:"N\xFAmero NFS-e"},{value:"xNomeEmitente",label:"Emitente"},{value:"xNomeDestinatario",label:"Destinat\xE1rio"},{value:"valor",label:"Valor"}]},direcaoOpcoes(){return[{value:"asc",label:"Crescente"},{value:"desc",label:"Decrescente"}]}},methods:{async atualizar(l){var i,n,d,c,u,p,v,h,E,D,z;const a=$utils.logarIni("NfseLista");this.filtros.termoBusca=null,this.filtros.id=null;let e=(l==null?void 0:l.buscarDadosRecentes)||!1,o={};e&&(o=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:"NfseLista_"+((i=this.usuario)==null?void 0:i.id)}),o!=null&&o._id&&(this.tabSelecionada.valor=(o==null?void 0:o.tabSelecionada)||"Rascunho",this.busca=(o==null?void 0:o.busca)||"",this.filtros={emitente:((n=o==null?void 0:o.filtros)==null?void 0:n.emitente)||null,destinatario:((d=o==null?void 0:o.filtros)==null?void 0:d.destinatario)||null,numeroRps:((c=o==null?void 0:o.filtros)==null?void 0:c.numeroRps)||null,numeroNfse:((u=o==null?void 0:o.filtros)==null?void 0:u.numeroNfse)||null,dataEmissaoNfseDe:((p=o==null?void 0:o.filtros)==null?void 0:p.dataEmissaoNfseDe)||null,dataEmissaoNfseAte:((v=o==null?void 0:o.filtros)==null?void 0:v.dataEmissaoNfseAte)||null,dataCriacaoRpsDe:((h=o==null?void 0:o.filtros)==null?void 0:h.dataCriacaoRpsDe)||null,dataCriacaoRpsAte:((E=o==null?void 0:o.filtros)==null?void 0:E.dataCriacaoRpsAte)||null},this.compareObject(this.filtrosOriginal,this.filtros,["id","termoBusca"])&&(this.$refs.nfseLista.filtros=!0))),l!=null&&l.id&&(this.busca=l==null?void 0:l.id),this.busca&&(this.paginacao.atual=1,/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/.test(this.busca)?(this.tabSelecionada.valor="Todos",this.filtros.id=this.busca):this.filtros.termoBusca=this.busca),await $tryLoading(async()=>$db.hibrido.isOnline()?this.atualizarOnline(l):this.atualizarOffline(l)),o={_id:"NfseLista_"+this.usuario.id,tabSelecionada:this.tabSelecionada.valor,busca:this.busca||"",filtros:$utils.clonar(this.filtros)},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:o}),$utils.logarFim(a,(z=(D=this.paginacao)==null?void 0:D.total)!=null?z:1)},async atualizarOffline(l){this.documentos=await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{tipo:"NFSe"}});for(const o of this.documentos){const{rps:i}=JSON.parse(o.json);o.rps=i}const a=this.paginacao.direcao==="asc"?1:-1,e={numeroRps:(o,i)=>{var n,d;return(Number(((n=o.rps.identificacaoRps)==null?void 0:n.numero)||0)-Number(((d=i.rps.identificacaoRps)==null?void 0:d.numero)||0))*a},numeroNfse:(o,i)=>(Number(o.rps.numero||0)-Number(i.rps.numero||0))*a,valor:(o,i)=>{var n,d,c,u;return(Number(((d=(n=o.rps.servico)==null?void 0:n.valores)==null?void 0:d.valorServicos)||0)-Number(((u=(c=i.rps.servico)==null?void 0:c.valores)==null?void 0:u.valorServicos)||0))*a},dataEmissao:(o,i)=>(new Date(o.rps.dataEmissao||0)-new Date(i.rps.dataEmissao||0))*a,dataHoraCriacao:(o,i)=>(new Date(o.rps.dataHoraCriacao||0)-new Date(i.rps.dataHoraCriacao||0))*a,xNomeEmitente:(o,i)=>String(o.xNomeEmitente).localeCompare(String(i.xNomeEmitente))*a,xNomeDestinatario:(o,i)=>String(o.xNomeDestinatario).localeCompare(String(i.xNomeDestinatario))*a}[this.paginacao.ordenacao];this.documentos=this.documentos.sort(e),await this.aplicarFiltrosEPaginacao()},async atualizarOnline(){this.lista=[],this.tabSelecionadaAnt!==this.tabSelecionada.valor&&(this.paginacao.atual=1),this.tabSelecionadaAnt=this.tabSelecionada.valor,this.filtros.situacao=this.tabSelecionada.valor==="Todos"?null:this.tabSelecionada.valor;const l={numeroRps:"cast(JSON_VALUE(json, '$.rps.identificacaoRps.numero') as int)",numeroNfse:"cast(JSON_VALUE(json, '$.rps.numero') as int)",dataEmissao:"JSON_VALUE(json, '$.rps.dataEmissao')",dataHoraCriacao:"JSON_VALUE(json, '$.rps.dataHoraCriacao')",valor:"cast(JSON_VALUE(json, '$.rps.servico.valores.valorServicos') as decimal(10,2))"}[this.paginacao.ordenacao]||this.paginacao.ordenacao,a=await $utils.geeksApi({listaNfse:{funcao:"C79B2497-0D9C-4971-8656-2C04FF41F247",where:this.filtros,limit:this.paginacao.limite,page:this.paginacao.atual,sort:[l],dir:[this.paginacao.direcao]}}),{data:e,total:o,totalPages:i}=a.data.listaNfse;let n=!0;for(const d of e)this.listaLayout.hasOwnProperty(d.id)||(this.listaLayout[d.id]={detalhes:!1}),this.listaLayout[d.id].detalhes||(n=!1);this.$refs.nfseLista.detalhes=e!=null&&e.length?n:!1,this.lista=e,this.paginacao.total=o,this.paginacao.maximo=i},async mostrarNfse(l){this.$router.replace({params:{id:l}}),await this.$refs.modalNfse.show(l)},async selecionarEmpresa(){let l;const a={ativo:!0,empresas:!0},e=await $g.promptContato.show({filtro:a,placeholder:"Selecione"});if(!e)throw new Error("Nenhum contato selecionado");e.nome||(l="\xC9 preciso informar a Raz\xE3o Social do Prestador"),!l&&!e.numeroDocumentoMunicipal&&(l="\xC9 preciso informar a inscri\xE7\xE3o municipal");const o=!e.numeroDocumentoNacional||e.numeroDocumentoNacional.length<14;if(!l&&o&&(l="\xC9 preciso informar o CNPJ do Prestador"),l)throw $q.notifyError(l),new Error(l);return e},async criarRps(){var l;try{const a=await this.selecionarEmpresa(),e=(await $db.empresa.le({idContato:a.id}))[0],o=await $db.contatoEndereco.leEnderecoPrincipal(a.id),i={documento:a.numeroDocumentoNacional.match(/\d+/g).join(""),nome:a.nome,inscricaoMunicipal:a.numeroDocumentoMunicipal,nfseOptanteSimples:(e==null?void 0:e.nfseOptanteSimples)||"",nfseIncentivadorCultural:(e==null?void 0:e.nfseIncentivadorCultural)||"",nfseNaturezaOperacao:(e==null?void 0:e.nfseNaturezaOperacao)||"",nfseRegimeTributario:(e==null?void 0:e.nfseRegimeTributario)||"",nfseDescricaoServico:(e==null?void 0:e.nfseDescricaoServico)||"",nfseCodigoServico:(e==null?void 0:e.nfseCodigoServico)||"",nfseAliquotaIss:e==null?void 0:e.nfseAliquotaIss,nfseItensListaDeServico:JSON.parse(e==null?void 0:e.nfseItensListaDeServico)||"",ibgeCod:(o==null?void 0:o.ibgeCod)||"",cidadeUf:(o==null?void 0:o.municipio)+"-"+(o==null?void 0:o.uf)};this.im=(l=a==null?void 0:a.numeroDocumentoMunicipal)!=null?l:"";const n=await this.obterNFSeRPSMaisRecente();$utils.gconsole.log("NfseLista",{im:this.im,nfseRPSMaisRecente:n}),this.$refs.modalNfse.show(null,i,n)}catch(a){console.log(a.message)}},async obterNFSeRPSMaisRecente(){var l,a;if($db.hibrido.isOnline()){const e=await $utils.geeksApi({listaNfse:{funcao:"C79B2497-0D9C-4971-8656-2C04FF41F247",where:{inscricaoMunicipal:this.im},limit:1,page:1,sort:["cast(JSON_VALUE(json, '$.rps.identificacaoRps.numero') as int)"],dir:["desc"]}}),{data:o}=e.data.listaNfse;return(l=o[0])!=null?l:null}else{let e;e=await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{tipo:"NFSe"}}),this.im&&(e=e.filter(i=>JSON.parse(i.json).rps.inscricaoMunicipal===this.im)),e.sort((i,n)=>{var u,p,v,h,E,D,z,q;const d=Number((h=(v=(p=JSON.parse((u=i.json)!=null?u:null))==null?void 0:p.rps)==null?void 0:v.identificacaoRps)==null?void 0:h.numero),c=Number((q=(z=(D=JSON.parse((E=n.json)!=null?E:null))==null?void 0:D.rps)==null?void 0:z.identificacaoRps)==null?void 0:q.numero);return d>c?-1:1});const o=(a=e[0])!=null?a:null;return o!=null&&o.json&&(o.rps=JSON.parse(o.json).rps),o}},async aplicarFiltrosEPaginacao(l){var n,d;if(this.tabSelecionadaAnt!==this.tabSelecionada.valor&&(this.paginacao.atual=1),this.tabSelecionadaAnt=this.tabSelecionada.valor,this.tabSelecionada.valor==="Todos"?this.listaTmp=this.documentos:this.listaTmp=this.documentos.filter(c=>c.situacao===this.tabSelecionada.valor),this.filtros.id&&(this.paginacao.atual=1,this.listaTmp=this.listaTmp.filter(c=>c.id===this.filtros.id)),this.filtros.termoBusca){const c=this.filtros.termoBusca,u=new RegExp(c,"i");this.listaTmp=this.listaTmp.filter(p=>u.test(p.xNomeDestinatario))}if(this.filtros.emitente){const c=new RegExp(this.filtros.emitente,"i");this.listaTmp=this.listaTmp.filter(u=>c.test(u.xNomeEmitente))}if(this.filtros.destinatario){const c=this.filtros.destinatario,u=new RegExp(c,"i");this.listaTmp=this.listaTmp.filter(p=>u.test(p.xNomeDestinatario))}if(this.filtros.numeroRps){const c=new RegExp(this.filtros.numeroRps);this.listaTmp=this.listaTmp.filter(u=>c.test(u.rps.identificacaoRps.numero))}if(this.filtros.numeroNfse&&(this.listaTmp=this.listaTmp.filter(c=>c.rps.numero===this.filtros.numeroNfse)),this.filtros.dataEmissaoNfseDe&&this.filtros.dataEmissaoNfseDe.length===10){const c=this.filtros.dataEmissaoNfseDe.split("/"),u=new Date(Number(c[2]),Number(c[1])-1,Number(c[0]));this.listaTmp=this.listaTmp.filter(p=>new Date(new Date(p.rps.dataEmissao).toDateString())>=u)}if(this.filtros.dataEmissaoNfseAte&&this.filtros.dataEmissaoNfseAte.length===10){const c=this.filtros.dataEmissaoNfseAte.split("/"),u=new Date(Number(c[2]),Number(c[1])-1,Number(c[0]));this.listaTmp=this.listaTmp.filter(p=>new Date(new Date(p.rps.dataEmissao).toDateString())<=u)}if(this.filtros.dataCriacaoRpsDe&&this.filtros.dataCriacaoRpsDe.length===10){const c=this.filtros.dataCriacaoRpsDe.split("/"),u=new Date(Number(c[2]),Number(c[1])-1,Number(c[0]));this.listaTmp=this.listaTmp.filter(p=>new Date(new Date(p.rps.dataHoraCriacao).toDateString())>=u)}if(this.filtros.dataCriacaoRpsAte&&this.filtros.dataCriacaoRpsAte.length===10){const c=this.filtros.dataCriacaoRpsAte.split("/"),u=new Date(Number(c[2]),Number(c[1])-1,Number(c[0]));this.listaTmp=this.listaTmp.filter(p=>new Date(new Date(p.rps.dataHoraCriacao).toDateString())<=u)}const a=Math.ceil(this.listaTmp.length/this.paginacao.limite);this.paginacao.atual=this.paginacao.atual>a?a:this.paginacao.atual,this.paginacao.total=this.listaTmp.length,this.paginacao.maximo=a;const e=this.paginacao.atual*this.paginacao.limite-this.paginacao.limite,o=this.paginacao.atual*this.paginacao.limite;this.lista=this.listaTmp.slice(e,o);let i=!0;for(const c of this.lista)this.listaLayout.hasOwnProperty(c.id)||(this.listaLayout[c.id]={detalhes:!1}),(n=this.listaLayout[c.id])!=null&&n.detalhes||(i=!1);this.$refs.nfseLista.detalhes=(d=this.lista)!=null&&d.length?i:!1},async limparFiltrosClick(){this.filtros=$utils.clonar(this.filtrosOriginal),await this.atualizar()},detalhesClick(){this.detalhes=!this.detalhes,this.lista.forEach(l=>{this.abrirDetalhes(l,this.detalhes)})},async abrirDetalhes(l,a){var e;this.listaLayout[l.id].detalhes=a||!((e=this.listaLayout[l.id])!=null&&e.detalhes),this.verificarListaLayout("detalhes")},verificarListaLayout(l){{let a=!0;for(const e of this.lista)this.listaLayout[e.id].detalhes||(a=!1);this.detalhes=a,this.$refs.nfseLista.detalhes=a}},async exportaXLSClick(){try{$q.loading.show();const l=$utils.eliminarVazios(this.filtros);delete l.ativo,this.tabSelecionada.valor==="Ativos"&&(l.ativo=!0),this.tabSelecionada.valor==="Excluidos"&&(l.ativo=!1);const a=await $db.item.leRefatorado({filtros:l,limit:999999,page:1,sort:"descricao"}),e=A.utils.book_new(),o=A.utils.json_to_sheet(a.data,{header:Object.keys(a.data[0])});A.utils.book_append_sheet(e,o,"itens"),A.writeFile(e,"itens.xlsx")}catch(l){$q.notifyError("Erro iniciar",l)}finally{$q.loading.hide()}},abrirModalDeCancelamento(l){$q.dialog({title:"Cancelar NFS-e",message:"Qual o motivo do cancelamento?",prompt:{model:"",isValid:a=>!!a},cancel:!0,persistent:!0}).onOk(async a=>{const{rps:e}=l,o={numero:e.numero,motivoCancelamento:a,inscricaoMunicipal:e.prestador.inscricaoMunicipal,cnpj:e.prestador.documento,codigoMunicipio:e.servico.municipioPrestacaoServico,codigoCancelamento:5};await this.cancelarNfse(o,l)})},async cancelarNfse(l,a){var e,o,i,n,d;this.$q.loading.show();try{if((e=a.rps)!=null&&e.plugNotasConsulta){console.log("cancelamento via plugNotas");const c={motivo:l.motivoCancelamento},u=await $api.plugnotas.nfse.solicitarCancelamentoNFSe((o=a.rps.plugNotasConsulta)==null?void 0:o.id,c);if((u==null?void 0:u.message)==="Cancelamento em processamento"&&((i=u==null?void 0:u.data)==null?void 0:i.protocol))if((await $api.plugnotas.nfse.consultarCancelamentoNFSe((n=u==null?void 0:u.data)==null?void 0:n.protocol)).data.status==="CONCLUIDO"){a.rps.motivoCancelamento=l.motivoCancelamento,a.rps.status="2";const v={...a,situacao:"Cancelada",json:JSON.stringify({rps:a.rps})};await $db.documentoFiscalEletronico.grava({atual:v,original:a});let h={};v.id&&(h=(await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:v.id}}))[0],await $db.documentoFiscalEletronicoXml.grava({atual:{...h,situacao:v.situacao},original:h})),$q.notifyPositive("NFS-e cancelada!")}else $q.notifyError("N\xE3o foi poss\xEDvel realizar o cancelamento, por favor tente novamente!")}if(!((d=a.rps)!=null&&d.plugNotasConsulta))if((await P.post("https://api.b15.com.br/integradorjs/nfse/cancelar",{jsonParaXML:l})).data.xmlPassou){$q.notifyPositive("NFS-e cancelada!"),a.rps.motivoCancelamento=l.motivoCancelamento,a.rps.status="2";const u={...a,situacao:"Cancelada",json:JSON.stringify({rps:a.rps})};await $db.documentoFiscalEletronico.grava({atual:u,original:a});let p={};u.id&&(p=(await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:u.id}}))[0],await $db.documentoFiscalEletronicoXml.grava({atual:{...p,situacao:u.situacao},original:p}))}else $q.notifyError("N\xE3o foi poss\xEDvel realizar o cancelamento, por favor tente novamente!")}catch{$q.notifyError("Falha ao enviar XML")}await this.atualizar(),this.$q.loading.hide()},confirmarExclusaoNfse(l){$q.dialog({title:"Remover NFS-e",message:"Deseja remover esta NFS-e?",cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(async()=>{try{await $db.documentoFiscalEletronico.remove(l),$q.notifyPositive("NFS-e removida com sucesso")}catch{$q.notifyError("Falha ao remover NFS-e")}await this.atualizar()})},async downloadPDF(l){var o;let a=await $db.hibrido.le({table:"documentoFiscalEletronico",id:l}),e=JSON.parse((o=a==null?void 0:a.json)!=null?o:null);try{$q.loading.show({message:"Solicitando URL...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"}),e.rps.pdf=await $db.nfse.solicitarURLImpressao(l);let i=document.createElement("a");i.href=e.rps.pdf,i.download=`nfse-${e.rps.identificacaoRps.numero}.pdf`,i.click()}catch(i){console.error(i.message)}finally{$q.loading.hide()}},async solicitarURLImpressao(l){var i,n,d;let a=await $db.hibrido.le({table:"documentoFiscalEletronico",id:l}),e=JSON.parse((i=a==null?void 0:a.json)!=null?i:null),o;try{$q.loading.show({message:"Solicitando URL...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"}),o=await $db.nfse.solicitarURLImpressao(l),(n=e==null?void 0:e.rps)!=null&&n.plugNotasConsulta&&window.open("","_blank").document.write(`<iframe width='100%' height='100%' src='${o}'></iframe>`),(d=e==null?void 0:e.rps)!=null&&d.plugNotasConsulta||window.open(o,"_blank"),await this.atualizar()}catch(c){let u=c.message.replace("db.nfse.sincronizarLote: ","");u.length!==c.message&&$q.notifyError(u),u.length===c.message&&console.error(c.message)}finally{$q.loading.hide()}},async solicitarURLImpressaoEmLote(){var a;const l=$utils.clonarV2(this.lista.filter(e=>e.situacao==="Enviada"));l.sort((e,o)=>{var d,c,u,p;const i=(c=(d=e==null?void 0:e.rps)==null?void 0:d.identificacaoRps)==null?void 0:c.numero,n=(p=(u=o==null?void 0:o.rps)==null?void 0:u.identificacaoRps)==null?void 0:p.numero;return i>n?1:-1});for(const e of l)try{let o=await $db.hibrido.le({table:"documentoFiscalEletronico",id:e.id}),i=JSON.parse((a=o==null?void 0:o.json)!=null?a:null),n;n=await $db.nfse.solicitarURLImpressao(e.id)}catch(o){console.log(o.message)}},async baixarXml(l){var o,i;let{xml:a}=l.rps;if((!a||/^https:\/\/.+$/.test(a))&&((i=(o=l.rps)==null?void 0:o.plugNotasConsulta)==null?void 0:i.xml)){const n=l.rps.plugNotasConsulta.xml;a=await $api.plugnotas.nfse.baixarXmlNFSe(n,l)}if(a){const n=document.createElement("a");var e=new Blob([a],{type:"text/plain"});n.setAttribute("href",window.URL.createObjectURL(e)),n.setAttribute("download",`${l.rps.identificacaoRps.numero}.xml`),n.dataset.downloadurl=["text/plain",n.download,n.href].join(":"),n.click()}a||this.$q.notifyError("N\xE3o foi poss\xEDvel recuperar o XML")},async recarregarPDF(l){var i,n,d;let a=await $db.hibrido.le({table:"documentoFiscalEletronico",id:l}),e=$utils.clonarV2(a),o=JSON.parse((i=a==null?void 0:a.json)!=null?i:null);(n=o.rps.plugNotasConsulta)!=null&&n.pdf&&((d=o.rps.plugNotasConsulta)==null||delete d.pdf),o.rps.pdf&&delete o.rps.pdf,a.json=o,await $db.documentoFiscalEletronico.grava({atual:a,original:e}),this.solicitarURLImpressao(l)},async enviarEmailNfse(l){var a,e;try{if(this.$q.loading.show(),!l.cpfCnpjDestinatario||!l.id)return;const o=await $db.hibrido.le({table:"documentoFiscalEletronico",id:l.id});if(!(o!=null&&o.id))return;const n=(await $db.contato.ler({filtros:{termoBusca:o.cpfCnpjDestinatario,ativo:!0}})).data.find(v=>{var h;return((h=v.numeroDocumentoNacional)!=null?h:"").replace(/\D/g,"")===o.cpfCnpjDestinatario}),d=(e=JSON.parse((a=o.json)!=null?a:null))==null?void 0:e.rps;if(!d)return;let c;this.$q.loading.hide();try{c=await new Promise((v,h)=>{var E;$q.dialog({title:"Informe o e-mail",message:"E-mail do destinat\xE1rio",prompt:{model:(E=n==null?void 0:n.email)!=null?E:"",isValid:D=>/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(D.toLowerCase()),type:"text"},cancel:!0,persistent:!1}).onOk(D=>{v(D)}).onCancel(()=>{h("Cancelado pelo usu\xE1rio")}).onDismiss(()=>{h("Cancelado pelo usu\xE1rio")})}).catch(v=>{throw new Error(v)})}catch(v){console.log(v.message);return}this.$q.loading.show();const u=[{name:"nfse.xml",content:d.xml}];d.link&&u.push({name:"nfse.pdf",url:d.link,method:"url2pdf"});const p={host:"smtp.gmail.com",port:587,ssl:!0,auth:{user:"auto@geekssolucoes.com.br",pass:"xpto@9@9"},from:"Geeks Solu\xE7\xF5es <auto@geekssolucoes.com.br>",to:c,subject:`Nota Fiscal Eletr\xF4nica de Servi\xE7os N\xBA ${d.numero}`,text:`Voc\xEA est\xE1 recebendo os arquivos digitais NFS-e (Nota Fiscal Eletr\xF4nica de Servi\xE7os) da empresa ${o.xNomeEmitente}`,attachments:u};await P({baseURL:"https://api.b15.com.br",method:"post",url:"/email/v2",data:p}),this.$q.notifyPositive("E-mail enviado com sucesso")}catch{this.$q.notifyError("Erro ao enviar email")}finally{this.$q.loading.hide()}},async enviarLote(){var l,a;try{$q.loading.show({message:"Preparando envio do lote...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"});const e=$utils.clonarV2(this.lista.filter(o=>o.situacao==="Rascunho"));$utils.gconsole.log("NFSeEnviaLote",`Inicio envio de lote com ${e.length} notas`);for(const o of e){const i=(await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:o.id}}))[0],n=o.rps;n!=null&&n.dataEmissao||(n.dataEmissao=$utils.dataAtual()),$q.loading.show({message:`Enviando...
                <br /><br />
                <strong>Lote</strong> ${n.numeroLote}<br />
                <strong>RPS</strong> ${n.identificacaoRps.numero}<br />
                <strong>S\xE9rie</strong> ${n.identificacaoRps.serie}<br />
                <br />
                ${n.tomador.razaoSocial}`,html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"}),$utils.gconsole.log("NFSeEnviaLote",`rps:${(l=n==null?void 0:n.identificacaoRps)==null?void 0:l.numero} tomador:${n.tomador.razaoSocial}`);const{nfse:d,situacao:c}=await $db.nfse.emitir({nfse:n,aguardarRetorno:!1}),u={id:o.id,tipo:"NFSe",tpAmb:"2",situacao:c,mod:"",serie:"",nNF:"",chNFe:"",vNF:0,dhEmi:T.formatarDataNFe(new Date((a=this.nfse)==null?void 0:a.dataEmissao)),cpfCnpjEmitente:d.prestador.documento,xNomeEmitente:d.prestador.razaoSocial,cpfCnpjDestinatario:d.tomador.documento,xNomeDestinatario:d.tomador.razaoSocial,dataHoraEmissao:d==null?void 0:d.dataEmissao,dataHoraCriacao:o.dataHoraCriacao||$utils.dataAtual(),json:JSON.stringify({rps:d})},p={id:(i==null?void 0:i.id)||$utils.uuid(),tipo:u.tipo,situacao:c,tpAmb:u.tpAmb,dataHoraEnvio:d==null?void 0:d.dataEmissao,cpfCnpjEmitente:d.prestador.documento,xmlEnvio:d.xml,idDocumentoFiscalEletronico:u.id};await $db.documentoFiscalEletronico.grava({atual:u,original:o}),await $db.documentoFiscalEletronicoXml.grava({atual:p,original:i})}await this.atualizar()}catch(e){console.log(e.message)}finally{$q.loading.hide()}},async protocolarLote(){var l;try{$q.loading.show({message:"Preparando envio do lote...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"});const a=$utils.clonarV2(this.lista.filter(e=>e.situacao==="Protocolada"));a.sort((e,o)=>{var d,c,u,p;const i=(c=(d=e==null?void 0:e.rps)==null?void 0:d.identificacaoRps)==null?void 0:c.numero,n=(p=(u=o==null?void 0:o.rps)==null?void 0:u.identificacaoRps)==null?void 0:p.numero;return i>n?1:-1});for(const e of a){const o=(await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:e.id}}))[0],i=e==null?void 0:e.rps;i!=null&&i.dataEmissao||(i.dataEmissao=$utils.dataAtual()),$q.loading.show({message:`Enviando...
                <br /><br />
                <strong>Lote</strong> ${i.numeroLote}<br />
                <strong>RPS</strong> ${i.identificacaoRps.numero}<br />
                <strong>S\xE9rie</strong> ${i.identificacaoRps.serie}<br />
                <br />
                ${i.tomador.razaoSocial}`,html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"});const{nfse:n,situacao:d}=await $db.nfse.emitir({nfse:i,aguardarRetorno:!1}),c={id:e.id,tipo:"NFSe",tpAmb:"2",situacao:d,mod:"",serie:"",nNF:"",chNFe:"",vNF:0,dhEmi:T.formatarDataNFe(new Date((l=this.nfse)==null?void 0:l.dataEmissao)),cpfCnpjEmitente:n.prestador.documento,xNomeEmitente:n.prestador.razaoSocial,cpfCnpjDestinatario:n.tomador.documento,xNomeDestinatario:n.tomador.razaoSocial,dataHoraEmissao:n==null?void 0:n.dataEmissao,dataHoraCriacao:e.dataHoraCriacao||$utils.dataAtual(),json:JSON.stringify({rps:n})},u={id:(o==null?void 0:o.id)||$utils.uuid(),tipo:c.tipo,situacao:d,tpAmb:c.tpAmb,dataHoraEnvio:n==null?void 0:n.dataEmissao,cpfCnpjEmitente:n.prestador.documento,xmlEnvio:n.xml,idDocumentoFiscalEletronico:c.id};await $db.documentoFiscalEletronico.grava({atual:c,original:e}),await $db.documentoFiscalEletronicoXml.grava({atual:u,original:o})}await this.atualizar()}catch(a){console.log(a.message)}finally{$q.loading.hide()}},async abrirDialogoSincronizarLote(){const l=new Date,a=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.dialogoSincronizarLote.listaEmpresas=a.map(e=>({value:e.id,label:e.nome+" - "+e.numeroDocumentoNacional,cnpj:e.numeroDocumentoNacional,inscricaoMunicipal:e.numeroDocumentoMunicipal})),this.dialogoSincronizarLote.empresa=this.dialogoSincronizarLote.listaEmpresas[0],this.dialogoSincronizarLote.periodoInicial=l,this.dialogoSincronizarLote.periodoFinal=l,this.dialogoSincronizarLote.visivel=!0},async sincronizarLote(){try{$q.loading.show({message:"Obtendo dados do servidor...",html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"}),await $db.nfse.sincronizarLote({inscricaoMunicipal:this.dialogoSincronizarLote.empresa.inscricaoMunicipal,cnpj:this.dialogoSincronizarLote.empresa.cnpj,periodo:{inicial:this.dialogoSincronizarLote.periodoInicial,final:this.dialogoSincronizarLote.periodoFinal}},(l,a)=>$q.loading.show({message:`${a}...
                <br /><br />
                <strong>Lote</strong> ${l.numeroLote}<br />
                <strong>RPS</strong> ${l.identificacaoRps.numero}<br />
                <strong>S\xE9rie</strong> ${l.identificacaoRps.serie}<br />
                <br />
                ${l.tomador.razaoSocial}`,html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"})),this.dialogoSincronizarLote.visivel=!1,await this.atualizar()}catch(l){let a=l.message.replace("db.nfse.sincronizarLote: ","");a.length!==l.message&&$q.notifyError(a),a.length===l.message&&console.error(l.message)}finally{$q.loading.hide()}},async mostrarJsonViewer(){await this.$refs.jsonViewer.show(this)},formatarDocumento(l){const a=l.replace(/\D/g,"");return a.length===11?a.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4"):a.length===14?a.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/,"$1.$2.$3/$4-$5"):a},compareObject(l,a,e=[]){const o=Object.keys(l);for(const i of o)if(!e.includes(i)){if(typeof l[i]=="object"&&l[i]!==null){if(!this.compareObject(l[i],a[i],e))continue;return!0}else if(l[i]!==a[i])return!0}return!1}},async mounted(){this.usuario=JSON.parse(localStorage.getItem("usuario")),this.filtrosOriginal=$utils.clonar(this.filtros),this.$route.params.id&&this.$route.params.id.length?(this.mostrarNfse(this.$route.params.id),this.busca=this.$route.params.id,await this.atualizar()):await this.atualizar({buscarDadosRecentes:!0})}},sa={id:"NfseLista"},la={class:"mw100 text-center"},ra={class:"text-weight-bold"},na={class:"text-weight-medium"},ca={class:"text-weight-medium"},da={class:"col-12"},ua={class:"col"},ma={class:"col"},fa={class:"q-mt-lg text-right"};function pa(l,a,e,o,i,n){const d=L("campo"),c=L("g-label"),u=L("BadgeCopiarUid"),p=L("avatar"),v=L("badge"),h=L("g-col"),E=L("g-row"),D=L("Lista"),z=L("Nfse"),q=L("JsonViewer"),M=L("row");return g(),O("div",sa,[t(D,{ref:"nfseLista",busca:i.busca,"onUpdate:busca":a[16]||(a[16]=r=>i.busca=r),onAtualizar:n.atualizar,onCriarClick:n.criarRps,onLimparFiltrosClick:n.limparFiltrosClick,onDetalhesClick:n.detalhesClick,onExportaXLSClick:n.exportaXLSClick,lista:i.lista,tabSelecionada:i.tabSelecionada,tabs:i.tabs,paginacao:i.paginacao,mostrar:i.mostrar},{menuExtras:s(()=>[F((g(),b(N,{onClick:a[0]||(a[0]=r=>n.enviarLote()),clickable:""},{default:s(()=>[t(m,{avatar:""},{default:s(()=>[t(w,{name:"mdi-file-replace",size:"sm"})]),_:1}),t(m,null,{default:s(()=>a[21]||(a[21]=[f("Enviar Lote")])),_:1})]),_:1})),[[R]]),F((g(),b(N,{onClick:a[1]||(a[1]=r=>n.protocolarLote()),clickable:""},{default:s(()=>[t(m,{avatar:""},{default:s(()=>[t(w,{name:"mdi-file-replace",size:"sm"})]),_:1}),t(m,null,{default:s(()=>a[22]||(a[22]=[f("Protocolar Lote")])),_:1})]),_:1})),[[R]]),F((g(),b(N,{onClick:a[2]||(a[2]=r=>n.solicitarURLImpressaoEmLote()),clickable:""},{default:s(()=>[t(m,{avatar:""},{default:s(()=>[t(w,{name:"mdi-file-replace",size:"sm"})]),_:1}),t(m,null,{default:s(()=>a[23]||(a[23]=[f("Solicitar PDF Lote")])),_:1})]),_:1})),[[R]]),F((g(),b(N,{onClick:a[3]||(a[3]=r=>n.abrirDialogoSincronizarLote()),clickable:""},{default:s(()=>[t(m,{avatar:""},{default:s(()=>[t(w,{name:"mdi-file-replace",size:"sm"})]),_:1}),t(m,null,{default:s(()=>a[24]||(a[24]=[f("Sincronizar Lote")])),_:1})]),_:1})),[[R]]),l.$db.usuario.desenvolvedor()?F((g(),b(N,{key:0,onClick:a[4]||(a[4]=r=>n.mostrarJsonViewer()),clickable:""},{default:s(()=>[t(m,{avatar:""},{default:s(()=>[t(w,{name:"mdi-file-replace",size:"sm"})]),_:1}),t(m,null,{default:s(()=>a[25]||(a[25]=[f("Ver Objeto")])),_:1})]),_:1})),[[R]]):C("",!0)]),filtroCampos:s(()=>[t(d,{modelValue:i.filtros.emitente,"onUpdate:modelValue":a[5]||(a[5]=r=>i.filtros.emitente=r),dense:"",rotulo:"Emitente",class:"col-12 q-mt-md"},null,8,["modelValue"]),t(d,{modelValue:i.filtros.destinatario,"onUpdate:modelValue":a[6]||(a[6]=r=>i.filtros.destinatario=r),dense:"",rotulo:"Destinat\xE1rio",class:"col-12 q-mt-lg"},null,8,["modelValue"]),t(d,{modelValue:i.filtros.numeroRps,"onUpdate:modelValue":a[7]||(a[7]=r=>i.filtros.numeroRps=r),rotulo:"RPS (Recibo provis\xF3rio)",dense:"",class:"col-12 q-mt-lg"},null,8,["modelValue"]),t(d,{modelValue:i.filtros.numeroNfse,"onUpdate:modelValue":a[8]||(a[8]=r=>i.filtros.numeroNfse=r),dense:"",rotulo:"N\xFAmero NFS-e",class:"col-12 q-mt-lg"},null,8,["modelValue"]),t(c,{class:"q-mt-xl",caption:""},{default:s(()=>a[26]||(a[26]=[f("Data de emiss\xE3o")])),_:1}),t(d,{modelValue:i.filtros.dataEmissaoNfseDe,"onUpdate:modelValue":a[9]||(a[9]=r=>i.filtros.dataEmissaoNfseDe=r),dense:"",tipo:"data",mask:"DD/MM/YYYY",rotulo:"De",class:"col-12"},null,8,["modelValue"]),t(d,{modelValue:i.filtros.dataEmissaoNfseAte,"onUpdate:modelValue":a[10]||(a[10]=r=>i.filtros.dataEmissaoNfseAte=r),dense:"",tipo:"data",mask:"DD/MM/YYYY",rotulo:"At\xE9",class:"col-12 q-mt-xs"},null,8,["modelValue"]),t(c,{class:"q-mt-xl",caption:""},{default:s(()=>a[27]||(a[27]=[f("Data de cria\xE7\xE3o RPS")])),_:1}),t(d,{modelValue:i.filtros.dataCriacaoRpsDe,"onUpdate:modelValue":a[11]||(a[11]=r=>i.filtros.dataCriacaoRpsDe=r),dense:"",tipo:"data",mask:"DD/MM/YYYY",rotulo:"De",class:"col-12"},null,8,["modelValue"]),t(d,{modelValue:i.filtros.dataCriacaoRpsAte,"onUpdate:modelValue":a[12]||(a[12]=r=>i.filtros.dataCriacaoRpsAte=r),dense:"",tipo:"data",mask:"DD/MM/YYYY",rotulo:"At\xE9",class:"col-12 q-mt-xs"},null,8,["modelValue"]),t(d,{modelValue:i.paginacao.ordenacao,"onUpdate:modelValue":a[13]||(a[13]=r=>i.paginacao.ordenacao=r),options:n.ordenacaoOpcoes,dense:"",tipo:"seletor",rotulo:"Ordena\xE7\xE3o",class:"col-12 q-mt-xl"},null,8,["modelValue","options"]),t(d,{modelValue:i.paginacao.direcao,"onUpdate:modelValue":a[14]||(a[14]=r=>i.paginacao.direcao=r),options:n.direcaoOpcoes,dense:"",tipo:"seletor",rotulo:"Dire\xE7\xE3o",class:"col-12 q-mt-xs"},null,8,["modelValue","options"]),t(d,{modelValue:i.paginacao.limite,"onUpdate:modelValue":a[15]||(a[15]=r=>i.paginacao.limite=r),tipo:"quantidade",min:"1",rotulo:"Quantidade por p\xE1gina",class:"col-12 q-mt-xl"},null,8,["modelValue"])]),itemLista:s(()=>[t(U,{bordered:"",class:"bg-white q-mb-xs rounded-borders"},{default:s(()=>[(g(!0),O(J,null,X(i.lista,r=>{var j;return g(),O("div",{key:r,class:"itemHover"},[r?(g(),b(N,{key:0,"manual-focus":"",clickable:"",class:"q-py-sm q-px-xs items-center"},{default:s(()=>[t(m,{class:"hideonmobile col-auto q-pr-sm no-margin"},{default:s(()=>[S("div",la,[r.id||r.rps.numero?(g(),b($,{key:0},{default:s(()=>[t(u,{numero:r.rps.numero,id:r.id,cor:"positive",dica:"N\xBA Nota"},null,8,["numero","id"])]),_:2},1024)):C("",!0),r.rps.identificacaoRps.numero?(g(),b($,{key:1},{default:s(()=>[t(u,{cor:"tertiary",dica:"Recibo provis\xF3rio",numero:String(r.rps.identificacaoRps.numero||0),id:String(r.rps.identificacaoRps.numero||0)},{default:s(()=>a[28]||(a[28]=[S("span",{style:{"font-size":"9.5px","margin-left":"3px"}},"RPS",-1)])),_:2},1032,["numero","id"])]),_:2},1024)):C("",!0)])]),_:2},1024),t(m,{class:"col-md col-lg col-xl no-margin"},{default:s(()=>[t(N,{class:"q-pa-none"},{default:s(()=>[t(m,{class:"col-auto items-center"},{default:s(()=>[t(p,{rotulo:r==null?void 0:r.xNomeDestinatario,tamanho:"40",style:{display:"flex","align-self":"center"}},null,8,["rotulo"]),r.rps.mensagemDeRetorno?(g(),b(_,{key:0,onClick:x=>n.abrirDetalhes(r),icon:"report",size:"15px",color:"red-7",dense:"",flat:"",rounded:"",class:"hideondesktop q-mt-md"},{default:s(()=>[t(V,{anchor:"bottom middle",self:"center middle"},{default:s(()=>a[29]||(a[29]=[f(" Ver msg. de retorno ")])),_:1})]),_:2},1032,["onClick"])):C("",!0)]),_:2},1024),t(m,{onClick:x=>n.mostrarNfse(r.id),class:"col"},{default:s(()=>[t($,{class:"text-weight-bold"},{default:s(()=>[S("span",null,[f(y(r.xNomeDestinatario)+" ",1),t(V,{anchor:"bottom middle",self:"center middle"},{default:s(()=>a[30]||(a[30]=[f(" Destinat\xE1rio ")])),_:1})])]),_:2},1024),t($,{caption:""},{default:s(()=>[S("span",null,[f(y(n.formatarDocumento(r.cpfCnpjDestinatario))+" ",1),t(V,{anchor:"bottom middle",self:"center middle"},{default:s(()=>a[31]||(a[31]=[f(" CPF/CNPJ ")])),_:1})])]),_:2},1024),t(m,{class:"hideondesktop q-mt-sm"},{default:s(()=>[t($,null,{default:s(()=>[t(u,{id:String(r.rps.identificacaoRps.numero||0),numero:String(r.rps.identificacaoRps.numero||0),cor:"tertiary",dica:"Recibo provis\xF3rio",class:"q-mr-xs"},{default:s(()=>a[32]||(a[32]=[S("span",{style:{"font-size":"9.5px","margin-left":"3px"}},"RPS",-1)])),_:2},1032,["id","numero"]),t(u,{numero:String(r.rps.numero),id:r.id,cor:"positive",dica:"N\xBA Nota",class:"q-mr-xs"},null,8,["numero","id"]),t(v,{rotulo:r.situacao,escuro:"",cor:"tertiary"},null,8,["rotulo"])]),_:2},1024),t(N,{class:"q-pa-none"},{default:s(()=>[t(m,{class:"no-margin",style:{"max-width":"95px"}},{default:s(()=>[t($,{lines:"2",caption:"",class:"q-pt-xs"},{default:s(()=>[t(w,{name:"mdi-calendar-today",size:"xs"}),S("span",ra,y(l.$filters.data(r.rps.dataEmissao)),1),f(" "+y(l.$filters.hora(r.rps.dataEmissao)),1)]),_:2},1024)]),_:2},1024),t(m,{class:"no-margin"},{default:s(()=>[t($,{class:"text-weight-bold text-right"},{default:s(()=>[f(y(l.$filters.numero(r.rps.servico.valores.valorServicos,2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),r.rps.mensagemDeRetorno?(g(),b(m,{key:0,style:{width:"35px"},class:"hideonmobile col-shrink q-pl-sm no-margin"},{default:s(()=>[t(_,{onClick:x=>n.abrirDetalhes(r),icon:"report",color:"red-7",dense:"",flat:"",rounded:""},{default:s(()=>[t(V,{anchor:"bottom middle",self:"center middle"},{default:s(()=>a[33]||(a[33]=[f(" Ver msg. de retorno ")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):C("",!0),i.tabSelecionada.valor==="Todos"?(g(),b(m,{key:1,onClick:x=>n.mostrarNfse(r.id),class:"hideonmobile maxw90 q-pl-sm no-margin"},{default:s(()=>[t(v,{rotulo:r.situacao,escuro:"",cor:"tertiary",dica:"Situa\xE7\xE3o",class:"col-auto q-mx-auto"},null,8,["rotulo"])]),_:2},1032,["onClick"])):C("",!0),t(m,{onClick:x=>n.mostrarNfse(r.id),class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:s(()=>[t(N,{class:"q-pa-none"},{default:s(()=>[t(m,{side:"",class:"q-pr-xs text-center"},{default:s(()=>[t(w,{name:"mdi-calendar-today",size:"xs"})]),_:1}),t(m,null,{default:s(()=>[t($,{caption:"",class:"text-weight-bold"},{default:s(()=>[f(y(l.$filters.data(r.rps.dataEmissao)),1)]),_:2},1024),t($,{caption:""},{default:s(()=>[f(y(l.$filters.hora(r.rps.dataEmissao)),1)]),_:2},1024)]),_:2},1024),t(V,{anchor:"bottom middle",self:"center middle"},{default:s(()=>a[34]||(a[34]=[f(" Data de emiss\xE3o ")])),_:1})]),_:2},1024)]),_:2},1032,["onClick"]),t(m,{onClick:x=>n.mostrarNfse(r.id),class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:s(()=>[t($,{caption:"",class:"text-weight-bold text-right"},{default:s(()=>[S("span",null,[f(y(l.$filters.numero(r.rps.servico.valores.valorServicos,2))+" ",1),t(V,{anchor:"bottom middle",self:"center middle"},{default:s(()=>a[35]||(a[35]=[f(" Valor dos Servi\xE7os ")])),_:1})])]),_:2},1024)]),_:2},1032,["onClick"]),t(m,{class:"col-auto q-pl-sm no-margin"},{default:s(()=>[t(N,{class:"q-pa-none"},{default:s(()=>[t(m,{class:"no-margin hideonmobile",style:{width:"32px"}},{default:s(()=>{var x;return[t(_,{onClick:k=>n.abrirDetalhes(r),flat:"",round:"",dense:"",color:"tertiary",size:"md",icon:(x=i.listaLayout[r==null?void 0:r.id])!=null&&x.detalhes?"keyboard_arrow_up":"keyboard_arrow_down"},null,8,["onClick","icon"])]}),_:2},1024),t(m,{class:"no-margin hideonmobile",style:{width:"32px"}},{default:s(()=>[t(_,{onClick:x=>n.mostrarNfse(r.id),dense:"",flat:"",round:"",icon:"edit",size:"md",color:"primary"},null,8,["onClick"])]),_:2},1024),r.situacao==="Enviada"||r.situacao==="Rascunho"?(g(),b(m,{key:0,class:"no-margin",style:{width:"32px"}},{default:s(()=>[t(_,{icon:"more_vert",size:"md",dense:"",flat:"",round:""},{default:s(()=>[t(B,null,{default:s(()=>[F((g(),b(U,{link:"","no-border":"",separator:""},{default:s(()=>{var x;return[t(N,{onClick:k=>n.abrirDetalhes(r),clickable:"",class:"hideondesktop"},{default:s(()=>[t(m,{avatar:""},{default:s(()=>{var k;return[t(w,{name:(k=i.listaLayout[r==null?void 0:r.id])!=null&&k.detalhes?"keyboard_arrow_up":"keyboard_arrow_down"},null,8,["name"])]}),_:2},1024),t(m,null,{default:s(()=>a[36]||(a[36]=[f("Ver Detalhes")])),_:1})]),_:2},1032,["onClick"]),t(N,{onClick:k=>n.mostrarNfse(r.id),clickable:"",class:"hideondesktop"},{default:s(()=>[t(m,{avatar:""},{default:s(()=>[t(w,{name:"edit"})]),_:1}),t(m,null,{default:s(()=>a[37]||(a[37]=[f("Editar")])),_:1})]),_:2},1032,["onClick"]),r.situacao==="Rascunho"?(g(),b(N,{key:0,onClick:k=>n.confirmarExclusaoNfse(r.id),clickable:""},{default:s(()=>[t(m,{avatar:""},{default:s(()=>[t(w,{name:"delete"})]),_:1}),t(m,null,{default:s(()=>a[38]||(a[38]=[f("Remover")])),_:1})]),_:2},1032,["onClick"])):C("",!0),r.situacao==="Enviada"&&r.id?(g(),b(N,{key:1,onClick:k=>n.solicitarURLImpressao(r.id),clickable:""},{default:s(()=>[t(m,{avatar:""},{default:s(()=>[t(w,{name:"print"})]),_:1}),t(m,null,{default:s(()=>a[39]||(a[39]=[f("Imprimir")])),_:1})]),_:2},1032,["onClick"])):C("",!0),r.situacao==="Enviada"&&((x=r.rps)==null?void 0:x.plugNotasConsulta)?(g(),b(N,{key:2,onClick:k=>n.downloadPDF(r.id),clickable:""},{default:s(()=>[t(m,{avatar:""},{default:s(()=>[t(w,{name:"download_for_offline"})]),_:1}),t(m,null,{default:s(()=>a[40]||(a[40]=[f("Download PDF")])),_:1})]),_:2},1032,["onClick"])):C("",!0),r.situacao==="Enviada"&&r.id?(g(),b(N,{key:3,onClick:k=>n.recarregarPDF(r.id),clickable:""},{default:s(()=>[t(m,{avatar:""},{default:s(()=>[t(w,{name:"download_for_offline"})]),_:1}),t(m,null,{default:s(()=>a[41]||(a[41]=[f("Recarregar PDF")])),_:1})]),_:2},1032,["onClick"])):C("",!0),r.situacao==="Enviada"&&r.rps.numero?(g(),b(N,{key:4,onClick:k=>n.abrirModalDeCancelamento(r),clickable:""},{default:s(()=>[t(m,{avatar:""},{default:s(()=>[t(w,{name:"delete"})]),_:1}),t(m,null,{default:s(()=>a[42]||(a[42]=[f("Cancelar")])),_:1})]),_:2},1032,["onClick"])):C("",!0),r.situacao==="Enviada"&&r.rps.xml?(g(),b(N,{key:5,onClick:k=>n.baixarXml(r),clickable:""},{default:s(()=>[t(m,{avatar:""},{default:s(()=>[t(w,{name:"mdi-download"})]),_:1}),t(m,null,{default:s(()=>a[43]||(a[43]=[f("Baixar XML")])),_:1})]),_:2},1032,["onClick"])):C("",!0),r.situacao==="Enviada"&&r.rps.xml?(g(),b(N,{key:6,onClick:k=>n.enviarEmailNfse(r),clickable:""},{default:s(()=>[t(m,{avatar:""},{default:s(()=>[t(w,{name:"mail"})]),_:1}),t(m,null,{default:s(()=>a[44]||(a[44]=[f("Enviar por email")])),_:1})]),_:2},1032,["onClick"])):C("",!0)]}),_:2},1024)),[[R]])]),_:2},1024)]),_:2},1024)]),_:2},1024)):C("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)):C("",!0),(j=i.listaLayout[r==null?void 0:r.id])!=null&&j.detalhes?(g(),b(E,{key:1,gutter:"md-x lg-y",items:"center",justify:"center"},{default:s(()=>[r.rps.mensagemDeRetorno?(g(),b(h,{key:0,col:"12",bordered:""},{default:s(()=>[t(c,{icon:"report xs red-7",text:"caption"},{default:s(()=>[f(y(r.rps.mensagemDeRetorno),1)]),_:2},1024)]),_:2},1024)):C("",!0),t(h,{col:"xs12 md4",bordered:""},{default:s(()=>[t(c,{caption:"",class:"text-tertiary"},{default:s(()=>a[45]||(a[45]=[f("Emitente")])),_:1}),t(c,{text:"medium"},{default:s(()=>[f(y(r.xNomeEmitente),1)]),_:2},1024)]),_:2},1024),t(h,{col:"xs12 md4",bordered:""},{default:s(()=>[t(E,{items:"center",justify:"center"},{default:s(()=>[t(h,{col:"shrink"},{default:s(()=>[t(w,{name:"event",size:"sm"})]),_:1}),t(h,{col:"grow"},{default:s(()=>[t(c,{caption:""},{default:s(()=>a[46]||(a[46]=[f("Cria\xE7\xE3o RPS")])),_:1}),t(c,null,{default:s(()=>[S("span",na,y(l.$filters.data(r.rps.dataHoraCriacao)),1),f(" "+y(l.$filters.hora(r.rps.dataHoraCriacao)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(h,{col:"xs12 md4",bordered:""},{default:s(()=>[t(E,{items:"center",justify:"center"},{default:s(()=>[t(h,{col:"shrink"},{default:s(()=>[t(w,{name:"today",size:"sm"})]),_:1}),t(h,{col:"grow"},{default:s(()=>[t(c,{caption:""},{default:s(()=>a[47]||(a[47]=[f("Emiss\xE3o NFS-e")])),_:1}),t(c,null,{default:s(()=>[S("span",ca,y(l.$filters.data(r.rps.dataEmissao)),1),f(" "+y(l.$filters.hora(r.rps.dataEmissao)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):C("",!0),r?(g(),b(H,{key:2})):C("",!0)])}),128))]),_:1})]),_:1},8,["busca","onAtualizar","onCriarClick","onLimparFiltrosClick","onDetalhesClick","onExportaXLSClick","lista","tabSelecionada","tabs","paginacao","mostrar"]),t(z,{onAtualizar:n.atualizar,ref:"modalNfse"},null,8,["onAtualizar"]),t(q,{ref:"jsonViewer"},null,512),t(aa,{modelValue:i.dialogoSincronizarLote.visivel,"onUpdate:modelValue":a[20]||(a[20]=r=>i.dialogoSincronizarLote.visivel=r),"content-css":{minWidth:"50vw"}},{default:s(()=>[t(Q,null,{default:s(()=>[t(Y,{class:"bg-primary text-white"},{default:s(()=>[t(Z,null,{default:s(()=>a[48]||(a[48]=[f("Sincronizar Lote")])),_:1}),F(t(_,{dense:"",flat:"",icon:"close",round:""},null,512),[[R]])]),_:1}),t(G,null,{default:s(()=>[t(W,{onSubmit:n.sincronizarLote},{default:s(()=>[t(M,{class:"q-col-gutter-md"},{default:s(()=>[S("div",da,[t(K,{modelValue:i.dialogoSincronizarLote.empresa,"onUpdate:modelValue":a[17]||(a[17]=r=>i.dialogoSincronizarLote.empresa=r),label:"Empresa",options:i.dialogoSincronizarLote.listaEmpresas,"option-value":"id","option-label":"label","emit-value":"","map-options":""},null,8,["modelValue","options"])]),S("div",ua,[t(d,{modelValue:i.dialogoSincronizarLote.periodoInicial,"onUpdate:modelValue":a[18]||(a[18]=r=>i.dialogoSincronizarLote.periodoInicial=r),tipo:"data",dense:"",outlined:""},null,8,["modelValue"])]),a[49]||(a[49]=S("div",{class:"col-auto",style:{"align-items":"center",display:"flex"}},[S("label",null,"at\xE9")],-1)),S("div",ma,[t(d,{modelValue:i.dialogoSincronizarLote.periodoFinal,"onUpdate:modelValue":a[19]||(a[19]=r=>i.dialogoSincronizarLote.periodoFinal=r),tipo:"data",dense:"",outlined:""},null,8,["modelValue"])])]),_:1}),S("div",fa,[F(t(_,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[R]]),t(_,{color:"primary",class:"q-ml-sm no-shadow",unelevated:"",label:"Sincronizar",type:"submit"})])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var Ca=I(ia,[["render",pa]]);export{Ca as default};
