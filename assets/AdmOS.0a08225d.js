import{_ as W,r as b,o as u,p as D,f as a,bJ as M,w as o,h as z,j as C,i as A,k as m,Q as H,G as q,J as F,L as I,F as P,x as Q,d as p,t as y,A as T,e as _,q as j,dR as E,bf as G,H as J,P as Z,S as x,T as S,U as k,N as K,I as B,M as X,as as R,b0 as Y}from"./index.4ea15c5f.js";import{O as aa}from"./OSTrocarStatus.9f2d5ec9.js";import{M as oa}from"./ModalHistoricoStatus.8de5ab83.js";import{B as ea}from"./BoxEnvioWhatsapp.53ca3f7e.js";import{d as ta}from"./vuedraggable.umd.ecc5688d.js";import"./open-url.f5c38293.js";const ra={components:{OSTrocarStatus:aa,ModalHistoricoStatus:oa,BoxEnvioWhatsapp:ea,draggable:ta},data(){return{sistema:$utils.sistemaPai(),tela:{},listas:{Processando:[],Entregue:[]},filtros:{visivel:!1,termo:"",prazo:{selecionado:null,opcoes:[{value:"bordaVerdeOS",label:"Em dia"},{value:"bordaAmarelaOS",label:"Entrega para esta semana"},{value:"bordaVermelhaOS",label:"Entrega atrasada"}]},empresa:{selecionada:null,opcoes:[]},entregueInicio:$utils.dataAtual(),entregueFim:$utils.dataAtual()},trocarStatus:{visivel:!1,dados:{}},whatsapp:{mensagem:`
            Ol\xE1 *[PrimeiroApelido]*, tudo bem?
            Temos uma \xF3tima not\xEDcia.
            *Sua ordem de servi\xE7o ficou pronta*, pode vir retirar na loja!
            At\xE9 mais \u{1F609}
          `},configImpressaoOrcamento:[]}},methods:{async atualizar(){try{$q.loading.show();const l=await $db.os.leAdmOSOnline({entregueInicio:this.filtros.entregueInicio,entregueFim:this.filtros.entregueFim,empresas:this.filtros.empresa.opcoes.map(r=>r.id)})||[];$utils.verificarAlerta(!l||!l.length,"N\xE3o h\xE1 ordens de servi\xE7o");let e=await $db.configuracoes.le({nome:"vendas.os.status"});e=e.filter(r=>!["Processando","Entregue"].includes(r.texto));const g={Processando:[]};for(const r of $lodash.orderBy(e,"valor","asc").map(t=>t.texto))g[r]=[];g.Entregue=[];for(const r of l){let t="bordaVerdeOS",n="",w="Normal";if(r.status==="Entregue"){if(!!r.dataHoraPrevisto&&!!r.dataHoraFinalizado){const i=new Date(new Date(r.dataHoraPrevisto).toDateString()),d=(new Date(new Date(r.dataHoraFinalizado).toDateString())-i)/(1e3*60*60*24);t=d>=0?"bordaVermelhaOS":d>-7?"bordaAmarelaOS":"bordaVerdeOS",n=d>=0?"negative":d>-7?"warning":"",w=d>=0?"Atrasado":d>-7?"Aten\xE7\xE3o":"Normal"}}else if(r.dataHoraPrevisto){const i=new Date(new Date(r.dataHoraPrevisto).toDateString()),d=(new Date(new Date().toDateString())-i)/(1e3*60*60*24);t=d>=0?"bordaVermelhaOS":d>-7?"bordaAmarelaOS":"bordaVerdeOS",n=d>=0?"negative":d>-7?"warning":"",w=d>=0?"Atrasado":d>-7?"Aten\xE7\xE3o":"Normal"}const f={id:r.id,codigoCompra:r.codigoCompra||"-",codigoContatoResponsavel:r.codigoContatoResponsavel,codigoDocumento:r.codigoDocumento,codigoContato:r.codigoContato,idEmpresa:r.idEmpresa,codigoEmpresa:r.codigoEmpresa,descricaoEmpresa:r.descricaoEmpresa,descricao:r.descricao,corBorda:t,corLabel:n,txtLabel:w,dataHoraEmissao:new Date(r.dataHoraEmissao),dataHoraFinalizado:new Date(r.dataHoraFinalizado),dataHoraRetorno:new Date(r.dataHoraRetorno),dataHoraPrevisto:new Date(r.dataHoraPrevisto),mostra:!0,nomeCliente:r.nomeCliente||"-",nomeResponsavel:r.nomeResponsavel||"-",nomeVendedor:r.nomeVendedor||"-",idVenda:r.idVenda,numeroVenda:r.numeroVenda?String(r.numeroVenda):"-",numeroOS:r.numeroOS?String(r.numeroOS):"-",status:r.status};g[r.status]&&g[r.status].push(f)}this.listas=g,this.filtrar()}catch(l){this.$q.notifyError("Erro na consulta online de oss",l)}finally{$q.loading.hide()}},async eventoEnd(){for(const l in this.listas)for(const e of this.listas[l])if(e.status!==l){this.trocarStatus.dados={codigoContatoResponsavel:e.codigoContatoResponsavel,codigoDocumento:e.codigoDocumento,codigoUsuario:null,nomeCliente:e.nomeCliente,observacao:"",statusAtual:e.status,statusNovo:l},this.trocarStatus.visivel=!0;return}},async eventoConfirmarTroca(l){try{$q.loading.show();let e;$db.usuario.logado.cpf&&(e=(await $db.contato.ler({filtros:{termoBusca:$db.usuario.logado.cpf}})).data.find(r=>{var t;return r.numeroDocumentoNacional.replace(/\D/g,"")===((t=$db.usuario.logado.cpf)==null?void 0:t.replace(/\D/g,""))})),l.cpfUsuario=e==null?void 0:e.numeroDocumentoNacional,await $db.os.trocaStatusOnline(l),this.$q.notifyPositive("Status trocado com sucesso"),await this.atualizar()}catch(e){$q.notifyError("Erro na troca de status",e)}finally{$q.loading.hide()}},async eventoCancelarTroca(l){await this.atualizar()},filtrar(){const l=$utils.removerAcentos(this.filtros.termo.toUpperCase()).split(" ").filter(Boolean),e=l.filter(r=>r.match(/^\d+$/)),g=l.filter(r=>!r.match(/^\d+$/));for(const r in this.listas)for(const t of this.listas[r]){const n=$utils.removerAcentos([t==null?void 0:t.id,t==null?void 0:t.nomeCliente,t==null?void 0:t.nomeResponsavel,t==null?void 0:t.nomeVendedor].join(" ").toUpperCase()),w=[t==null?void 0:t.numeroVenda,t==null?void 0:t.numeroOS].map(String);let f=!0;for(const i of e)f=f&&w.includes(i);for(const i of g)f=f&&n.includes(i);this.filtros.empresa.selecionada&&(f=f&&this.filtros.empresa.selecionada.value===t.codigoEmpresa),t.mostra=f}},filtrarDebounce(){$lodash.debounce(this.filtrar,700)()},async empresaOpcoes(){const l=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.filtros.empresa.opcoes=l.map(e=>({id:e.id,value:e.codigoContato,label:e.apelido||e.nome}))},btnFiltros(){this.filtros.visivel=!this.filtros.visivel},async btnAtendimento(l){const e=await $erp().contato.where({codigoContato:l}).first()||{};e.id&&this.$router.push({name:"Atendimento",params:{id:e.id}})},async carregarImpressoes(l){await this.configuraImpressaoOrcamento(l.idEmpresa)},async configuraImpressaoOrcamento(l){const e=await $db.configuracoes.porNome("impressao.venda",l),g=[{valor:"invoice",texto:"Or\xE7amento/Venda (Invoice)"}];this.sistema==="optisoul"&&g.push({valor:"orcamento",texto:"Or\xE7amento (Antigo)"},{valor:"termoGarantia",texto:"Termo de Garantia"}),this.configImpressaoOrcamento=[...e.length?e.map(r=>({texto:"Imprimir Or\xE7amento",...r})):g]},enviarWhatsapp(l){try{$q.loading.show(),this.$refs.BoxEnvioWhatsapp.abrir(l.id,l.status)}catch{$q.notify({type:"negativo",message:"Erro ao enviar mensagem pelo whatsapp"})}finally{$q.loading.hide()}},resize(){this.tela={header:$utils.tela("AdmOSHeader").height}}},watch:{async"filtros.entregueInicio"(){await this.atualizar()},async"filtros.entregueFim"(){await this.atualizar()}},async created(){await this.empresaOpcoes(),await this.atualizar()}},sa={id:"AdmOS"};function la(l,e,g,r,t,n){const w=b("barraTopo"),f=b("campo"),i=b("g-col"),v=b("g-row"),d=b("badge"),V=b("g-label"),U=b("draggable"),N=b("OSTrocarStatus"),$=b("ModalHistoricoStatus"),L=b("BoxEnvioWhatsapp");return u(),D("div",sa,[a(M,{onResize:e[0]||(e[0]=c=>n.resize())}),a(q,{id:"AdmOSHeader",class:"bg-gradiente"},{default:o(()=>[a(w),a(z,{class:"q-px-sm"},{default:o(()=>[a(C,{name:"view_week",size:"sm"}),a(A,null,{default:o(()=>e[10]||(e[10]=[m("Adm. OS")])),_:1}),a(H,{onClick:e[1]||(e[1]=c=>n.btnFiltros()),icon:"mdi-filter",round:"",flat:"",dense:""})]),_:1})]),_:1}),a(B,null,{default:o(()=>[a(F,{class:"overflow-hidden no-scroll"},{default:o(()=>[a(v,{id:"container",relative:"",style:I(`height:calc(100vh - ${t.tela.header}px)`)},{default:o(()=>[(u(!0),D(P,null,Q(t.listas,(c,O)=>(u(),p(i,{key:O,id:"coluna"},{default:o(()=>[a(z,null,{default:o(()=>[a(A,null,{default:o(()=>[m(y(O),1)]),_:2},1024)]),_:2},1024),O==="Entregue"?(u(),p(T,{key:0,class:"q-pa-sm q-my-md q-mx-xs shadow-1 bg-white"},{default:o(()=>[a(v,{gutter:"md"},{default:o(()=>[a(i,{col:"12"},{default:o(()=>[a(f,{modelValue:t.filtros.entregueInicio,"onUpdate:modelValue":e[2]||(e[2]=s=>t.filtros.entregueInicio=s),rotulo:"In\xEDcio",tipo:"data"},null,8,["modelValue"])]),_:1}),a(i,{col:"12"},{default:o(()=>[a(f,{modelValue:t.filtros.entregueFim,"onUpdate:modelValue":e[3]||(e[3]=s=>t.filtros.entregueFim=s),rotulo:"Fim",tipo:"data"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):_("",!0),a(U,{list:c,id:O,onEnd:n.eventoEnd,itemKey:"id",delay:"250",group:"osGroup",draggable:".OS",class:"scroll q-px-xs",style:I(`${O==="Entregue"?"height:calc(100vh - "+(t.tela.header+226)+"px);":"height:calc(100vh - "+(t.tela.header+50)+"px);"}`)},{item:o(({element:s})=>[s.mostra&&(t.filtros.prazo.selecionado===null||t.filtros.prazo.selecionado===s.corBorda)?(u(),p(T,{key:0,class:j(`OS q-pa-sm q-my-md shadow-1 bg-white ${s.corBorda}`)},{default:o(()=>[a(v,null,{default:o(()=>[a(i,{col:"6"},{default:o(()=>[s.corLabel?(u(),p(d,{key:0,cor:s.corLabel,rotulo:s.txtLabel,escuro:""},null,8,["cor","rotulo"])):(u(),p(d,{key:1,rotulo:s.txtLabel},null,8,["rotulo"]))]),_:2},1024),a(i,{col:"6",text:"right"},{default:o(()=>[s.numeroVenda&&s.numeroVenda!=="-"?(u(),p(d,{key:0,cor:"light",rotulo:s.numeroVenda,icone:"shopping_cart",class:"q-ml-sm",dica:"N\xBA Venda"},null,8,["rotulo"])):_("",!0),s.numeroOS&&s.numeroOS!=="-"?(u(),p(d,{key:1,rotulo:s.numeroOS,icone:"assignment_turned_in",cor:"tertiary",escuro:"",class:"q-ml-sm",dica:"N\xBA O.S."},null,8,["rotulo"])):_("",!0)]),_:2},1024)]),_:2},1024),a(v,{mg:"md-y"},{default:o(()=>[a(i,{col:"12"},{default:o(()=>[s.nomeCliente?(u(),p(V,{key:0,text:"sub1 medium"},{default:o(()=>[m(y(s.nomeCliente),1)]),_:2},1024)):_("",!0),s.nomeCliente!==s.descricao?(u(),p(V,{key:1,caption:""},{default:o(()=>[m(y(s.descricao),1)]),_:2},1024)):_("",!0)]),_:2},1024)]),_:2},1024),a(v,null,{default:o(()=>[a(i,null,{default:o(()=>[s.descricaoEmpresa&&s.descricaoEmpresa!=="-"?(u(),p(v,{key:0,mg:"sm-b",items:"center"},{default:o(()=>[a(i,{col:"shrink",mg:"xs-r",self:"start"},{default:o(()=>[a(E,{icon:"business",size:"sm",color:"grey-3","text-color":"tertiary"})]),_:1}),a(i,null,{default:o(()=>[a(V,{caption:"",tip:"Empresa"},{default:o(()=>[m(y(s.descricaoEmpresa),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)):_("",!0),s.nomeVendedor&&s.nomeVendedor!=="-"?(u(),p(v,{key:1,mg:"sm-b",items:"center"},{default:o(()=>[a(i,{col:"shrink",mg:"xs-r",self:"start"},{default:o(()=>[a(E,{icon:"person",size:"sm",color:"grey-3","text-color":"tertiary"})]),_:1}),a(i,null,{default:o(()=>[a(V,{caption:"",tip:"Vendedor"},{default:o(()=>[m(y(s.nomeVendedor),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)):_("",!0),s.nomeResponsavel&&s.nomeResponsavel!=="-"?(u(),p(v,{key:2,mg:"sm-b",items:"center"},{default:o(()=>[a(i,{col:"shrink",mg:"xs-r",self:"start"},{default:o(()=>[a(E,{icon:"person",size:"sm",color:"grey-3","text-color":"tertiary"})]),_:1}),a(i,null,{default:o(()=>[a(V,{caption:"",tip:"Respons\xE1vel"},{default:o(()=>[m(y(s.nomeResponsavel),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)):_("",!0),a(v,null,{default:o(()=>[a(i,{col:"shrink",mg:"xs-r",self:"start"},{default:o(()=>[a(E,{icon:"calendar_today",size:"sm",color:"grey-3","text-color":"tertiary"})]),_:1}),a(i,null,{default:o(()=>[a(V,{caption:"",tip:s.dataHoraFinalizado>new Date("1970-01-01T00:00:00.000Z")?"Finalizado em":"Previsto para"},{default:o(()=>[m(y(l.$filters.data(s.dataHoraFinalizado>new Date("1970-01-01T00:00:00.000Z")?s.dataHoraFinalizado:s.dataHoraPrevisto)),1)]),_:2},1032,["tip"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(i,{col:"shrink",self:"end"},{default:o(()=>[a(H,{onClick:h=>n.carregarImpressoes(s),icon:"more_vert",dense:"",round:"",unelevated:""},{default:o(()=>[a(G,null,{default:o(()=>[J((u(),p(Z,{link:"",separator:""},{default:o(()=>[a(x,{onClick:h=>l.$refs.modalHistoricoStatus.mostrar({idDocumento:s.id}),clickable:""},{default:o(()=>[a(S,{avatar:""},{default:o(()=>[a(C,{name:"history"})]),_:1}),a(S,null,{default:o(()=>[a(k,null,{default:o(()=>e[11]||(e[11]=[m("Hist\xF3rico do Status")])),_:1})]),_:1})]),_:2},1032,["onClick"]),a(x,{onClick:h=>n.btnAtendimento(s.codigoContato),clickable:""},{default:o(()=>[a(S,{avatar:""},{default:o(()=>[a(C,{name:"launch"})]),_:1}),a(S,null,{default:o(()=>[a(k,null,{default:o(()=>e[12]||(e[12]=[m("Ir para o Atendimentos")])),_:1})]),_:1})]),_:2},1032,["onClick"]),a(x,{onClick:h=>n.enviarWhatsapp(s),clickable:""},{default:o(()=>[a(S,{avatar:""},{default:o(()=>[a(C,{name:"mdi-whatsapp"})]),_:1}),a(S,null,{default:o(()=>[a(k,null,{default:o(()=>e[13]||(e[13]=[m("Enviar Mensagem")])),_:1}),a(k,{caption:""},{default:o(()=>e[14]||(e[14]=[m("WhatsApp")])),_:1})]),_:1})]),_:2},1032,["onClick"]),(u(!0),D(P,null,Q(t.configImpressaoOrcamento.filter(h=>h.valor),h=>(u(),p(x,{onClick:ia=>l.$imprimir(h.valor,{id:(s==null?void 0:s.idVenda)||"0",Oculto:"0"}),key:h.valor,clickable:""},{default:o(()=>[a(S,{avatar:""},{default:o(()=>[a(C,{name:"print"})]),_:1}),a(S,null,{default:o(()=>[a(k,null,{default:o(()=>[m(y(h.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:2},1024)),[[K]])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"])):_("",!0)]),_:2},1032,["list","id","onEnd","style"])]),_:2},1024))),128))]),_:1},8,["style"])]),_:1})]),_:1}),a(Y,{modelValue:t.filtros.visivel,"onUpdate:modelValue":e[8]||(e[8]=c=>t.filtros.visivel=c),bordered:"",side:"right",class:"hide-scrollbar"},{default:o(()=>[a(X,{view:"hHh lpR lFr"},{default:o(()=>[a(q,{class:"bg-white"},{default:o(()=>[a(z,{class:"text-tertiary border-bottom"},{default:o(()=>[a(C,{name:"mdi-filter",size:"sm"}),a(A,null,{default:o(()=>e[15]||(e[15]=[m("Filtros Avan\xE7ados")])),_:1}),a(H,{onClick:e[4]||(e[4]=c=>n.btnFiltros()),icon:"close",dense:"",flat:"",round:""})]),_:1})]),_:1}),a(B,null,{default:o(()=>[a(F,{class:"q-pa-md"},{default:o(()=>[a(f,{modelValue:t.filtros.termo,"onUpdate:modelValue":[e[5]||(e[5]=c=>t.filtros.termo=c),n.filtrarDebounce],ajuda:"Buscar por cliente, respons\xE1vel, vendedor, id, n\xBA venda, n\xBA o.s.",dense:"",rotulo:"Filtrar",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue"]),a(R,{modelValue:t.filtros.prazo.selecionado,"onUpdate:modelValue":[e[6]||(e[6]=c=>t.filtros.prazo.selecionado=c),n.filtrar],options:t.filtros.prazo.opcoes,clearable:"",dense:"",label:"Por prazo",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","options"]),a(R,{modelValue:t.filtros.empresa.selecionada,"onUpdate:modelValue":[e[7]||(e[7]=c=>t.filtros.empresa.selecionada=c),n.filtrar],options:t.filtros.empresa.opcoes,clearable:"",dense:"",label:"Por empresa",class:"q-field--with-bottom"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(N,{modelValue:t.trocarStatus.visivel,"onUpdate:modelValue":e[9]||(e[9]=c=>t.trocarStatus.visivel=c),dados:t.trocarStatus.dados,onConfirmar:n.eventoConfirmarTroca,onCancelar:n.eventoCancelarTroca},null,8,["modelValue","dados","onConfirmar","onCancelar"]),a($,{ref:"modalHistoricoStatus"},null,512),a(L,{ref:"BoxEnvioWhatsapp",mensagem:t.whatsapp.mensagem},null,8,["mensagem"])])}var fa=W(ra,[["render",la]]);export{fa as default};
