import{_ as Kt,a5 as Ie,r as ct,o as Q,d as ot,w as l,f as e,M as Yt,G as Jt,h as Rt,i as Lt,k as M,t as et,m as St,e as ut,H as gt,Q as ht,N as Tt,I as te,J as ee,p as kt,b0 as ke,b1 as re,b6 as Ce,b7 as ie,W as qt,b8 as ue,d6 as ce,d7 as Bt,K as se,aW as pe,D as ae,bj as ge,at as Ot,b5 as Dt,s as me,bg as Qt,P as xt,S as It,T as nt,j as Et,U as vt,A as Ee,F as Nt,u as Ut,C as ft,l as ne,aQ as fe,E as Se,bs as ve,d$ as De,c as Wt,bI as Gt,e0 as Ve,av as xe,d8 as Pe,aP as he}from"./index.da706716.js";import{L as ze}from"./Lista.b52dbdca.js";import{S as Fe}from"./SeletorCfop.bdeff4a8.js";import{C as Te}from"./Campo.6052d876.js";import"./xlsx.7e2a70dc.js";const Ae={components:{SeletorNcm:Ie,SeletorCfop:Fe,Campo:Te},data(){return{abaSelecionada:"tab1",historicoItem:[],tabelaHistoricoItem:{colunas:[{name:"fornecedor",label:"Fornecedor",align:"left"},{name:"dataCompra",label:"Data Compra",align:"right"},{name:"quantidade",label:"Quantidade",align:"right"},{name:"valorCusto",label:"Valor de Custo",align:"right"},{name:"valorTotal",label:"Valor Total (Custo)",align:"right"}],paginacao:{page:1,rowsPerPage:5}},estoqueItem:[],tabelaEstoqueItem:{colunas:[{name:"empresa",label:"Empresa",align:"left"},{name:"tipoEstoque",label:"Tipo estoque",align:"right"},{name:"lote",label:"Lote",align:"right"},{name:"quantidade",label:"Quantidade",align:"right"}],paginacao:{page:1,rowsPerPage:5}},compra:{},cfop:null,cstIcms:"",cstIpi:"",contaEstoque:[],impostoCstIpi:[],impostoIcmsModalidade:[],impostoCstIcms:[],impostoCstIcmsSt:[],documentoItem:{},imposto:{},item:{},visivel:!1,contasOpcoes:[],exibirIcms:!1,exibirIcmsSt:!1,exibirIpi:!1,somenteLeituraIcms:!1,somenteLeituraIcmsSt:!1,exibirHistorico:!1,exibirEstoque:!1,exibeCfop:!1}},emits:["salvar"],methods:{async mostrar(i,u,p){var f,t,c,b,v,g,_,r,w,o;this.compra=p,this.documentoItem=$utils.clonarV2(i),this.item=$utils.clonarV2(u),await this.consultarHistoricoItem(this.item),await this.consultarEstoqueItem(this.item);const k=await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:1}}),a=await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:21}});this.impostoCstIcms=k.concat(a).map(d=>({rotulo:d.numero.trim()+" - "+d.descr,valor:Number(d.numero)})).sort((d,h)=>Number(d.valor)-Number(h.valor)),this.impostoIcmsModalidade=(await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:3}})).map(d=>({rotulo:d.numero.trim()+" - "+d.descr,valor:Number(d.numero)})).sort((d,h)=>Number(d.valor)-Number(h.valor)),this.impostoCstIcmsSt=(await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:4}})).map(d=>({rotulo:d.numero.trim()+" - "+d.descr,valor:Number(d.numero)})).sort((d,h)=>Number(d.valor)-Number(h.valor)),this.impostoCstIpi=(await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:5}})).map(d=>({rotulo:d.numero.trim()+" - "+d.descr,valor:Number(d.numero)})).sort((d,h)=>Number(d.valor)-Number(h.valor)),this.contaEstoque=(await $db.hibrido.lista({table:"financeiroPlanoConta"})).map(d=>{var h,I,E;return{rotulo:(E=(I=(h=d==null?void 0:d.descricao)!=null?h:" - "+(d==null?void 0:d.classificacao))!=null?I:" - "+(d==null?void 0:d.caminho))!=null?E:"",valor:d.id}}).sort((d,h)=>Number(d.valor)-Number(h.valor));let s;(f=this.documentoItem)!=null&&f.idCfop&&(s=await $erp().cfop.where({id:this.documentoItem.idCfop}).first()),s===void 0&&console.log("CFOP inv\xE1lido"),this.documentoItem.cfop=(t=s==null?void 0:s.cfop.toString())!=null?t:"",this.documentoItem.codigoCfop=(c=s==null?void 0:s.codigoCfop)!=null?c:null,this.documentoItem.idCfop=(b=s.id)!=null?b:null,this.documentoItem.valorBaseIcms=(g=(v=this.documentoItem.valorBaseIcms)!=null?v:this.documentoItem.total)!=null?g:0,this.documentoItem.valorBaseIpi=(r=(_=this.documentoItem.valorBaseIpi)!=null?_:this.documentoItem.total)!=null?r:0,this.documentoItem.valorBaseIcmsSt=(o=(w=this.documentoItem.valorBaseIcmsSt)!=null?w:this.documentoItem.total)!=null?o:0,this.calcularImpostos(),this.exibeCfop=!0,this.visivel=!0},async salvar(){try{if(Object.keys(this.documentoItem.cfop).length>0){const i=await $db.hibrido.lista({table:"cfop",where:{cfop:Number(this.documentoItem.cfop)}});this.documentoItem.codigoCfop=i[0].codigoCfop,this.documentoItem.idCfop=i[0].id}this.documentoItem.cfop&&delete this.documentoItem.cfop,this.$emit("salvar",this.documentoItem),this.exibirIcms=!1,this.exibirIcmsSt=!1,this.exibirIpi=!1,this.visivel=!1}catch(i){$q.notifyError("Ocorreu um erro ao salvar o produto: ",i.message)}finally{$q.notifyPositive("Produto salvo com sucesso.")}},calcularImpostos(i){var g,_,r,w,o,d,h,I,E,V;let u=(g=this.documentoItem.valorBaseIcms)!=null?g:0,p=(_=this.documentoItem.valorBaseIpi)!=null?_:0,k=(r=this.documentoItem.valorBaseIcmsSt)!=null?r:0,a=(w=this.documentoItem.percentualIcms)!=null?w:0,s=(o=this.documentoItem.percentualIpi)!=null?o:0,f=(d=this.documentoItem.percentualIVA)!=null?d:0,t=(h=this.documentoItem.percentualIcmsSt)!=null?h:0,c=(I=this.documentoItem.valorIcms)!=null?I:0,b=(E=this.documentoItem.valorIpi)!=null?E:0,v=(V=this.documentoItem.valorIcmsSt)!=null?V:0;["valorBaseIcms","percentualIcms"].includes(i)&&(c=u*a/100),i==="valorIcms"&&(a=c/u*100),["valorBaseIpi","percentualIpi"].includes(i)&&(b=p*s/100),i==="valorIpi"&&(s=b/p*100),i==="valorBaseIcmsSt"&&(f=0,k>0&&u>0&&k>=u&&(f=(k-u)/u*100),v=k*t/100-c),i==="percentualIVA"&&(k=u*(1+f/100),v=k*t/100-c),i==="percentualIcmsSt"&&(v=k*t/100-c),i==="valorIcmsSt"&&(t=v/k*100),this.documentoItem.valorBaseIcmsSt=parseFloat(k.toFixed(2)),this.documentoItem.percentualIcms=parseFloat(a.toFixed(2)),this.documentoItem.percentualIcmsSt=parseFloat(t.toFixed(2)),this.documentoItem.percentualIpi=parseFloat(s.toFixed(2)),this.documentoItem.percentualIVA=parseFloat(f.toFixed(2)),this.documentoItem.valorIcms=parseFloat(c.toFixed(2)),this.documentoItem.valorIcmsSt=parseFloat(v.toFixed(2)),this.documentoItem.valorIpi=parseFloat(b.toFixed(2)),(this.documentoItem.modalidadeBaseCalculo||this.documentoItem.codigoCst||this.documentoItem.percentualIcms>0||this.documentoItem.valorIcms>0)&&(this.exibirIcms=!0),(this.documentoItem.modalidadeBaseCalculoST||this.documentoItem.percentualIcmsSt>0||this.documentoItem.valorIcmsSt>0)&&(this.exibirIcmsSt=!0),(this.documentoItem.codigoCstIpi||this.documentoItem.percentualIpi>0||this.documentoItem.valorIpi>0)&&(this.exibirIpi=!0)},async consultarCFOP(){var p,k;const i=this.documentoItem.cfop,u=await $erp().cfop.where({cfop:Number(i)}).first();u===void 0&&console.log("CFOP inv\xE1lido"),this.documentoItem.idCfop=(p=u==null?void 0:u.id)!=null?p:null,this.documentoItem.codigoCfop=(k=u==null?void 0:u.CodigoCFOP)!=null?k:null},async consultarHistoricoItem(i){const u={};(i==null?void 0:i.atual)&&Object.keys(i.atual).length>0&&(i=i.atual);const k=(await $db.hibrido.lista({table:"documentoItem",where:{idItem:i.id}})).filter(a=>(a.operacao==="Compra"||a.operacao==="Compra de Mercadoria")&&a.status==="Finalizado"&&a.operacaoFator===1&&a.quantidade>0);for(const a of k){const s=await $db.hibrido.le({table:"documento",id:a.idDocumento}),f=await $db.hibrido.le({table:"contato",id:s.idContato});u[a.idItem]||(u[a.idItem]={fornecedores:[]}),u[a.idItem].fornecedores.push({fornecedor:f.apelido||"",dataCompra:s.dataCompra||"",quantidade:a.quantidade||"",valorCusto:a.valorItem||"",valorTotal:a.valorItem*a.quantidade||""})}Object.keys(u).length>0?(this.historicoItem=u,this.historicoItem[i.id].fornecedores.sort((a,s)=>{const f=new Date(a.dataCompra||"1900-01-01");return new Date(s.dataCompra||"1900-01-01")-f})):this.historicoItem[i.id]={fornecedores:[]},this.exibirHistorico=!0},async consultarEstoqueItem(i){const u={};(i==null?void 0:i.atual)&&Object.keys(i.atual).length>0&&(i=i.atual);const p=await $db.hibrido.lista({table:"estoqueSaldoProdutoEmpresa",where:{idItem:i.id},whereFilter:{tipoEstoque:"Dispon\xEDvel"}});for(const k of p){const a=await $db.hibrido.le({table:"contato",id:k.idEmpresa});u[k.idItem]||(u[k.idItem]={estoques:[]}),u[k.idItem].estoques.push({empresa:a.apelido||"",tipoEstoque:k.tipoEstoque||"",lote:k.lote||"-",quantidade:k.saldo||""})}Object.keys(u).length>0?(this.estoqueItem=u,this.estoqueItem[i.id].estoques.sort((k,a)=>{const s=Number(k.quantidade||0);return Number(a.quantidade||0)-s})):this.estoqueItem[i.id]={estoques:[]},this.exibirEstoque=!0},async fechar(){this.documentoItem.cfop&&delete this.documentoItem.cfop,this.exibirIcms=!1,this.exibirIcmsSt=!1,this.exibirIpi=!1}}},Be=["src"],Ne={key:0},Oe={key:0};function Ue(i,u,p,k,a,s){const f=ct("badge"),t=ct("g-col"),c=ct("g-row"),b=ct("campo"),v=ct("SeletorNcm"),g=ct("SeletorCfop"),_=ct("g-label");return Q(),ot(ae,{modelValue:a.visivel,"onUpdate:modelValue":u[36]||(u[36]=r=>a.visivel=r),persistent:""},{default:l(()=>[e(Yt,{container:"",view:"hHh Lpr fFf",class:"bg-white",style:{"max-width":"980px"}},{default:l(()=>[e(Jt,{class:"bg-primary"},{default:l(()=>[e(Rt,{class:"bg-primary text-white"},{default:l(()=>[e(Lt,null,{default:l(()=>[M(et(a.documentoItem.descricaoItem),1)]),_:1}),a.item.referencia?(Q(),ot(f,{key:0,cor:"tertiary",class:"q-mr-sm"},{default:l(()=>[M(et(a.item.referencia)+" ",1),e(St,null,{default:l(()=>[M(" Refer\xEAncia ")]),_:1})]),_:1})):ut("",!0),a.item.codigoItem?(Q(),ot(f,{key:1,cor:"positive",class:"q-mr-sm"},{default:l(()=>[M(" #"+et(a.item.codigoItem.toString().padStart(4,"0"))+" ",1),e(St,null,{default:l(()=>[M(" C\xF3digo Item ")]),_:1})]),_:1})):ut("",!0),gt(e(ht,{onClick:s.fechar,dense:"",flat:"",icon:"close",round:""},null,8,["onClick"]),[[Tt]])]),_:1})]),_:1}),e(te,null,{default:l(()=>[e(ee,null,{default:l(()=>[e(c,{gutter:"md"},{default:l(()=>[e(t,null,{default:l(()=>[e(c,{class:"col-12 text-center"},{default:l(()=>[e(t,null,{default:l(()=>{var r,w,o,d,h,I;return[((r=a.item)==null?void 0:r.imagem)||((o=(w=a.item)==null?void 0:w.atual)==null?void 0:o.imagem)?(Q(),kt("img",{key:0,src:((d=a.item)==null?void 0:d.imagem)||((I=(h=a.item)==null?void 0:h.atual)==null?void 0:I.imagem),alt:"",style:{"max-width":"33%"}},null,8,Be)):ut("",!0)]}),_:1})]),_:1}),e(ke,{modelValue:a.abaSelecionada,"onUpdate:modelValue":u[0]||(u[0]=r=>a.abaSelecionada=r),align:"justify",dense:"","indicator-color":"light-blue-4",class:"text-primary q-px-sm"},{default:l(()=>[e(re,{default:"",name:"tab1",icon:"info",label:"Detalhes",class:"cinza"}),e(re,{name:"tab2",icon:"history",label:"Compras",class:"cinza"}),e(re,{name:"tab3",icon:"compare_arrows",label:"Estoque",class:"cinza"})]),_:1},8,["modelValue"]),e(Ce,{modelValue:a.abaSelecionada,"onUpdate:modelValue":u[35]||(u[35]=r=>a.abaSelecionada=r),animated:"",class:"text-tertiary"},{default:l(()=>[e(ie,{name:"tab1",class:"q-px-sm"},{default:l(()=>[e(c,null,{default:l(()=>[e(t,null,{default:l(()=>[e(b,{modelValue:a.documentoItem.observacao,"onUpdate:modelValue":u[1]||(u[1]=r=>a.documentoItem.observacao=r),tipo:"textoArea",rotulo:"Observa\xE7\xE3o",dense:"",rows:"4"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{mg:"lg-t"},{default:l(()=>[e(t,{col:"12"},{default:l(()=>[e(b,{modelValue:a.documentoItem.referenciaFornecedor,"onUpdate:modelValue":u[2]||(u[2]=r=>a.documentoItem.referenciaFornecedor=r),rotulo:"Refer\xEAncia Fornecedor"},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{mg:"lg-t"},{default:l(()=>[e(t,{col:"12"},{default:l(()=>[e(v,{modelValue:a.documentoItem.ncm,"onUpdate:modelValue":u[3]||(u[3]=r=>a.documentoItem.ncm=r),class:"col-12 col-md-6",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{mg:"lg-t"},{default:l(()=>[e(t,{col:"12"},{default:l(()=>[e(g,{modelValue:a.documentoItem.cfop,"onUpdate:modelValue":u[4]||(u[4]=r=>a.documentoItem.cfop=r),class:"col-12 col-md-6",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{mg:"lg-t"},{default:l(()=>[e(t,null,{default:l(()=>[e(_,{text:"sub1 medium"},{default:l(()=>[M("Estoque")]),_:1})]),_:1})]),_:1}),e(c,{items:"center"},{default:l(()=>[e(t,{col:"12"},{default:l(()=>[e(b,{modelValue:a.documentoItem.idPlanoContaEstoque,"onUpdate:modelValue":u[5]||(u[5]=r=>a.documentoItem.idPlanoContaEstoque=r),opcoes:a.contaEstoque,tipo:"seletor",ajuda:"Plano de Conta de Estoque para Entrada de Mercadoria",dense:"",outlined:"",rotulo:"Conta Estoque"},null,8,["modelValue","opcoes"])]),_:1})]),_:1}),e(c,{mg:"lg-t"},{default:l(()=>[e(t,null,{default:l(()=>[e(_,{text:"sub1 medium"},{default:l(()=>[M("Impostos")]),_:1})]),_:1})]),_:1}),e(c,null,{default:l(()=>[e(qt,{label:"ICMS",modelValue:a.exibirIcms,"onUpdate:modelValue":u[6]||(u[6]=r=>a.exibirIcms=r)},null,8,["modelValue"])]),_:1}),a.exibirIcms?(Q(),ot(c,{key:0,items:"center"},{default:l(()=>[e(t,{col:"12 sm6"},{default:l(()=>[e(b,{modelValue:a.documentoItem.modalidadeBaseCalculo,"onUpdate:modelValue":u[7]||(u[7]=r=>a.documentoItem.modalidadeBaseCalculo=r),opcoes:a.impostoIcmsModalidade,"somente-leitura":a.somenteLeituraIcms,tipo:"seletor",outlined:"",rotulo:"ICMS (Modalidade)"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),e(t,{col:"12 sm6"},{default:l(()=>[e(b,{modelValue:a.documentoItem.codigoCst,"onUpdate:modelValue":u[8]||(u[8]=r=>a.documentoItem.codigoCst=r),opcoes:a.impostoCstIcms,"somente-leitura":a.somenteLeituraIcms,tipo:"seletor",outlined:"",rotulo:"CST ICMS"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),e(t,{col:"12 sm4"},{default:l(()=>[e(b,{modelValue:a.documentoItem.valorBaseIcms,"onUpdate:modelValue":u[9]||(u[9]=r=>a.documentoItem.valorBaseIcms=r),onBlur:u[10]||(u[10]=r=>s.calcularImpostos("valorBaseIcms")),"somente-leitura":a.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base ICMS"},null,8,["modelValue","somente-leitura"])]),_:1}),e(t,{col:"12 sm4"},{default:l(()=>[e(b,{modelValue:a.documentoItem.percentualIcms,"onUpdate:modelValue":u[11]||(u[11]=r=>a.documentoItem.percentualIcms=r),onBlur:u[12]||(u[12]=r=>s.calcularImpostos("percentualIcms")),"somente-leitura":a.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"ICMS %"},null,8,["modelValue","somente-leitura"])]),_:1}),e(t,{col:"12 sm4"},{default:l(()=>[e(b,{modelValue:a.documentoItem.valorIcms,"onUpdate:modelValue":u[13]||(u[13]=r=>a.documentoItem.valorIcms=r),onBlur:u[14]||(u[14]=r=>s.calcularImpostos("valorIcms")),"somente-leitura":a.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor ICMS"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})):ut("",!0),e(c,null,{default:l(()=>[e(qt,{label:"ICMS ST",modelValue:a.exibirIcmsSt,"onUpdate:modelValue":u[15]||(u[15]=r=>a.exibirIcmsSt=r)},null,8,["modelValue"])]),_:1}),a.exibirIcmsSt?(Q(),ot(c,{key:1,items:"center"},{default:l(()=>[e(t,{col:"12 sm6"},{default:l(()=>[e(b,{modelValue:a.documentoItem.modalidadeBaseCalculoST,"onUpdate:modelValue":u[16]||(u[16]=r=>a.documentoItem.modalidadeBaseCalculoST=r),opcoes:a.impostoCstIcmsSt,"somente-leitura":a.somenteLeituraIcmsSt,tipo:"seletor",outlined:"",rotulo:"ICMS ST (Modalidade)"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),e(t,{col:"12 sm6"},{default:l(()=>[e(b,{modelValue:a.documentoItem.percentualIVA,"onUpdate:modelValue":u[17]||(u[17]=r=>a.documentoItem.percentualIVA=r),onBlur:u[18]||(u[18]=r=>s.calcularImpostos("percentualIVA")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"IVA (%)"},null,8,["modelValue"])]),_:1}),e(t,{col:"12 sm4"},{default:l(()=>[e(b,{modelValue:a.documentoItem.valorBaseIcmsSt,"onUpdate:modelValue":u[19]||(u[19]=r=>a.documentoItem.valorBaseIcmsSt=r),onBlur:u[20]||(u[20]=r=>s.calcularImpostos("valorBaseIcmsSt")),"somente-leitura":a.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base ICMS ST"},null,8,["modelValue","somente-leitura"])]),_:1}),e(t,{col:"12 sm4"},{default:l(()=>[e(b,{modelValue:a.documentoItem.percentualIcmsSt,"onUpdate:modelValue":u[21]||(u[21]=r=>a.documentoItem.percentualIcmsSt=r),onBlur:u[22]||(u[22]=r=>s.calcularImpostos("percentualIcmsSt")),"somente-leitura":a.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"ICMS ST (%)"},null,8,["modelValue","somente-leitura"])]),_:1}),e(t,{col:"12 sm4"},{default:l(()=>[e(b,{modelValue:a.documentoItem.valorIcmsSt,"onUpdate:modelValue":u[23]||(u[23]=r=>a.documentoItem.valorIcmsSt=r),onBlur:u[24]||(u[24]=r=>s.calcularImpostos("valorIcmsSt")),"somente-leitura":a.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor ICMS ST"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})):ut("",!0),e(c,null,{default:l(()=>[e(qt,{label:"IPI",modelValue:a.exibirIpi,"onUpdate:modelValue":u[25]||(u[25]=r=>a.exibirIpi=r)},null,8,["modelValue"])]),_:1}),a.exibirIpi?(Q(),ot(c,{key:2,items:"center"},{default:l(()=>[e(t,{col:"12"},{default:l(()=>[e(b,{modelValue:a.documentoItem.codigoCstIpi,"onUpdate:modelValue":u[26]||(u[26]=r=>a.documentoItem.codigoCstIpi=r),opcoes:a.impostoCstIpi,tipo:"seletor",dense:"",outlined:"",rotulo:"CST IPI"},null,8,["modelValue","opcoes"])]),_:1}),e(t,{col:"12 sm4"},{default:l(()=>[e(b,{modelValue:a.documentoItem.valorBaseIpi,"onUpdate:modelValue":u[27]||(u[27]=r=>a.documentoItem.valorBaseIpi=r),onBlur:u[28]||(u[28]=r=>s.calcularImpostos("valorBaseIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base IPI"},null,8,["modelValue"])]),_:1}),e(t,{col:"12 sm4"},{default:l(()=>[e(b,{modelValue:a.documentoItem.percentualIpi,"onUpdate:modelValue":u[29]||(u[29]=r=>a.documentoItem.percentualIpi=r),onBlur:u[30]||(u[30]=r=>s.calcularImpostos("percentualIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"IPI %"},null,8,["modelValue"])]),_:1}),e(t,{col:"12 sm4"},{default:l(()=>[e(b,{modelValue:a.documentoItem.valorIpi,"onUpdate:modelValue":u[31]||(u[31]=r=>a.documentoItem.valorIpi=r),onBlur:u[32]||(u[32]=r=>s.calcularImpostos("valorIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor IPI"},null,8,["modelValue"])]),_:1})]),_:1})):ut("",!0)]),_:1}),e(ie,{name:"tab2",class:"q-px-sm"},{default:l(()=>[a.exibirHistorico?(Q(),ot(ue,{key:0,rows:a.historicoItem[a.documentoItem.idItem].fornecedores,columns:a.tabelaHistoricoItem.colunas,pagination:a.tabelaHistoricoItem.paginacao,"onUpdate:pagination":u[33]||(u[33]=r=>a.tabelaHistoricoItem.paginacao=r),"row-key":"index",class:"no-shadow text-left"},{body:l(r=>[e(ce,{props:r},{default:l(()=>[e(Bt,{key:"fornecedor",props:r},{default:l(()=>[M(et(r.row.fornecedor),1)]),_:2},1032,["props"]),e(Bt,{key:"dataCompra",props:r},{default:l(()=>[r.row.dataCompra!==""?(Q(),kt("span",Ne,et(i.$filters.data(r.row.dataCompra)),1)):ut("",!0)]),_:2},1032,["props"]),e(Bt,{key:"quantidade",props:r},{default:l(()=>[M(et(r.row.quantidade),1)]),_:2},1032,["props"]),e(Bt,{key:"valorCusto",props:r},{default:l(()=>[M(et(i.$filters.numero(r.row.valorCusto,2)),1)]),_:2},1032,["props"]),e(Bt,{key:"valorTotal",props:r},{default:l(()=>[M(et(i.$filters.numero(r.row.valorTotal,2)),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])):ut("",!0)]),_:1}),e(ie,{name:"tab3",class:"q-px-sm"},{default:l(()=>[a.exibirEstoque?(Q(),ot(ue,{key:0,rows:a.estoqueItem[a.documentoItem.idItem].estoques,columns:a.tabelaEstoqueItem.colunas,pagination:a.tabelaEstoqueItem.paginacao,"onUpdate:pagination":u[34]||(u[34]=r=>a.tabelaEstoqueItem.paginacao=r),"row-key":"index",class:"no-shadow text-left"},{body:l(r=>[e(ce,{props:r},{default:l(()=>[e(Bt,{key:"empresa",props:r},{default:l(()=>[M(et(r.row.empresa),1)]),_:2},1032,["props"]),e(Bt,{key:"tipoEstoque",props:r},{default:l(()=>[M(et(r.row.tipoEstoque),1)]),_:2},1032,["props"]),e(Bt,{key:"lote",props:r},{default:l(()=>[r.row.lote!==""?(Q(),kt("span",Oe,et(r.row.lote),1)):ut("",!0)]),_:2},1032,["props"]),e(Bt,{key:"quantidade",props:r},{default:l(()=>[M(et(r.row.quantidade),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])):ut("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(se,{class:"bg-light q-pa-sm",bordered:""},{default:l(()=>[e(Rt,null,{default:l(()=>[e(pe),gt(e(ht,{onClick:s.fechar,label:"Cancelar",size:"md",flat:"","no-ripple":"",color:"tertiary",class:"q-mr-sm"},null,8,["onClick"]),[[Tt]]),e(ht,{onClick:s.salvar,label:"Salvar",color:"primary","no-ripple":"",unelevated:""},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var qe=Kt(Ae,[["render",Ue]]);const Re={components:{ModalEditarProdutoCompras:qe,PromptItemV2:ge},data(){const i={ehOrcamento:!0,adicionar:{modal:{value:!1,name:""}},dataPrevistaEntrega:"",horaPrevistaEntrega:"",contatos:{},produtos:[],formasDePagamento:[],visivel:!1,somenteLeitura:!1,condicaoPagamentoRules:[async()=>{const u=this.compra.condicaoPagamento;return/^[\d/]*$/.test(u)}],formaPagamentoRules:[async()=>{const u=this.compra.formaDePagamento;return/^[^\d\s][a-zA-Z\s]*[^\d\s]$/.test(u)}],erroDesconto:!1,erroFrete:!1,erroSeguro:!1,erroOutrasDespesas:!1,exibeInfNota:!1,documentoNovo:!1,valorTotalPagamento:0,sku:0,operacao:"",alterarPrevisaoEntrega:!1};return this.limpaCampos(i),i},emits:["atualizar"],computed:{skus(){return this.compraItens.length>0?`${Number(this.compraItens.length)}`:"0"}},methods:{editarProduto(i){const u=this.produtos[i.idItem],p=this.compra;this.$refs.ModalEditarProdutoCompras.mostrar(i,u,p)},removerItem(i){this.compraItens=this.compraItens.filter(u=>u.id!==i.id),this.calcularTotais()},fecharEdicaoProduto(i){const u=this.compraItens.findIndex(p=>p.id===i.id);this.compraItens[u]=$utils.clonar(i),this.calcularTotaisItem(u)},async atualizar(){var p,k;this.compraOriginal=await $db.hibrido.le({table:"documento",id:this.compra.id}),this.compra=$utils.clonarV2(this.compraOriginal),$utils.verificarErro(!this.compra.id,"Compra n\xE3o encontrada"),this.compraItensOriginal=(await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:this.compra.id}})).sort((a,s)=>new Date(a.dataHoraEmissao||0)-new Date(s.dataHoraEmissao||0)),this.compraItens=$utils.clonarV2(this.compraItensOriginal),this.compraCondicoesDePagamentoOriginal=(await $db.hibrido.lista({table:"documentoCondicaoPagamento",where:{idDocumento:this.compra.id}})).sort((a,s)=>new Date(a.dataVencimento||0)-new Date(s.dataVencimento||0)),this.compraCondicoesDePagamento=$utils.clonarV2(this.compraCondicoesDePagamentoOriginal),this.compraTitulosOriginal=await $db.hibrido.lista({table:"financeiroTitulo",where:{documentoId:this.compra.id}}),this.compraTitulos=$utils.clonarV2(this.compraTitulosOriginal),this.compraMovimentacoesOriginal=await $db.hibrido.lista({table:"financeiroMovimentacao",where:{documentoId:this.compra.id}}),this.compraMovimentacoes=$utils.clonarV2(this.compraMovimentacoesOriginal),this.compraDocumentoXmlOriginal=await $db.hibrido.lista({table:"documentoXML",where:{idDocumento:this.compra.id}}),this.compraDocumentoXml=$utils.clonarV2(this.compraDocumentoXmlOriginal),this.compra.totalComImposto=!0,this.compra.calcularTributacao=(p=this.compra.calcularTributacao)!=null?p:!0,this.compra.naoGerarFinanceiro=(k=this.compra.naoGerarFinanceiro)!=null?k:!1;const i=[this.compra.idEmpresa,this.compra.idContato,this.compra.idContatoComprador,this.compra.idContatoVendedor,this.compra.idContatoTransportadora].filter(Boolean);this.carregarImagensContatos(i);const u=this.compraItens.map(({idItem:a})=>a).filter(Boolean);if(this.carregarImagensItens(u),this.valorTotalPagamento===0)for(const a of this.compraCondicoesDePagamento)this.valorTotalPagamento=this.valorTotalPagamento+a.valor;this.compra.dataHoraPrevisto&&(this.dataPrevistaEntrega=this.compra.dataHoraPrevisto.slice(0,10),this.horaPrevistaEntrega=this.compra.dataHoraPrevisto.slice(11,16)),this.exibeInfNota=!0},async carregarContatos(i){const u=await $db.hibrido.lista({table:"contato",columns:["id","apelido","imagem"],whereIn:{id:i}});for(const p of u)this.contatos[p.id]=p},async carregarImagensContatos(i){if(!!i.length){await $utils.dormir(200);try{await this.carregarContatos(i)}catch(u){console.error("Erro ao carregar imagens de contatos - ",u)}}},async carregarItens(i){const u=await $db.hibrido.lista({table:"item",columns:["id","descricao","imagem","valorCustoReposicao","marca","referencia","codigoItem"],whereIn:{id:i}});for(const p of u)this.produtos[p.id]=p},async carregarImagensItens(i){if(!!i.length){await $utils.dormir(200);try{await this.carregarItens(i)}catch(u){console.error("Erro ao ler imagens de itens - ",u)}}},async salvar_click(){await $tryLoading(async()=>{if(this.compra.idContato||(this.compra.idContato=$db.usuario.logado.id),this.dataPrevistaEntrega){const i=`${this.dataPrevistaEntrega} ${this.horaPrevistaEntrega||"00:00:00"}`;this.compra.dataHoraPrevisto=Ot.formatDate(i)}await this.salvar(),this.$emit("atualizar",{aba:"Digita\xE7\xE3o"}),this.ocultarModal(),$q.notifyPositive(this.compra.operacao==="Nota de Entrada"?"A Nota de Entrada foi salva com sucesso.":"O Pedido de Compra foi salvo com sucesso.")},{mensagem:"Salvando..."})},async excluir_click(){!await $q.dialogSimNao({title:"Excluir compra",message:`Deseja excluir ${this.compra.operacao==="Pedido de Compra"?`o ${this.compra.operacao}?`:`a ${this.compra.operacao}?`}`})||await $tryLoading(async()=>{this.visivel=!1,this.operacao=this.compra.operacao,this.compra={},this.compraCondicoesDePagamento=[],this.compraItens=[],this.compraMovimentacoes=[],this.compraTitulos=[],this.compraDocumentoXml=[],await this.salvar(),await this.fechar(),$q.notifyPositive(this.compra.operacao==="Nota de Entrada"?"A Nota de Entrada foi excluida com sucesso.":"O Pedido de Compra foi excluido com sucesso.")},{mensagem:"Excluindo..."})},async criar(){await $tryLoading(async()=>{const i=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;if(!(i.length>0)){this.$q.notify({message:"N\xE3o h\xE1 empresa configurada",timeout:0,type:"negative",closeBtn:!0});return}let u=i[0];if(i.length>1){const a={ativo:!0,empresas:!0};if(u=await $g.promptContato.show({filtro:a,placeholder:"Selecione a empresa"}),!u){this.ocultarModal();return}}const p=(await $db.hibrido.lista({table:"empresa",where:{idContato:u.id}}))[0];if(!p){this.ocultarModal(),this.$q.notifyError("Erro ao selecionar empresa");return}if(this.contatos[u.id]||await this.carregarContatos([u.id]),this.limpaCampos(this),this.compra={id:$utils.uuid(),tipo:"Compra",operacao:"Pedido de Compra",status:"Digita\xE7\xE3o",descricaoEmpresa:p.nome,numeroDocumentoEmpresa:p.numeroDocumentoNacional,descricaoContato:"",idContatoComprador:null,dataHoraEmissao:$utils.dataAtual(),tipoFrete:"CIF",tipoTransporte:null,idEmpresa:p.idContato,idContato:null,totalDesconto:0,totalPercentualDesconto:0,calcularTributacao:!0,totalComImposto:!0,naoGerarFinanceiro:!1,freteSeparado:!1,dataHoraPrevisto:null,valorBaseIcms:0,valorIcms:0,valorBaseIcmsSt:0,valorIcmsSt:0,valorOutrasDespesas:0},!await this.abrirModalFornecedor()){this.ocultarModal();return}this.documentoNovo=!0,this.exibeInfNota=!0,this.visivel=!0})},async validaCampos(){try{if($utils.verificarErro(!this.compra.descricaoContato,"N\xE3o \xE9 permitido finalizar a compra sem informar o fornecedor!"),$utils.verificarErro(!this.compraItens.length,"N\xE3o \xE9 permitido finalizar compra sem itens!"),!this.compra.naoGerarFinanceiro){const i=$utils.arredondar(this.compraCondicoesDePagamento.reduce((u,p)=>u+p.valor,0));$utils.verificarErro(!this.compra.formaDePagamento,"N\xE3o \xE9 permitido finalizar a compra sem informar a forma de pagamento!"),$utils.verificarErro(this.compraCondicoesDePagamento.length>0&&this.compra.totalDocumento!==i,"N\xE3o \xE9 permitido finalizar a compra se o valor total difere da soma das parcelas!"),$utils.verificarErro(this.compraCondicoesDePagamento.length===0,'Verifique se a op\xE7\xE3o "N\xE3o gerar financeiro" est\xE1 marcada, ou adicione as parcelas para finalizar a compra!')}return this.compra.operacao==="Nota de Entrada"&&($utils.verificarErro(!this.compra.notaNumero,"N\xE3o \xE9 permitido finalizar a compra sem informar o n\xFAmero da Nota de Entrada!"),$utils.verificarErro(!this.compra.notaSerie,"N\xE3o \xE9 permitido finalizar a compra sem informara s\xE9rie da Nota de Entrada!"),$utils.verificarErro(!this.compra.naturezaOperacao,"N\xE3o \xE9 permitido finalizar a compra sem informar natureza de opera\xE7\xE3o da Nota de Entrada!"),$utils.verificarErro(!this.compra.dataCompra,"N\xE3o \xE9 permitido finalizar a compra sem informar a data de compra da Nota de Entrada!"),$utils.verificarErro(!this.compra.chaveAcesso,"N\xE3o \xE9 permitido finalizar a compra sem informar a chave de acesso da Nota de Entrada!")),!0}catch(i){return $q.notifyError("Ocorreu um erro na valida\xE7\xE3o de campos",i),!1}},async finalizar_click(){if(!await this.validaCampos())return;let i=!1;this.compra.naoGerarFinanceiro||(i=await $q.dialogSimNao({title:"Gerar Financeiro",message:"Deseja gerar as provis\xF5es financeiras?"})),await $tryLoading(async()=>{this.compra.status="Finalizado",this.compra.dataHoraFinalizado=$utils.dataAtual(),this.compra.provisaoCompra=i?1:void 0,await this.finalizarItens(),i&&await this.gerarFinanceiro(),await this.salvar(),this.$emit("atualizar",{aba:"Finalizado"}),this.ocultarModal(),$q.notifyPositive("Compra finalizada com sucesso!"),i&&$q.notifyPositive("Provisionamento gerado com sucesso!")},{mensagem:"Finalizando Compra..."})},finalizarItens(){var s,f;let i=1,u=0,p=0,k=!1;const a=this.compra;if(a.subTotalProduto>0&&(a.tipoFrete==="FOB"&&a.freteSeparado===0&&(u=(a.valorFrete||0)+(a.valorSeguro||0)),i=((a.subTotalProduto||0)+(a.valorOutrasDespesas||0)-(a.totalDesconto||0)+(u||0))/(a.subTotalProduto||1)),p=this.compraItens.reduce((t,c)=>t+c.valorIcmsSt,p),p!==a.valorIcmsSt&&(k=!0),a.operacao==="Nota de Entrada")for(const t of this.compraItens)t.dataCompra=$utils.dataAtual(),k&&(t.valorIcmsSt=a.valorIcmsSt*((t==null?void 0:t.total)||0)/(a.subTotalProduto>0?a.subTotalProduto:1)),t.valorFreteRateado=a.valorFrete*(((t==null?void 0:t.total)||0)/(a.subTotalProduto||1)),t.valorSeguroRateado=a.valorSeguro*(((t==null?void 0:t.total)||0)/(a.subTotalProduto||1)),t.valorOutrasDespesasRateado=(a.valorOutrasDespesas||0)*(((t==null?void 0:t.total)||0)/(a.subTotalProduto||1)),t.descontoTotalRateado=(a.totalDesconto||0)*(((t==null?void 0:t.total)||0)/(a.subTotalProduto||1)),(t==null?void 0:t.valorIcmsSt)-(t==null?void 0:t.valorIcms)>0&&((t==null?void 0:t.valorIcmsSt)||0)-((t==null?void 0:t.valorIcms)||0),t.valorRealTotal=((t==null?void 0:t.total)||0)*i+((t==null?void 0:t.valorIpi)||0)+((t==null?void 0:t.valorIcms)||0),t.valorRealTotalImpostos=((t==null?void 0:t.total)||0)+t.valorFreteRateado+t.valorSeguroRateado+t.valorOutrasDespesasRateado-t.descontoTotalRateado+((t==null?void 0:t.valorIpi)||0)+((t==null?void 0:t.valorIcmsSt)||0),t.valorReal=t.valorRealTotalImpostos/((t==null?void 0:t.quantidade)||1),t.valorCustoReposicao=((s=this.produtos[t.idItem])==null?void 0:s.valorCustoReposicao)||0;if(a.operacao==="Pedido de Compra")for(const t of this.compraItens){k&&(t.valorIcmsSt=$utils.arredondar(a.valorIcmsSt*(t.total||0)/(a.subTotalProduto>0?a.subTotalProduto:1))),t.valorFreteRateado=$utils.arredondar((a.valorFrete||0)*(t.total||0)/(a.subTotalProduto||1),4),t.valorSeguroRateado=$utils.arredondar((a.valorSeguro||0)*(t.total||0)/(a.subTotalProduto||1),4),t.valorOutrasDespesasRateado=$utils.arredondar((a.valorOutrasDespesas||0)*(t.total||0)/(a.subTotalProduto||1),4),t.descontoTotalRateado=$utils.arredondar((a.totalDesconto||0)*(t.total||0)/(a.subTotalProduto||1),4);let c=0;t.valorIcmsSt-t.valorIcms>0&&(c=$utils.arredondar((t.valorIcmsSt||0)-(t.valorIcms||0),2)),t.valorRealTotal=$utils.arredondar((t.total||0)*i+(t.valorIpi||0)+(c>0?c:0),2),t.valorRealTotalImpostos=$utils.arredondar((t.total||0)+t.valorFreteRateado+t.valorSeguroRateado+t.valorOutrasDespesasRateado-t.descontoTotalRateado+(t.valorIpi||0)+(t.valorIcmsSt||0),4),t.valorReal=$utils.arredondar(t.valorRealTotalImpostos/(t.quantidade||1),4),t.valorCustoReposicao=$utils.arredondar(((f=this.produtos[t.idItem])==null?void 0:f.valorCustoReposicao)||0,2)}},async transformarEmNotaDeEntrada_click(){this.compra.operacao==="Pedido de Compra"&&await $tryLoading(async()=>{var p;const i=this.compraItens.map(({idItem:k})=>k).filter(Boolean),u=await $db.hibrido.lista({table:"itemFornecedor",whereIn:{idItem:i},whereFilter:{idContato:this.compra.idContato}});for(const k of this.compraItens)if(!u.some(({idItem:a})=>a===k.idItem)){const a={id:$utils.uuid(),idItem:k.idItem,idContato:this.compra.idContato,referencia:"",descricao:k.descricaoItem};await $db.hibrido.grava("itemFornecedor",{atual:a,original:{}})}for(const k of this.compraTitulos)k.formaDePagamento=(p=this.compra.formaDePagamento)!=null?p:"";this.compra.operacao="Nota de Entrada",this.compra.dataHoraFinalizado="",this.compra.status="Digita\xE7\xE3o",await this.salvar(),this.$emit("atualizar",{aba2:"Nota de Entrada",aba:"Digita\xE7\xE3o"}),this.ocultarModal(),$q.notifyPositive("Nota de Entrada gerada com sucesso!")},{mensagem:"Processando..."})},async mostrar({id:i}){this.visivel=!0;const u=$utils.logarIni("ComprasFicha");await $tryLoading(async()=>{this.compra.id=i,await this.atualizar()}),$utils.logarFim(u,1)},fechar(){this.compra.status==="Finalizado"?this.$emit("atualizar",{aba:"Finalizado"}):this.$emit("atualizar",{aba:"Digita\xE7\xE3o"}),this.ocultarModal(),this.dataPrevistaEntrega="",this.horaPrevistaEntrega="",this.produtos=[],this.limpaCampos(this),this.formasDePagamento=[],this.documentoNovo=!1,this.exibeInfNota=!1,this.valorTotalPagamento=0},ocultarModal(){this.visivel=!1},async abrirModalEmpresa(){const i={ativo:!0,empresas:!0},u=await $g.promptContato.show({filtro:i,placeholder:"Selecione"});if(!u)return;let p=(await $db.hibrido.lista({table:"empresa",where:{idContato:u.id}}))[0];if(!p){this.ocultarModal(),this.$q.notifyError("Erro ao selecionar empresa");return}this.contatos[u.id]||await this.carregarContatos([u.id]),this.compra.descricaoEmpresa=p.nome,this.compra.idEmpresa=p.idContato,this.compra.numeroDocumentoEmpresa=p.numeroDocumentoNacional,this.compra.InscricaoMunicipalEmpresa=p.InscricaoMunicipalEmpresa},async abrirModalComprador(){const i=await this.selecionarContato({placeholder:"Selecione o comprador",filtro:{ativo:!0,compradores:!0}});i.id&&(this.compra.idContatoComprador=i.id),this.contatos[i.id]||await this.carregarContatos([i.id])},async abrirModalFornecedor(){const i={ativo:!0},u=await $g.promptContato.show({filtro:i,placeholder:"Selecione o fornecedor"});if(!u)return u;const p=await $db.contatoTelefone.le({idContato:u.id}),k=await $db.contatoEndereco.le({idContato:u.id}),a=p.find(t=>t.tipoTelefone==="Principal"||t.tipoTelefone==="WhatsApp")||p[0]||null,s=k.find(t=>t.grupo==="Principal")||k[0]||null;let f;return s&&Object.keys(s).length>0&&(f=`${s.logradouro}, ${s.numero} ${s.complemento} - ${s.bairro} - ${s.municipio}/${s.uf}`),u.id&&(this.compra.idContato=u.id,this.compra.descricaoContato=u.nome,this.compra.numeroDocumentoContato=u.numeroDocumentoNacional,this.compra.emailContato=(u==null?void 0:u.email)||null,this.compra.regimeContato=(u==null?void 0:u.regime)||null,this.compra.telefoneContato=(a==null?void 0:a.telefone)||null,this.compra.descricaoContatoEndereco=f||null),this.contatos[u.id]||await this.carregarContatos([u.id]),u},async abrirModalVendedor(){const i=(await $db.contato.leFilhos(this.compra.idContato)).map(p=>p.id),u=await this.selecionarContato({placeholder:"Selecione o vendedor",filtro:{ativo:!0,usuarios:i}});u.id&&(this.compra.idContatoVendedor=u.id),this.contatos[u.id]||await this.carregarContatos([u.id])},async abrirModalTransportador(){const i=await this.selecionarContato({placeholder:"Selecione o transportadora",filtro:{ativo:!0,transportadoras:!0}});i.id&&(this.compra.idContatoTransportadora=i.id),this.contatos[i.id]||await this.carregarContatos([i.id])},async selecionarContato(i){const{placeholder:u,filtro:p}={placeholder:"Selecione o contato",filtro:{ativo:!0},...i},k=await $g.promptContato.show({filtro:p,placeholder:u});if(!k)throw new Error("Contato n\xE3o selecionado");return k},async adicionarItem(){let i={},u=[];for(const p of u)i[p.idItem]={item:await $db.hibrido.le({table:"item",id:p.idItem}),quantidade:p.quantidade};this.adicionar.modal.value=!0,this.adicionar.modal.name="Item"},async selecionarItens(i){var u,p;for(const k in i){let a=await $db.hibrido.lista({table:"estoqueSaldoProdutoEmpresa",whereFilter:{idEmpresa:this.compra.idEmpresa,tipoEstoque:"Dispon\xEDvel",idItem:k}});a=a[0];const s=await $db.configuracoes.porNome("vendas.checaestoque",this.compra.idEmpresa);Number((u=s.find(r=>r.id))==null?void 0:u.valor);const f=i[k].item||{},t=((p=(await $db.hibrido.lista({table:"itemFornecedor",whereFilter:{idItem:f.id}}))[0])==null?void 0:p.referencia)||null,c=i[k].quantidade||0,b=(f==null?void 0:f.valorCustoReposicao)||(a==null?void 0:a.valorCustoMedio)||0;let v=this.compraItens.find(r=>r.idItem===k);const g=(await $erp().cfop.where({cfop:5102}).toArray())[0],_=await $db.financeiroPlanoConta.lePorConfig("financeiro.planocontas.comprageral");if(v)v.quantidade=$utils.arredondar(c,4),v.quantidadeRealizado=$utils.arredondar(c,4),v.subTotal=$utils.arredondar(b,2),v.total=$utils.arredondar(c*b,2);else{const r={dataHoraEmissao:$utils.dataAtual(),dataHoraFinalizado:"",descricaoItem:f.descricao,id:$utils.uuid(),idDocumento:this.compra.id,idItem:f.id,referencia:f.referencia,referenciaFornecedor:t,ncm:f.ncm||null,operacao:"Compra de Mercadoria",operacaoFator:1,idCfop:g==null?void 0:g.id,idPlanoContaEstoque:_==null?void 0:_.id,quantidade:$utils.arredondar(c,4),quantidadeRealizado:$utils.arredondar(c,4),status:"Digita\xE7\xE3o",tipoItem:f.tipo,subTotal:$utils.arredondar(b,2),total:$utils.arredondar(c*b,2),unidade:f.unidade,valorCustoMedio:(a==null?void 0:a.valorCustoMedio)||0,valorItem:b,valorOriginal:b,observacao:""};this.compraItens.push(r),await this.carregarItens([f.id])}this.compra.subTotal=0,this.compra.subTotalProduto=0;for(let r in this.compraItens)this.compra.subTotal+=this.compraItens[r].total,this.compra.subTotalProduto+=this.compraItens[r].total;this.compra.subTotal=$utils.arredondar(this.compra.subTotal,2),this.compra.totalDocumento=this.compra.subTotal}},formatXml(i,u="  "){let p="",k="";return i.split(/>\s*</).forEach(a=>{a.match(/^\/\w/)&&(k=k.substring(u.length)),p+=k+"<"+a+`>
`,a.match(/^<?\w[^>]*[^\/]$/)&&(k+=u)}),p.substring(1,p.length-3)},calcularTotaisItem(i,u){const p=$utils.clonar(this.compraItens[i]),k=p.valorOriginal||0,a=p.quantidade||0;let s=p.valorItem||0,f=p.descontoPercentualItem||0,t=p.descontoItem||0,c=p.subTotal||0,b=p.total||0;u==="descontoPercentualItem"&&((f<0||f>100)&&(f=0),t=s*f/100,c=s-t),u==="descontoItem"&&((t<0||t>s)&&(t=0),f=t/s*100,c=s-t),u==="valorItem"&&(s<k&&(s=k),t>s&&(t=0,f=0),f=t/s*100,c=s-t),u==="subTotal"&&((c<0||c>s)&&(c=s),t=s-c,f=t/s*100),b=a*c,p.valorItem=s,p.descontoItem=t,p.descontoPercentualItem=f,p.subTotal=c,p.total=b,this.compraItens[i]=p,this.calcularTotais("totalDesconto")},calcularTotais(i){const u=$utils.clonar(this.compra);let p=0,k=0,a=0,s=u.totalDesconto||0,f=u.totalPercentualDesconto||0,t=u.valorFrete||0,c=u.valorSeguro||0,b=u.valorOutrasDespesas||0,v=0,g=0,_=0,r=0,w=0;this.erroFrete=!1,this.erroSeguro=!1,this.erroOutrasDespesas=!1;for(const o of this.compraItens)p+=o.total,v+=o.valorBaseIcms||0,g+=o.valorIcms||0,_+=o.valorBaseIcmsSt||0,r+=o.valorIcmsSt||0,w+=o.valorIpi||0;i==="totalPercentualDesconto"&&(this.erroDesconto=!1,(f<0||f>100)&&(this.erroDesconto=!0),s=p*f/100),i==="totalDesconto"&&(this.erroDesconto=!1,(s<0||s>p)&&(this.erroDesconto=!0),f=s/p*100),t<0&&(this.erroFrete=!0),t=u.tipoFrete==="FOB"?t:0,c<0&&(this.erroSeguro=!0),c=u.tipoFrete==="FOB"?c:0,b<0&&(this.erroOutrasDespesas=!0),u.calcularTributacao||(v=0,g=0,_=0,r=0),u.totalComImposto||(w=0),k=p-s+t+c+b,a=k+w,u.valorBaseIcms=$utils.arredondar(v,2),u.valorIcms=$utils.arredondar(g),u.valorBaseIcmsSt=$utils.arredondar(_),u.valorIcmsSt=$utils.arredondar(r),u.valorIpi=$utils.arredondar(w),u.totalDesconto=$utils.arredondar(s),u.totalPercentualDesconto=$utils.arredondar(f),u.subTotalProduto=$utils.arredondar(p),u.totalProduto=$utils.arredondar(p)-$utils.arredondar(s),u.subTotal=$utils.arredondar(k),u.totalDocumento=$utils.arredondar(a),this.compra=u},limpaCampos(i){i.compra={},i.compraOriginal={},i.compraItens=[],i.compraItensOriginal=[],i.compraCondicoesDePagamento=[],i.compraCondicoesDePagamentoOriginal=[],i.compraTitulos=[],i.compraTitulosOriginal=[],i.compraMovimentacoes=[],i.compraMovimentacoesOriginal=[],i.compraDocumentoXml=[],i.compraDocumentoXmlOriginal=[]},async salvar(){this.compra.totalComImposto&&delete this.compra.totalComImposto;for(const i of this.compraItens)i.dataHoraFinalizado=this.compra.dataHoraFinalizado,i.status=this.compra.status;this.compra.id?await $db.hibrido.grava("documento",{atual:this.compra,original:this.compraOriginal}):this.compraOriginal.id&&await $db.hibrido.remove("documento",this.compraOriginal),await $db.hibrido.gravaLista("documentoItem",{atual:this.compraItens,original:this.compraItensOriginal}),await $db.hibrido.gravaLista("documentoCondicaoPagamento",{atual:this.compraCondicoesDePagamento,original:this.compraCondicoesDePagamentoOriginal}),await $db.hibrido.gravaLista("financeiroTitulo",{atual:this.compraTitulos,original:this.compraTitulosOriginal}),await $db.hibrido.gravaLista("financeiroMovimentacao",{atual:this.compraMovimentacoes,original:this.compraMovimentacoesOriginal}),await $db.hibrido.gravaLista("documentoXML",{atual:this.compraDocumentoXml,original:this.compraDocumentoXmlOriginal}),this.compra.totalComImposto=!0,this.calculaKardex()},async calculaKardex(){const i=$utils.logarIni("calculaKardex"),u=this.compraItens.map(({idItem:p})=>p).filter(Boolean);try{u.length&&await $utils.geeksApi({calculaKardex:{funcao:"9913E9FD-24A5-4C0A-9F1E-AACCDC7EAB9D",idsItem:u}})}catch(p){console.error(`Erro ao calcular Kardex
`,p)}$utils.logarFim(i,u.length)},async reabrir_click(){!await $q.dialogSimNao({title:"Reabertura",message:`Deseja reabrir o documento?<br/>${this.compra.naoGerarFinanceiro?"":"<strong>O Financeiro ser\xE1 apagado!</strong>"}`,html:!0})||await $tryLoading(async()=>{await this.retornarParaDigitacao(),await this.salvar(),await this.atualizar(),$q.notifyPositive("Documento reaberto para digita\xE7\xE3o!")},{mensagem:"Reabrindo..."})},async retornarParaDigitacao(){$utils.verificarErro(this.compra.status!=="Finalizado","N\xE3o \xE9 poss\xEDvel realizar esta opera\xE7\xE3o em documento n\xE3o finalizado.");const i=this.compraTitulos.filter(({dataPagamento:u})=>u);$utils.verificarErro(i.length,"N\xE3o \xE9 poss\xEDvel excluir o Financeiro. Parcelas provisionadas j\xE1 pagas!"),this.compra.dataHoraFinalizado="",this.compra.status="Digita\xE7\xE3o",this.compra.operacao==="Pedido de Compra"&&(this.compraTitulos=[],this.compraMovimentacoes=[])},async removerPagamento_click(i){try{this.compraCondicoesDePagamento=this.compraCondicoesDePagamento.filter(u=>u.id!==i.id),this.compraCondicoesDePagamento.sort((u,p)=>{let k=new Date(u.dataVencimento),a=new Date(p.dataVencimento);return k-a}),await this.atualizaValorTotalPagamento({condicao:i,acao:"remover"})}catch(u){console.log(u.message)}},async gerarCondicoesDePagamento_click(){var i;try{let u=this.compra.id,p=this.compra.condicaoPagamento,k=(i=this.compra.notaNumero)!=null?i:null;this.compra.naoGerarFinanceiro||await this.gerarParcelamento(u,p,k),this.compra.naoGerarFinanceiro&&(this.compraCondicoesDePagamento=[])}catch(u){console.log(u.message)}},async gerarParcelamento(i,u,p){var g;this.compraCondicoesDePagamento=[];const k=$utils.clonar(this.compra),a=u.split("/").length,s=!!(k!=null&&k.dataCompra)&&(k==null?void 0:k.dataCompra)!==""?k.dataCompra:!!(k!=null&&k.dataHoraPrevisto)&&(k==null?void 0:k.dataHoraPrevisto)!==""?k.dataHoraPrevisto:!!this.dataPrevistaEntrega&&this.dataPrevistaEntrega!==""?new Date(this.dataPrevistaEntrega):$utils.dataAtual(),f=(k==null?void 0:k.freteSeparado)||0;let t=$utils.arredondar(k==null?void 0:k.totalDocumento,2);const c=((k==null?void 0:k.valorFrete)||0)+((k==null?void 0:k.valorSeguro)||0);if(f&&(k==null?void 0:k.tipoFrete)==="FOB"&&c>0){let _={id:$utils.uuid(),idDocumento:k==null?void 0:k.id,dataVencimento:s,valor:c,observacao:"Valor Frete + Seguro",freteSeparado:!0};this.compraCondicoesDePagamento.push(_),t-=c}let b=0,v=t/a;for(let _ in u.split("/")){let r=!!(k!=null&&k.dataCompra)&&(k==null?void 0:k.dataCompra)!==""?k.dataCompra:!!(k!=null&&k.dataHoraPrevisto)&&(k==null?void 0:k.dataHoraPrevisto)!==""?k.dataHoraPrevisto:!!this.dataPrevistaEntrega&&this.dataPrevistaEntrega!==""?new Date(this.dataPrevistaEntrega):$utils.dataAtual();typeof r=="string"&&(r=(g=new Date(r))!=null?g:$utils.dataAtual()),r.setDate(r.getDate()+parseInt(u.split("/")[_])||0);let w={id:$utils.uuid(),idDocumento:k==null?void 0:k.id,dataVencimento:Ot.formatDate(r),valor:v,observacao:""};this.compraCondicoesDePagamento.push(w),b+=v||0}t!==b&&(this.compraCondicoesDePagamento[0].valor+=(t||0)-(b||0)),this.valorTotalPagamento=f&&(k==null?void 0:k.tipoFrete)==="FOB"?t+c:t},async gerarFinanceiro(){var f,t;const i=await $db.financeiroPlanoConta.lePorConfig("financeiro.planocontas.comprageral"),u=[];for(const c of this.compraItens){if(c.idPlanoContaEstoque===i.id)continue;const b=(c.total||0)-(c.descontoTotalRateado||0),v=u.findIndex(({idPlanoContaEstoque:g})=>g===c.idPlanoContaEstoque);v!==-1?u[v].valor+=b:u.push({idPlanoContaEstoque:c.idPlanoContaEstoque,idPlanoContaDestino:"",valor:b,porcentagem:0})}for(const c of u)c.valor=$utils.arredondar(c.valor),c.porcentagem=$utils.arredondar(c.valor/this.compra.totalDocumento,4);const p=await $db.financeiroPlanoConta.lePorConfig("financeiro.planocontas.freteaquisicao"),k=this.compraTitulos.filter(({dataPagamento:c})=>c);$utils.verificarErro(k.length,"N\xE3o \xE9 poss\xEDvel regerar o Financeiro. Parcelas provisionadas j\xE1 pagas!");const a=Ot.formatDate(new Date().setHours(0,0,0,0));this.compraTitulos=[];for(const c in this.compraCondicoesDePagamento){const b=this.compraCondicoesDePagamento[c],v=[b.observacao,this.compra.codigoDocumento?`Pedido de Compra: ${this.compra.codigoDocumento}`:"",this.compra.notaNumero?`Nota nro: ${this.compra.notaNumero}`:""].filter(Boolean).join(" | "),g={id:$utils.uuid(),dataEmissao:a,dataCompetencia:a,dataVencimento:Ot.formatDate(new Date(b.dataVencimento).setHours(0,0,0,0)),dataVencimentoOriginal:Ot.formatDate(new Date(b.dataVencimento).setHours(0,0,0,0)),valor:$utils.arredondar(b.valor,2),tipoJuros:"dia",valorMulta:0,percentualJuros:0,documentoTipo:this.compra.operacao,parcela:`${Number(c)+1}/${this.compraCondicoesDePagamento.length}`,descricao:this.compra.operacao,observacao:v,formaDePagamento:this.compra.operacao!=="Pedido de Compra"?`Provis\xE3o Pedido - ${(f=this.compra.formaDePagamento)!=null?f:""}`:(t=this.compra.formaDePagamento)!=null?t:"",receberPagar:0,valorOriginal:$utils.arredondar(b.valor,2),documentoVinculado:1,valorTotal:$utils.arredondar(b.valor,2),valorARealizar:$utils.arredondar(b.valor,2),valorDesconto:0,percentualDesconto:0,idEmpresa:this.compra.idEmpresa,idContato:(b==null?void 0:b.freteSeparado)&&!!this.compra.idContatoTransportadora?this.compra.idContatoTransportadora:this.compra.idContato,idFinanceiroPlanoConta:b.observacao==="Valor Frete + Seguro"?p.id:i==null?void 0:i.id,documentoId:this.compra.id,idFinanceiroMovimentacaoAgrupamentoAutomatico:$utils.uuid(),cobrancaAtivo:1};this.compraTitulos.push(g)}const s=$utils.uuid();this.compraMovimentacoes=[];for(const c of u){const b={id:$utils.uuid(),idFinanceiroMovimentacaoN:s,idEmpresa:this.compra.idEmpresa,idFinanceiroPlanoConta:i.id,dataEmissao:a,valorCredito:this.compra.totalDocumento*c.porcentagem,valorDebito:0,descricao:i.descricao.trim(),observacao:"",automatico:0,liquidando:0,dataCompetencia:a,dataVencimento:a,dataMovimento:a,documentoTipo:this.compra.operacao,documentoId:this.compra.id};this.compraMovimentacoes.push(b);const v=await $db.financeiroPlanoConta.leCache({id:c.idPlanoContaEstoque}),g={id:$utils.uuid(),idFinanceiroMovimentacaoN:s,idEmpresa:this.compra.idEmpresa,idFinanceiroPlanoConta:c.idPlanoContaEstoque,dataEmissao:a,valorCredito:0,valorDebito:this.compra.totalDocumento*c.porcentagem,descricao:v.descricao.trim(),observacao:"",automatico:0,liquidando:0,dataCompetencia:a,dataVencimento:a,dataMovimento:a,documentoTipo:this.compra.operacao,documentoId:this.compra.id};this.compraMovimentacoes.push(g)}},async atualizaValorTotalPagamento({condicao:i,acao:u}){!i||u==="remover"&&(this.valorTotalPagamento=this.valorTotalPagamento-i.valor)},async ajustarPrevisaoEntrega(i){i==="alterar"&&(this.alterarPrevisaoEntrega=!0),i==="salvar"&&(await $tryLoading(async()=>{const u=`${this.dataPrevistaEntrega} ${this.horaPrevistaEntrega||"00:00:00"}`;$utils.verificarErro(!this.dataPrevistaEntrega&&this.horaPrevistaEntrega,"\xC9 necess\xE1rio preencher uma data em conjunto com a hora."),Ot.formatDate(u)!==Ot.formatDate(this.compra.dataHoraPrevisto)?(this.compra.dataHoraPrevisto=Ot.formatDate(u)||"",await this.salvar(),await this.atualizar(),$q.notifyPositive("A previs\xE3o foi salva com sucesso")):$q.notifyPositive("N\xE3o h\xE1 dados alterados.")}),this.alterarPrevisaoEntrega=!1)}}},Le={class:"row items-center"},Me={class:"col-auto"},je={class:"col-auto"},$e=ft("span",{class:"q-px-xs"},"|",-1);function He(i,u,p,k,a,s){const f=ct("g-label"),t=ct("g-col"),c=ct("Badge"),b=ct("BadgeCopiarUid"),v=ct("g-row"),g=ct("avatar"),_=ct("campo"),r=ct("ModalEditarProdutoCompras"),w=ct("PromptItemV2");return Q(),kt(Nt,null,[e(ae,{modelValue:i.visivel,"onUpdate:modelValue":u[31]||(u[31]=o=>i.visivel=o),persistent:"",maximized:"",onKeyup:ve(s.fechar,["esc"])},{default:l(()=>[e(Yt,{view:"hHh lpR lFr",container:"",class:"bg-light"},{default:l(()=>[e(Jt,null,{default:l(()=>[e(Rt,null,{default:l(()=>[e(ht,{onClick:s.fechar,icon:"arrow_back",flat:"",round:"",dense:""},null,8,["onClick"]),e(Lt,null,{default:l(()=>[M(et(i.compra.operacao),1)]),_:1}),gt(e(ht,{onClick:s.salvar_click,label:"Salvar",color:"white","text-color":"primary",unelevated:"",class:"q-ml-sm"},null,8,["onClick"]),[[Dt,i.compra.status==="Digita\xE7\xE3o"]])]),_:1})]),_:1}),e(te,{class:"u-container"},{default:l(()=>[e(ee,null,{default:l(()=>[e(v,{gutter:"md",mg:"md",bg:"bg-white"},{default:l(()=>[e(t,{col:"12 sm12 md6"},{default:l(()=>[e(v,{items:"center",justify:"end",class:"hideondesktop",style:{border:"1px solid salmon"}},{default:l(()=>[e(t,{col:"xs-shrink",order:"1 sm0"},{default:l(()=>[gt(e(f,{text:"caption",icon:"mdi-calendar-today sm tertiary left",tip:`Emitido \xE1s ${i.$filters.hora(i.compra.dataHoraEmissao)}`},{default:l(()=>[M(et(i.$filters.data(i.compra.dataHoraEmissao)),1)]),_:1},8,["tip"]),[[Dt,i.compra.dataHoraEmissao]])]),_:1}),e(t,{col:"xs-shrink",order:"1 sm0"},{default:l(()=>[gt(e(f,{text:"caption",icon:"mdi-calendar-today sm tertiary left",tip:`Finalizado \xE1s ${i.$filters.hora(i.compra.dataHoraFinalizado)}`},{default:l(()=>[M(et(i.$filters.data(i.compra.dataHoraFinalizado)),1)]),_:1},8,["tip"]),[[Dt,i.compra.dataHoraFinalizado]])]),_:1}),e(t,{col:"xs12 sm-shrink",order:"0 sm1",text:"right"},{default:l(()=>[e(c,{cor:i.compra.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:i.compra.status!=="Digita\xE7\xE3o",class:"q-ml-sm"},{default:l(()=>[M(et(i.compra.status),1)]),_:1},8,["cor","escuro"]),e(b,{id:i.compra.id,numero:i.compra.numero,cor:"positive",class:"q-ml-sm"},null,8,["id","numero"])]),_:1})]),_:1}),e(v,null,{default:l(()=>[e(t,{col:"12 sm6"},{default:l(()=>[e(v,null,{default:l(()=>[e(t,{col:"xs-shrink"},{default:l(()=>{var o,d;return[e(g,{imagem:(o=i.contatos[i.compra.idContato])==null?void 0:o.imagem,rotulo:(d=i.contatos[i.compra.idContato])==null?void 0:d.apelido,tamanho:"50"},null,8,["imagem","rotulo"])]}),_:1}),e(t,{col:"xs"},{default:l(()=>{var o;return[e(_,{modelValue:(o=i.contatos[i.compra.idContato])==null?void 0:o.apelido,"somente-leitura":"",after:[{icon:"edit",handler(){s.abrirModalFornecedor()}}],disable:i.compra.status!=="Digita\xE7\xE3o",rotulo:"Fornecedor",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","after","disable"])]}),_:1})]),_:1})]),_:1}),e(t,{col:"12 sm6"},{default:l(()=>{var o;return[e(_,{modelValue:(o=i.contatos[i.compra.idContatoVendedor])==null?void 0:o.apelido,"somente-leitura":"",disable:i.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){s.abrirModalVendedor()}}],rotulo:"Vendedor",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]}),_:1}),e(t,{col:"12 sm6"},{default:l(()=>{var o;return[e(_,{modelValue:(o=i.contatos[i.compra.idEmpresa])==null?void 0:o.apelido,"somente-leitura":"",after:[{icon:"edit",handler(){s.abrirModalEmpresa()}}],disable:i.compra.status!=="Digita\xE7\xE3o",rotulo:"Empresa",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","after","disable"])]}),_:1}),e(t,{col:"12 sm6"},{default:l(()=>{var o;return[e(_,{modelValue:(o=i.contatos[i.compra.idContatoComprador])==null?void 0:o.apelido,"somente-leitura":"",disable:i.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){s.abrirModalComprador()}}],rotulo:"Comprador",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]}),_:1}),e(t,{col:"12 sm6"},{default:l(()=>{var o;return[e(_,{modelValue:(o=i.contatos[i.compra.idContatoTransportadora])==null?void 0:o.apelido,"somente-leitura":"",disable:i.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){s.abrirModalTransportador()}}],rotulo:"Transportadora",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]}),_:1}),e(t,{col:"12 sm6"},{default:l(()=>[e(v,null,{default:l(()=>[e(t,{col:"7"},{default:l(()=>[e(me,{modelValue:i.dataPrevistaEntrega,"onUpdate:modelValue":u[0]||(u[0]=o=>i.dataPrevistaEntrega=o),disable:!this.alterarPrevisaoEntrega&&this.compra.status!=="Digita\xE7\xE3o",type:"date",label:"Data Prevista de Entrega",clearable:"",dense:"","stack-label":"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable"])]),_:1}),e(t,{col:"5"},{default:l(()=>[e(me,{modelValue:i.horaPrevistaEntrega,"onUpdate:modelValue":u[1]||(u[1]=o=>i.horaPrevistaEntrega=o),disable:!this.alterarPrevisaoEntrega&&this.compra.status!=="Digita\xE7\xE3o",type:"time",label:"Hora Prevista de Entrega",clearable:"",dense:"","stack-label":"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(t,{col:"12 sm12 md6"},{default:l(()=>[e(v,{justify:"end",items:"center",text:"right",class:"hideonmobile"},{default:l(()=>[e(t,{col:"12"},{default:l(()=>[e(v,{justify:"end",items:"center"},{default:l(()=>[e(c,{cor:i.compra.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:i.compra.status!=="Digita\xE7\xE3o"},{default:l(()=>[M(et(i.compra.status),1)]),_:1},8,["cor","escuro"]),e(b,{id:i.compra.id,numero:i.compra.numero,cor:"positive",class:"q-ml-sm"},null,8,["id","numero"]),e(ht,{color:"tertiary",flat:"",icon:"more_vert",round:""},{default:l(()=>[e(Qt,null,{default:l(()=>[gt((Q(),ot(xt,{link:"",separator:""},{default:l(()=>[i.alterarPrevisaoEntrega?(Q(),ot(It,{key:1,clickable:"",onClick:u[3]||(u[3]=o=>s.ajustarPrevisaoEntrega("salvar"))},{default:l(()=>[e(nt,{avatar:""},{default:l(()=>[e(Et,{name:"local_shipping"})]),_:1}),e(nt,null,{default:l(()=>[e(vt,null,{default:l(()=>[M("Salvar Previs\xE3o de Entrega")]),_:1})]),_:1})]),_:1})):(Q(),ot(It,{key:0,disable:i.compra.status==="Digita\xE7\xE3o",clickable:"",onClick:u[2]||(u[2]=o=>s.ajustarPrevisaoEntrega("alterar"))},{default:l(()=>[e(nt,{avatar:""},{default:l(()=>[e(Et,{name:"local_shipping"})]),_:1}),e(nt,null,{default:l(()=>[e(vt,null,{default:l(()=>[M("Alterar Previs\xE3o de Entrega")]),_:1})]),_:1})]),_:1},8,["disable"]))]),_:1})),[[Tt]])]),_:1})]),_:1})]),_:1})]),_:1}),e(t,{col:"shrink"},{default:l(()=>[gt(e(f,{text:"caption",icon:"mdi-calendar-today sm tertiary left",tip:`Emitido \xE1s ${i.$filters.hora(i.compra.dataHoraEmissao)}`},{default:l(()=>[M(et(i.$filters.data(i.compra.dataHoraEmissao)),1)]),_:1},8,["tip"]),[[Dt,i.compra.dataHoraEmissao]])]),_:1}),e(t,{col:"shrink"},{default:l(()=>[gt(e(f,{text:"caption",icon:"mdi-calendar sm tertiary left",tip:`Finalizado \xE1s ${i.$filters.hora(i.compra.dataHoraFinalizado)}`},{default:l(()=>[M(et(i.$filters.data(i.compra.dataHoraFinalizado)),1)]),_:1},8,["tip"]),[[Dt,i.compra.dataHoraFinalizado]])]),_:1})]),_:1}),e(v,null,{default:l(()=>[e(t,null,{default:l(()=>[e(_,{modelValue:i.compra.observacao,"onUpdate:modelValue":u[4]||(u[4]=o=>i.compra.observacao=o),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",tipo:"textoArea",rotulo:"Observa\xE7\xE3o",rows:"4"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})]),_:1})]),_:1}),e(v,{gutter:"md",mg:"md",bg:"bg-white"},{default:l(()=>[i.exibeInfNota?(Q(),ot(Ee,{key:0,"default-opened":i.compra.notaNumero>0||i.documentoNovo,"header-class":"q-px-sm",class:"notaEntrada g-col col-12"},{header:l(()=>[e(nt,null,{default:l(()=>[e(f,{text:"sub1 medium",icon:"mdi-file-replace sm tertiary left"},{default:l(()=>[M("Nota de Entrada")]),_:1})]),_:1})]),default:l(()=>[e(t,{col:"12"},{default:l(()=>[e(v,null,{default:l(()=>[e(t,{col:"12 sm6 md3"},{default:l(()=>[e(_,{modelValue:i.compra.notaNumero,"onUpdate:modelValue":u[5]||(u[5]=o=>i.compra.notaNumero=o),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Numero",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),e(t,{col:"12 sm6 md3"},{default:l(()=>[e(_,{modelValue:i.compra.notaSerie,"onUpdate:modelValue":u[6]||(u[6]=o=>i.compra.notaSerie=o),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Serie",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),e(t,{col:"12 sm6 md3"},{default:l(()=>[e(_,{modelValue:i.compra.naturezaOperacao,"onUpdate:modelValue":u[7]||(u[7]=o=>i.compra.naturezaOperacao=o),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Natureza da Opera\xE7\xE3o",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),e(t,{col:"12 sm6 md3"},{default:l(()=>[e(_,{modelValue:i.compra.dataCompra,"onUpdate:modelValue":u[8]||(u[8]=o=>i.compra.dataCompra=o),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Data compra",tipo:"data",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),e(t,{col:"12"},{default:l(()=>[e(_,{modelValue:i.compra.chaveAcesso,"onUpdate:modelValue":u[9]||(u[9]=o=>i.compra.chaveAcesso=o),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Chave",dense:""},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})]),_:1})]),_:1},8,["default-opened"])):ut("",!0)]),_:1}),e(v,{gutter:"md",mg:"md",bg:"bg-white"},{default:l(()=>[e(t,{col:"12"},{default:l(()=>[e(f,{text:"sub1 medium",icon:"shopping_cart sm tertiary left"},{default:l(()=>[M("Carrinho "),e(ht,{onClick:u[10]||(u[10]=o=>s.adicionarItem()),disable:i.compra.status!=="Digita\xE7\xE3o",icon:"add",label:"Produto",size:"md",color:"primary",flat:"",dense:"",class:"float-right q-px-sm"},null,8,["disable"])]),_:1})]),_:1}),(Q(!0),kt(Nt,null,Ut(i.compraItens,(o,d)=>(Q(),ot(t,{col:"12",key:d},{default:l(()=>[e(xt,{class:"full-width"},{default:l(()=>[e(It,{class:"q-px-none"},{default:l(()=>{var h;return[e(nt,{avatar:"",class:"col-auto"},{default:l(()=>{var I;return[e(g,{imagem:(I=i.produtos[o.idItem])==null?void 0:I.imagem,rotulo:o.descricaoItem,tamanho:"50"},null,8,["imagem","rotulo"])]}),_:2},1024),e(nt,{class:"q-px-none"},{default:l(()=>[e(vt,null,{default:l(()=>[M(et(o.descricaoItem),1)]),_:2},1024),e(vt,{caption:""},{default:l(()=>{var I,E;return[M(et((E=(I=i.produtos[o.idItem])==null?void 0:I.marca)!=null?E:""),1)]}),_:2},1024)]),_:2},1024),gt(e(nt,{avatar:""},{default:l(()=>[e(c,{denso:""},{default:l(()=>{var I,E;return[M(et((E=(I=i.produtos[o.idItem])==null?void 0:I.referencia)!=null?E:""),1)]}),_:2},1024)]),_:2},1536),[[Dt,(h=i.produtos[o.idItem])==null?void 0:h.referencia]]),e(nt,{avatar:""},{default:l(()=>[ft("div",Le,[ft("div",Me,[e(ht,{color:"primary",dense:"",flat:"",icon:"edit",round:"",onClick:I=>s.editarProduto(o),disable:i.compra.status!=="Digita\xE7\xE3o"},null,8,["onClick","disable"])]),ft("div",je,[e(ht,{color:"tertiary",dense:"",flat:"",icon:"delete",round:"",onClick:I=>s.removerItem(o),disable:i.compra.status!=="Digita\xE7\xE3o"},{default:l(()=>[e(St,{anchor:"bottom middle",self:"center middle"},{default:l(()=>[M("Remover Item")]),_:1})]),_:2},1032,["onClick","disable"])])])]),_:2},1024)]}),_:2},1024)]),_:2},1024),e(v,null,{default:l(()=>[e(t,{col:"4 md"},{default:l(()=>[e(_,{dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"",rotulo:"Valor do produto",modelValue:o.valorItem,"onUpdate:modelValue":h=>o.valorItem=h,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",onBlur:h=>s.calcularTotaisItem(d,"valorItem")},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),_:2},1024),e(t,{col:"4 md"},{default:l(()=>[e(v,{items:"center"},{default:l(()=>[e(t,{col:"shrink"},{default:l(()=>[e(Et,{name:"mdi-minus",color:"primary"})]),_:1}),e(t,{col:"xs"},{default:l(()=>[e(_,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",rotulo:"Desconto percentual",modelValue:o.descontoPercentualItem,"onUpdate:modelValue":h=>o.descontoPercentualItem=h,outlined:"",suffix:"%","somente-leitura":i.compra.status!=="Digita\xE7\xE3o",onBlur:h=>s.calcularTotaisItem(d,"descontoPercentualItem")},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(t,{col:"4 md"},{default:l(()=>[e(_,{dense:"",tipo:"decimal",modelValue:o.descontoItem,"onUpdate:modelValue":h=>o.descontoItem=h,decimals:"4",zerosDireita:"2",outlined:"",rotulo:"Desconto em reais",prefix:"R$",onBlur:h=>s.calcularTotaisItem(d,"descontoItem"),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","somente-leitura"])]),_:2},1024),e(t,{col:"6 md"},{default:l(()=>[e(v,{items:"center"},{default:l(()=>[e(t,{col:"shrink",class:"hideonmobile"},{default:l(()=>[e(Et,{name:"mdi-equal",color:"primary"})]),_:1}),e(t,{col:"xs"},{default:l(()=>[e(_,{dense:"",outlined:"",opcoes:{maximumValue:10,minimumValue:0},rotulo:"Subtotal",tipo:"decimal",decimals:"4",zerosDireita:"2",modelValue:o.subTotal,"onUpdate:modelValue":h=>o.subTotal=h,onBlur:h=>s.calcularTotaisItem(d,"subTotal"),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","somente-leitura"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(t,{col:"6 md"},{default:l(()=>[e(v,{items:"center"},{default:l(()=>[e(t,{col:"shrink"},{default:l(()=>[e(Et,{name:"mdi-close",color:"primary"})]),_:1}),e(t,{col:"xs"},{default:l(()=>[e(_,{dense:"",max:"100",min:"0",outlined:"",modelValue:o.quantidade,"onUpdate:modelValue":h=>o.quantidade=h,decimals:"4",zerosDireita:"0",tipo:"quantidade",onBlur:h=>s.calcularTotaisItem(d),disable:i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","disable"]),e(St,{anchor:"bottom middle",self:"center middle"},{default:l(()=>[M("Quantidade")]),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1024),e(t,{col:"12 md"},{default:l(()=>[e(v,{items:"center"},{default:l(()=>[e(t,{col:"shrink",class:"hideonmobile"},{default:l(()=>[e(Et,{name:"mdi-equal",color:"primary"})]),_:1}),e(t,{col:"xs"},{default:l(()=>[e(_,{dense:"",tipo:"decimal",decimals:"2",rotulo:"Total","somente-leitura":"",modelValue:o.total,"onUpdate:modelValue":h=>o.total=h,outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),e(t,{col:"12"},{default:l(()=>[e(v,{gutter:"md",mg:"md-y",justify:"end",items:"center",bg:"bg-light","rounded-borders":"","min-height":"49px"},{default:l(()=>[e(t,{col:"3 sm2 md-shrink",text:"bold"},{default:l(()=>[M(" Calcular ")]),_:1}),e(t,{col:"9 sm10 md"},{default:l(()=>[e(qt,{modelValue:i.compra.calcularTributacao,"onUpdate:modelValue":[u[11]||(u[11]=o=>i.compra.calcularTributacao=o),s.calcularTotais],"checked-icon":"check",color:"green","unchecked-icon":"clear",disable:i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),e(t,{col:"6 md-shrink"},{default:l(()=>[M(" Base ICMS ")]),_:1}),e(t,{col:"6 md",text:"right"},{default:l(()=>[e(_,{dense:"",outlined:"",decimals:"2",zerosDireita:"2",tipo:"decimal",modelValue:i.compra.valorBaseIcms,"onUpdate:modelValue":u[12]||(u[12]=o=>i.compra.valorBaseIcms=o),"somente-leitura":!!i.compra.calcularTributacao||i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somente-leitura"])]),_:1}),e(t,{col:"6 md-shrink"},{default:l(()=>[M(" Valor ICMS ")]),_:1}),e(t,{col:"6 md",text:"right"},{default:l(()=>[e(_,{dense:"",outlined:"",modelValue:i.compra.valorIcms,"onUpdate:modelValue":u[13]||(u[13]=o=>i.compra.valorIcms=o),decimals:"2",zerosDireita:"2",tipo:"decimal","somente-leitura":!!i.compra.calcularTributacao||i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somente-leitura"])]),_:1}),e(t,{col:"6 md-shrink"},{default:l(()=>[M(" Base ICMS ST ")]),_:1}),e(t,{col:"6 md",text:"right"},{default:l(()=>[e(_,{dense:"",outlined:"",modelValue:i.compra.valorBaseIcmsSt,"onUpdate:modelValue":u[14]||(u[14]=o=>i.compra.valorBaseIcmsSt=o),decimals:"2",zerosDireita:"2",tipo:"decimal","somente-leitura":!!i.compra.calcularTributacao||i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somente-leitura"])]),_:1}),e(t,{col:"6 md-shrink"},{default:l(()=>[M(" ICMS ST ")]),_:1}),e(t,{col:"6 md",text:"right"},{default:l(()=>[e(_,{dense:"",outlined:"",modelValue:i.compra.valorIcmsSt,"onUpdate:modelValue":u[15]||(u[15]=o=>i.compra.valorIcmsSt=o),decimals:"2",zerosDireita:"2",tipo:"decimal","somente-leitura":!!i.compra.calcularTributacao||i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1}),e(v,{mg:"lg-t",justify:"end"},{default:l(()=>[e(t,{col:"xs12 sm8 md4"},{default:l(()=>[e(v,{items:"center"},{default:l(()=>[e(t,{col:"3",text:"bold"},{default:l(()=>[M(" Subtotal ")]),_:1}),e(t,{col:"xs",text:"right bold"},{default:l(()=>[M(et(i.$filters.numero(i.compra.subTotalProduto,2)),1)]),_:1})]),_:1}),e(ne,{class:"q-mb-md q-mt-xs"}),e(v,{items:"center"},{default:l(()=>[e(t,{col:"xs3"},{default:l(()=>[M(" Desconto ")]),_:1}),e(t,{col:"xs"},{default:l(()=>[e(_,{tipo:"decimal",decimals:"2",modelValue:i.compra.totalPercentualDesconto,"onUpdate:modelValue":u[16]||(u[16]=o=>i.compra.totalPercentualDesconto=o),onBlur:u[17]||(u[17]=o=>s.calcularTotais("totalPercentualDesconto")),suffix:"%",error:i.erroDesconto,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","error","somente-leitura"])]),_:1}),e(t,{col:"xs"},{default:l(()=>[e(_,{tipo:"decimal",decimals:"2",modelValue:i.compra.totalDesconto,"onUpdate:modelValue":u[18]||(u[18]=o=>i.compra.totalDesconto=o),onBlur:u[19]||(u[19]=o=>s.calcularTotais("totalDesconto")),error:i.erroDesconto,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","error","somente-leitura"])]),_:1})]),_:1}),e(v,{items:"center"},{default:l(()=>[e(t,{col:"xs3"},{default:l(()=>[M(" Frete ")]),_:1}),e(t,{col:"xs"},{default:l(()=>[e(fe,{class:"q-mr-md",label:"CIF",val:"CIF",modelValue:i.compra.tipoFrete,"onUpdate:modelValue":[u[20]||(u[20]=o=>i.compra.tipoFrete=o),s.calcularTotais],dense:"",disable:i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"]),e(fe,{label:"FOB",val:"FOB",modelValue:i.compra.tipoFrete,"onUpdate:modelValue":[u[21]||(u[21]=o=>i.compra.tipoFrete=o),s.calcularTotais],dense:"",disable:i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),e(t,{col:"xs"},{default:l(()=>[e(_,{tipo:"decimal",decimals:"2",modelValue:i.compra.valorFrete,"onUpdate:modelValue":u[22]||(u[22]=o=>i.compra.valorFrete=o),onBlur:s.calcularTotais,error:i.erroFrete,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),e(v,{items:"center"},{default:l(()=>[e(t,{col:"xs3"},{default:l(()=>[M(" Seguro ")]),_:1}),e(t,{col:"xs"},{default:l(()=>[e(_,{tipo:"decimal",decimals:"2",modelValue:i.compra.valorSeguro,"onUpdate:modelValue":u[23]||(u[23]=o=>i.compra.valorSeguro=o),onBlur:s.calcularTotais,error:i.erroSeguro,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),e(v,{items:"center"},{default:l(()=>[e(t,{col:"xs5"},{default:l(()=>[M(" Outras despesas ")]),_:1}),e(t,{col:"xs"},{default:l(()=>[e(_,{tipo:"decimal",decimals:"2",modelValue:i.compra.valorOutrasDespesas,"onUpdate:modelValue":u[24]||(u[24]=o=>i.compra.valorOutrasDespesas=o),onBlur:s.calcularTotais,error:i.erroOutrasDespesas,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),e(ne,{class:"q-mt-md q-mb-xs"}),e(v,{items:"center"},{default:l(()=>[e(t,{col:"xs4",text:"bold"},{default:l(()=>[M(" Total ")]),_:1}),e(t,{col:"xs",text:"right bold"},{default:l(()=>[M(et(i.$filters.numero(i.compra.totalProduto,2)),1)]),_:1})]),_:1}),i.compra.totalComImposto?(Q(),ot(v,{key:0,items:"center"},{default:l(()=>[e(t,{col:"xs4",text:"bold"},{default:l(()=>[M(" Total IPI ")]),_:1}),e(t,{col:"xs",text:"right bold"},{default:l(()=>[M(et(i.$filters.numero(i.compra.valorIpi,2)),1)]),_:1})]),_:1})):ut("",!0),e(v,{items:"center"},{default:l(()=>[e(t,{col:"xs5",text:"bold"},{default:l(()=>[M(" Total c/ Impostos ")]),_:1}),e(t,{col:"xs-shrink"},{default:l(()=>[e(qt,{disable:i.compra.status!=="Digita\xE7\xE3o",modelValue:i.compra.totalComImposto,"onUpdate:modelValue":[u[25]||(u[25]=o=>i.compra.totalComImposto=o),s.calcularTotais],"checked-icon":"check",color:"green","unchecked-icon":"clear"},null,8,["disable","modelValue","onUpdate:modelValue"])]),_:1}),e(t,{col:"xs",text:"right bold"},{default:l(()=>[M(et(i.$filters.numero(i.compra.totalDocumento,2)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(v,{gutter:"md",mg:"md",bg:"bg-white"},{default:l(()=>[e(t,{col:"12"},{default:l(()=>[e(f,{text:"sub1 medium",icon:"credit_card sm tertiary left"},{default:l(()=>[M("Faturar")]),_:1})]),_:1}),e(t,{col:"12"},{default:l(()=>[e(_,{modelValue:i.compra.observacaoFaturamento,"onUpdate:modelValue":u[26]||(u[26]=o=>i.compra.observacaoFaturamento=o),tipo:"textoArea",rotulo:"Observa\xE7\xE3o faturamento",rows:"5"},null,8,["modelValue"])]),_:1}),e(t,{col:"12"},{default:l(()=>[e(Se,{ref:"formAdicionarPagamento"},{default:l(()=>[e(v,{mg:"md-y",items:"center"},{default:l(()=>[e(t,{col:"12 sm6 md"},{default:l(()=>[e(_,{modelValue:i.compra.formaDePagamento,"onUpdate:modelValue":u[27]||(u[27]=o=>i.compra.formaDePagamento=o),rules:i.formaPagamentoRules,ajuda:"Exemplo: Boleto","somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Forma de pagamento"},null,8,["modelValue","rules","somente-leitura"])]),_:1}),e(t,{col:"12 sm6 md"},{default:l(()=>[e(_,{modelValue:i.compra.condicaoPagamento,"onUpdate:modelValue":u[28]||(u[28]=o=>i.compra.condicaoPagamento=o),rules:i.condicaoPagamentoRules,ajuda:"Exemplo: 28/56/64","somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Cond. Pag",tipo:"numero"},null,8,["modelValue","rules","somente-leitura"])]),_:1}),e(t,{col:"12 sm4 md",text:"bold",class:"q-my-sm"},{default:l(()=>[M(" Frete Separado "),e(qt,{modelValue:i.compra.freteSeparado,"onUpdate:modelValue":[u[29]||(u[29]=o=>i.compra.freteSeparado=o),s.calcularTotais],disable:i.compra.status!=="Digita\xE7\xE3o",dense:"",class:"q-ml-sm"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),e(t,{col:"12 sm4 md",text:"bold",class:"q-my-sm"},{default:l(()=>[M(" N\xE3o gerar financeiro "),e(qt,{modelValue:i.compra.naoGerarFinanceiro,"onUpdate:modelValue":[u[30]||(u[30]=o=>i.compra.naoGerarFinanceiro=o),s.calcularTotais],disable:i.compra.status!=="Digita\xE7\xE3o",dense:"",class:"q-ml-sm"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),e(t,{col:"12 sm4 md",text:"center"},{default:l(()=>[e(ht,{onClick:s.gerarCondicoesDePagamento_click,disable:i.compra.status!=="Digita\xE7\xE3o",color:"positive",icon:"add",label:"Forma de pagamento",outline:"",size:"sm"},null,8,["onClick","disable"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(t,{col:"12"},{default:l(()=>[gt(e(f,{text:"sub1 medium"},{default:l(()=>[M("Condi\xE7\xF5es de pagamento")]),_:1},512),[[Dt,i.compraCondicoesDePagamento.length>0]]),(Q(!0),kt(Nt,null,Ut(i.compraCondicoesDePagamento,o=>(Q(),ot(xt,{highlight:"",class:"q-pa-none",key:o.id},{default:l(()=>[e(v,{gutter:"md",mg:"sm-y",items:"center",bordered:"","rounded-borders":""},{default:l(()=>[e(t,{col:"xs6 md-shrink"},{default:l(()=>[e(_,{modelValue:o.dataVencimento,"onUpdate:modelValue":d=>o.dataVencimento=d,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Data vencimento",tipo:"data",dense:""},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),e(t,{col:"xs6 md2"},{default:l(()=>[e(_,{modelValue:o.valor,"onUpdate:modelValue":d=>o.valor=d,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",align:"left",rotulo:"Valor",decimals:"2",zerosDireita:"2",tipo:"decimal"},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),e(t,{col:"xs-grow"},{default:l(()=>[e(_,{modelValue:o.observacao,"onUpdate:modelValue":d=>o.observacao=d,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"||o.observacao==="Valor Frete + Seguro",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),e(t,{col:"xs-shrink",text:"right"},{default:l(()=>[e(ht,{onClick:d=>s.removerPagamento_click(o),icon:"delete",round:"",dense:"",flat:"",color:"tertiary",disable:i.compra.status!=="Digita\xE7\xE3o"},null,8,["onClick","disable"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),i.valorTotalPagamento>0?(Q(),ot(v,{key:0,mg:"sm-t"},{default:l(()=>[e(t,{col:"xs-shrink",text:"bold"},{default:l(()=>[M(" Valor total: "+et(i.$filters.numero(i.valorTotalPagamento,2)),1)]),_:1})]),_:1})):ut("",!0)]),_:1})]),_:1}),i.$db.usuario.desenvolvedor()?(Q(),ot(v,{key:0,gutter:"md",mg:"md",bg:"bg-yellow"},{default:l(()=>[e(t,{col:"12"},{default:l(()=>[e(f,{text:"sub1 medium",icon:"credit_card sm tertiary left"},{default:l(()=>[M("Contabilidade (apenas desenvolvedor)")]),_:1})]),_:1}),e(t,{col:"12"},{default:l(()=>[i.compraTitulos.length?(Q(),ot(f,{key:0,text:"sub1 medium"},{default:l(()=>[M("Titulos")]),_:1})):ut("",!0),e(xt,{highlight:"",class:"q-pa-none"},{default:l(()=>[(Q(!0),kt(Nt,null,Ut(i.compraTitulos,o=>(Q(),ot(v,{key:o.id,items:"center"},{default:l(()=>[e(t,{col:"sm2"},{default:l(()=>[e(_,{modelValue:o.dataVencimento,"somente-leitura":"",rotulo:"Data vencimento",tipo:"data",dense:""},null,8,["modelValue"])]),_:2},1024),e(t,{col:"sm2"},{default:l(()=>[e(_,{modelValue:o.dataPagamento||"A pagar","somente-leitura":"",rotulo:"Data pagamento",tipo:o.dataPagamento?"data":"texto",dense:""},null,8,["modelValue","tipo"])]),_:2},1024),e(t,{col:"sm2"},{default:l(()=>[e(_,{modelValue:o.valor,"somente-leitura":"",align:"left",rotulo:"Valor",decimals:"2",tipo:"decimal"},null,8,["modelValue"])]),_:2},1024),e(t,{col:"sm2"},{default:l(()=>[e(_,{modelValue:o.parcela,"somente-leitura":"",align:"left",rotulo:"Parcela"},null,8,["modelValue"])]),_:2},1024),e(t,{col:"sm2"},{default:l(()=>[e(_,{modelValue:o.formaDePagamento,"somente-leitura":"",rotulo:"Forma de pagamento"},null,8,["modelValue"])]),_:2},1024),e(t,{col:"sm2"},{default:l(()=>[e(_,{modelValue:o.observacao,"somente-leitura":"",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(t,{col:"12"},{default:l(()=>[i.compraMovimentacoes.length?(Q(),ot(f,{key:0,text:"sub1 medium"},{default:l(()=>[M("Movimenta\xE7\xF4es")]),_:1})):ut("",!0),e(xt,{highlight:"",class:"q-pa-none"},{default:l(()=>[(Q(!0),kt(Nt,null,Ut(i.compraMovimentacoes,o=>(Q(),ot(v,{key:o.id,gutter:"sm",mg:"sm-y",items:"center"},{default:l(()=>[e(t,{col:"xs-grow"},{default:l(()=>[e(_,{modelValue:o.descricao,"somente-leitura":"",rotulo:"Descri\xE7\xE3o"},null,8,["modelValue"])]),_:2},1024),o.valorCredito?(Q(),ot(t,{key:0,col:"xs6 md2"},{default:l(()=>[e(_,{modelValue:o.valorCredito,"somente-leitura":"",align:"left",rotulo:"Valor Credito",decimals:"2",tipo:"decimal"},null,8,["modelValue"])]),_:2},1024)):ut("",!0),o.valorDebito?(Q(),ot(t,{key:1,col:"xs6 md2"},{default:l(()=>[e(_,{modelValue:o.valorDebito,"somente-leitura":"",align:"left",rotulo:"Valor Debito",decimals:"2",tipo:"decimal"},null,8,["modelValue"])]),_:2},1024)):ut("",!0),e(t,{col:"xs6 md-shrink"},{default:l(()=>[e(_,{modelValue:o.dataCompetencia,"somente-leitura":"",rotulo:"Data competencia",tipo:"data",dense:""},null,8,["modelValue"])]),_:2},1024),e(t,{col:"xs-grow"},{default:l(()=>[e(_,{modelValue:o.observacao,"somente-leitura":"",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):ut("",!0),i.$db.usuario.desenvolvedor()&&i.compraDocumentoXml.length?(Q(),ot(v,{key:1,gutter:"md",mg:"md",bg:"bg-yellow"},{default:l(()=>[e(t,{col:"12"},{default:l(()=>[e(f,{text:"sub1 medium",icon:"credit_card sm tertiary left"},{default:l(()=>[M("XML importado (apenas desenvolvedor)")]),_:1})]),_:1}),e(t,{col:"12"},{default:l(()=>[e(xt,{highlight:"",class:"q-pa-none"},{default:l(()=>[(Q(!0),kt(Nt,null,Ut(i.compraDocumentoXml,o=>(Q(),ot(v,{key:o.id},{default:l(()=>[ft("pre",null,et(s.formatXml(o.xmlData)),1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):ut("",!0)]),_:1})]),_:1}),e(se,{class:"bg-light border-top"},{default:l(()=>[e(Rt,{class:"bg-light text-tertiary q-px-md u-container"},{default:l(()=>[e(Lt,{class:"text-subtitle2"},{default:l(()=>[M(" Valor Total: "+et(i.$filters.numero(i.compra.totalDocumento,2))+" ",1),$e,M(" SKU: "+et(s.skus),1)]),_:1}),e(pe),gt(e(ht,{onClick:s.excluir_click,type:"submit",class:"q-ml-sm",color:"white","text-color":"negative",flat:"",label:"Excluir"},null,8,["onClick"]),[[Dt,i.compra.status==="Digita\xE7\xE3o"]]),gt(e(ht,{onClick:s.finalizar_click,type:"submit",class:"q-ml-sm",color:"primary",unelevated:"",label:"Finalizar"},null,8,["onClick"]),[[Dt,i.compra.status==="Digita\xE7\xE3o"]]),gt(e(ht,{onClick:s.reabrir_click,color:"tertiary",flat:"",label:"Reabrir",type:"submit",class:"q-ml-sm"},null,8,["onClick"]),[[Dt,i.compra.status==="Finalizado"]]),gt(e(ht,{unelevated:"",onClick:s.transformarEmNotaDeEntrada_click,class:"q-ml-sm",color:"primary",label:"Transformar em Nota de Entrada",type:"submit"},null,8,["onClick"]),[[Dt,i.compra.status==="Finalizado"&&i.compra.operacao==="Pedido de Compra"]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onKeyup"]),e(r,{ref:"ModalEditarProdutoCompras",onSalvar:s.fecharEdicaoProduto},null,8,["onSalvar"]),e(w,{modelValue:i.adicionar.modal.value,"onUpdate:modelValue":u[32]||(u[32]=o=>i.adicionar.modal.value=o),filtro:{ativo:!0,idEmpresa:i.compra.idEmpresa},ref:"promptItem",habilitarQuantidade:!0,exibirValorVenda:!1,calculaItemCusto:!0,onSelecionarItens:s.selecionarItens},null,8,["modelValue","filtro","onSelecionarItens"])],64)}var Ze=Kt(Re,[["render",He]]);const Xe={components:{PromptItemV2:ge},data(){return{mostrarItemModal:!1,idxItem:0,compra:{},compraItens:[],visivel:!1,edicaoGeral:{marca:"",grupo:"",subGrupo:"",percentualMarkup:0}}},emits:["atualizar","concluirImportacao"],computed:{produtosNaoVinculados(){return this.compraItens.reduce((i,u)=>i+(u.vinculado?0:1),0)},quantProdutos(){return this.compraItens.reduce((i,u)=>i+1,0)}},methods:{async mostrar(i){for(const u of i.documentosItem)this.recalcularItem_blur(u);this.compra=i,this.compraItens=i.documentosItem,this.visivel=!0},async fechar(){this.visivel=!1},async selecionarItens(i){await $tryLoading(async()=>{var f;const u=(f=Object.values(i)[0])==null?void 0:f.item;$utils.verificarErro(!(u!=null&&u.id),"Produto inv\xE1lido"),this.compraItens[this.idxItem].item=u;const{documentoItem:p,item:k,nfeProd:a}=this.compraItens[this.idxItem];p.idItem=k.id,p.descricaoItem=k.descricao;const s={id:$utils.uuid(),idItem:p.idItem,idContato:this.compra.documento.idContato,referencia:a.cProd,descricao:a.xProd};this.compra.itensFornecedor.push(s),this.compraItens[this.idxItem].vinculado=!0,$q.notifyPositive(`Produto vinculado com sucesso: ${k.descricao}`)},{mensagem:"Vinculando produto..."}),this.mostrarItemModal=!1},aplicar_click(){for(const i of this.compraItens)this.edicaoGeral.marca&&(i.item.marca=this.edicaoGeral.marca),this.edicaoGeral.grupo&&(i.item.grupo=this.edicaoGeral.grupo),this.edicaoGeral.subGrupo&&(i.item.subGrupo=this.edicaoGeral.subGrupo),this.edicaoGeral.percentualMarkup&&(i.item.percentualMarkup=this.edicaoGeral.percentualMarkup,this.recalcularItem_blur(i))},async recalcularItem_blur(i){const{item:u,documentoItem:p,itemAnterior:k=$utils.clonarV2(i.item)}=i,{valorFreteRateado:a=0,valorSeguroRateado:s=0,valorOutrasDespesasRateado:f=0}=p;i.valoresEdicao||(i.valoresEdicao={valorOutrasDespesas:a+s+f,percentualIpi:p.percentualIpi||0,percentualIcmsSt:p.percentualIcmsSt||0,percentualDifal:0});const{valorOutrasDespesas:t,percentualIpi:c,percentualIcmsSt:b,percentualDifal:v}=i.valoresEdicao,{valorCusto:g=0,percentualMarkup:_=0,valorVenda:r=0}=u,w=g+t,o=w*c/100,d=w*b/100,h=w*v/100;u.valorCustoReposicao=$utils.arredondar(w+o+d+h,2),r!==k.valorVenda?u.percentualMarkup=$utils.arredondar(100*(r-u.valorCustoReposicao)/r,2):u.valorVenda=$utils.arredondar(u.valorCustoReposicao/(1-_/100),2),i.itemAnterior=$utils.clonarV2(u)},async adicionarItem_click(i){i.buttonLoading=!0,await this.$nextTick(),await $tryLoading(async()=>{const u=await $db.hibrido.lista({table:"item",where:{referencia:i.item.referencia}});$utils.verificarErro(u.length,"Referencia j\xE1 utilizada por outro produto"),i.documentoItem.descricaoItem=i.item.descricao,i.item.descricaoConcatenada=i.item.descricao;const p=i.nfeProd,k={id:$utils.uuid(),idItem:i.item.id,idContato:this.compra.documento.idContato,referencia:p.cProd,descricao:p.xProd};this.compra.itens.push(i.item),this.compra.itensFornecedor.push(k),i.vinculado=!0,$q.notifyPositive(`Item criado com sucesso: ${i.item.descricao}`)},{mensagem:"Cadastrando produto..."}),i.buttonLoading=!1},async salvar_click(){this.compraItens.some(({vinculado:i})=>!i)?$q.notifyError("Verifique todos os itens n\xE3o vinculados!"):(this.mostrarItemModal=!1,this.visivel=!1,this.$emit("concluirImportacao",this.compra))},async incluirTodos_click(){for(const i of this.compraItens)i.vinculado||await this.adicionarItem_click(i)}}},We={class:"layout-padding q-pa-none q-pb-md"},Ge={class:"items-carrinho items-center row q-pa-none rounded-borders u-container",style:{"margin-top":"12px","margin-bottom":"12px"}},Qe=ft("div",{class:"col-8"},null,-1),Ke={class:"col-2"},Ye=["id"],Je={class:"col-12"},ta={class:"col-4 col-md"},ea={class:"col-4 col-md"},aa={class:"col-4 col-md"},oa={class:"col-4 col-md"},ra={class:"col-6 col-md"},ia={class:"col-12 col-md"},na={class:"col-6 col-md"},sa={class:"col-12 col-md"},la={key:0,class:"col-12"},da={class:"col-12 col-md-4"},ua=ft("div",{class:"col-12 col-md-auto"},"ou",-1),ca={class:"col-12 col-md-auto q-pl-none"},ma={key:1,class:"col-12 q-pt-md text-right text-bold"},fa={class:"text-positive"};function ha(i,u,p,k,a,s){const f=ct("ajuda"),t=ct("campo"),c=ct("row"),b=ct("card"),v=ct("PromptItemV2");return Q(),kt(Nt,null,[e(ae,{modelValue:a.visivel,"onUpdate:modelValue":u[4]||(u[4]=g=>a.visivel=g),persistent:"",maximized:"",onKeyup:ve(s.fechar,["esc"])},{default:l(()=>[e(Yt,{container:"",view:"hHh LpR fFf",class:"bg-light"},{default:l(()=>[e(Jt,null,{default:l(()=>[e(Rt,null,{default:l(()=>[e(ht,{icon:"arrow_back",flat:"",round:"",dense:"",onClick:s.fechar},null,8,["onClick"]),e(Lt,null,{default:l(()=>[M("Importar XML x Cadastro")]),_:1}),e(f)]),_:1})]),_:1}),e(te,null,{default:l(()=>[e(ee,null,{default:l(()=>[ft("div",We,[ft("div",Ge,[e(b,{icon:"mdi-set-none",label:"Propriedades para todos os produtos",class:"full-width"},{default:l(()=>[e(c,null,{default:l(()=>[e(t,{modelValue:a.edicaoGeral.marca,"onUpdate:modelValue":u[0]||(u[0]=g=>a.edicaoGeral.marca=g),rotulo:"Marca",dense:"",tipo:"texto",outlined:"",col:"4"},null,8,["modelValue"]),e(t,{modelValue:a.edicaoGeral.grupo,"onUpdate:modelValue":u[1]||(u[1]=g=>a.edicaoGeral.grupo=g),rotulo:"Grupo",dense:"",tipo:"texto",outlined:"",col:"4"},null,8,["modelValue"]),e(t,{modelValue:a.edicaoGeral.subGrupo,"onUpdate:modelValue":u[2]||(u[2]=g=>a.edicaoGeral.subGrupo=g),rotulo:"SubGrupo",dense:"",tipo:"texto",outlined:"",col:"4"},null,8,["modelValue"])]),_:1}),e(c,{class:"q-pt-sm"},{default:l(()=>[Qe,e(t,{modelValue:a.edicaoGeral.percentualMarkup,"onUpdate:modelValue":u[3]||(u[3]=g=>a.edicaoGeral.percentualMarkup=g),rotulo:"Margem de Lucro",suffix:"%",opcoes:{maximumValue:100},dense:"",tipo:"decimal",decimals:"2",outlined:"",col:"2"},null,8,["modelValue"]),ft("div",Ke,[e(ht,{class:"q-ml-sm no-shadow",color:"primary",icon:"play_arrow",unelevated:"",label:"Aplicar",onClick:s.aplicar_click},null,8,["onClick"])])]),_:1})]),_:1})]),e(De,{items:a.compraItens,separator:""},{default:l(({item:g,index:_})=>[ft("div",{class:"items-carrinho items-center row q-pa-md bg-white rounded-borders u-container",style:{"margin-top":"12px","margin-bottom":"12px"},id:_},[e(xt,{class:"full-width"},{default:l(()=>[e(It,{class:"q-px-none"},{default:l(()=>[e(nt,{class:"q-px-none"},{default:l(()=>[e(vt,null,{default:l(()=>[e(t,{dense:"",align:"left",tipo:"texto",outlined:"",rotulo:"Descri\xE7\xE3o Item",modelValue:g.item.descricao,"onUpdate:modelValue":r=>g.item.descricao=r,"somente-leitura":!!g.vinculado},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024)]),_:2},1024),e(nt,null,{default:l(()=>[e(vt,null,{default:l(()=>[e(t,{dense:"",align:"left",tipo:"texto",outlined:"",rotulo:"Referencia",modelValue:g.item.referencia,"onUpdate:modelValue":r=>g.item.referencia=r,"somente-leitura":!!g.vinculado},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(xt,{class:"full-width"},{default:l(()=>[e(It,{class:"q-px-none"},{default:l(()=>[e(nt,null,{default:l(()=>[e(vt,null,{default:l(()=>[e(t,{dense:"",tipo:"texto",outlined:"",rotulo:"Marca",modelValue:g.item.marca,"onUpdate:modelValue":r=>g.item.marca=r,"somente-leitura":!!g.vinculado},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024)]),_:2},1024),e(nt,null,{default:l(()=>[e(vt,null,{default:l(()=>[e(t,{dense:"",tipo:"texto",outlined:"",rotulo:"Grupo",modelValue:g.item.grupo,"onUpdate:modelValue":r=>g.item.grupo=r,"somente-leitura":!!g.vinculado},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024)]),_:2},1024),e(nt,null,{default:l(()=>[e(vt,null,{default:l(()=>[e(t,{dense:"",tipo:"texto",outlined:"",rotulo:"SubGrupo",modelValue:g.item.subGrupo,"onUpdate:modelValue":r=>g.item.subGrupo=r,"somente-leitura":!!g.vinculado},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),ft("div",Je,[e(c,{class:"q-col-gutter-sm"},{default:l(()=>[ft("div",ta,[e(t,{modelValue:g.item.valorCusto,"onUpdate:modelValue":r=>g.item.valorCusto=r,rotulo:"Valor pr\xE9 custo",dense:"",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"","somente-leitura":""},null,8,["modelValue","onUpdate:modelValue"])]),ft("div",ea,[e(t,{modelValue:g.valoresEdicao.valorOutrasDespesas,"onUpdate:modelValue":r=>g.valoresEdicao.valorOutrasDespesas=r,rotulo:"Outras Despesas",dense:"",tipo:"decimal",decimals:"4","somente-leitura":!!g.vinculado,outlined:"",onBlur:r=>s.recalcularItem_blur(g)},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),ft("div",aa,[e(t,{modelValue:g.valoresEdicao.percentualIpi,"onUpdate:modelValue":r=>g.valoresEdicao.percentualIpi=r,rotulo:"IPI",suffix:"%",opcoes:{maximumValue:100},dense:"",tipo:"decimal",decimals:"2","somente-leitura":!!g.vinculado,outlined:"",onBlur:r=>s.recalcularItem_blur(g)},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),ft("div",oa,[e(t,{modelValue:g.valoresEdicao.percentualIcmsSt,"onUpdate:modelValue":r=>g.valoresEdicao.percentualIcmsSt=r,rotulo:"ST",suffix:"%",opcoes:{maximumValue:100},dense:"",tipo:"decimal",decimals:"2","somente-leitura":!!g.vinculado,outlined:"",onBlur:r=>s.recalcularItem_blur(g)},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),ft("div",ra,[e(t,{modelValue:g.valoresEdicao.percentualDifal,"onUpdate:modelValue":r=>g.valoresEdicao.percentualDifal=r,rotulo:"DIFAL",suffix:"%",opcoes:{maximumValue:100},dense:"",tipo:"decimal",decimals:"2","somente-leitura":!!g.vinculado,outlined:"",onBlur:r=>s.recalcularItem_blur(g)},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),ft("div",ia,[e(t,{modelValue:g.item.valorCustoReposicao,"onUpdate:modelValue":r=>g.item.valorCustoReposicao=r,rotulo:"Custo de reposi\xE7\xE3o",dense:"",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"","somente-leitura":""},null,8,["modelValue","onUpdate:modelValue"])]),ft("div",na,[e(t,{modelValue:g.item.percentualMarkup,"onUpdate:modelValue":r=>g.item.percentualMarkup=r,rotulo:"Margem de Lucro",suffix:"%",opcoes:{maximumValue:100},dense:"",tipo:"decimal",decimals:"2","somente-leitura":!!g.vinculado,outlined:"",onBlur:r=>s.recalcularItem_blur(g)},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),ft("div",sa,[e(t,{modelValue:g.item.valorVenda,"onUpdate:modelValue":r=>g.item.valorVenda=r,rotulo:"Valor de Venda",dense:"",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"","somente-leitura":!!g.vinculado,onBlur:r=>s.recalcularItem_blur(g)},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])])]),_:2},1024)]),g.vinculado?(Q(),kt("div",ma," Produto vinculado ")):(Q(),kt("div",la,[e(c,{class:"q-mt-lg text-right full-width justify-end items-center"},{default:l(()=>[ft("div",da,[e(ht,{class:"q-ml-sm no-shadow",color:"primary",icon:"search",unelevated:"",label:"Vincular",onClick:()=>{a.mostrarItemModal=!a.mostrarItemModal,a.idxItem=_}},null,8,["onClick"])]),ua,ft("div",ca,[e(ht,{loading:g.buttonLoading,class:"q-ml-sm no-shadow",color:"primary",icon:"add",unelevated:"",label:"Novo",onClick:r=>s.adicionarItem_click(g)},null,8,["loading","onClick"])])]),_:2},1024)]))],8,Ye)]),_:1},8,["items"])])]),_:1})]),_:1}),e(se,{class:"bg-light"},{default:l(()=>[e(Rt,null,{default:l(()=>[e(Lt,null,{default:l(()=>[ft("span",fa,"Produtos: "+et(s.quantProdutos)+" - N\xE3o vinculados: "+et(s.produtosNaoVinculados),1)]),_:1}),s.produtosNaoVinculados?(Q(),ot(ht,{key:0,class:"q-ml-sm no-shadow float-right",color:"primary",label:"Incluir Todos",onClick:s.incluirTodos_click,unelevated:""},null,8,["onClick"])):(Q(),ot(ht,{key:1,class:"q-ml-sm no-shadow float-right",color:"primary",label:"Salvar",onClick:s.salvar_click,unelevated:""},null,8,["onClick"]))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onKeyup"]),e(v,{modelValue:a.mostrarItemModal,"onUpdate:modelValue":u[5]||(u[5]=g=>a.mostrarItemModal=g),habilitarQuantidade:!1,filtro:{ativo:!0,idEmpresa:a.compra.idEmpresa},exibirValorVenda:!1,onSelecionarItens:s.selecionarItens,ref:"promptItem"},null,8,["modelValue","filtro","onSelecionarItens"])],64)}var pa=Kt(Xe,[["render",ha]]),be={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(i,u){(function(p){i.exports=p()})(function(){return function p(k,a,s){function f(b,v){if(!a[b]){if(!k[b]){var g=typeof Gt=="function"&&Gt;if(!v&&g)return g(b,!0);if(t)return t(b,!0);var _=new Error("Cannot find module '"+b+"'");throw _.code="MODULE_NOT_FOUND",_}var r=a[b]={exports:{}};k[b][0].call(r.exports,function(w){var o=k[b][1][w];return f(o||w)},r,r.exports,p,k,a,s)}return a[b].exports}for(var t=typeof Gt=="function"&&Gt,c=0;c<s.length;c++)f(s[c]);return f}({1:[function(p,k,a){var s=p("./utils"),f=p("./support"),t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode=function(c){for(var b,v,g,_,r,w,o,d=[],h=0,I=c.length,E=I,V=s.getTypeOf(c)!=="string";h<c.length;)E=I-h,g=V?(b=c[h++],v=h<I?c[h++]:0,h<I?c[h++]:0):(b=c.charCodeAt(h++),v=h<I?c.charCodeAt(h++):0,h<I?c.charCodeAt(h++):0),_=b>>2,r=(3&b)<<4|v>>4,w=1<E?(15&v)<<2|g>>6:64,o=2<E?63&g:64,d.push(t.charAt(_)+t.charAt(r)+t.charAt(w)+t.charAt(o));return d.join("")},a.decode=function(c){var b,v,g,_,r,w,o=0,d=0,h="data:";if(c.substr(0,h.length)===h)throw new Error("Invalid base64 input, it looks like a data url.");var I,E=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===t.charAt(64)&&E--,c.charAt(c.length-2)===t.charAt(64)&&E--,E%1!=0)throw new Error("Invalid base64 input, bad content length.");for(I=f.uint8array?new Uint8Array(0|E):new Array(0|E);o<c.length;)b=t.indexOf(c.charAt(o++))<<2|(_=t.indexOf(c.charAt(o++)))>>4,v=(15&_)<<4|(r=t.indexOf(c.charAt(o++)))>>2,g=(3&r)<<6|(w=t.indexOf(c.charAt(o++))),I[d++]=b,r!==64&&(I[d++]=v),w!==64&&(I[d++]=g);return I}},{"./support":30,"./utils":32}],2:[function(p,k,a){var s=p("./external"),f=p("./stream/DataWorker"),t=p("./stream/Crc32Probe"),c=p("./stream/DataLengthProbe");function b(v,g,_,r,w){this.compressedSize=v,this.uncompressedSize=g,this.crc32=_,this.compression=r,this.compressedContent=w}b.prototype={getContentWorker:function(){var v=new f(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),g=this;return v.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),v},getCompressedWorker:function(){return new f(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},b.createWorkerFrom=function(v,g,_){return v.pipe(new t).pipe(new c("uncompressedSize")).pipe(g.compressWorker(_)).pipe(new c("compressedSize")).withStreamInfo("compression",g)},k.exports=b},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(p,k,a){var s=p("./stream/GenericWorker");a.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},a.DEFLATE=p("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(p,k,a){var s=p("./utils"),f=function(){for(var t,c=[],b=0;b<256;b++){t=b;for(var v=0;v<8;v++)t=1&t?3988292384^t>>>1:t>>>1;c[b]=t}return c}();k.exports=function(t,c){return t!==void 0&&t.length?s.getTypeOf(t)!=="string"?function(b,v,g,_){var r=f,w=_+g;b^=-1;for(var o=_;o<w;o++)b=b>>>8^r[255&(b^v[o])];return-1^b}(0|c,t,t.length,0):function(b,v,g,_){var r=f,w=_+g;b^=-1;for(var o=_;o<w;o++)b=b>>>8^r[255&(b^v.charCodeAt(o))];return-1^b}(0|c,t,t.length,0):0}},{"./utils":32}],5:[function(p,k,a){a.base64=!1,a.binary=!1,a.dir=!1,a.createFolders=!0,a.date=null,a.compression=null,a.compressionOptions=null,a.comment=null,a.unixPermissions=null,a.dosPermissions=null},{}],6:[function(p,k,a){var s=null;s=typeof Promise!="undefined"?Promise:p("lie"),k.exports={Promise:s}},{lie:37}],7:[function(p,k,a){var s=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Uint32Array!="undefined",f=p("pako"),t=p("./utils"),c=p("./stream/GenericWorker"),b=s?"uint8array":"array";function v(g,_){c.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=_,this.meta={}}a.magic="\b\0",t.inherits(v,c),v.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(t.transformTo(b,g.data),!1)},v.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},v.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},v.prototype._createPako=function(){this._pako=new f[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(_){g.push({data:_,meta:g.meta})}},a.compressWorker=function(g){return new v("Deflate",g)},a.uncompressWorker=function(){return new v("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(p,k,a){function s(r,w){var o,d="";for(o=0;o<w;o++)d+=String.fromCharCode(255&r),r>>>=8;return d}function f(r,w,o,d,h,I){var E,V,x=r.file,q=r.compression,B=I!==b.utf8encode,$=t.transformTo("string",I(x.name)),A=t.transformTo("string",b.utf8encode(x.name)),W=x.comment,at=t.transformTo("string",I(W)),S=t.transformTo("string",b.utf8encode(W)),N=A.length!==x.name.length,m=S.length!==W.length,U="",it="",j="",st=x.dir,H=x.date,rt={crc32:0,compressedSize:0,uncompressedSize:0};w&&!o||(rt.crc32=r.crc32,rt.compressedSize=r.compressedSize,rt.uncompressedSize=r.uncompressedSize);var F=0;w&&(F|=8),B||!N&&!m||(F|=2048);var z=0,tt=0;st&&(z|=16),h==="UNIX"?(tt=798,z|=function(G,bt){var Ct=G;return G||(Ct=bt?16893:33204),(65535&Ct)<<16}(x.unixPermissions,st)):(tt=20,z|=function(G){return 63&(G||0)}(x.dosPermissions)),E=H.getUTCHours(),E<<=6,E|=H.getUTCMinutes(),E<<=5,E|=H.getUTCSeconds()/2,V=H.getUTCFullYear()-1980,V<<=4,V|=H.getUTCMonth()+1,V<<=5,V|=H.getUTCDate(),N&&(it=s(1,1)+s(v($),4)+A,U+="up"+s(it.length,2)+it),m&&(j=s(1,1)+s(v(at),4)+S,U+="uc"+s(j.length,2)+j);var K="";return K+=`
\0`,K+=s(F,2),K+=q.magic,K+=s(E,2),K+=s(V,2),K+=s(rt.crc32,4),K+=s(rt.compressedSize,4),K+=s(rt.uncompressedSize,4),K+=s($.length,2),K+=s(U.length,2),{fileRecord:g.LOCAL_FILE_HEADER+K+$+U,dirRecord:g.CENTRAL_FILE_HEADER+s(tt,2)+K+s(at.length,2)+"\0\0\0\0"+s(z,4)+s(d,4)+$+U+at}}var t=p("../utils"),c=p("../stream/GenericWorker"),b=p("../utf8"),v=p("../crc32"),g=p("../signature");function _(r,w,o,d){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=w,this.zipPlatform=o,this.encodeFileName=d,this.streamFiles=r,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}t.inherits(_,c),_.prototype.push=function(r){var w=r.meta.percent||0,o=this.entriesCount,d=this._sources.length;this.accumulate?this.contentBuffer.push(r):(this.bytesWritten+=r.data.length,c.prototype.push.call(this,{data:r.data,meta:{currentFile:this.currentFile,percent:o?(w+100*(o-d-1))/o:100}}))},_.prototype.openedSource=function(r){this.currentSourceOffset=this.bytesWritten,this.currentFile=r.file.name;var w=this.streamFiles&&!r.file.dir;if(w){var o=f(r,w,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:o.fileRecord,meta:{percent:0}})}else this.accumulate=!0},_.prototype.closedSource=function(r){this.accumulate=!1;var w=this.streamFiles&&!r.file.dir,o=f(r,w,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(o.dirRecord),w)this.push({data:function(d){return g.DATA_DESCRIPTOR+s(d.crc32,4)+s(d.compressedSize,4)+s(d.uncompressedSize,4)}(r),meta:{percent:100}});else for(this.push({data:o.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},_.prototype.flush=function(){for(var r=this.bytesWritten,w=0;w<this.dirRecords.length;w++)this.push({data:this.dirRecords[w],meta:{percent:100}});var o=this.bytesWritten-r,d=function(h,I,E,V,x){var q=t.transformTo("string",x(V));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(h,2)+s(h,2)+s(I,4)+s(E,4)+s(q.length,2)+q}(this.dirRecords.length,o,r,this.zipComment,this.encodeFileName);this.push({data:d,meta:{percent:100}})},_.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},_.prototype.registerPrevious=function(r){this._sources.push(r);var w=this;return r.on("data",function(o){w.processChunk(o)}),r.on("end",function(){w.closedSource(w.previous.streamInfo),w._sources.length?w.prepareNextSource():w.end()}),r.on("error",function(o){w.error(o)}),this},_.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},_.prototype.error=function(r){var w=this._sources;if(!c.prototype.error.call(this,r))return!1;for(var o=0;o<w.length;o++)try{w[o].error(r)}catch{}return!0},_.prototype.lock=function(){c.prototype.lock.call(this);for(var r=this._sources,w=0;w<r.length;w++)r[w].lock()},k.exports=_},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(p,k,a){var s=p("../compressions"),f=p("./ZipFileWorker");a.generateWorker=function(t,c,b){var v=new f(c.streamFiles,b,c.platform,c.encodeFileName),g=0;try{t.forEach(function(_,r){g++;var w=function(I,E){var V=I||E,x=s[V];if(!x)throw new Error(V+" is not a valid compression method !");return x}(r.options.compression,c.compression),o=r.options.compressionOptions||c.compressionOptions||{},d=r.dir,h=r.date;r._compressWorker(w,o).withStreamInfo("file",{name:_,dir:d,date:h,comment:r.comment||"",unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions}).pipe(v)}),v.entriesCount=g}catch(_){v.error(_)}return v}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(p,k,a){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var f=new s;for(var t in this)typeof this[t]!="function"&&(f[t]=this[t]);return f}}(s.prototype=p("./object")).loadAsync=p("./load"),s.support=p("./support"),s.defaults=p("./defaults"),s.version="3.10.1",s.loadAsync=function(f,t){return new s().loadAsync(f,t)},s.external=p("./external"),k.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(p,k,a){var s=p("./utils"),f=p("./external"),t=p("./utf8"),c=p("./zipEntries"),b=p("./stream/Crc32Probe"),v=p("./nodejsUtils");function g(_){return new f.Promise(function(r,w){var o=_.decompressed.getContentWorker().pipe(new b);o.on("error",function(d){w(d)}).on("end",function(){o.streamInfo.crc32!==_.decompressed.crc32?w(new Error("Corrupted zip : CRC32 mismatch")):r()}).resume()})}k.exports=function(_,r){var w=this;return r=s.extend(r||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:t.utf8decode}),v.isNode&&v.isStream(_)?f.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",_,!0,r.optimizedBinaryString,r.base64).then(function(o){var d=new c(r);return d.load(o),d}).then(function(o){var d=[f.Promise.resolve(o)],h=o.files;if(r.checkCRC32)for(var I=0;I<h.length;I++)d.push(g(h[I]));return f.Promise.all(d)}).then(function(o){for(var d=o.shift(),h=d.files,I=0;I<h.length;I++){var E=h[I],V=E.fileNameStr,x=s.resolve(E.fileNameStr);w.file(x,E.decompressed,{binary:!0,optimizedBinaryString:!0,date:E.date,dir:E.dir,comment:E.fileCommentStr.length?E.fileCommentStr:null,unixPermissions:E.unixPermissions,dosPermissions:E.dosPermissions,createFolders:r.createFolders}),E.dir||(w.file(x).unsafeOriginalName=V)}return d.zipComment.length&&(w.comment=d.zipComment),w})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(p,k,a){var s=p("../utils"),f=p("../stream/GenericWorker");function t(c,b){f.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(b)}s.inherits(t,f),t.prototype._bindStream=function(c){var b=this;(this._stream=c).pause(),c.on("data",function(v){b.push({data:v,meta:{percent:0}})}).on("error",function(v){b.isPaused?this.generatedError=v:b.error(v)}).on("end",function(){b.isPaused?b._upstreamEnded=!0:b.end()})},t.prototype.pause=function(){return!!f.prototype.pause.call(this)&&(this._stream.pause(),!0)},t.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},k.exports=t},{"../stream/GenericWorker":28,"../utils":32}],13:[function(p,k,a){var s=p("readable-stream").Readable;function f(t,c,b){s.call(this,c),this._helper=t;var v=this;t.on("data",function(g,_){v.push(g)||v._helper.pause(),b&&b(_)}).on("error",function(g){v.emit("error",g)}).on("end",function(){v.push(null)})}p("../utils").inherits(f,s),f.prototype._read=function(){this._helper.resume()},k.exports=f},{"../utils":32,"readable-stream":16}],14:[function(p,k,a){k.exports={isNode:typeof Buffer!="undefined",newBufferFrom:function(s,f){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,f);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,f)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var f=new Buffer(s);return f.fill(0),f},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(p,k,a){function s(x,q,B){var $,A=t.getTypeOf(q),W=t.extend(B||{},v);W.date=W.date||new Date,W.compression!==null&&(W.compression=W.compression.toUpperCase()),typeof W.unixPermissions=="string"&&(W.unixPermissions=parseInt(W.unixPermissions,8)),W.unixPermissions&&16384&W.unixPermissions&&(W.dir=!0),W.dosPermissions&&16&W.dosPermissions&&(W.dir=!0),W.dir&&(x=h(x)),W.createFolders&&($=d(x))&&I.call(this,$,!0);var at=A==="string"&&W.binary===!1&&W.base64===!1;B&&B.binary!==void 0||(W.binary=!at),(q instanceof g&&q.uncompressedSize===0||W.dir||!q||q.length===0)&&(W.base64=!1,W.binary=!0,q="",W.compression="STORE",A="string");var S=null;S=q instanceof g||q instanceof c?q:w.isNode&&w.isStream(q)?new o(x,q):t.prepareContent(x,q,W.binary,W.optimizedBinaryString,W.base64);var N=new _(x,S,W);this.files[x]=N}var f=p("./utf8"),t=p("./utils"),c=p("./stream/GenericWorker"),b=p("./stream/StreamHelper"),v=p("./defaults"),g=p("./compressedObject"),_=p("./zipObject"),r=p("./generate"),w=p("./nodejsUtils"),o=p("./nodejs/NodejsStreamInputAdapter"),d=function(x){x.slice(-1)==="/"&&(x=x.substring(0,x.length-1));var q=x.lastIndexOf("/");return 0<q?x.substring(0,q):""},h=function(x){return x.slice(-1)!=="/"&&(x+="/"),x},I=function(x,q){return q=q!==void 0?q:v.createFolders,x=h(x),this.files[x]||s.call(this,x,null,{dir:!0,createFolders:q}),this.files[x]};function E(x){return Object.prototype.toString.call(x)==="[object RegExp]"}var V={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(x){var q,B,$;for(q in this.files)$=this.files[q],(B=q.slice(this.root.length,q.length))&&q.slice(0,this.root.length)===this.root&&x(B,$)},filter:function(x){var q=[];return this.forEach(function(B,$){x(B,$)&&q.push($)}),q},file:function(x,q,B){if(arguments.length!==1)return x=this.root+x,s.call(this,x,q,B),this;if(E(x)){var $=x;return this.filter(function(W,at){return!at.dir&&$.test(W)})}var A=this.files[this.root+x];return A&&!A.dir?A:null},folder:function(x){if(!x)return this;if(E(x))return this.filter(function(A,W){return W.dir&&x.test(A)});var q=this.root+x,B=I.call(this,q),$=this.clone();return $.root=B.name,$},remove:function(x){x=this.root+x;var q=this.files[x];if(q||(x.slice(-1)!=="/"&&(x+="/"),q=this.files[x]),q&&!q.dir)delete this.files[x];else for(var B=this.filter(function(A,W){return W.name.slice(0,x.length)===x}),$=0;$<B.length;$++)delete this.files[B[$].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(x){var q,B={};try{if((B=t.extend(x||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:f.utf8encode})).type=B.type.toLowerCase(),B.compression=B.compression.toUpperCase(),B.type==="binarystring"&&(B.type="string"),!B.type)throw new Error("No output type specified.");t.checkSupport(B.type),B.platform!=="darwin"&&B.platform!=="freebsd"&&B.platform!=="linux"&&B.platform!=="sunos"||(B.platform="UNIX"),B.platform==="win32"&&(B.platform="DOS");var $=B.comment||this.comment||"";q=r.generateWorker(this,B,$)}catch(A){(q=new c("error")).error(A)}return new b(q,B.type||"string",B.mimeType)},generateAsync:function(x,q){return this.generateInternalStream(x).accumulate(q)},generateNodeStream:function(x,q){return(x=x||{}).type||(x.type="nodebuffer"),this.generateInternalStream(x).toNodejsStream(q)}};k.exports=V},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(p,k,a){k.exports=p("stream")},{stream:void 0}],17:[function(p,k,a){var s=p("./DataReader");function f(t){s.call(this,t);for(var c=0;c<this.data.length;c++)t[c]=255&t[c]}p("../utils").inherits(f,s),f.prototype.byteAt=function(t){return this.data[this.zero+t]},f.prototype.lastIndexOfSignature=function(t){for(var c=t.charCodeAt(0),b=t.charCodeAt(1),v=t.charCodeAt(2),g=t.charCodeAt(3),_=this.length-4;0<=_;--_)if(this.data[_]===c&&this.data[_+1]===b&&this.data[_+2]===v&&this.data[_+3]===g)return _-this.zero;return-1},f.prototype.readAndCheckSignature=function(t){var c=t.charCodeAt(0),b=t.charCodeAt(1),v=t.charCodeAt(2),g=t.charCodeAt(3),_=this.readData(4);return c===_[0]&&b===_[1]&&v===_[2]&&g===_[3]},f.prototype.readData=function(t){if(this.checkOffset(t),t===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,c},k.exports=f},{"../utils":32,"./DataReader":18}],18:[function(p,k,a){var s=p("../utils");function f(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}f.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(){},readInt:function(t){var c,b=0;for(this.checkOffset(t),c=this.index+t-1;c>=this.index;c--)b=(b<<8)+this.byteAt(c);return this.index+=t,b},readString:function(t){return s.transformTo("string",this.readData(t))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},k.exports=f},{"../utils":32}],19:[function(p,k,a){var s=p("./Uint8ArrayReader");function f(t){s.call(this,t)}p("../utils").inherits(f,s),f.prototype.readData=function(t){this.checkOffset(t);var c=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,c},k.exports=f},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(p,k,a){var s=p("./DataReader");function f(t){s.call(this,t)}p("../utils").inherits(f,s),f.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},f.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},f.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},f.prototype.readData=function(t){this.checkOffset(t);var c=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,c},k.exports=f},{"../utils":32,"./DataReader":18}],21:[function(p,k,a){var s=p("./ArrayReader");function f(t){s.call(this,t)}p("../utils").inherits(f,s),f.prototype.readData=function(t){if(this.checkOffset(t),t===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,c},k.exports=f},{"../utils":32,"./ArrayReader":17}],22:[function(p,k,a){var s=p("../utils"),f=p("../support"),t=p("./ArrayReader"),c=p("./StringReader"),b=p("./NodeBufferReader"),v=p("./Uint8ArrayReader");k.exports=function(g){var _=s.getTypeOf(g);return s.checkSupport(_),_!=="string"||f.uint8array?_==="nodebuffer"?new b(g):f.uint8array?new v(s.transformTo("uint8array",g)):new t(s.transformTo("array",g)):new c(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(p,k,a){a.LOCAL_FILE_HEADER="PK",a.CENTRAL_FILE_HEADER="PK",a.CENTRAL_DIRECTORY_END="PK",a.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",a.ZIP64_CENTRAL_DIRECTORY_END="PK",a.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(p,k,a){var s=p("./GenericWorker"),f=p("../utils");function t(c){s.call(this,"ConvertWorker to "+c),this.destType=c}f.inherits(t,s),t.prototype.processChunk=function(c){this.push({data:f.transformTo(this.destType,c.data),meta:c.meta})},k.exports=t},{"../utils":32,"./GenericWorker":28}],25:[function(p,k,a){var s=p("./GenericWorker"),f=p("../crc32");function t(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}p("../utils").inherits(t,s),t.prototype.processChunk=function(c){this.streamInfo.crc32=f(c.data,this.streamInfo.crc32||0),this.push(c)},k.exports=t},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(p,k,a){var s=p("../utils"),f=p("./GenericWorker");function t(c){f.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(t,f),t.prototype.processChunk=function(c){if(c){var b=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=b+c.data.length}f.prototype.processChunk.call(this,c)},k.exports=t},{"../utils":32,"./GenericWorker":28}],27:[function(p,k,a){var s=p("../utils"),f=p("./GenericWorker");function t(c){f.call(this,"DataWorker");var b=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(v){b.dataIsReady=!0,b.data=v,b.max=v&&v.length||0,b.type=s.getTypeOf(v),b.isPaused||b._tickAndRepeat()},function(v){b.error(v)})}s.inherits(t,f),t.prototype.cleanUp=function(){f.prototype.cleanUp.call(this),this.data=null},t.prototype.resume=function(){return!!f.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},t.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},t.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,b=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,b);break;case"uint8array":c=this.data.subarray(this.index,b);break;case"array":case"nodebuffer":c=this.data.slice(this.index,b)}return this.index=b,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},k.exports=t},{"../utils":32,"./GenericWorker":28}],28:[function(p,k,a){function s(f){this.name=f||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(f){this.emit("data",f)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(f){this.emit("error",f)}return!0},error:function(f){return!this.isFinished&&(this.isPaused?this.generatedError=f:(this.isFinished=!0,this.emit("error",f),this.previous&&this.previous.error(f),this.cleanUp()),!0)},on:function(f,t){return this._listeners[f].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(f,t){if(this._listeners[f])for(var c=0;c<this._listeners[f].length;c++)this._listeners[f][c].call(this,t)},pipe:function(f){return f.registerPrevious(this)},registerPrevious:function(f){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=f.streamInfo,this.mergeStreamInfo(),this.previous=f;var t=this;return f.on("data",function(c){t.processChunk(c)}),f.on("end",function(){t.end()}),f.on("error",function(c){t.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var f=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),f=!0),this.previous&&this.previous.resume(),!f},flush:function(){},processChunk:function(f){this.push(f)},withStreamInfo:function(f,t){return this.extraStreamInfo[f]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var f in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,f)&&(this.streamInfo[f]=this.extraStreamInfo[f])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var f="Worker "+this.name;return this.previous?this.previous+" -> "+f:f}},k.exports=s},{}],29:[function(p,k,a){var s=p("../utils"),f=p("./ConvertWorker"),t=p("./GenericWorker"),c=p("../base64"),b=p("../support"),v=p("../external"),g=null;if(b.nodestream)try{g=p("../nodejs/NodejsStreamOutputAdapter")}catch{}function _(w,o){return new v.Promise(function(d,h){var I=[],E=w._internalType,V=w._outputType,x=w._mimeType;w.on("data",function(q,B){I.push(q),o&&o(B)}).on("error",function(q){I=[],h(q)}).on("end",function(){try{var q=function(B,$,A){switch(B){case"blob":return s.newBlob(s.transformTo("arraybuffer",$),A);case"base64":return c.encode($);default:return s.transformTo(B,$)}}(V,function(B,$){var A,W=0,at=null,S=0;for(A=0;A<$.length;A++)S+=$[A].length;switch(B){case"string":return $.join("");case"array":return Array.prototype.concat.apply([],$);case"uint8array":for(at=new Uint8Array(S),A=0;A<$.length;A++)at.set($[A],W),W+=$[A].length;return at;case"nodebuffer":return Buffer.concat($);default:throw new Error("concat : unsupported type '"+B+"'")}}(E,I),x);d(q)}catch(B){h(B)}I=[]}).resume()})}function r(w,o,d){var h=o;switch(o){case"blob":case"arraybuffer":h="uint8array";break;case"base64":h="string"}try{this._internalType=h,this._outputType=o,this._mimeType=d,s.checkSupport(h),this._worker=w.pipe(new f(h)),w.lock()}catch(I){this._worker=new t("error"),this._worker.error(I)}}r.prototype={accumulate:function(w){return _(this,w)},on:function(w,o){var d=this;return w==="data"?this._worker.on(w,function(h){o.call(d,h.data,h.meta)}):this._worker.on(w,function(){s.delay(o,arguments,d)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(w){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},w)}},k.exports=r},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(p,k,a){if(a.base64=!0,a.array=!0,a.string=!0,a.arraybuffer=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined",a.nodebuffer=typeof Buffer!="undefined",a.uint8array=typeof Uint8Array!="undefined",typeof ArrayBuffer=="undefined")a.blob=!1;else{var s=new ArrayBuffer(0);try{a.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var f=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);f.append(s),a.blob=f.getBlob("application/zip").size===0}catch{a.blob=!1}}}try{a.nodestream=!!p("readable-stream").Readable}catch{a.nodestream=!1}},{"readable-stream":16}],31:[function(p,k,a){for(var s=p("./utils"),f=p("./support"),t=p("./nodejsUtils"),c=p("./stream/GenericWorker"),b=new Array(256),v=0;v<256;v++)b[v]=252<=v?6:248<=v?5:240<=v?4:224<=v?3:192<=v?2:1;b[254]=b[254]=1;function g(){c.call(this,"utf-8 decode"),this.leftOver=null}function _(){c.call(this,"utf-8 encode")}a.utf8encode=function(r){return f.nodebuffer?t.newBufferFrom(r,"utf-8"):function(w){var o,d,h,I,E,V=w.length,x=0;for(I=0;I<V;I++)(64512&(d=w.charCodeAt(I)))==55296&&I+1<V&&(64512&(h=w.charCodeAt(I+1)))==56320&&(d=65536+(d-55296<<10)+(h-56320),I++),x+=d<128?1:d<2048?2:d<65536?3:4;for(o=f.uint8array?new Uint8Array(x):new Array(x),I=E=0;E<x;I++)(64512&(d=w.charCodeAt(I)))==55296&&I+1<V&&(64512&(h=w.charCodeAt(I+1)))==56320&&(d=65536+(d-55296<<10)+(h-56320),I++),d<128?o[E++]=d:(d<2048?o[E++]=192|d>>>6:(d<65536?o[E++]=224|d>>>12:(o[E++]=240|d>>>18,o[E++]=128|d>>>12&63),o[E++]=128|d>>>6&63),o[E++]=128|63&d);return o}(r)},a.utf8decode=function(r){return f.nodebuffer?s.transformTo("nodebuffer",r).toString("utf-8"):function(w){var o,d,h,I,E=w.length,V=new Array(2*E);for(o=d=0;o<E;)if((h=w[o++])<128)V[d++]=h;else if(4<(I=b[h]))V[d++]=65533,o+=I-1;else{for(h&=I===2?31:I===3?15:7;1<I&&o<E;)h=h<<6|63&w[o++],I--;1<I?V[d++]=65533:h<65536?V[d++]=h:(h-=65536,V[d++]=55296|h>>10&1023,V[d++]=56320|1023&h)}return V.length!==d&&(V.subarray?V=V.subarray(0,d):V.length=d),s.applyFromCharCode(V)}(r=s.transformTo(f.uint8array?"uint8array":"array",r))},s.inherits(g,c),g.prototype.processChunk=function(r){var w=s.transformTo(f.uint8array?"uint8array":"array",r.data);if(this.leftOver&&this.leftOver.length){if(f.uint8array){var o=w;(w=new Uint8Array(o.length+this.leftOver.length)).set(this.leftOver,0),w.set(o,this.leftOver.length)}else w=this.leftOver.concat(w);this.leftOver=null}var d=function(I,E){var V;for((E=E||I.length)>I.length&&(E=I.length),V=E-1;0<=V&&(192&I[V])==128;)V--;return V<0||V===0?E:V+b[I[V]]>E?V:E}(w),h=w;d!==w.length&&(f.uint8array?(h=w.subarray(0,d),this.leftOver=w.subarray(d,w.length)):(h=w.slice(0,d),this.leftOver=w.slice(d,w.length))),this.push({data:a.utf8decode(h),meta:r.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=g,s.inherits(_,c),_.prototype.processChunk=function(r){this.push({data:a.utf8encode(r.data),meta:r.meta})},a.Utf8EncodeWorker=_},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(p,k,a){var s=p("./support"),f=p("./base64"),t=p("./nodejsUtils"),c=p("./external");function b(o){return o}function v(o,d){for(var h=0;h<o.length;++h)d[h]=255&o.charCodeAt(h);return d}p("setimmediate"),a.newBlob=function(o,d){a.checkSupport("blob");try{return new Blob([o],{type:d})}catch{try{var h=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return h.append(o),h.getBlob(d)}catch{throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(o,d,h){var I=[],E=0,V=o.length;if(V<=h)return String.fromCharCode.apply(null,o);for(;E<V;)d==="array"||d==="nodebuffer"?I.push(String.fromCharCode.apply(null,o.slice(E,Math.min(E+h,V)))):I.push(String.fromCharCode.apply(null,o.subarray(E,Math.min(E+h,V)))),E+=h;return I.join("")},stringifyByChar:function(o){for(var d="",h=0;h<o.length;h++)d+=String.fromCharCode(o[h]);return d},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,t.allocBuffer(1)).length===1}catch{return!1}}()}};function _(o){var d=65536,h=a.getTypeOf(o),I=!0;if(h==="uint8array"?I=g.applyCanBeUsed.uint8array:h==="nodebuffer"&&(I=g.applyCanBeUsed.nodebuffer),I)for(;1<d;)try{return g.stringifyByChunk(o,h,d)}catch{d=Math.floor(d/2)}return g.stringifyByChar(o)}function r(o,d){for(var h=0;h<o.length;h++)d[h]=o[h];return d}a.applyFromCharCode=_;var w={};w.string={string:b,array:function(o){return v(o,new Array(o.length))},arraybuffer:function(o){return w.string.uint8array(o).buffer},uint8array:function(o){return v(o,new Uint8Array(o.length))},nodebuffer:function(o){return v(o,t.allocBuffer(o.length))}},w.array={string:_,array:b,arraybuffer:function(o){return new Uint8Array(o).buffer},uint8array:function(o){return new Uint8Array(o)},nodebuffer:function(o){return t.newBufferFrom(o)}},w.arraybuffer={string:function(o){return _(new Uint8Array(o))},array:function(o){return r(new Uint8Array(o),new Array(o.byteLength))},arraybuffer:b,uint8array:function(o){return new Uint8Array(o)},nodebuffer:function(o){return t.newBufferFrom(new Uint8Array(o))}},w.uint8array={string:_,array:function(o){return r(o,new Array(o.length))},arraybuffer:function(o){return o.buffer},uint8array:b,nodebuffer:function(o){return t.newBufferFrom(o)}},w.nodebuffer={string:_,array:function(o){return r(o,new Array(o.length))},arraybuffer:function(o){return w.nodebuffer.uint8array(o).buffer},uint8array:function(o){return r(o,new Uint8Array(o.length))},nodebuffer:b},a.transformTo=function(o,d){if(d=d||"",!o)return d;a.checkSupport(o);var h=a.getTypeOf(d);return w[h][o](d)},a.resolve=function(o){for(var d=o.split("/"),h=[],I=0;I<d.length;I++){var E=d[I];E==="."||E===""&&I!==0&&I!==d.length-1||(E===".."?h.pop():h.push(E))}return h.join("/")},a.getTypeOf=function(o){return typeof o=="string"?"string":Object.prototype.toString.call(o)==="[object Array]"?"array":s.nodebuffer&&t.isBuffer(o)?"nodebuffer":s.uint8array&&o instanceof Uint8Array?"uint8array":s.arraybuffer&&o instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(o){if(!s[o.toLowerCase()])throw new Error(o+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(o){var d,h,I="";for(h=0;h<(o||"").length;h++)I+="\\x"+((d=o.charCodeAt(h))<16?"0":"")+d.toString(16).toUpperCase();return I},a.delay=function(o,d,h){setImmediate(function(){o.apply(h||null,d||[])})},a.inherits=function(o,d){function h(){}h.prototype=d.prototype,o.prototype=new h},a.extend=function(){var o,d,h={};for(o=0;o<arguments.length;o++)for(d in arguments[o])Object.prototype.hasOwnProperty.call(arguments[o],d)&&h[d]===void 0&&(h[d]=arguments[o][d]);return h},a.prepareContent=function(o,d,h,I,E){return c.Promise.resolve(d).then(function(V){return s.blob&&(V instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(V))!==-1)&&typeof FileReader!="undefined"?new c.Promise(function(x,q){var B=new FileReader;B.onload=function($){x($.target.result)},B.onerror=function($){q($.target.error)},B.readAsArrayBuffer(V)}):V}).then(function(V){var x=a.getTypeOf(V);return x?(x==="arraybuffer"?V=a.transformTo("uint8array",V):x==="string"&&(E?V=f.decode(V):h&&I!==!0&&(V=function(q){return v(q,s.uint8array?new Uint8Array(q.length):new Array(q.length))}(V))),V):c.Promise.reject(new Error("Can't read the data of '"+o+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(p,k,a){var s=p("./reader/readerFor"),f=p("./utils"),t=p("./signature"),c=p("./zipEntry"),b=p("./support");function v(g){this.files=[],this.loadOptions=g}v.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var _=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+f.pretty(_)+", expected "+f.pretty(g)+")")}},isSignature:function(g,_){var r=this.reader.index;this.reader.setIndex(g);var w=this.reader.readString(4)===_;return this.reader.setIndex(r),w},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),_=b.uint8array?"uint8array":"array",r=f.transformTo(_,g);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,_,r,w=this.zip64EndOfCentralSize-44;0<w;)g=this.reader.readInt(2),_=this.reader.readInt(4),r=this.reader.readData(_),this.zip64ExtensibleData[g]={id:g,length:_,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,_;for(g=0;g<this.files.length;g++)_=this.files[g],this.reader.setIndex(_.localHeaderOffset),this.checkSignature(t.LOCAL_FILE_HEADER),_.readLocalPart(this.reader),_.handleUTF8(),_.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(t.CENTRAL_FILE_HEADER);)(g=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(t.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,t.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var _=g;if(this.checkSignature(t.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===f.MAX_VALUE_16BITS||this.diskWithCentralDirStart===f.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===f.MAX_VALUE_16BITS||this.centralDirRecords===f.MAX_VALUE_16BITS||this.centralDirSize===f.MAX_VALUE_32BITS||this.centralDirOffset===f.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(t.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(t.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,t.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(t.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(t.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var w=_-r;if(0<w)this.isSignature(_,t.CENTRAL_FILE_HEADER)||(this.reader.zero=w);else if(w<0)throw new Error("Corrupted zip: missing "+Math.abs(w)+" bytes.")},prepareReader:function(g){this.reader=s(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},k.exports=v},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(p,k,a){var s=p("./reader/readerFor"),f=p("./utils"),t=p("./compressedObject"),c=p("./crc32"),b=p("./utf8"),v=p("./compressions"),g=p("./support");function _(r,w){this.options=r,this.loadOptions=w}_.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(r){var w,o;if(r.skip(22),this.fileNameLength=r.readInt(2),o=r.readInt(2),this.fileName=r.readData(this.fileNameLength),r.skip(o),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((w=function(d){for(var h in v)if(Object.prototype.hasOwnProperty.call(v,h)&&v[h].magic===d)return v[h];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+f.pretty(this.compressionMethod)+" unknown (inner file : "+f.transformTo("string",this.fileName)+")");this.decompressed=new t(this.compressedSize,this.uncompressedSize,this.crc32,w,r.readData(this.compressedSize))},readCentralPart:function(r){this.versionMadeBy=r.readInt(2),r.skip(2),this.bitFlag=r.readInt(2),this.compressionMethod=r.readString(2),this.date=r.readDate(),this.crc32=r.readInt(4),this.compressedSize=r.readInt(4),this.uncompressedSize=r.readInt(4);var w=r.readInt(2);if(this.extraFieldsLength=r.readInt(2),this.fileCommentLength=r.readInt(2),this.diskNumberStart=r.readInt(2),this.internalFileAttributes=r.readInt(2),this.externalFileAttributes=r.readInt(4),this.localHeaderOffset=r.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");r.skip(w),this.readExtraFields(r),this.parseZIP64ExtraField(r),this.fileComment=r.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var r=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),r==0&&(this.dosPermissions=63&this.externalFileAttributes),r==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var r=s(this.extraFields[1].value);this.uncompressedSize===f.MAX_VALUE_32BITS&&(this.uncompressedSize=r.readInt(8)),this.compressedSize===f.MAX_VALUE_32BITS&&(this.compressedSize=r.readInt(8)),this.localHeaderOffset===f.MAX_VALUE_32BITS&&(this.localHeaderOffset=r.readInt(8)),this.diskNumberStart===f.MAX_VALUE_32BITS&&(this.diskNumberStart=r.readInt(4))}},readExtraFields:function(r){var w,o,d,h=r.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});r.index+4<h;)w=r.readInt(2),o=r.readInt(2),d=r.readData(o),this.extraFields[w]={id:w,length:o,value:d};r.setIndex(h)},handleUTF8:function(){var r=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=b.utf8decode(this.fileName),this.fileCommentStr=b.utf8decode(this.fileComment);else{var w=this.findExtraFieldUnicodePath();if(w!==null)this.fileNameStr=w;else{var o=f.transformTo(r,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(o)}var d=this.findExtraFieldUnicodeComment();if(d!==null)this.fileCommentStr=d;else{var h=f.transformTo(r,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(h)}}},findExtraFieldUnicodePath:function(){var r=this.extraFields[28789];if(r){var w=s(r.value);return w.readInt(1)!==1||c(this.fileName)!==w.readInt(4)?null:b.utf8decode(w.readData(r.length-5))}return null},findExtraFieldUnicodeComment:function(){var r=this.extraFields[25461];if(r){var w=s(r.value);return w.readInt(1)!==1||c(this.fileComment)!==w.readInt(4)?null:b.utf8decode(w.readData(r.length-5))}return null}},k.exports=_},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(p,k,a){function s(w,o,d){this.name=w,this.dir=d.dir,this.date=d.date,this.comment=d.comment,this.unixPermissions=d.unixPermissions,this.dosPermissions=d.dosPermissions,this._data=o,this._dataBinary=d.binary,this.options={compression:d.compression,compressionOptions:d.compressionOptions}}var f=p("./stream/StreamHelper"),t=p("./stream/DataWorker"),c=p("./utf8"),b=p("./compressedObject"),v=p("./stream/GenericWorker");s.prototype={internalStream:function(w){var o=null,d="string";try{if(!w)throw new Error("No output type specified.");var h=(d=w.toLowerCase())==="string"||d==="text";d!=="binarystring"&&d!=="text"||(d="string"),o=this._decompressWorker();var I=!this._dataBinary;I&&!h&&(o=o.pipe(new c.Utf8EncodeWorker)),!I&&h&&(o=o.pipe(new c.Utf8DecodeWorker))}catch(E){(o=new v("error")).error(E)}return new f(o,d,"")},async:function(w,o){return this.internalStream(w).accumulate(o)},nodeStream:function(w,o){return this.internalStream(w||"nodebuffer").toNodejsStream(o)},_compressWorker:function(w,o){if(this._data instanceof b&&this._data.compression.magic===w.magic)return this._data.getCompressedWorker();var d=this._decompressWorker();return this._dataBinary||(d=d.pipe(new c.Utf8EncodeWorker)),b.createWorkerFrom(d,w,o)},_decompressWorker:function(){return this._data instanceof b?this._data.getContentWorker():this._data instanceof v?this._data:new t(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],_=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},r=0;r<g.length;r++)s.prototype[g[r]]=_;k.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(p,k,a){(function(s){var f,t,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var b=0,v=new c(w),g=s.document.createTextNode("");v.observe(g,{characterData:!0}),f=function(){g.data=b=++b%2}}else if(s.setImmediate||s.MessageChannel===void 0)f="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var o=s.document.createElement("script");o.onreadystatechange=function(){w(),o.onreadystatechange=null,o.parentNode.removeChild(o),o=null},s.document.documentElement.appendChild(o)}:function(){setTimeout(w,0)};else{var _=new s.MessageChannel;_.port1.onmessage=w,f=function(){_.port2.postMessage(0)}}var r=[];function w(){var o,d;t=!0;for(var h=r.length;h;){for(d=r,r=[],o=-1;++o<h;)d[o]();h=r.length}t=!1}k.exports=function(o){r.push(o)!==1||t||f()}}).call(this,typeof Wt!="undefined"?Wt:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],37:[function(p,k,a){var s=p("immediate");function f(){}var t={},c=["REJECTED"],b=["FULFILLED"],v=["PENDING"];function g(h){if(typeof h!="function")throw new TypeError("resolver must be a function");this.state=v,this.queue=[],this.outcome=void 0,h!==f&&o(this,h)}function _(h,I,E){this.promise=h,typeof I=="function"&&(this.onFulfilled=I,this.callFulfilled=this.otherCallFulfilled),typeof E=="function"&&(this.onRejected=E,this.callRejected=this.otherCallRejected)}function r(h,I,E){s(function(){var V;try{V=I(E)}catch(x){return t.reject(h,x)}V===h?t.reject(h,new TypeError("Cannot resolve promise with itself")):t.resolve(h,V)})}function w(h){var I=h&&h.then;if(h&&(typeof h=="object"||typeof h=="function")&&typeof I=="function")return function(){I.apply(h,arguments)}}function o(h,I){var E=!1;function V(B){E||(E=!0,t.reject(h,B))}function x(B){E||(E=!0,t.resolve(h,B))}var q=d(function(){I(x,V)});q.status==="error"&&V(q.value)}function d(h,I){var E={};try{E.value=h(I),E.status="success"}catch(V){E.status="error",E.value=V}return E}(k.exports=g).prototype.finally=function(h){if(typeof h!="function")return this;var I=this.constructor;return this.then(function(E){return I.resolve(h()).then(function(){return E})},function(E){return I.resolve(h()).then(function(){throw E})})},g.prototype.catch=function(h){return this.then(null,h)},g.prototype.then=function(h,I){if(typeof h!="function"&&this.state===b||typeof I!="function"&&this.state===c)return this;var E=new this.constructor(f);return this.state!==v?r(E,this.state===b?h:I,this.outcome):this.queue.push(new _(E,h,I)),E},_.prototype.callFulfilled=function(h){t.resolve(this.promise,h)},_.prototype.otherCallFulfilled=function(h){r(this.promise,this.onFulfilled,h)},_.prototype.callRejected=function(h){t.reject(this.promise,h)},_.prototype.otherCallRejected=function(h){r(this.promise,this.onRejected,h)},t.resolve=function(h,I){var E=d(w,I);if(E.status==="error")return t.reject(h,E.value);var V=E.value;if(V)o(h,V);else{h.state=b,h.outcome=I;for(var x=-1,q=h.queue.length;++x<q;)h.queue[x].callFulfilled(I)}return h},t.reject=function(h,I){h.state=c,h.outcome=I;for(var E=-1,V=h.queue.length;++E<V;)h.queue[E].callRejected(I);return h},g.resolve=function(h){return h instanceof this?h:t.resolve(new this(f),h)},g.reject=function(h){var I=new this(f);return t.reject(I,h)},g.all=function(h){var I=this;if(Object.prototype.toString.call(h)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=h.length,V=!1;if(!E)return this.resolve([]);for(var x=new Array(E),q=0,B=-1,$=new this(f);++B<E;)A(h[B],B);return $;function A(W,at){I.resolve(W).then(function(S){x[at]=S,++q!==E||V||(V=!0,t.resolve($,x))},function(S){V||(V=!0,t.reject($,S))})}},g.race=function(h){var I=this;if(Object.prototype.toString.call(h)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=h.length,V=!1;if(!E)return this.resolve([]);for(var x=-1,q=new this(f);++x<E;)B=h[x],I.resolve(B).then(function($){V||(V=!0,t.resolve(q,$))},function($){V||(V=!0,t.reject(q,$))});var B;return q}},{immediate:36}],38:[function(p,k,a){var s={};(0,p("./lib/utils/common").assign)(s,p("./lib/deflate"),p("./lib/inflate"),p("./lib/zlib/constants")),k.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(p,k,a){var s=p("./zlib/deflate"),f=p("./utils/common"),t=p("./utils/strings"),c=p("./zlib/messages"),b=p("./zlib/zstream"),v=Object.prototype.toString,g=0,_=-1,r=0,w=8;function o(h){if(!(this instanceof o))return new o(h);this.options=f.assign({level:_,method:w,chunkSize:16384,windowBits:15,memLevel:8,strategy:r,to:""},h||{});var I=this.options;I.raw&&0<I.windowBits?I.windowBits=-I.windowBits:I.gzip&&0<I.windowBits&&I.windowBits<16&&(I.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new b,this.strm.avail_out=0;var E=s.deflateInit2(this.strm,I.level,I.method,I.windowBits,I.memLevel,I.strategy);if(E!==g)throw new Error(c[E]);if(I.header&&s.deflateSetHeader(this.strm,I.header),I.dictionary){var V;if(V=typeof I.dictionary=="string"?t.string2buf(I.dictionary):v.call(I.dictionary)==="[object ArrayBuffer]"?new Uint8Array(I.dictionary):I.dictionary,(E=s.deflateSetDictionary(this.strm,V))!==g)throw new Error(c[E]);this._dict_set=!0}}function d(h,I){var E=new o(I);if(E.push(h,!0),E.err)throw E.msg||c[E.err];return E.result}o.prototype.push=function(h,I){var E,V,x=this.strm,q=this.options.chunkSize;if(this.ended)return!1;V=I===~~I?I:I===!0?4:0,typeof h=="string"?x.input=t.string2buf(h):v.call(h)==="[object ArrayBuffer]"?x.input=new Uint8Array(h):x.input=h,x.next_in=0,x.avail_in=x.input.length;do{if(x.avail_out===0&&(x.output=new f.Buf8(q),x.next_out=0,x.avail_out=q),(E=s.deflate(x,V))!==1&&E!==g)return this.onEnd(E),!(this.ended=!0);x.avail_out!==0&&(x.avail_in!==0||V!==4&&V!==2)||(this.options.to==="string"?this.onData(t.buf2binstring(f.shrinkBuf(x.output,x.next_out))):this.onData(f.shrinkBuf(x.output,x.next_out)))}while((0<x.avail_in||x.avail_out===0)&&E!==1);return V===4?(E=s.deflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===g):V!==2||(this.onEnd(g),!(x.avail_out=0))},o.prototype.onData=function(h){this.chunks.push(h)},o.prototype.onEnd=function(h){h===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.msg=this.strm.msg},a.Deflate=o,a.deflate=d,a.deflateRaw=function(h,I){return(I=I||{}).raw=!0,d(h,I)},a.gzip=function(h,I){return(I=I||{}).gzip=!0,d(h,I)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(p,k,a){var s=p("./zlib/inflate"),f=p("./utils/common"),t=p("./utils/strings"),c=p("./zlib/constants"),b=p("./zlib/messages"),v=p("./zlib/zstream"),g=p("./zlib/gzheader"),_=Object.prototype.toString;function r(o){if(!(this instanceof r))return new r(o);this.options=f.assign({chunkSize:16384,windowBits:0,to:""},o||{});var d=this.options;d.raw&&0<=d.windowBits&&d.windowBits<16&&(d.windowBits=-d.windowBits,d.windowBits===0&&(d.windowBits=-15)),!(0<=d.windowBits&&d.windowBits<16)||o&&o.windowBits||(d.windowBits+=32),15<d.windowBits&&d.windowBits<48&&(15&d.windowBits)==0&&(d.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new v,this.strm.avail_out=0;var h=s.inflateInit2(this.strm,d.windowBits);if(h!==c.Z_OK)throw new Error(b[h]);this.header=new g,s.inflateGetHeader(this.strm,this.header)}function w(o,d){var h=new r(d);if(h.push(o,!0),h.err)throw h.msg||b[h.err];return h.result}r.prototype.push=function(o,d){var h,I,E,V,x,q,B=this.strm,$=this.options.chunkSize,A=this.options.dictionary,W=!1;if(this.ended)return!1;I=d===~~d?d:d===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof o=="string"?B.input=t.binstring2buf(o):_.call(o)==="[object ArrayBuffer]"?B.input=new Uint8Array(o):B.input=o,B.next_in=0,B.avail_in=B.input.length;do{if(B.avail_out===0&&(B.output=new f.Buf8($),B.next_out=0,B.avail_out=$),(h=s.inflate(B,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&A&&(q=typeof A=="string"?t.string2buf(A):_.call(A)==="[object ArrayBuffer]"?new Uint8Array(A):A,h=s.inflateSetDictionary(this.strm,q)),h===c.Z_BUF_ERROR&&W===!0&&(h=c.Z_OK,W=!1),h!==c.Z_STREAM_END&&h!==c.Z_OK)return this.onEnd(h),!(this.ended=!0);B.next_out&&(B.avail_out!==0&&h!==c.Z_STREAM_END&&(B.avail_in!==0||I!==c.Z_FINISH&&I!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(E=t.utf8border(B.output,B.next_out),V=B.next_out-E,x=t.buf2string(B.output,E),B.next_out=V,B.avail_out=$-V,V&&f.arraySet(B.output,B.output,E,V,0),this.onData(x)):this.onData(f.shrinkBuf(B.output,B.next_out)))),B.avail_in===0&&B.avail_out===0&&(W=!0)}while((0<B.avail_in||B.avail_out===0)&&h!==c.Z_STREAM_END);return h===c.Z_STREAM_END&&(I=c.Z_FINISH),I===c.Z_FINISH?(h=s.inflateEnd(this.strm),this.onEnd(h),this.ended=!0,h===c.Z_OK):I!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(B.avail_out=0))},r.prototype.onData=function(o){this.chunks.push(o)},r.prototype.onEnd=function(o){o===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=o,this.msg=this.strm.msg},a.Inflate=r,a.inflate=w,a.inflateRaw=function(o,d){return(d=d||{}).raw=!0,w(o,d)},a.ungzip=w},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(p,k,a){var s=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";a.assign=function(c){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var v=b.shift();if(v){if(typeof v!="object")throw new TypeError(v+"must be non-object");for(var g in v)v.hasOwnProperty(g)&&(c[g]=v[g])}}return c},a.shrinkBuf=function(c,b){return c.length===b?c:c.subarray?c.subarray(0,b):(c.length=b,c)};var f={arraySet:function(c,b,v,g,_){if(b.subarray&&c.subarray)c.set(b.subarray(v,v+g),_);else for(var r=0;r<g;r++)c[_+r]=b[v+r]},flattenChunks:function(c){var b,v,g,_,r,w;for(b=g=0,v=c.length;b<v;b++)g+=c[b].length;for(w=new Uint8Array(g),b=_=0,v=c.length;b<v;b++)r=c[b],w.set(r,_),_+=r.length;return w}},t={arraySet:function(c,b,v,g,_){for(var r=0;r<g;r++)c[_+r]=b[v+r]},flattenChunks:function(c){return[].concat.apply([],c)}};a.setTyped=function(c){c?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,f)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,t))},a.setTyped(s)},{}],42:[function(p,k,a){var s=p("./common"),f=!0,t=!0;try{String.fromCharCode.apply(null,[0])}catch{f=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{t=!1}for(var c=new s.Buf8(256),b=0;b<256;b++)c[b]=252<=b?6:248<=b?5:240<=b?4:224<=b?3:192<=b?2:1;function v(g,_){if(_<65537&&(g.subarray&&t||!g.subarray&&f))return String.fromCharCode.apply(null,s.shrinkBuf(g,_));for(var r="",w=0;w<_;w++)r+=String.fromCharCode(g[w]);return r}c[254]=c[254]=1,a.string2buf=function(g){var _,r,w,o,d,h=g.length,I=0;for(o=0;o<h;o++)(64512&(r=g.charCodeAt(o)))==55296&&o+1<h&&(64512&(w=g.charCodeAt(o+1)))==56320&&(r=65536+(r-55296<<10)+(w-56320),o++),I+=r<128?1:r<2048?2:r<65536?3:4;for(_=new s.Buf8(I),o=d=0;d<I;o++)(64512&(r=g.charCodeAt(o)))==55296&&o+1<h&&(64512&(w=g.charCodeAt(o+1)))==56320&&(r=65536+(r-55296<<10)+(w-56320),o++),r<128?_[d++]=r:(r<2048?_[d++]=192|r>>>6:(r<65536?_[d++]=224|r>>>12:(_[d++]=240|r>>>18,_[d++]=128|r>>>12&63),_[d++]=128|r>>>6&63),_[d++]=128|63&r);return _},a.buf2binstring=function(g){return v(g,g.length)},a.binstring2buf=function(g){for(var _=new s.Buf8(g.length),r=0,w=_.length;r<w;r++)_[r]=g.charCodeAt(r);return _},a.buf2string=function(g,_){var r,w,o,d,h=_||g.length,I=new Array(2*h);for(r=w=0;r<h;)if((o=g[r++])<128)I[w++]=o;else if(4<(d=c[o]))I[w++]=65533,r+=d-1;else{for(o&=d===2?31:d===3?15:7;1<d&&r<h;)o=o<<6|63&g[r++],d--;1<d?I[w++]=65533:o<65536?I[w++]=o:(o-=65536,I[w++]=55296|o>>10&1023,I[w++]=56320|1023&o)}return v(I,w)},a.utf8border=function(g,_){var r;for((_=_||g.length)>g.length&&(_=g.length),r=_-1;0<=r&&(192&g[r])==128;)r--;return r<0||r===0?_:r+c[g[r]]>_?r:_}},{"./common":41}],43:[function(p,k,a){k.exports=function(s,f,t,c){for(var b=65535&s|0,v=s>>>16&65535|0,g=0;t!==0;){for(t-=g=2e3<t?2e3:t;v=v+(b=b+f[c++]|0)|0,--g;);b%=65521,v%=65521}return b|v<<16|0}},{}],44:[function(p,k,a){k.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(p,k,a){var s=function(){for(var f,t=[],c=0;c<256;c++){f=c;for(var b=0;b<8;b++)f=1&f?3988292384^f>>>1:f>>>1;t[c]=f}return t}();k.exports=function(f,t,c,b){var v=s,g=b+c;f^=-1;for(var _=b;_<g;_++)f=f>>>8^v[255&(f^t[_])];return-1^f}},{}],46:[function(p,k,a){var s,f=p("../utils/common"),t=p("./trees"),c=p("./adler32"),b=p("./crc32"),v=p("./messages"),g=0,_=4,r=0,w=-2,o=-1,d=4,h=2,I=8,E=9,V=286,x=30,q=19,B=2*V+1,$=15,A=3,W=258,at=W+A+1,S=42,N=113,m=1,U=2,it=3,j=4;function st(n,O){return n.msg=v[O],O}function H(n){return(n<<1)-(4<n?9:0)}function rt(n){for(var O=n.length;0<=--O;)n[O]=0}function F(n){var O=n.state,T=O.pending;T>n.avail_out&&(T=n.avail_out),T!==0&&(f.arraySet(n.output,O.pending_buf,O.pending_out,T,n.next_out),n.next_out+=T,O.pending_out+=T,n.total_out+=T,n.avail_out-=T,O.pending-=T,O.pending===0&&(O.pending_out=0))}function z(n,O){t._tr_flush_block(n,0<=n.block_start?n.block_start:-1,n.strstart-n.block_start,O),n.block_start=n.strstart,F(n.strm)}function tt(n,O){n.pending_buf[n.pending++]=O}function K(n,O){n.pending_buf[n.pending++]=O>>>8&255,n.pending_buf[n.pending++]=255&O}function G(n,O){var T,C,y=n.max_chain_length,D=n.strstart,R=n.prev_length,L=n.nice_match,P=n.strstart>n.w_size-at?n.strstart-(n.w_size-at):0,Z=n.window,Y=n.w_mask,X=n.prev,J=n.strstart+W,pt=Z[D+R-1],dt=Z[D+R];n.prev_length>=n.good_match&&(y>>=2),L>n.lookahead&&(L=n.lookahead);do if(Z[(T=O)+R]===dt&&Z[T+R-1]===pt&&Z[T]===Z[D]&&Z[++T]===Z[D+1]){D+=2,T++;do;while(Z[++D]===Z[++T]&&Z[++D]===Z[++T]&&Z[++D]===Z[++T]&&Z[++D]===Z[++T]&&Z[++D]===Z[++T]&&Z[++D]===Z[++T]&&Z[++D]===Z[++T]&&Z[++D]===Z[++T]&&D<J);if(C=W-(J-D),D=J-W,R<C){if(n.match_start=O,L<=(R=C))break;pt=Z[D+R-1],dt=Z[D+R]}}while((O=X[O&Y])>P&&--y!=0);return R<=n.lookahead?R:n.lookahead}function bt(n){var O,T,C,y,D,R,L,P,Z,Y,X=n.w_size;do{if(y=n.window_size-n.lookahead-n.strstart,n.strstart>=X+(X-at)){for(f.arraySet(n.window,n.window,X,X,0),n.match_start-=X,n.strstart-=X,n.block_start-=X,O=T=n.hash_size;C=n.head[--O],n.head[O]=X<=C?C-X:0,--T;);for(O=T=X;C=n.prev[--O],n.prev[O]=X<=C?C-X:0,--T;);y+=X}if(n.strm.avail_in===0)break;if(R=n.strm,L=n.window,P=n.strstart+n.lookahead,Z=y,Y=void 0,Y=R.avail_in,Z<Y&&(Y=Z),T=Y===0?0:(R.avail_in-=Y,f.arraySet(L,R.input,R.next_in,Y,P),R.state.wrap===1?R.adler=c(R.adler,L,Y,P):R.state.wrap===2&&(R.adler=b(R.adler,L,Y,P)),R.next_in+=Y,R.total_in+=Y,Y),n.lookahead+=T,n.lookahead+n.insert>=A)for(D=n.strstart-n.insert,n.ins_h=n.window[D],n.ins_h=(n.ins_h<<n.hash_shift^n.window[D+1])&n.hash_mask;n.insert&&(n.ins_h=(n.ins_h<<n.hash_shift^n.window[D+A-1])&n.hash_mask,n.prev[D&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=D,D++,n.insert--,!(n.lookahead+n.insert<A)););}while(n.lookahead<at&&n.strm.avail_in!==0)}function Ct(n,O){for(var T,C;;){if(n.lookahead<at){if(bt(n),n.lookahead<at&&O===g)return m;if(n.lookahead===0)break}if(T=0,n.lookahead>=A&&(n.ins_h=(n.ins_h<<n.hash_shift^n.window[n.strstart+A-1])&n.hash_mask,T=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),T!==0&&n.strstart-T<=n.w_size-at&&(n.match_length=G(n,T)),n.match_length>=A)if(C=t._tr_tally(n,n.strstart-n.match_start,n.match_length-A),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=A){for(n.match_length--;n.strstart++,n.ins_h=(n.ins_h<<n.hash_shift^n.window[n.strstart+A-1])&n.hash_mask,T=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart,--n.match_length!=0;);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=(n.ins_h<<n.hash_shift^n.window[n.strstart+1])&n.hash_mask;else C=t._tr_tally(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(C&&(z(n,!1),n.strm.avail_out===0))return m}return n.insert=n.strstart<A-1?n.strstart:A-1,O===_?(z(n,!0),n.strm.avail_out===0?it:j):n.last_lit&&(z(n,!1),n.strm.avail_out===0)?m:U}function lt(n,O){for(var T,C,y;;){if(n.lookahead<at){if(bt(n),n.lookahead<at&&O===g)return m;if(n.lookahead===0)break}if(T=0,n.lookahead>=A&&(n.ins_h=(n.ins_h<<n.hash_shift^n.window[n.strstart+A-1])&n.hash_mask,T=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=A-1,T!==0&&n.prev_length<n.max_lazy_match&&n.strstart-T<=n.w_size-at&&(n.match_length=G(n,T),n.match_length<=5&&(n.strategy===1||n.match_length===A&&4096<n.strstart-n.match_start)&&(n.match_length=A-1)),n.prev_length>=A&&n.match_length<=n.prev_length){for(y=n.strstart+n.lookahead-A,C=t._tr_tally(n,n.strstart-1-n.prev_match,n.prev_length-A),n.lookahead-=n.prev_length-1,n.prev_length-=2;++n.strstart<=y&&(n.ins_h=(n.ins_h<<n.hash_shift^n.window[n.strstart+A-1])&n.hash_mask,T=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),--n.prev_length!=0;);if(n.match_available=0,n.match_length=A-1,n.strstart++,C&&(z(n,!1),n.strm.avail_out===0))return m}else if(n.match_available){if((C=t._tr_tally(n,0,n.window[n.strstart-1]))&&z(n,!1),n.strstart++,n.lookahead--,n.strm.avail_out===0)return m}else n.match_available=1,n.strstart++,n.lookahead--}return n.match_available&&(C=t._tr_tally(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<A-1?n.strstart:A-1,O===_?(z(n,!0),n.strm.avail_out===0?it:j):n.last_lit&&(z(n,!1),n.strm.avail_out===0)?m:U}function mt(n,O,T,C,y){this.good_length=n,this.max_lazy=O,this.nice_length=T,this.max_chain=C,this.func=y}function yt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=I,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new f.Buf16(2*B),this.dyn_dtree=new f.Buf16(2*(2*x+1)),this.bl_tree=new f.Buf16(2*(2*q+1)),rt(this.dyn_ltree),rt(this.dyn_dtree),rt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new f.Buf16($+1),this.heap=new f.Buf16(2*V+1),rt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new f.Buf16(2*V+1),rt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function _t(n){var O;return n&&n.state?(n.total_in=n.total_out=0,n.data_type=h,(O=n.state).pending=0,O.pending_out=0,O.wrap<0&&(O.wrap=-O.wrap),O.status=O.wrap?S:N,n.adler=O.wrap===2?0:1,O.last_flush=g,t._tr_init(O),r):st(n,w)}function zt(n){var O=_t(n);return O===r&&function(T){T.window_size=2*T.w_size,rt(T.head),T.max_lazy_match=s[T.level].max_lazy,T.good_match=s[T.level].good_length,T.nice_match=s[T.level].nice_length,T.max_chain_length=s[T.level].max_chain,T.strstart=0,T.block_start=0,T.lookahead=0,T.insert=0,T.match_length=T.prev_length=A-1,T.match_available=0,T.ins_h=0}(n.state),O}function Pt(n,O,T,C,y,D){if(!n)return w;var R=1;if(O===o&&(O=6),C<0?(R=0,C=-C):15<C&&(R=2,C-=16),y<1||E<y||T!==I||C<8||15<C||O<0||9<O||D<0||d<D)return st(n,w);C===8&&(C=9);var L=new yt;return(n.state=L).strm=n,L.wrap=R,L.gzhead=null,L.w_bits=C,L.w_size=1<<L.w_bits,L.w_mask=L.w_size-1,L.hash_bits=y+7,L.hash_size=1<<L.hash_bits,L.hash_mask=L.hash_size-1,L.hash_shift=~~((L.hash_bits+A-1)/A),L.window=new f.Buf8(2*L.w_size),L.head=new f.Buf16(L.hash_size),L.prev=new f.Buf16(L.w_size),L.lit_bufsize=1<<y+6,L.pending_buf_size=4*L.lit_bufsize,L.pending_buf=new f.Buf8(L.pending_buf_size),L.d_buf=1*L.lit_bufsize,L.l_buf=3*L.lit_bufsize,L.level=O,L.strategy=D,L.method=T,zt(n)}s=[new mt(0,0,0,0,function(n,O){var T=65535;for(T>n.pending_buf_size-5&&(T=n.pending_buf_size-5);;){if(n.lookahead<=1){if(bt(n),n.lookahead===0&&O===g)return m;if(n.lookahead===0)break}n.strstart+=n.lookahead,n.lookahead=0;var C=n.block_start+T;if((n.strstart===0||n.strstart>=C)&&(n.lookahead=n.strstart-C,n.strstart=C,z(n,!1),n.strm.avail_out===0)||n.strstart-n.block_start>=n.w_size-at&&(z(n,!1),n.strm.avail_out===0))return m}return n.insert=0,O===_?(z(n,!0),n.strm.avail_out===0?it:j):(n.strstart>n.block_start&&(z(n,!1),n.strm.avail_out),m)}),new mt(4,4,8,4,Ct),new mt(4,5,16,8,Ct),new mt(4,6,32,32,Ct),new mt(4,4,16,16,lt),new mt(8,16,32,32,lt),new mt(8,16,128,128,lt),new mt(8,32,128,256,lt),new mt(32,128,258,1024,lt),new mt(32,258,258,4096,lt)],a.deflateInit=function(n,O){return Pt(n,O,I,15,8,0)},a.deflateInit2=Pt,a.deflateReset=zt,a.deflateResetKeep=_t,a.deflateSetHeader=function(n,O){return n&&n.state?n.state.wrap!==2?w:(n.state.gzhead=O,r):w},a.deflate=function(n,O){var T,C,y,D;if(!n||!n.state||5<O||O<0)return n?st(n,w):w;if(C=n.state,!n.output||!n.input&&n.avail_in!==0||C.status===666&&O!==_)return st(n,n.avail_out===0?-5:w);if(C.strm=n,T=C.last_flush,C.last_flush=O,C.status===S)if(C.wrap===2)n.adler=0,tt(C,31),tt(C,139),tt(C,8),C.gzhead?(tt(C,(C.gzhead.text?1:0)+(C.gzhead.hcrc?2:0)+(C.gzhead.extra?4:0)+(C.gzhead.name?8:0)+(C.gzhead.comment?16:0)),tt(C,255&C.gzhead.time),tt(C,C.gzhead.time>>8&255),tt(C,C.gzhead.time>>16&255),tt(C,C.gzhead.time>>24&255),tt(C,C.level===9?2:2<=C.strategy||C.level<2?4:0),tt(C,255&C.gzhead.os),C.gzhead.extra&&C.gzhead.extra.length&&(tt(C,255&C.gzhead.extra.length),tt(C,C.gzhead.extra.length>>8&255)),C.gzhead.hcrc&&(n.adler=b(n.adler,C.pending_buf,C.pending,0)),C.gzindex=0,C.status=69):(tt(C,0),tt(C,0),tt(C,0),tt(C,0),tt(C,0),tt(C,C.level===9?2:2<=C.strategy||C.level<2?4:0),tt(C,3),C.status=N);else{var R=I+(C.w_bits-8<<4)<<8;R|=(2<=C.strategy||C.level<2?0:C.level<6?1:C.level===6?2:3)<<6,C.strstart!==0&&(R|=32),R+=31-R%31,C.status=N,K(C,R),C.strstart!==0&&(K(C,n.adler>>>16),K(C,65535&n.adler)),n.adler=1}if(C.status===69)if(C.gzhead.extra){for(y=C.pending;C.gzindex<(65535&C.gzhead.extra.length)&&(C.pending!==C.pending_buf_size||(C.gzhead.hcrc&&C.pending>y&&(n.adler=b(n.adler,C.pending_buf,C.pending-y,y)),F(n),y=C.pending,C.pending!==C.pending_buf_size));)tt(C,255&C.gzhead.extra[C.gzindex]),C.gzindex++;C.gzhead.hcrc&&C.pending>y&&(n.adler=b(n.adler,C.pending_buf,C.pending-y,y)),C.gzindex===C.gzhead.extra.length&&(C.gzindex=0,C.status=73)}else C.status=73;if(C.status===73)if(C.gzhead.name){y=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>y&&(n.adler=b(n.adler,C.pending_buf,C.pending-y,y)),F(n),y=C.pending,C.pending===C.pending_buf_size)){D=1;break}D=C.gzindex<C.gzhead.name.length?255&C.gzhead.name.charCodeAt(C.gzindex++):0,tt(C,D)}while(D!==0);C.gzhead.hcrc&&C.pending>y&&(n.adler=b(n.adler,C.pending_buf,C.pending-y,y)),D===0&&(C.gzindex=0,C.status=91)}else C.status=91;if(C.status===91)if(C.gzhead.comment){y=C.pending;do{if(C.pending===C.pending_buf_size&&(C.gzhead.hcrc&&C.pending>y&&(n.adler=b(n.adler,C.pending_buf,C.pending-y,y)),F(n),y=C.pending,C.pending===C.pending_buf_size)){D=1;break}D=C.gzindex<C.gzhead.comment.length?255&C.gzhead.comment.charCodeAt(C.gzindex++):0,tt(C,D)}while(D!==0);C.gzhead.hcrc&&C.pending>y&&(n.adler=b(n.adler,C.pending_buf,C.pending-y,y)),D===0&&(C.status=103)}else C.status=103;if(C.status===103&&(C.gzhead.hcrc?(C.pending+2>C.pending_buf_size&&F(n),C.pending+2<=C.pending_buf_size&&(tt(C,255&n.adler),tt(C,n.adler>>8&255),n.adler=0,C.status=N)):C.status=N),C.pending!==0){if(F(n),n.avail_out===0)return C.last_flush=-1,r}else if(n.avail_in===0&&H(O)<=H(T)&&O!==_)return st(n,-5);if(C.status===666&&n.avail_in!==0)return st(n,-5);if(n.avail_in!==0||C.lookahead!==0||O!==g&&C.status!==666){var L=C.strategy===2?function(P,Z){for(var Y;;){if(P.lookahead===0&&(bt(P),P.lookahead===0)){if(Z===g)return m;break}if(P.match_length=0,Y=t._tr_tally(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++,Y&&(z(P,!1),P.strm.avail_out===0))return m}return P.insert=0,Z===_?(z(P,!0),P.strm.avail_out===0?it:j):P.last_lit&&(z(P,!1),P.strm.avail_out===0)?m:U}(C,O):C.strategy===3?function(P,Z){for(var Y,X,J,pt,dt=P.window;;){if(P.lookahead<=W){if(bt(P),P.lookahead<=W&&Z===g)return m;if(P.lookahead===0)break}if(P.match_length=0,P.lookahead>=A&&0<P.strstart&&(X=dt[J=P.strstart-1])===dt[++J]&&X===dt[++J]&&X===dt[++J]){pt=P.strstart+W;do;while(X===dt[++J]&&X===dt[++J]&&X===dt[++J]&&X===dt[++J]&&X===dt[++J]&&X===dt[++J]&&X===dt[++J]&&X===dt[++J]&&J<pt);P.match_length=W-(pt-J),P.match_length>P.lookahead&&(P.match_length=P.lookahead)}if(P.match_length>=A?(Y=t._tr_tally(P,1,P.match_length-A),P.lookahead-=P.match_length,P.strstart+=P.match_length,P.match_length=0):(Y=t._tr_tally(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++),Y&&(z(P,!1),P.strm.avail_out===0))return m}return P.insert=0,Z===_?(z(P,!0),P.strm.avail_out===0?it:j):P.last_lit&&(z(P,!1),P.strm.avail_out===0)?m:U}(C,O):s[C.level].func(C,O);if(L!==it&&L!==j||(C.status=666),L===m||L===it)return n.avail_out===0&&(C.last_flush=-1),r;if(L===U&&(O===1?t._tr_align(C):O!==5&&(t._tr_stored_block(C,0,0,!1),O===3&&(rt(C.head),C.lookahead===0&&(C.strstart=0,C.block_start=0,C.insert=0))),F(n),n.avail_out===0))return C.last_flush=-1,r}return O!==_?r:C.wrap<=0?1:(C.wrap===2?(tt(C,255&n.adler),tt(C,n.adler>>8&255),tt(C,n.adler>>16&255),tt(C,n.adler>>24&255),tt(C,255&n.total_in),tt(C,n.total_in>>8&255),tt(C,n.total_in>>16&255),tt(C,n.total_in>>24&255)):(K(C,n.adler>>>16),K(C,65535&n.adler)),F(n),0<C.wrap&&(C.wrap=-C.wrap),C.pending!==0?r:1)},a.deflateEnd=function(n){var O;return n&&n.state?(O=n.state.status)!==S&&O!==69&&O!==73&&O!==91&&O!==103&&O!==N&&O!==666?st(n,w):(n.state=null,O===N?st(n,-3):r):w},a.deflateSetDictionary=function(n,O){var T,C,y,D,R,L,P,Z,Y=O.length;if(!n||!n.state||(D=(T=n.state).wrap)===2||D===1&&T.status!==S||T.lookahead)return w;for(D===1&&(n.adler=c(n.adler,O,Y,0)),T.wrap=0,Y>=T.w_size&&(D===0&&(rt(T.head),T.strstart=0,T.block_start=0,T.insert=0),Z=new f.Buf8(T.w_size),f.arraySet(Z,O,Y-T.w_size,T.w_size,0),O=Z,Y=T.w_size),R=n.avail_in,L=n.next_in,P=n.input,n.avail_in=Y,n.next_in=0,n.input=O,bt(T);T.lookahead>=A;){for(C=T.strstart,y=T.lookahead-(A-1);T.ins_h=(T.ins_h<<T.hash_shift^T.window[C+A-1])&T.hash_mask,T.prev[C&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=C,C++,--y;);T.strstart=C,T.lookahead=A-1,bt(T)}return T.strstart+=T.lookahead,T.block_start=T.strstart,T.insert=T.lookahead,T.lookahead=0,T.match_length=T.prev_length=A-1,T.match_available=0,n.next_in=L,n.input=P,n.avail_in=R,T.wrap=D,r},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(p,k,a){k.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(p,k,a){k.exports=function(s,f){var t,c,b,v,g,_,r,w,o,d,h,I,E,V,x,q,B,$,A,W,at,S,N,m,U;t=s.state,c=s.next_in,m=s.input,b=c+(s.avail_in-5),v=s.next_out,U=s.output,g=v-(f-s.avail_out),_=v+(s.avail_out-257),r=t.dmax,w=t.wsize,o=t.whave,d=t.wnext,h=t.window,I=t.hold,E=t.bits,V=t.lencode,x=t.distcode,q=(1<<t.lenbits)-1,B=(1<<t.distbits)-1;t:do{E<15&&(I+=m[c++]<<E,E+=8,I+=m[c++]<<E,E+=8),$=V[I&q];e:for(;;){if(I>>>=A=$>>>24,E-=A,(A=$>>>16&255)===0)U[v++]=65535&$;else{if(!(16&A)){if((64&A)==0){$=V[(65535&$)+(I&(1<<A)-1)];continue e}if(32&A){t.mode=12;break t}s.msg="invalid literal/length code",t.mode=30;break t}W=65535&$,(A&=15)&&(E<A&&(I+=m[c++]<<E,E+=8),W+=I&(1<<A)-1,I>>>=A,E-=A),E<15&&(I+=m[c++]<<E,E+=8,I+=m[c++]<<E,E+=8),$=x[I&B];a:for(;;){if(I>>>=A=$>>>24,E-=A,!(16&(A=$>>>16&255))){if((64&A)==0){$=x[(65535&$)+(I&(1<<A)-1)];continue a}s.msg="invalid distance code",t.mode=30;break t}if(at=65535&$,E<(A&=15)&&(I+=m[c++]<<E,(E+=8)<A&&(I+=m[c++]<<E,E+=8)),r<(at+=I&(1<<A)-1)){s.msg="invalid distance too far back",t.mode=30;break t}if(I>>>=A,E-=A,(A=v-g)<at){if(o<(A=at-A)&&t.sane){s.msg="invalid distance too far back",t.mode=30;break t}if(N=h,(S=0)===d){if(S+=w-A,A<W){for(W-=A;U[v++]=h[S++],--A;);S=v-at,N=U}}else if(d<A){if(S+=w+d-A,(A-=d)<W){for(W-=A;U[v++]=h[S++],--A;);if(S=0,d<W){for(W-=A=d;U[v++]=h[S++],--A;);S=v-at,N=U}}}else if(S+=d-A,A<W){for(W-=A;U[v++]=h[S++],--A;);S=v-at,N=U}for(;2<W;)U[v++]=N[S++],U[v++]=N[S++],U[v++]=N[S++],W-=3;W&&(U[v++]=N[S++],1<W&&(U[v++]=N[S++]))}else{for(S=v-at;U[v++]=U[S++],U[v++]=U[S++],U[v++]=U[S++],2<(W-=3););W&&(U[v++]=U[S++],1<W&&(U[v++]=U[S++]))}break}}break}}while(c<b&&v<_);c-=W=E>>3,I&=(1<<(E-=W<<3))-1,s.next_in=c,s.next_out=v,s.avail_in=c<b?b-c+5:5-(c-b),s.avail_out=v<_?_-v+257:257-(v-_),t.hold=I,t.bits=E}},{}],49:[function(p,k,a){var s=p("../utils/common"),f=p("./adler32"),t=p("./crc32"),c=p("./inffast"),b=p("./inftrees"),v=1,g=2,_=0,r=-2,w=1,o=852,d=592;function h(S){return(S>>>24&255)+(S>>>8&65280)+((65280&S)<<8)+((255&S)<<24)}function I(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function E(S){var N;return S&&S.state?(N=S.state,S.total_in=S.total_out=N.total=0,S.msg="",N.wrap&&(S.adler=1&N.wrap),N.mode=w,N.last=0,N.havedict=0,N.dmax=32768,N.head=null,N.hold=0,N.bits=0,N.lencode=N.lendyn=new s.Buf32(o),N.distcode=N.distdyn=new s.Buf32(d),N.sane=1,N.back=-1,_):r}function V(S){var N;return S&&S.state?((N=S.state).wsize=0,N.whave=0,N.wnext=0,E(S)):r}function x(S,N){var m,U;return S&&S.state?(U=S.state,N<0?(m=0,N=-N):(m=1+(N>>4),N<48&&(N&=15)),N&&(N<8||15<N)?r:(U.window!==null&&U.wbits!==N&&(U.window=null),U.wrap=m,U.wbits=N,V(S))):r}function q(S,N){var m,U;return S?(U=new I,(S.state=U).window=null,(m=x(S,N))!==_&&(S.state=null),m):r}var B,$,A=!0;function W(S){if(A){var N;for(B=new s.Buf32(512),$=new s.Buf32(32),N=0;N<144;)S.lens[N++]=8;for(;N<256;)S.lens[N++]=9;for(;N<280;)S.lens[N++]=7;for(;N<288;)S.lens[N++]=8;for(b(v,S.lens,0,288,B,0,S.work,{bits:9}),N=0;N<32;)S.lens[N++]=5;b(g,S.lens,0,32,$,0,S.work,{bits:5}),A=!1}S.lencode=B,S.lenbits=9,S.distcode=$,S.distbits=5}function at(S,N,m,U){var it,j=S.state;return j.window===null&&(j.wsize=1<<j.wbits,j.wnext=0,j.whave=0,j.window=new s.Buf8(j.wsize)),U>=j.wsize?(s.arraySet(j.window,N,m-j.wsize,j.wsize,0),j.wnext=0,j.whave=j.wsize):(U<(it=j.wsize-j.wnext)&&(it=U),s.arraySet(j.window,N,m-U,it,j.wnext),(U-=it)?(s.arraySet(j.window,N,m-U,U,0),j.wnext=U,j.whave=j.wsize):(j.wnext+=it,j.wnext===j.wsize&&(j.wnext=0),j.whave<j.wsize&&(j.whave+=it))),0}a.inflateReset=V,a.inflateReset2=x,a.inflateResetKeep=E,a.inflateInit=function(S){return q(S,15)},a.inflateInit2=q,a.inflate=function(S,N){var m,U,it,j,st,H,rt,F,z,tt,K,G,bt,Ct,lt,mt,yt,_t,zt,Pt,n,O,T,C,y=0,D=new s.Buf8(4),R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!S||!S.state||!S.output||!S.input&&S.avail_in!==0)return r;(m=S.state).mode===12&&(m.mode=13),st=S.next_out,it=S.output,rt=S.avail_out,j=S.next_in,U=S.input,H=S.avail_in,F=m.hold,z=m.bits,tt=H,K=rt,O=_;t:for(;;)switch(m.mode){case w:if(m.wrap===0){m.mode=13;break}for(;z<16;){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}if(2&m.wrap&&F===35615){D[m.check=0]=255&F,D[1]=F>>>8&255,m.check=t(m.check,D,2,0),z=F=0,m.mode=2;break}if(m.flags=0,m.head&&(m.head.done=!1),!(1&m.wrap)||(((255&F)<<8)+(F>>8))%31){S.msg="incorrect header check",m.mode=30;break}if((15&F)!=8){S.msg="unknown compression method",m.mode=30;break}if(z-=4,n=8+(15&(F>>>=4)),m.wbits===0)m.wbits=n;else if(n>m.wbits){S.msg="invalid window size",m.mode=30;break}m.dmax=1<<n,S.adler=m.check=1,m.mode=512&F?10:12,z=F=0;break;case 2:for(;z<16;){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}if(m.flags=F,(255&m.flags)!=8){S.msg="unknown compression method",m.mode=30;break}if(57344&m.flags){S.msg="unknown header flags set",m.mode=30;break}m.head&&(m.head.text=F>>8&1),512&m.flags&&(D[0]=255&F,D[1]=F>>>8&255,m.check=t(m.check,D,2,0)),z=F=0,m.mode=3;case 3:for(;z<32;){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}m.head&&(m.head.time=F),512&m.flags&&(D[0]=255&F,D[1]=F>>>8&255,D[2]=F>>>16&255,D[3]=F>>>24&255,m.check=t(m.check,D,4,0)),z=F=0,m.mode=4;case 4:for(;z<16;){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}m.head&&(m.head.xflags=255&F,m.head.os=F>>8),512&m.flags&&(D[0]=255&F,D[1]=F>>>8&255,m.check=t(m.check,D,2,0)),z=F=0,m.mode=5;case 5:if(1024&m.flags){for(;z<16;){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}m.length=F,m.head&&(m.head.extra_len=F),512&m.flags&&(D[0]=255&F,D[1]=F>>>8&255,m.check=t(m.check,D,2,0)),z=F=0}else m.head&&(m.head.extra=null);m.mode=6;case 6:if(1024&m.flags&&(H<(G=m.length)&&(G=H),G&&(m.head&&(n=m.head.extra_len-m.length,m.head.extra||(m.head.extra=new Array(m.head.extra_len)),s.arraySet(m.head.extra,U,j,G,n)),512&m.flags&&(m.check=t(m.check,U,G,j)),H-=G,j+=G,m.length-=G),m.length))break t;m.length=0,m.mode=7;case 7:if(2048&m.flags){if(H===0)break t;for(G=0;n=U[j+G++],m.head&&n&&m.length<65536&&(m.head.name+=String.fromCharCode(n)),n&&G<H;);if(512&m.flags&&(m.check=t(m.check,U,G,j)),H-=G,j+=G,n)break t}else m.head&&(m.head.name=null);m.length=0,m.mode=8;case 8:if(4096&m.flags){if(H===0)break t;for(G=0;n=U[j+G++],m.head&&n&&m.length<65536&&(m.head.comment+=String.fromCharCode(n)),n&&G<H;);if(512&m.flags&&(m.check=t(m.check,U,G,j)),H-=G,j+=G,n)break t}else m.head&&(m.head.comment=null);m.mode=9;case 9:if(512&m.flags){for(;z<16;){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}if(F!==(65535&m.check)){S.msg="header crc mismatch",m.mode=30;break}z=F=0}m.head&&(m.head.hcrc=m.flags>>9&1,m.head.done=!0),S.adler=m.check=0,m.mode=12;break;case 10:for(;z<32;){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}S.adler=m.check=h(F),z=F=0,m.mode=11;case 11:if(m.havedict===0)return S.next_out=st,S.avail_out=rt,S.next_in=j,S.avail_in=H,m.hold=F,m.bits=z,2;S.adler=m.check=1,m.mode=12;case 12:if(N===5||N===6)break t;case 13:if(m.last){F>>>=7&z,z-=7&z,m.mode=27;break}for(;z<3;){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}switch(m.last=1&F,z-=1,3&(F>>>=1)){case 0:m.mode=14;break;case 1:if(W(m),m.mode=20,N!==6)break;F>>>=2,z-=2;break t;case 2:m.mode=17;break;case 3:S.msg="invalid block type",m.mode=30}F>>>=2,z-=2;break;case 14:for(F>>>=7&z,z-=7&z;z<32;){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}if((65535&F)!=(F>>>16^65535)){S.msg="invalid stored block lengths",m.mode=30;break}if(m.length=65535&F,z=F=0,m.mode=15,N===6)break t;case 15:m.mode=16;case 16:if(G=m.length){if(H<G&&(G=H),rt<G&&(G=rt),G===0)break t;s.arraySet(it,U,j,G,st),H-=G,j+=G,rt-=G,st+=G,m.length-=G;break}m.mode=12;break;case 17:for(;z<14;){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}if(m.nlen=257+(31&F),F>>>=5,z-=5,m.ndist=1+(31&F),F>>>=5,z-=5,m.ncode=4+(15&F),F>>>=4,z-=4,286<m.nlen||30<m.ndist){S.msg="too many length or distance symbols",m.mode=30;break}m.have=0,m.mode=18;case 18:for(;m.have<m.ncode;){for(;z<3;){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}m.lens[R[m.have++]]=7&F,F>>>=3,z-=3}for(;m.have<19;)m.lens[R[m.have++]]=0;if(m.lencode=m.lendyn,m.lenbits=7,T={bits:m.lenbits},O=b(0,m.lens,0,19,m.lencode,0,m.work,T),m.lenbits=T.bits,O){S.msg="invalid code lengths set",m.mode=30;break}m.have=0,m.mode=19;case 19:for(;m.have<m.nlen+m.ndist;){for(;mt=(y=m.lencode[F&(1<<m.lenbits)-1])>>>16&255,yt=65535&y,!((lt=y>>>24)<=z);){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}if(yt<16)F>>>=lt,z-=lt,m.lens[m.have++]=yt;else{if(yt===16){for(C=lt+2;z<C;){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}if(F>>>=lt,z-=lt,m.have===0){S.msg="invalid bit length repeat",m.mode=30;break}n=m.lens[m.have-1],G=3+(3&F),F>>>=2,z-=2}else if(yt===17){for(C=lt+3;z<C;){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}z-=lt,n=0,G=3+(7&(F>>>=lt)),F>>>=3,z-=3}else{for(C=lt+7;z<C;){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}z-=lt,n=0,G=11+(127&(F>>>=lt)),F>>>=7,z-=7}if(m.have+G>m.nlen+m.ndist){S.msg="invalid bit length repeat",m.mode=30;break}for(;G--;)m.lens[m.have++]=n}}if(m.mode===30)break;if(m.lens[256]===0){S.msg="invalid code -- missing end-of-block",m.mode=30;break}if(m.lenbits=9,T={bits:m.lenbits},O=b(v,m.lens,0,m.nlen,m.lencode,0,m.work,T),m.lenbits=T.bits,O){S.msg="invalid literal/lengths set",m.mode=30;break}if(m.distbits=6,m.distcode=m.distdyn,T={bits:m.distbits},O=b(g,m.lens,m.nlen,m.ndist,m.distcode,0,m.work,T),m.distbits=T.bits,O){S.msg="invalid distances set",m.mode=30;break}if(m.mode=20,N===6)break t;case 20:m.mode=21;case 21:if(6<=H&&258<=rt){S.next_out=st,S.avail_out=rt,S.next_in=j,S.avail_in=H,m.hold=F,m.bits=z,c(S,K),st=S.next_out,it=S.output,rt=S.avail_out,j=S.next_in,U=S.input,H=S.avail_in,F=m.hold,z=m.bits,m.mode===12&&(m.back=-1);break}for(m.back=0;mt=(y=m.lencode[F&(1<<m.lenbits)-1])>>>16&255,yt=65535&y,!((lt=y>>>24)<=z);){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}if(mt&&(240&mt)==0){for(_t=lt,zt=mt,Pt=yt;mt=(y=m.lencode[Pt+((F&(1<<_t+zt)-1)>>_t)])>>>16&255,yt=65535&y,!(_t+(lt=y>>>24)<=z);){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}F>>>=_t,z-=_t,m.back+=_t}if(F>>>=lt,z-=lt,m.back+=lt,m.length=yt,mt===0){m.mode=26;break}if(32&mt){m.back=-1,m.mode=12;break}if(64&mt){S.msg="invalid literal/length code",m.mode=30;break}m.extra=15&mt,m.mode=22;case 22:if(m.extra){for(C=m.extra;z<C;){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}m.length+=F&(1<<m.extra)-1,F>>>=m.extra,z-=m.extra,m.back+=m.extra}m.was=m.length,m.mode=23;case 23:for(;mt=(y=m.distcode[F&(1<<m.distbits)-1])>>>16&255,yt=65535&y,!((lt=y>>>24)<=z);){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}if((240&mt)==0){for(_t=lt,zt=mt,Pt=yt;mt=(y=m.distcode[Pt+((F&(1<<_t+zt)-1)>>_t)])>>>16&255,yt=65535&y,!(_t+(lt=y>>>24)<=z);){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}F>>>=_t,z-=_t,m.back+=_t}if(F>>>=lt,z-=lt,m.back+=lt,64&mt){S.msg="invalid distance code",m.mode=30;break}m.offset=yt,m.extra=15&mt,m.mode=24;case 24:if(m.extra){for(C=m.extra;z<C;){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}m.offset+=F&(1<<m.extra)-1,F>>>=m.extra,z-=m.extra,m.back+=m.extra}if(m.offset>m.dmax){S.msg="invalid distance too far back",m.mode=30;break}m.mode=25;case 25:if(rt===0)break t;if(G=K-rt,m.offset>G){if((G=m.offset-G)>m.whave&&m.sane){S.msg="invalid distance too far back",m.mode=30;break}bt=G>m.wnext?(G-=m.wnext,m.wsize-G):m.wnext-G,G>m.length&&(G=m.length),Ct=m.window}else Ct=it,bt=st-m.offset,G=m.length;for(rt<G&&(G=rt),rt-=G,m.length-=G;it[st++]=Ct[bt++],--G;);m.length===0&&(m.mode=21);break;case 26:if(rt===0)break t;it[st++]=m.length,rt--,m.mode=21;break;case 27:if(m.wrap){for(;z<32;){if(H===0)break t;H--,F|=U[j++]<<z,z+=8}if(K-=rt,S.total_out+=K,m.total+=K,K&&(S.adler=m.check=m.flags?t(m.check,it,K,st-K):f(m.check,it,K,st-K)),K=rt,(m.flags?F:h(F))!==m.check){S.msg="incorrect data check",m.mode=30;break}z=F=0}m.mode=28;case 28:if(m.wrap&&m.flags){for(;z<32;){if(H===0)break t;H--,F+=U[j++]<<z,z+=8}if(F!==(4294967295&m.total)){S.msg="incorrect length check",m.mode=30;break}z=F=0}m.mode=29;case 29:O=1;break t;case 30:O=-3;break t;case 31:return-4;case 32:default:return r}return S.next_out=st,S.avail_out=rt,S.next_in=j,S.avail_in=H,m.hold=F,m.bits=z,(m.wsize||K!==S.avail_out&&m.mode<30&&(m.mode<27||N!==4))&&at(S,S.output,S.next_out,K-S.avail_out)?(m.mode=31,-4):(tt-=S.avail_in,K-=S.avail_out,S.total_in+=tt,S.total_out+=K,m.total+=K,m.wrap&&K&&(S.adler=m.check=m.flags?t(m.check,it,K,S.next_out-K):f(m.check,it,K,S.next_out-K)),S.data_type=m.bits+(m.last?64:0)+(m.mode===12?128:0)+(m.mode===20||m.mode===15?256:0),(tt==0&&K===0||N===4)&&O===_&&(O=-5),O)},a.inflateEnd=function(S){if(!S||!S.state)return r;var N=S.state;return N.window&&(N.window=null),S.state=null,_},a.inflateGetHeader=function(S,N){var m;return S&&S.state?(2&(m=S.state).wrap)==0?r:((m.head=N).done=!1,_):r},a.inflateSetDictionary=function(S,N){var m,U=N.length;return S&&S.state?(m=S.state).wrap!==0&&m.mode!==11?r:m.mode===11&&f(1,N,U,0)!==m.check?-3:at(S,N,U,U)?(m.mode=31,-4):(m.havedict=1,_):r},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(p,k,a){var s=p("../utils/common"),f=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],t=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],b=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];k.exports=function(v,g,_,r,w,o,d,h){var I,E,V,x,q,B,$,A,W,at=h.bits,S=0,N=0,m=0,U=0,it=0,j=0,st=0,H=0,rt=0,F=0,z=null,tt=0,K=new s.Buf16(16),G=new s.Buf16(16),bt=null,Ct=0;for(S=0;S<=15;S++)K[S]=0;for(N=0;N<r;N++)K[g[_+N]]++;for(it=at,U=15;1<=U&&K[U]===0;U--);if(U<it&&(it=U),U===0)return w[o++]=20971520,w[o++]=20971520,h.bits=1,0;for(m=1;m<U&&K[m]===0;m++);for(it<m&&(it=m),S=H=1;S<=15;S++)if(H<<=1,(H-=K[S])<0)return-1;if(0<H&&(v===0||U!==1))return-1;for(G[1]=0,S=1;S<15;S++)G[S+1]=G[S]+K[S];for(N=0;N<r;N++)g[_+N]!==0&&(d[G[g[_+N]]++]=N);if(B=v===0?(z=bt=d,19):v===1?(z=f,tt-=257,bt=t,Ct-=257,256):(z=c,bt=b,-1),S=m,q=o,st=N=F=0,V=-1,x=(rt=1<<(j=it))-1,v===1&&852<rt||v===2&&592<rt)return 1;for(;;){for($=S-st,W=d[N]<B?(A=0,d[N]):d[N]>B?(A=bt[Ct+d[N]],z[tt+d[N]]):(A=96,0),I=1<<S-st,m=E=1<<j;w[q+(F>>st)+(E-=I)]=$<<24|A<<16|W|0,E!==0;);for(I=1<<S-1;F&I;)I>>=1;if(I!==0?(F&=I-1,F+=I):F=0,N++,--K[S]==0){if(S===U)break;S=g[_+d[N]]}if(it<S&&(F&x)!==V){for(st===0&&(st=it),q+=m,H=1<<(j=S-st);j+st<U&&!((H-=K[j+st])<=0);)j++,H<<=1;if(rt+=1<<j,v===1&&852<rt||v===2&&592<rt)return 1;w[V=F&x]=it<<24|j<<16|q-o|0}}return F!==0&&(w[q+F]=S-st<<24|64<<16|0),h.bits=it,0}},{"../utils/common":41}],51:[function(p,k,a){k.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(p,k,a){var s=p("../utils/common"),f=0,t=1;function c(y){for(var D=y.length;0<=--D;)y[D]=0}var b=0,v=29,g=256,_=g+1+v,r=30,w=19,o=2*_+1,d=15,h=16,I=7,E=256,V=16,x=17,q=18,B=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],$=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],at=new Array(2*(_+2));c(at);var S=new Array(2*r);c(S);var N=new Array(512);c(N);var m=new Array(256);c(m);var U=new Array(v);c(U);var it,j,st,H=new Array(r);function rt(y,D,R,L,P){this.static_tree=y,this.extra_bits=D,this.extra_base=R,this.elems=L,this.max_length=P,this.has_stree=y&&y.length}function F(y,D){this.dyn_tree=y,this.max_code=0,this.stat_desc=D}function z(y){return y<256?N[y]:N[256+(y>>>7)]}function tt(y,D){y.pending_buf[y.pending++]=255&D,y.pending_buf[y.pending++]=D>>>8&255}function K(y,D,R){y.bi_valid>h-R?(y.bi_buf|=D<<y.bi_valid&65535,tt(y,y.bi_buf),y.bi_buf=D>>h-y.bi_valid,y.bi_valid+=R-h):(y.bi_buf|=D<<y.bi_valid&65535,y.bi_valid+=R)}function G(y,D,R){K(y,R[2*D],R[2*D+1])}function bt(y,D){for(var R=0;R|=1&y,y>>>=1,R<<=1,0<--D;);return R>>>1}function Ct(y,D,R){var L,P,Z=new Array(d+1),Y=0;for(L=1;L<=d;L++)Z[L]=Y=Y+R[L-1]<<1;for(P=0;P<=D;P++){var X=y[2*P+1];X!==0&&(y[2*P]=bt(Z[X]++,X))}}function lt(y){var D;for(D=0;D<_;D++)y.dyn_ltree[2*D]=0;for(D=0;D<r;D++)y.dyn_dtree[2*D]=0;for(D=0;D<w;D++)y.bl_tree[2*D]=0;y.dyn_ltree[2*E]=1,y.opt_len=y.static_len=0,y.last_lit=y.matches=0}function mt(y){8<y.bi_valid?tt(y,y.bi_buf):0<y.bi_valid&&(y.pending_buf[y.pending++]=y.bi_buf),y.bi_buf=0,y.bi_valid=0}function yt(y,D,R,L){var P=2*D,Z=2*R;return y[P]<y[Z]||y[P]===y[Z]&&L[D]<=L[R]}function _t(y,D,R){for(var L=y.heap[R],P=R<<1;P<=y.heap_len&&(P<y.heap_len&&yt(D,y.heap[P+1],y.heap[P],y.depth)&&P++,!yt(D,L,y.heap[P],y.depth));)y.heap[R]=y.heap[P],R=P,P<<=1;y.heap[R]=L}function zt(y,D,R){var L,P,Z,Y,X=0;if(y.last_lit!==0)for(;L=y.pending_buf[y.d_buf+2*X]<<8|y.pending_buf[y.d_buf+2*X+1],P=y.pending_buf[y.l_buf+X],X++,L===0?G(y,P,D):(G(y,(Z=m[P])+g+1,D),(Y=B[Z])!==0&&K(y,P-=U[Z],Y),G(y,Z=z(--L),R),(Y=$[Z])!==0&&K(y,L-=H[Z],Y)),X<y.last_lit;);G(y,E,D)}function Pt(y,D){var R,L,P,Z=D.dyn_tree,Y=D.stat_desc.static_tree,X=D.stat_desc.has_stree,J=D.stat_desc.elems,pt=-1;for(y.heap_len=0,y.heap_max=o,R=0;R<J;R++)Z[2*R]!==0?(y.heap[++y.heap_len]=pt=R,y.depth[R]=0):Z[2*R+1]=0;for(;y.heap_len<2;)Z[2*(P=y.heap[++y.heap_len]=pt<2?++pt:0)]=1,y.depth[P]=0,y.opt_len--,X&&(y.static_len-=Y[2*P+1]);for(D.max_code=pt,R=y.heap_len>>1;1<=R;R--)_t(y,Z,R);for(P=J;R=y.heap[1],y.heap[1]=y.heap[y.heap_len--],_t(y,Z,1),L=y.heap[1],y.heap[--y.heap_max]=R,y.heap[--y.heap_max]=L,Z[2*P]=Z[2*R]+Z[2*L],y.depth[P]=(y.depth[R]>=y.depth[L]?y.depth[R]:y.depth[L])+1,Z[2*R+1]=Z[2*L+1]=P,y.heap[1]=P++,_t(y,Z,1),2<=y.heap_len;);y.heap[--y.heap_max]=y.heap[1],function(dt,Vt){var Mt,Ft,jt,wt,Zt,oe,At=Vt.dyn_tree,le=Vt.max_code,_e=Vt.stat_desc.static_tree,we=Vt.stat_desc.has_stree,ye=Vt.stat_desc.extra_bits,de=Vt.stat_desc.extra_base,$t=Vt.stat_desc.max_length,Xt=0;for(wt=0;wt<=d;wt++)dt.bl_count[wt]=0;for(At[2*dt.heap[dt.heap_max]+1]=0,Mt=dt.heap_max+1;Mt<o;Mt++)$t<(wt=At[2*At[2*(Ft=dt.heap[Mt])+1]+1]+1)&&(wt=$t,Xt++),At[2*Ft+1]=wt,le<Ft||(dt.bl_count[wt]++,Zt=0,de<=Ft&&(Zt=ye[Ft-de]),oe=At[2*Ft],dt.opt_len+=oe*(wt+Zt),we&&(dt.static_len+=oe*(_e[2*Ft+1]+Zt)));if(Xt!==0){do{for(wt=$t-1;dt.bl_count[wt]===0;)wt--;dt.bl_count[wt]--,dt.bl_count[wt+1]+=2,dt.bl_count[$t]--,Xt-=2}while(0<Xt);for(wt=$t;wt!==0;wt--)for(Ft=dt.bl_count[wt];Ft!==0;)le<(jt=dt.heap[--Mt])||(At[2*jt+1]!==wt&&(dt.opt_len+=(wt-At[2*jt+1])*At[2*jt],At[2*jt+1]=wt),Ft--)}}(y,D),Ct(Z,pt,y.bl_count)}function n(y,D,R){var L,P,Z=-1,Y=D[1],X=0,J=7,pt=4;for(Y===0&&(J=138,pt=3),D[2*(R+1)+1]=65535,L=0;L<=R;L++)P=Y,Y=D[2*(L+1)+1],++X<J&&P===Y||(X<pt?y.bl_tree[2*P]+=X:P!==0?(P!==Z&&y.bl_tree[2*P]++,y.bl_tree[2*V]++):X<=10?y.bl_tree[2*x]++:y.bl_tree[2*q]++,Z=P,pt=(X=0)===Y?(J=138,3):P===Y?(J=6,3):(J=7,4))}function O(y,D,R){var L,P,Z=-1,Y=D[1],X=0,J=7,pt=4;for(Y===0&&(J=138,pt=3),L=0;L<=R;L++)if(P=Y,Y=D[2*(L+1)+1],!(++X<J&&P===Y)){if(X<pt)for(;G(y,P,y.bl_tree),--X!=0;);else P!==0?(P!==Z&&(G(y,P,y.bl_tree),X--),G(y,V,y.bl_tree),K(y,X-3,2)):X<=10?(G(y,x,y.bl_tree),K(y,X-3,3)):(G(y,q,y.bl_tree),K(y,X-11,7));Z=P,pt=(X=0)===Y?(J=138,3):P===Y?(J=6,3):(J=7,4)}}c(H);var T=!1;function C(y,D,R,L){K(y,(b<<1)+(L?1:0),3),function(P,Z,Y,X){mt(P),X&&(tt(P,Y),tt(P,~Y)),s.arraySet(P.pending_buf,P.window,Z,Y,P.pending),P.pending+=Y}(y,D,R,!0)}a._tr_init=function(y){T||(function(){var D,R,L,P,Z,Y=new Array(d+1);for(P=L=0;P<v-1;P++)for(U[P]=L,D=0;D<1<<B[P];D++)m[L++]=P;for(m[L-1]=P,P=Z=0;P<16;P++)for(H[P]=Z,D=0;D<1<<$[P];D++)N[Z++]=P;for(Z>>=7;P<r;P++)for(H[P]=Z<<7,D=0;D<1<<$[P]-7;D++)N[256+Z++]=P;for(R=0;R<=d;R++)Y[R]=0;for(D=0;D<=143;)at[2*D+1]=8,D++,Y[8]++;for(;D<=255;)at[2*D+1]=9,D++,Y[9]++;for(;D<=279;)at[2*D+1]=7,D++,Y[7]++;for(;D<=287;)at[2*D+1]=8,D++,Y[8]++;for(Ct(at,_+1,Y),D=0;D<r;D++)S[2*D+1]=5,S[2*D]=bt(D,5);it=new rt(at,B,g+1,_,d),j=new rt(S,$,0,r,d),st=new rt(new Array(0),A,0,w,I)}(),T=!0),y.l_desc=new F(y.dyn_ltree,it),y.d_desc=new F(y.dyn_dtree,j),y.bl_desc=new F(y.bl_tree,st),y.bi_buf=0,y.bi_valid=0,lt(y)},a._tr_stored_block=C,a._tr_flush_block=function(y,D,R,L){var P,Z,Y=0;0<y.level?(y.strm.data_type===2&&(y.strm.data_type=function(X){var J,pt=4093624447;for(J=0;J<=31;J++,pt>>>=1)if(1&pt&&X.dyn_ltree[2*J]!==0)return f;if(X.dyn_ltree[18]!==0||X.dyn_ltree[20]!==0||X.dyn_ltree[26]!==0)return t;for(J=32;J<g;J++)if(X.dyn_ltree[2*J]!==0)return t;return f}(y)),Pt(y,y.l_desc),Pt(y,y.d_desc),Y=function(X){var J;for(n(X,X.dyn_ltree,X.l_desc.max_code),n(X,X.dyn_dtree,X.d_desc.max_code),Pt(X,X.bl_desc),J=w-1;3<=J&&X.bl_tree[2*W[J]+1]===0;J--);return X.opt_len+=3*(J+1)+5+5+4,J}(y),P=y.opt_len+3+7>>>3,(Z=y.static_len+3+7>>>3)<=P&&(P=Z)):P=Z=R+5,R+4<=P&&D!==-1?C(y,D,R,L):y.strategy===4||Z===P?(K(y,2+(L?1:0),3),zt(y,at,S)):(K(y,4+(L?1:0),3),function(X,J,pt,dt){var Vt;for(K(X,J-257,5),K(X,pt-1,5),K(X,dt-4,4),Vt=0;Vt<dt;Vt++)K(X,X.bl_tree[2*W[Vt]+1],3);O(X,X.dyn_ltree,J-1),O(X,X.dyn_dtree,pt-1)}(y,y.l_desc.max_code+1,y.d_desc.max_code+1,Y+1),zt(y,y.dyn_ltree,y.dyn_dtree)),lt(y),L&&mt(y)},a._tr_tally=function(y,D,R){return y.pending_buf[y.d_buf+2*y.last_lit]=D>>>8&255,y.pending_buf[y.d_buf+2*y.last_lit+1]=255&D,y.pending_buf[y.l_buf+y.last_lit]=255&R,y.last_lit++,D===0?y.dyn_ltree[2*R]++:(y.matches++,D--,y.dyn_ltree[2*(m[R]+g+1)]++,y.dyn_dtree[2*z(D)]++),y.last_lit===y.lit_bufsize-1},a._tr_align=function(y){K(y,2,3),G(y,E,at),function(D){D.bi_valid===16?(tt(D,D.bi_buf),D.bi_buf=0,D.bi_valid=0):8<=D.bi_valid&&(D.pending_buf[D.pending++]=255&D.bi_buf,D.bi_buf>>=8,D.bi_valid-=8)}(y)}},{"../utils/common":41}],53:[function(p,k,a){k.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(p,k,a){(function(s){(function(f,t){if(!f.setImmediate){var c,b,v,g,_=1,r={},w=!1,o=f.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(f);d=d&&d.setTimeout?d:f,c={}.toString.call(f.process)==="[object process]"?function(V){process.nextTick(function(){I(V)})}:function(){if(f.postMessage&&!f.importScripts){var V=!0,x=f.onmessage;return f.onmessage=function(){V=!1},f.postMessage("","*"),f.onmessage=x,V}}()?(g="setImmediate$"+Math.random()+"$",f.addEventListener?f.addEventListener("message",E,!1):f.attachEvent("onmessage",E),function(V){f.postMessage(g+V,"*")}):f.MessageChannel?((v=new MessageChannel).port1.onmessage=function(V){I(V.data)},function(V){v.port2.postMessage(V)}):o&&"onreadystatechange"in o.createElement("script")?(b=o.documentElement,function(V){var x=o.createElement("script");x.onreadystatechange=function(){I(V),x.onreadystatechange=null,b.removeChild(x),x=null},b.appendChild(x)}):function(V){setTimeout(I,0,V)},d.setImmediate=function(V){typeof V!="function"&&(V=new Function(""+V));for(var x=new Array(arguments.length-1),q=0;q<x.length;q++)x[q]=arguments[q+1];var B={callback:V,args:x};return r[_]=B,c(_),_++},d.clearImmediate=h}function h(V){delete r[V]}function I(V){if(w)setTimeout(I,0,V);else{var x=r[V];if(x){w=!0;try{(function(q){var B=q.callback,$=q.args;switch($.length){case 0:B();break;case 1:B($[0]);break;case 2:B($[0],$[1]);break;case 3:B($[0],$[1],$[2]);break;default:B.apply(t,$)}})(x)}finally{h(V),w=!1}}}}function E(V){V.source===f&&typeof V.data=="string"&&V.data.indexOf(g)===0&&I(+V.data.slice(g.length))}})(typeof self=="undefined"?s===void 0?this:s:self)}).call(this,typeof Wt!="undefined"?Wt:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}]},{},[10])(10)})})(be);var ga=be.exports;const Ht={paginacao:{atual:1,maximo:1,total:1,limite:25},filtros:{numero:"",numeroCompra:null,termoBusca:"",periodoEmissao:{ini:"",fim:""},periodoFinalizado:{ini:"",fim:""},fornecedor:{id:"",nome:""},destinatario:{nome:""}}},va={components:{Lista:ze,ComprasFicha:Ze,ComprasImportacaoXML:pa},data(){return{lista:[],contatos:{},mostrar:{barraTopo:!0,toolbarTitulo:!0,icone:"factory",titulo:"Compras",filtroAvancado:!0,buscar:!0,btnAjuda:!0,btnAtualizar:!0,btnNovo:!0,toolbarAcoes:!0,checkBox:!1,btnRemover:!1,btnRestaurar:!1,centralizaTabs:!1,btnDetalhes:!1,btnExportaXLS:!1,btnMenuMais:!1,toolbarAdicao:!1,bannerMsg:""},resultado:{},busca:"",filtros:$utils.clonarV2(Ht.filtros),tabSelecionada:{valor:"Digita\xE7\xE3o"},tabs:[{valor:"Digita\xE7\xE3o",rotulo:"Digita\xE7\xE3o"},{valor:"Finalizado",rotulo:"Finalizado"},{valor:"Todos",rotulo:"Todos"}],tabSelecionada2:{valor:"Pedido de Compra"},tabs2:[{valor:"Pedido de Compra",rotulo:"Pedido de Compra"},{valor:"Nota de Entrada",rotulo:"Nota de Entrada"},{valor:"Nota no SEFAZ",rotulo:"Nota no SEFAZ"}],paginacao:$utils.clonarV2(Ht.paginacao),xmlDevolucao:!1,xmlEstrangeiro:!1,modalXMLNotaEntrada:!1,xmlNotaEntrada:{},configImpressao:[],abrirNotadeEntrada:null}},methods:{async atualizar(i){var p;const u=$utils.logarIni("ComprasLista");await $tryLoading(async()=>{let{buscarDadosRecentes:k}=i!=null?i:{},a,s,f,t,c=["dataHoraFinalizado","dataHoraEmissao"],b=["desc","desc"];if(i!=null&&i.aba2&&(this.tabSelecionada2.valor=i.aba2),this.tabSelecionada2Anterior&&this.tabSelecionada2Anterior!==this.tabSelecionada2.valor&&(this.setOpcoesTabs(this.tabSelecionada2.valor),this.filtros=$utils.clonarV2(Ht.filtros),this.paginacao=$utils.clonarV2(Ht.paginacao),this.busca="",k=!0),this.tabSelecionada2Anterior=this.tabSelecionada2.valor,k&&(a=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:this.tabSelecionada2.valor}),a!=null&&a._id&&(this.filtros=a.filtros,this.busca=a.termoBusca,this.paginacao.limite=a.limit,this.paginacao.atual=a.page,c=a.sort,b=a.dir)),i!=null&&i.aba&&(this.tabSelecionada.valor=i.aba),s=$utils.eliminarVazios(this.filtros),f=this.paginacao.limite,t=this.paginacao.atual,s.status=this.tabSelecionada.valor,s.operacao=this.tabSelecionada2.valor,s.termoBusca=this.busca,this.tabSelecionada.valor==="Todos"&&delete s.status,s.operacao==="Nota no SEFAZ"){const v=await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{tipo:"DFe",situacao:s.status}}),g=[];v.filter(r=>{var h,I,E,V;if(((h=this.filtros.fornecedor)==null?void 0:h.nome)&&!r.xNomeEmitente.toLowerCase().includes(this.filtros.fornecedor.nome.toLowerCase())||((I=this.filtros.destinatario)==null?void 0:I.nome)&&!r.xNomeDestinatario.toLowerCase().includes(this.filtros.destinatario.nome.toLowerCase()))return!1;const w=new Date(r.dhEmi).setHours(0,0,0,0),o=new Date((E=this.filtros.periodoEmissao)==null?void 0:E.ini).setHours(0,0,0,0),d=new Date((V=this.filtros.periodoEmissao)==null?void 0:V.fim).setHours(0,0,0,0);return!((o||d)&&w&&(o&&w<o||d&&w>d))}).forEach(r=>{const w={id:r.id,descricaoContato:r.xNomeEmitente,descricaoDestinatario:r.xNomeDestinatario,dataHoraEmissao:r.dataHoraEmissao,dataHoraFinalizado:null,totalDocumento:r.vNF,qtdeContatos:null,status:r.situacao,notaNumero:r.nNF};g.push(w)});const _=(t-1)*f;this.paginacao.total=g.length,this.paginacao.maximo=Math.ceil(this.paginacao.total/f)||1,this.lista=g.splice(_,f),this.configuraImpressao(this.filtros.idEmpresa)}else{const v=await $db.compra.leListaCompleta({filtros:s,limit:f,page:t,sort:c,dir:b});this.paginacao.total=v.total,this.paginacao.maximo=v.totalPages,this.lista=v.data.compras}for(const{idContato:v}of this.lista)v&&!this.contatos[v]&&(this.contatos[v]={});this.carregarImagensContatos(this.contatos),a={_id:this.tabSelecionada2.valor,tabSelecionada:this.tabSelecionada.valor,filtros:$utils.clonarV2(s),termoBusca:this.busca,limit:this.paginacao.limite,page:this.paginacao.atual,sort:c,dir:b},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:a}),this.configuraImpressao(this.filtros.idEmpresa)}),$utils.logarFim(u,((p=this.paginacao)==null?void 0:p.total)||1)},async carregarImagensContatos(i){const u=Object.keys(i);if(!!u.length){await $utils.dormir(200);try{const p=await $db.hibrido.lista({table:"contato",columns:["id","apelido","imagem"],whereIn:{id:u}});for(const k of p)i[k.id].imagem=k.imagem||""}catch(p){console.error("Erro ao carregar imagens de contatos - ",p)}}},adicionarXml(i){this.xmlNotaEntrada.arquivo=i[0]},async concluirImportacao(i){await $tryLoading(async()=>{await $db.compra.grava({atual:i}),$q.notifyPositive("Importa\xE7\xE3o realizada com sucesso!"),this.tabSelecionada.valor="Digita\xE7\xE3o",this.tabSelecionada2.valor="Nota de Entrada",await this.$refs.comprasFicha.mostrar({id:i.documento.id})},{mensagem:"Gravando importa\xE7\xE3o..."})},async importarXmlNotaDeEntrada(){var p,k,a,s,f,t;let i,u;try{$utils.verificarErro(!this.xmlNotaEntrada.arquivo,"Adicione um arquivo XML antes de enviar!");const b=await(o=>new Promise((d,h)=>{const I=new FileReader;I.readAsBinaryString(o),I.onload=()=>d(I.result),I.onerror=E=>h(E)}))(this.xmlNotaEntrada.arquivo),v=new DOMParser,g=new XMLSerializer,_=v.parseFromString(b,"text/xml");u=g.serializeToString(_),$utils.verificarErro(_.documentElement.nodeName==="html","Arquivo inv\xE1lido ou corrompido");const r=new Ve.Parser;let w;r.parseString(u,(o,d)=>{o&&console.log(o),w=d}),i=(t=(f=(s=(a=(k=(p=w==null?void 0:w.nfeProc)==null?void 0:p.protNFe)==null?void 0:k[0])==null?void 0:a.infProt)==null?void 0:s[0])==null?void 0:f.nProt)==null?void 0:t[0]}catch(c){return $q.notifyError("Ocorreu um erro na importa\xE7\xE3o",c),!1}if(!i&&!await $q.dialogSimNao({title:"Aviso importante",message:"O XML que est\xE1 sendo importado n\xE3o foi protocolado pela Sefaz, gostaria de importar o XML sem o protocolo?",html:!0})){$q.notifyError("Opera\xE7\xE3o para importa\xE7\xE3o de XML n\xE3o realizada!",erro);return}await $tryLoading(async()=>{const c=(await $db.hibrido.lista({table:"documentoXML",whereFilter:{xmlAux:u}}))[0];$utils.verificarErro(c==null?void 0:c.id,"Esse xml j\xE1 foi importado!");const b=await $db.compra.importaXml({xmlString:u,xmlEstrangeiro:Boolean(this.xmlEstrangeiro)});b.documentosItem.find(({vinculado:v})=>!v)?this.$refs.comprasImportacaoXML.mostrar(b):await this.concluirImportacao(b)},{mensagem:"Importando..."}),delete this.xmlNotaEntrada.arquivo,this.modalXMLNotaEntrada=!1,this.xmlEstrangeiro=!1},async fecharXmlNotaDeEntrada(){delete this.xmlNotaEntrada.arquivo},async abrir(i){this.tabSelecionada2.valor!=="Nota no SEFAZ"&&this.$refs.comprasFicha.mostrar({id:i})},criarClick(){this.$refs.comprasFicha.criar()},importarXmlClick(){this.modalXMLNotaEntrada=!0},limparFiltrosClick(){this.filtros=$utils.clonarV2(Ht.filtros),this.atualizar()},async configuraImpressao(i){const u=await $db.configuracoes.porNome("impressao.compra",i);this.configImpressao=[...u.length?u.map(p=>({texto:"Imprimir Compra",...p})):[{valor:"invoice",texto:"Compras e Estoque"}]]},setOpcoesTabs(i){i!=="Nota no SEFAZ"&&(this.tabSelecionada.valor="Digita\xE7\xE3o",this.tabs=[{valor:"Digita\xE7\xE3o",rotulo:"Digita\xE7\xE3o"},{valor:"Finalizado",rotulo:"Finalizado"},{valor:"Todos",rotulo:"Todos"}]),i==="Nota no SEFAZ"&&(this.tabSelecionada.valor="N\xE3o Importada",this.tabs=[{valor:"N\xE3o Importada",rotulo:"N\xE3o Importada"},{valor:"Importada",rotulo:"Importada"},{valor:"Todos",rotulo:"Todos"}])},async downloadXmlDFeFiltrados(){var u,p,k,a,s;if(!await $q.dialogSimNao({title:"Download XML's filtrados",message:"Deseja prosseguir com a opera\xE7\xE3o?"}))return;let i=[];if($db.hibrido.isOnline())i=(s=(a=(k=await $utils.geeksApi({downloadDFe:{funcao:"2D9F9B43-47D3-491E-AD49-528EC9547BDC",...this.tabSelecionada.valor!=="Todos"?{situacao:this.tabSelecionada.valor}:{},fornecedor:(u=this.filtros.fornecedor)==null?void 0:u.nome,destinatario:(p=this.filtros.destinatario)==null?void 0:p.nome,periodoEmissao:this.filtros.periodoEmissao}}))==null?void 0:k.data)==null?void 0:a.downloadDFe)!=null?s:[];else{let f=await $db.hibrido.lista({table:"documentoFiscalEletronico",columns:["id","dhEmi","cpfCnpjDestinatario","xNomeEmitente","xNomeDestinatario"],where:{tipo:"DFe",...this.tabSelecionada.valor!=="Todos"?{situacao:this.tabSelecionada.valor}:{}}});f=f.filter(c=>{var _,r,w,o;if(((_=this.filtros.fornecedor)==null?void 0:_.nome)&&!c.xNomeEmitente.toLowerCase().includes(this.filtros.fornecedor.nome.toLowerCase())||((r=this.filtros.destinatario)==null?void 0:r.nome)&&!c.xNomeDestinatario.toLowerCase().includes(this.filtros.destinatario.nome.toLowerCase()))return!1;const b=new Date(c.dhEmi).setHours(0,0,0,0),v=new Date((w=this.filtros.periodoEmissao)==null?void 0:w.ini).setHours(0,0,0,0),g=new Date((o=this.filtros.periodoEmissao)==null?void 0:o.fim).setHours(0,0,0,0);return!((v||g)&&b&&(v&&b<v||g&&b>g))}),(await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",columns:["idDocumentoFiscalEletronico","chNFe","xmlProt"],whereIn:{idDocumentoFiscalEletronico:f.map(c=>c.id)}})).forEach(c=>{const b=f.find(v=>v.id===c.idDocumentoFiscalEletronico);b&&i.push({chNFe:c.chNFe,xml:c.xmlProt,cnpj:b.cpfCnpjDestinatario})})}if((i==null?void 0:i.length)>0){const f=Array.from(new Set(i.filter(t=>t.cnpj).map(t=>t.cnpj)));for(const t of f){const c=new ga;for(const b of i.filter(v=>v.cnpj===t))c.file(`${b.chNFe}.procNFe.xml`,b.xml);c.generateAsync({type:"blob"}).then(function(b){const v=new Date,g=document.createElement("a");g.href=window.URL.createObjectURL(b),g.download=`${v.getFullYear()}-${v.getMonth()+1}-${v.getDate()}_NotasEntradaSEFAZ-${t}.zip`,g.click()})}}},async downloadXmlDFe(i){if(!await $q.dialogSimNao({title:"Download XML",message:"Deseja prosseguir com a opera\xE7\xE3o?"}))return;const p=(await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:i}}))[0],k=p==null?void 0:p.xmlProt,a=p==null?void 0:p.chNFe;if(!k){this.$q.notify({message:"N\xE3o foi poss\xEDvel recuperar o XML",type:"negative"});return}const s=document.createElement("a"),f=new Blob([k],{type:"text/plain"});s.setAttribute("href",window.URL.createObjectURL(f)),s.setAttribute("download",`${a}-procNFe.xml`),s.dataset.downloadurl=["text/plain",s.download,s.href].join(":"),s.click()},async importarXmlDFe(i){!await $q.dialogSimNao({title:"Importar XML",message:"Deseja prosseguir com a opera\xE7\xE3o?"})||await $tryLoading(async()=>{try{const u=await $db.hibrido.le({table:"documentoFiscalEletronico",id:i}),p=(await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:i}}))[0];if((u==null?void 0:u.id)&&(p==null?void 0:p.xmlProt)){const k=await $db.compra.importaXml({xmlString:p.xmlProt}),a={original:$utils.clonar(u),atual:$utils.clonar(u)};a.atual.situacao="Importada",await $db.documentoFiscalEletronico.grava(a),await this.concluirImportacao(k),$q.notify({message:"XML Importado para Compras",type:"positive"})}}catch(u){$q.notifyError("Erro ao importar XML",u)}},{mensagem:"Importando..."})}},watch:{"tabSelecionada2.valor"(){this.tabSelecionada2.valor==="Nota no SEFAZ"&&(this.mostrar.btnMenuMais=!0)}},async mounted(){this.tabSelecionada2.valor=this.$route.name,this.atualizar({buscarDadosRecentes:!0})}},ba={id:"Compras"},_a={class:"mw80 text-center"},wa={class:"row q-ma-md"},ya={key:0,class:"row q-ma-md"},Ia={class:"certificado-error-messages"};function ka(i,u,p,k,a,s){const f=ct("campo"),t=ct("BadgeCopiarUid"),c=ct("avatar"),b=ct("g-label"),v=ct("g-col"),g=ct("g-row"),_=ct("badge"),r=ct("Lista"),w=ct("ComprasFicha"),o=ct("ComprasImportacaoXML");return Q(),kt("div",ba,[e(r,{busca:a.busca,"onUpdate:busca":u[9]||(u[9]=d=>a.busca=d),onAtualizar:s.atualizar,onLimparFiltrosClick:s.limparFiltrosClick,onCriarClick:s.criarClick,lista:a.lista,tabSelecionada:a.tabSelecionada,tabs:a.tabs,tabSelecionada2:a.tabSelecionada2,tabs2:a.tabs2,paginacao:a.paginacao,mostrar:a.mostrar},{botaoNovo:l(()=>[e(ht,{label:"Novo",icon:"add",unelevated:"",color:"primary","text-color":"white",class:"hideonmobile"},{default:l(()=>[e(Qt,null,{default:l(()=>[e(xt,{link:"","no-border":"",separator:""},{default:l(()=>[gt((Q(),ot(It,{onClick:s.criarClick,clickable:""},{default:l(()=>[e(nt,{avatar:""},{default:l(()=>[e(Et,{name:"add"})]),_:1}),e(nt,null,{default:l(()=>[e(vt,null,{default:l(()=>[M("Incluir Manual")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[Tt]]),gt((Q(),ot(It,{onClick:s.importarXmlClick,clickable:""},{default:l(()=>[e(nt,{avatar:""},{default:l(()=>[e(Et,{name:"add"})]),_:1}),e(nt,null,{default:l(()=>[e(vt,null,{default:l(()=>[M("Importar XML")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[Tt]])]),_:1})]),_:1})]),_:1}),e(ht,{icon:"add",flat:"",round:"",color:"primary","text-color":"white",class:"hideondesktop"},{default:l(()=>[e(Qt,null,{default:l(()=>[e(xt,{link:"","no-border":"",separator:""},{default:l(()=>[gt((Q(),ot(It,{onClick:s.criarClick,clickable:""},{default:l(()=>[e(nt,{avatar:""},{default:l(()=>[e(Et,{name:"add"})]),_:1}),e(nt,null,{default:l(()=>[e(vt,null,{default:l(()=>[M("Incluir Manual")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[Tt]]),gt((Q(),ot(It,{onClick:s.importarXmlClick,clickable:""},{default:l(()=>[e(nt,{avatar:""},{default:l(()=>[e(Et,{name:"add"})]),_:1}),e(nt,null,{default:l(()=>[e(vt,null,{default:l(()=>[M("Importar XML")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[Tt]])]),_:1})]),_:1})]),_:1})]),filtroCampos:l(()=>[e(f,{modelValue:a.filtros.numero,"onUpdate:modelValue":u[0]||(u[0]=d=>a.filtros.numero=d),rotulo:"N\xBA Nota",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),e(f,{modelValue:a.filtros.numeroCompra,"onUpdate:modelValue":u[1]||(u[1]=d=>a.filtros.numeroCompra=d),rotulo:"Ordem de compra",dense:"",class:"q-field--with-bottom"},null,8,["modelValue"]),e(f,{modelValue:a.filtros.destinatario.nome,"onUpdate:modelValue":u[2]||(u[2]=d=>a.filtros.destinatario.nome=d),rotulo:"Destinat\xE1rio",dense:"",class:"q-field--with-bottom q-mb-md"},null,8,["modelValue"]),e(f,{modelValue:a.filtros.fornecedor.nome,"onUpdate:modelValue":u[3]||(u[3]=d=>a.filtros.fornecedor.nome=d),rotulo:"Fornecedor",dense:"",class:"q-field--with-bottom q-mb-md"},null,8,["modelValue"]),e(f,{modelValue:a.filtros.periodoEmissao.ini,"onUpdate:modelValue":u[4]||(u[4]=d=>a.filtros.periodoEmissao.ini=d),rotulo:"Data Emiss\xE3o",dense:"",tipo:"data",class:"q-mb-x"},null,8,["modelValue"]),e(f,{modelValue:a.filtros.periodoEmissao.fim,"onUpdate:modelValue":u[5]||(u[5]=d=>a.filtros.periodoEmissao.fim=d),rotulo:"at\xE9",dense:"",tipo:"data",class:"q-mb-xl"},null,8,["modelValue"]),e(f,{modelValue:a.filtros.periodoFinalizado.ini,"onUpdate:modelValue":u[6]||(u[6]=d=>a.filtros.periodoFinalizado.ini=d),rotulo:"Data Finalizado",dense:"",tipo:"data",class:"q-mb-xs"},null,8,["modelValue"]),e(f,{modelValue:a.filtros.periodoFinalizado.fim,"onUpdate:modelValue":u[7]||(u[7]=d=>a.filtros.periodoFinalizado.fim=d),rotulo:"at\xE9",dense:"",tipo:"data",class:"q-mb-xl"},null,8,["modelValue"]),e(f,{modelValue:a.paginacao.limite,"onUpdate:modelValue":u[8]||(u[8]=d=>a.paginacao.limite=d),rotulo:"Quantidade por p\xE1gina",dense:"",tipo:"quantidade",min:"1",class:"q-field--with-bottom"},null,8,["modelValue"])]),menuExtras:l(()=>[this.tabSelecionada2.valor==="Nota no SEFAZ"?gt((Q(),ot(It,{key:0,onClick:s.downloadXmlDFeFiltrados,clickable:""},{default:l(()=>[e(nt,{avatar:""},{default:l(()=>[e(Et,{name:"download"})]),_:1}),e(nt,null,{default:l(()=>[e(vt,null,{default:l(()=>[M("Download")]),_:1})]),_:1}),e(St,null,{default:l(()=>[M("Download dos XML's filtrados")]),_:1})]),_:1},8,["onClick"])),[[Tt]]):ut("",!0)]),itemLista:l(()=>[e(xt,{bordered:"",class:"bg-white q-mb-xs rounded-borders",style:{"min-height":"calc(100vh - 200px)"}},{default:l(()=>[(Q(!0),kt(Nt,null,Ut(a.lista,d=>(Q(),kt("div",{key:d.id,class:"itemHover"},[e(It,{"manual-focus":"",class:"q-py-sm q-px-xs items-center"},{default:l(()=>[e(nt,{class:"hideonmobile col-auto q-px-sm no-margin"},{default:l(()=>[ft("div",_a,[e(t,{id:d.id,numero:d.numero,cor:"positive",escuro:""},null,8,["id","numero"])])]),_:2},1024),e(nt,{class:"col-md col-lg col-xl no-margin"},{default:l(()=>[e(It,{class:"q-pa-none"},{default:l(()=>[e(nt,{onClick:h=>s.abrir(d.id),class:"col-auto items-center"},{default:l(()=>[e(c,{imagem:(a.contatos[d.idContato]||{}).imagem,rotulo:d.descricaoContato,tamanho:"40"},null,8,["imagem","rotulo"])]),_:2},1032,["onClick"]),e(nt,{class:"col"},{default:l(()=>[e(vt,{onClick:h=>s.abrir(d.id),lines:"2",class:"text-tertiary text-weight-bold ellipsis-2-lines"},{default:l(()=>[M(et(d.descricaoContato)+" ",1),e(St,{anchor:"bottom middle",self:"center middle"},{default:l(()=>[M("Fornecedor")]),_:1})]),_:2},1032,["onClick"]),e(It,{class:"q-pa-none q-mt-xs hideonmobile"},{default:l(()=>[e(g,{mg:"xs-b"},{default:l(()=>[d.descricaoDestinatario?(Q(),ot(v,{key:0,col:"shrink"},{default:l(()=>[e(b,{icon:"business xs tertiary left"},{default:l(()=>[M(et(d.descricaoDestinatario),1)]),_:2},1024)]),_:2},1024)):ut("",!0)]),_:2},1024)]),_:2},1024),e(It,{class:"q-pa-none hideonmobile",style:{"min-height":"unset"}},{default:l(()=>[d.notaNumero?(Q(),ot(_,{key:0,cor:"tertiary",class:"mw50 text-center",escuro:""},{default:l(()=>[M(et(d.notaNumero)+" ",1),e(St,{anchor:"bottom middle",self:"center middle"},{default:l(()=>[M("N\xFAmero da Nota")]),_:1})]),_:2},1024)):(Q(),ot(_,{key:1,cor:"warning",class:"mw50 text-center",escuro:""},{default:l(()=>[M(" S/N "),e(St,{anchor:"bottom middle",self:"center middle"},{default:l(()=>[M("N\xFAmero da Nota")]),_:1})]),_:1}))]),_:2},1024),e(nt,{class:"hideondesktop q-mt-sm"},{default:l(()=>[e(g,{mg:"xs-b"},{default:l(()=>[d.descricaoDestinatario?(Q(),ot(v,{key:0,col:"shrink"},{default:l(()=>[e(b,{icon:"business xs tertiary left"},{default:l(()=>[M(et(d.descricaoDestinatario),1)]),_:2},1024)]),_:2},1024)):ut("",!0)]),_:2},1024),e(g,{mg:"xs-b"},{default:l(()=>[d.dataHoraEmissao?(Q(),ot(v,{key:0,col:"shrink"},{default:l(()=>[e(b,{icon:"mdi-calendar-today xs tertiary left",tip:`Emitido \xE1s ${i.$filters.hora(d.dataHoraEmissao)}`},{default:l(()=>[M(et(i.$filters.data(d.dataHoraEmissao)),1)]),_:2},1032,["tip"])]),_:2},1024)):ut("",!0),d.dataHoraFinalizado?(Q(),ot(v,{key:1,col:"shrink",class:"q-ml-sm"},{default:l(()=>[e(b,{icon:"mdi-calendar xs tertiary left",tip:`Finalizado \xE1s ${i.$filters.hora(d.dataHoraFinalizado)}`},{default:l(()=>[M(et(i.$filters.data(d.dataHoraFinalizado)),1)]),_:2},1032,["tip"])]),_:2},1024)):ut("",!0)]),_:2},1024),e(g,{mg:"xs-b"},{default:l(()=>[e(v,{col:"shrink"},{default:l(()=>[e(t,{id:d.id,numero:d.numero,cor:"positive",escuro:""},null,8,["id","numero"])]),_:2},1024),e(v,{col:"shrink",class:"q-ml-sm"},{default:l(()=>[d.notaNumero?(Q(),ot(_,{key:0,cor:"tertiary",class:"mw50",escuro:""},{default:l(()=>[M(et(d.notaNumero)+" ",1),e(St,{anchor:"bottom middle",self:"center middle"},{default:l(()=>[M("N\xFAmero da Nota")]),_:1})]),_:2},1024)):(Q(),ot(_,{key:1,cor:"warning",class:"mw50",escuro:""},{default:l(()=>[M(" S/N "),e(St,{anchor:"bottom middle",self:"center middle"},{default:l(()=>[M("N\xFAmero da Nota")]),_:1})]),_:1}))]),_:2},1024),e(v,{col:"shrink",class:"q-ml-sm"},{default:l(()=>[e(_,{rotulo:d.status,cor:d.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:d.status!=="Digita\xE7\xE3o"},null,8,["rotulo","cor","escuro"])]),_:2},1024)]),_:2},1024),e(g,null,{default:l(()=>[e(v,{col:"shrink",text:"bold"},{default:l(()=>[M(et(i.$filters.numero(d.totalDocumento,2)),1)]),_:2},1024),gt(e(v,{col:"grow",text:"center",class:"q-ml-sm"},{default:l(()=>[M(et(d.qtdeContatos)+" Itens ",1)]),_:2},1536),[[Dt,d.qtdeContatos>0]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(nt,{onClick:h=>s.abrir(d.id),class:"hideonmobile maxw110 q-pl-sm no-margin"},{default:l(()=>[d.dataHoraEmissao?(Q(),ot(vt,{key:0,lines:"1",color:"tertiary",class:"ellipsis"},{default:l(()=>[e(Et,{name:"mdi-calendar-today"}),M(" "+et(i.$filters.data(d.dataHoraEmissao))+" ",1),e(St,{anchor:"bottom middle",self:"center middle"},{default:l(()=>[M(" Emitido \xE1s "+et(i.$filters.hora(d.dataHoraEmissao)),1)]),_:2},1024)]),_:2},1024)):ut("",!0),d.dataHoraFinalizado?(Q(),ot(vt,{key:1,lines:"1",color:"tertiary",class:"ellipsis"},{default:l(()=>[e(Et,{name:"mdi-calendar"}),M(" "+et(i.$filters.data(d.dataHoraFinalizado))+" ",1),e(St,{anchor:"bottom middle",self:"center middle"},{default:l(()=>[M(" Finalizado \xE1s "+et(i.$filters.hora(d.dataHoraFinalizado)),1)]),_:2},1024)]),_:2},1024)):ut("",!0)]),_:2},1032,["onClick"]),e(nt,{onClick:h=>s.abrir(d.id),class:"hideonmobile maxw90 q-pl-sm no-margin"},{default:l(()=>[e(_,{cor:d.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:d.status!=="Digita\xE7\xE3o",class:"col-auto q-mx-auto"},{default:l(()=>[M(et(d.status)+" ",1),e(St,{anchor:"bottom middle",self:"center middle"},{default:l(()=>[M(" Status ")]),_:1})]),_:2},1032,["cor","escuro"])]),_:2},1032,["onClick"]),e(nt,{onClick:h=>s.abrir(d.id),class:"hideonmobile maxw120 q-pl-sm no-margin"},{default:l(()=>[e(vt,{class:"text-tertiary text-weight-bold text-right"},{default:l(()=>[M(et(i.$filters.numero(d.totalDocumento,2)),1)]),_:2},1024),gt(e(vt,{class:"text-tertiary text-right"},{default:l(()=>[M(et(d.qtdeContatos)+" Itens ",1)]),_:2},1536),[[Dt,d.qtdeContatos>0]])]),_:2},1032,["onClick"]),e(nt,{class:"hideonmobile col-auto q-pl-sm no-margin"},{default:l(()=>[e(It,{class:"q-pa-none"},{default:l(()=>[a.tabSelecionada2.valor!=="Nota no SEFAZ"?(Q(),ot(nt,{key:0,class:"q-pr-sm no-margin"},{default:l(()=>[e(ht,{onClick:h=>s.abrir(d.id),icon:"edit",size:"md",color:"primary",round:"",flat:"",dense:""},null,8,["onClick"])]),_:2},1024)):ut("",!0),a.tabSelecionada2.valor==="Nota no SEFAZ"&&d.status==="N\xE3o Importada"?(Q(),ot(nt,{key:1,class:"q-pr-sm no-margin"},{default:l(()=>[e(ht,{onClick:h=>s.importarXmlDFe(d.id),flat:"",round:"",dense:"",icon:"mdi-upload",size:"md",color:"tertiary",class:"buttons"},{default:l(()=>[e(St,{anchor:"bottom middle",self:"center middle"},{default:l(()=>[M("Importar XML")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):ut("",!0),a.tabSelecionada2.valor==="Nota no SEFAZ"?(Q(),ot(nt,{key:2,class:"q-pr-sm no-margin"},{default:l(()=>[e(ht,{onClick:h=>s.downloadXmlDFe(d.id),flat:"",round:"",dense:"",icon:"mdi-download",color:"tertiary",size:"md",class:"buttons"},{default:l(()=>[e(St,{anchor:"bottom middle",self:"center middle"},{default:l(()=>[M("Download XML")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):ut("",!0)]),_:2},1024)]),_:2},1024),e(nt,{class:"hideondesktop col-auto q-pl-sm no-margin"},{default:l(()=>[e(ht,{icon:"more_vert",size:"md",color:"tertiary",round:"",flat:"",dense:""},{default:l(()=>[e(Qt,null,{default:l(()=>[gt((Q(),ot(xt,{link:"","no-border":"",separator:""},{default:l(()=>[a.tabSelecionada2.valor!=="Nota no SEFAZ"?(Q(),ot(It,{key:0,onClick:h=>s.abrir(d.id),clickable:"",class:"itemHover"},{default:l(()=>[e(nt,{avatar:""},{default:l(()=>[e(Et,{name:"edit"})]),_:1}),e(nt,null,{default:l(()=>[e(vt,null,{default:l(()=>[M(" Editar ")]),_:1})]),_:1})]),_:2},1032,["onClick"])):ut("",!0),a.tabSelecionada2.valor==="Nota no SEFAZ"&&d.status==="N\xE3o Importada"?(Q(),ot(It,{key:1,onClick:h=>s.importarXmlDFe(d.id),clickable:"",class:"itemHover"},{default:l(()=>[e(nt,{avatar:""},{default:l(()=>[e(Et,{name:"mdi-upload"})]),_:1}),e(nt,null,{default:l(()=>[e(vt,null,{default:l(()=>[M(" Importar XML ")]),_:1})]),_:1})]),_:2},1032,["onClick"])):ut("",!0),a.tabSelecionada2.valor==="Nota no SEFAZ"?(Q(),ot(It,{key:2,onClick:h=>s.downloadXmlDFe(d.id),clickable:"",class:"itemHover"},{default:l(()=>[e(nt,{avatar:""},{default:l(()=>[e(Et,{name:"mdi-download"})]),_:1}),e(nt,null,{default:l(()=>[e(vt,null,{default:l(()=>[M(" Download XML ")]),_:1})]),_:1})]),_:2},1032,["onClick"])):ut("",!0)]),_:2},1024)),[[Tt]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(ne)]))),128))]),_:1})]),_:1},8,["busca","onAtualizar","onLimparFiltrosClick","onCriarClick","lista","tabSelecionada","tabs","tabSelecionada2","tabs2","paginacao","mostrar"]),e(w,{ref:"comprasFicha",onAtualizar:s.atualizar},null,8,["onAtualizar"]),e(o,{ref:"comprasImportacaoXML",onAtualizar:s.atualizar,onConcluirImportacao:s.concluirImportacao},null,8,["onAtualizar","onConcluirImportacao"]),e(ae,{modelValue:a.modalXMLNotaEntrada,"onUpdate:modelValue":u[13]||(u[13]=d=>a.modalXMLNotaEntrada=d),persistent:""},{default:l(()=>[e(Yt,{container:"",class:"bg-light",style:{height:"40vh",width:"50vw","max-width":"100vw"}},{default:l(()=>[ft("form",{onSubmit:u[12]||(u[12]=xe((...d)=>s.importarXmlNotaDeEntrada&&s.importarXmlNotaDeEntrada(...d),["prevent"]))},[e(Jt,null,{default:l(()=>[e(Rt,null,{default:l(()=>[gt(e(ht,{onClick:s.fecharXmlNotaDeEntrada,flat:"",round:"",dense:"",icon:"close"},null,8,["onClick"]),[[Tt]]),e(Lt,null,{default:l(()=>[M("Importar XML Nota de Entrada")]),_:1}),e(ht,{color:"white","text-color":"primary",label:"Enviar",type:"submit",unelevated:""})]),_:1})]),_:1}),e(te,{class:"u-container"},{default:l(()=>[e(ee,{style:{"min-height":"300px"}},{default:l(()=>{var d,h,I;return[ft("div",wa,[e(Pe,{class:"col-12","hide-upload-btn":"","auto-upload":"",factory:s.adicionarXml,filter:E=>E.filter(V=>V.type==="text/xml")},null,8,["factory","filter"]),e(he,{modelValue:a.xmlDevolucao,"onUpdate:modelValue":u[10]||(u[10]=E=>a.xmlDevolucao=E),label:"Devolu\xE7\xE3o"},null,8,["modelValue"]),e(he,{modelValue:a.xmlEstrangeiro,"onUpdate:modelValue":u[11]||(u[11]=E=>a.xmlEstrangeiro=E),label:"Importa\xE7\xE3o do exterior"},null,8,["modelValue"])]),Object.keys((I=(h=(d=a.xmlNotaEntrada.error)==null?void 0:d.data)==null?void 0:h.fields)!=null?I:{}).length?(Q(),kt("div",ya,[ft("ul",Ia,[(Q(!0),kt(Nt,null,Ut(Object.keys(a.xmlNotaEntrada.error.data.fields),E=>(Q(),kt("li",{key:E},[ft("span",null,et(E),1),ft("span",null,et(a.xmlNotaEntrada.error.data.fields[E]),1)]))),128))])])):ut("",!0)]}),_:1})]),_:1})],32)]),_:1})]),_:1},8,["modelValue"])])}var xa=Kt(va,[["render",ka]]);export{xa as default};
