import{_ as k,Y as S,cG as j,r as u,o as l,p as D,f as r,w as i,h as $,i as y,k as m,t as B,d,Q as f,m as x,e as h,bf as V,H as I,S as N,T as b,j as Q,N as T,G as P,J as R,C as q,dT as J,I as O}from"./index.dc6d0659.js";import{M as U}from"./MenuAbas.470b2d7c.js";import{J as A}from"./JsonViewer.3af816bc.js";const z={components:{Avatar:S,MenuAbas:U,Tutorial:j,JsonViewer:A},data(){return{contato:{},permissoes:{},sistemaPai:""}},methods:{async atualizar(){try{await this.obterContatoUsuario()}catch(e){$q.notifyError("N\xE3o foi poss\xEDvel carregar os dados do cockpit",e)}},async criarObjStoreIDB(){if(!("indexedDB"in window)){console.log("Navegador sem suporte ao IndexedDB");return}let e=indexedDB.open("cockpit",1);return e.onupgradeneeded=function(t){var o=t.target.result;o.createObjectStore("consultasRecentes",{keyPath:"id"}).createIndex("id","id",{unique:!0})},new Promise((t,o)=>{e.onsuccess=function(a){t()},e.onerror=function(a){t()}})},salvarObjIDb(e){if(!("indexedDB"in window))return;let t,o,a;return t=new Promise((s,n)=>{a=s}),o=indexedDB.open("cockpit",1),o.onsuccess=function(){o=o.result.transaction(["consultasRecentes"],"readwrite").objectStore("consultasRecentes").put(e),o.onsuccess=function(c){a()},o.onerror=function(c){a()}},t},obterObjIDb(e){if(!("indexedDB"in window))return;let t,o,a;return t=new Promise((s,n)=>{a=s}),o=indexedDB.open("cockpit",1),o.onsuccess=function(){o=o.result.transaction(["consultasRecentes"],"readwrite").objectStore("consultasRecentes").get(e),o.onsuccess=function(c){a(c.target.result)},o.onerror=function(c){a()}},t},async obterContatoUsuario(){const e=JSON.parse(localStorage.getItem("usuario"))||{},t=this.$route.params.id,o=e.numeroDocumentoNacional;let a={};if(o){if(t&&(a=await $erp().contato.get(t)||{},(!a.ativo||a.excluido||a.numeroDocumentoNacional!==o)&&(a={})),!a.id){let s;s=await $erp().contato.where({numeroDocumentoNacional:o}).toArray(),a=s.find(n=>n.ativo&&!n.excluido&&n.codigoUsuario)||{}}this.selecionarContato(a)}if(!a.id){this.$q.notifyError("Usu\xE1rio logado n\xE3o encontrado. Selecione um vendedor para continuar.");const s=await $g.promptContato.show({filtro:{ativo:!0,vendedores:!0},placeholder:"Selecione o usu\xE1rio"});if(!s){const n=localStorage.getItem("contatoSelecionado");this.$router.push({name:"Atendimento",params:{id:n||"0"}}),this.$q.notifyError("Selecione um vendedor para acessar o cockpit.");return}$lodash.get(s,"id")&&this.selecionarContato(s)}},async btBuscar_click(){const e=await $g.promptContato.show({filtro:{ativo:!0,vendedores:!0},placeholder:"Selecione o usu\xE1rio"});$lodash.get(e,"id")&&this.selecionarContato(e)},selecionarContato(e){e.id&&(this.contato={id:e.id,nome:e.nome||"",apelido:e.apelido||"",imagem:e.imagem||""},this.$router.push({name:this.$route.name==="Cockpit"?"CockpitVendedor":this.$route.name,params:{id:e.id||""}}),this.salvarConsultaRecente())},async salvarConsultaRecente(){await this.criarObjStoreIDB();let e,t;e=JSON.parse(localStorage.getItem("clienteSistema"))||{},t=e.codigoClienteSistema,this.salvarObjIDb({id:t,idContato:this.contato.id})},async mostrarJsonViewer(){await this.$refs.jsonViewer.show(this)}},updated(){this.$route.path==="/cockpit"&&this.atualizar()},mounted(){this.permissoes={obterUsuario:!1,envelope:!1,vendas:!1,faturas:!1},$db.permissao.objeto("Diretiva_Cockpit_MudarUsuario").then(e=>{this.permissoes.obterUsuario=e}),$db.permissao.objeto("cockpit/envelope").then(e=>{this.permissoes.envelope=e}),$db.permissao.objeto("cockpit/vendas").then(e=>{this.permissoes.vendas=e}),$db.permissao.objeto("cockpit/faturas").then(e=>{this.permissoes.faturas=e}),this.sistemaPai=$utils.sistemaPai(),this.atualizar()}},M={id:"CockpitLayout"},E={class:"u-container"};function L(e,t,o,a,s,n){const c=u("barraTopo"),v=u("Avatar"),_=u("Tutorial"),w=u("RouterView"),g=u("MenuAbas"),C=u("JsonViewer");return l(),D("div",M,[r(P,{class:"bg-gradiente text-white"},{default:i(()=>[r(c),r($,{class:"u-container q-px-sm"},{default:i(()=>[r(v,{imagem:s.contato.imagem,rotulo:s.contato.apelido,tamanho:"40"},null,8,["imagem","rotulo"]),r(y,null,{default:i(()=>[m(B(s.contato.nome),1)]),_:1}),s.permissoes.obterUsuario?(l(),d(f,{key:0,onClick:n.btBuscar_click,icon:"search",size:"md",flat:"",dense:"",round:""},{default:i(()=>[r(x,{anchor:"bottom middle",self:"center middle"},{default:i(()=>t[1]||(t[1]=[m("Buscar vendedor/empresa")])),_:1})]),_:1},8,["onClick"])):h("",!0),r(_,{componente:"CockpitLayout"}),e.$db.usuario.desenvolvedor()?(l(),d(f,{key:1,icon:"more_vert",size:"md",round:"",flat:"",dense:""},{default:i(()=>[r(V,null,{default:i(()=>[I((l(),d(N,{onClick:t[0]||(t[0]=p=>n.mostrarJsonViewer()),clickable:""},{default:i(()=>[r(b,{avatar:""},{default:i(()=>[r(Q,{name:"mdi-file-replace",size:"sm"})]),_:1}),r(b,null,{default:i(()=>t[2]||(t[2]=[m("Ver Objeto")])),_:1})]),_:1})),[[T]])]),_:1})]),_:1})):h("",!0)]),_:1})]),_:1}),r(O,null,{default:i(()=>[r(R,null,{default:i(()=>[r(g,{objetoPai:"cockpit"},{default:i(()=>[q("div",E,[r(w,null,{default:i(({Component:p})=>[(l(),d(J(p),{usuario:s.contato},null,8,["usuario"]))]),_:1})])]),_:1})]),_:1})]),_:1}),r(C,{ref:"jsonViewer"},null,512)])}var F=k(z,[["render",L]]);export{F as default};
