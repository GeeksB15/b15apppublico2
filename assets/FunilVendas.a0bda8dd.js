import{_ as Q,bd as q,r as v,o as g,d as w,w as s,C as c,f as t,h as y,i as F,k as b,H as A,Q as D,N as H,av as P,D as $,a0 as j,p as C,j as f,G as z,J as T,F as G,u as J,t as h,e as V,z as K,v as X,m as U,O as x,l as W,bg as Y,P as Z,S as I,T as S,U as O,I as M,M as oo,au as k,b2 as eo}from"./index.b5bd9116.js";import{C as to}from"./Campo.88fcd4e3.js";import{M as ao}from"./ModalHistoricoStatus.d70be491.js";import{d as so}from"./vuedraggable.umd.b13715a8.js";const lo={components:{Campo:to},data(){return{confirmado:!1}},emits:["cancelar","confirmar","update:modelValue"],methods:{eventoConfirmar(){q.log("CRMTrocarStatus","eventoConfirmar",this.dados),this.confirmado=!0,this.eventoInput(!1),this.$emit("confirmar",this.dados)},eventoCancelar(){q.log("CRMTrocarStatus","eventoCancelar",this.dados),this.confirmado=!1,this.eventoInput(!1)},eventoInput(a){this.$emit("update:modelValue",a)}},props:{modelValue:{required:!0,type:Boolean},dados:{required:!0,type:Object}},watch:{modelValue(a){a?this.confirmado=!1:this.confirmado||this.$emit("cancelar",this.dados)}}},io={container:"",class:"bg-white"};function ro(a,e,l,r,o,n){const i=v("campo"),p=v("row");return g(),w($,{"model-value":l.modelValue,"onUpdate:modelValue":n.eventoInput},{default:s(()=>[c("div",io,[t(y,{class:"bg-primary text-white"},{default:s(()=>[t(F,null,{default:s(()=>[b("Trocar status")]),_:1}),A(t(D,{flat:"",round:"",dense:"",icon:"close"},null,512),[[H]])]),_:1}),c("form",{onSubmit:e[4]||(e[4]=P((...m)=>n.eventoConfirmar&&n.eventoConfirmar(...m),["prevent"])),class:"q-pa-md"},[t(p,{class:"q-col-gutter-sm"},{default:s(()=>[t(i,{modelValue:l.dados.nomeCliente,"onUpdate:modelValue":e[0]||(e[0]=m=>l.dados.nomeCliente=m),somenteLeitura:"",class:"col-12",rotulo:"Cliente"},null,8,["modelValue"]),t(i,{modelValue:l.dados.statusAtual,"onUpdate:modelValue":e[1]||(e[1]=m=>l.dados.statusAtual=m),somenteLeitura:"",class:"col-12",rotulo:"De"},null,8,["modelValue"]),t(i,{modelValue:l.dados.statusNovo,"onUpdate:modelValue":e[2]||(e[2]=m=>l.dados.statusNovo=m),somenteLeitura:"",class:"col-12",rotulo:"Para"},null,8,["modelValue"]),t(i,{modelValue:l.dados.observacao,"onUpdate:modelValue":e[3]||(e[3]=m=>l.dados.observacao=m),modelModifiers:{trim:!0},class:"col-12",maxlength:"50",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue"])]),_:1}),t(y,{color:"light"},{default:s(()=>[t(F),t(D,{flat:"",color:"tertiary",onClick:n.eventoCancelar,label:"Cancelar"},null,8,["onClick"]),t(D,{unelevated:"",color:"primary",type:"submit",label:"Trocar"})]),_:1})],32)])]),_:1},8,["model-value","onUpdate:modelValue"])}var no=Q(lo,[["render",ro]]);const E={Or\u00E7amento:[],Conclu\u00EDdo:[]},co={components:{Badge:j,CrmTrocarStatus:no,ModalHistoricoStatus:ao,draggable:so},data(){return{showfilters:!1,empresaOpcoes:[],empresaSelecionada:null,entregueInicio:new Date(new Date($utils.dataAtual()).toDateString()),entregueFim:new Date(new Date($utils.dataAtual()).toDateString()),fraseFiltro:"",listas:$utils.clonarV2(E),tamanhoLista:{},listasFiltradas:$utils.clonarV2(E),total:{},trocarStatusDados:{},trocarStatusModal:!1,periodoOpcoes:[{label:"Hoje",value:0},{label:"Uma semana",value:7},{label:"Um m\xEAs",value:30}],prazoSelecionado:null,prazoOpcoes:[{label:"Em dia",value:"bordaVerdeCRM"},{label:"Entrega para esta semana",value:"bordaAmarelaCRM"},{label:"Entrega atrasada",value:"bordaVermelhaCRM"}],vendedorDigitadorSelecionado:null,vendedoresDigitadoresOpcoes:[],diretivaContatosAcessaTodosContatos:!1}},methods:{async eventoEnd(){for(const a in this.listasFiltradas)for(const e of this.listasFiltradas[a])if(e.crmFunilStatus!==a){$utils.gconsole.log("FunilVendas","eventoEnd De:",e.crmFunilStatus,"Para:",a,"codigo:",e.codigoDocumento),this.trocarStatusDados={codigoContatoResponsavel:e.codigoContatoResponsavel,codigoDocumento:e.codigoDocumento,codigoUsuario:null,nomeCliente:e.nomeCliente,observacao:"",statusAtual:e.crmFunilStatus,statusNovo:a},this.trocarStatusModal=!0;return}},async eventoConfirmarTroca(a){$utils.gconsole.log("FunilVendas","eventoConfirmaTroca",{...a}),this.$q.loading.show();try{let e;$db.usuario.logado.cpf&&(e=(await $db.contato.ler({filtros:{termoBusca:$db.usuario.logado.cpf}})).data.find(r=>{var o;return r.numeroDocumentoNacional.replace(/\D/g,"")===((o=$db.usuario.logado.cpf)==null?void 0:o.replace(/\D/g,""))})),a.cpfUsuario=e==null?void 0:e.numeroDocumentoNacional,await $db.crm.trocaStatusOnline(a),this.$q.notifyPositive("Status trocado com sucesso"),this.atualiza()}catch(e){this.$q.notifyError("Erro na troca de status",e)}finally{this.$q.loading.hide()}},eventoCancelarTroca(a){$utils.gconsole.log("FunilVendas","eventoCancelarTroca",a),this.atualiza()},async empresaOpcoesCarregar(){const a=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.empresaOpcoes=a.map(e=>({label:e.nome,value:e.codigoContato,id:e.id}))},async irParaAtendimento(a){const e=await $erp().contato.where({codigoContato:a}).first()||{};e.id&&this.$router.push({name:"Atendimento",params:{id:e.id}})},filtraDebounce(){$lodash.debounce(this.refazFiltro,700)()},refazFiltro(){$utils.gconsole.log("FunilVendas","refazFiltro()",this.fraseFiltro,this.empresaSelecionada);const a=$utils.removerAcentos((this.fraseFiltro||"").toUpperCase()).split(" ").filter(r=>r!==""),e={};for(const r in this.listas)for(const o of this.listas[r]){const n=$utils.removerAcentos((o.id||"").toUpperCase()+(o.nomeCliente||"").toUpperCase()+(o.nomeDigitador||"").toUpperCase()+(o.nomeVendedor||"").toUpperCase()+" "+String(o.numeroVenda||"")+" ");let i=!0;for(const p of a)isNaN(Number(p))?i=i&&n.includes(p):i=i&&n.includes(" "+p+" ");this.empresaSelecionada&&(i=i&&this.empresaSelecionada.value===o.codigoEmpresa),this.vendedorDigitadorSelecionado&&(i=i&&(this.vendedorDigitadorSelecionado.value===o.codigoContatoDigitador||this.vendedorDigitadorSelecionado.value===o.codigoContatoVendedor)),o.mostra=i,o.mostra&&(e[o.crmFunilStatus]=(e[o.crmFunilStatus]||0)+(o.totalDocumento||0))}const l={};for(const r in this.listas)this.tamanhoLista[r]=10,l[r]=this.listas[r].filter(o=>o.mostra).slice(0,this.tamanhoLista[r]),document.getElementById(r);this.listasFiltradas=l,this.$nextTick(()=>{for(const r in this.listasFiltradas)document.getElementById(r).removeEventListener("scroll",this.scrollHandler),document.getElementById(r).addEventListener("scroll",this.scrollHandler)}),this.total=e},scrollHandler(a){const e=a.target.id;a.target.scrollHeight-a.target.scrollTop-a.target.offsetHeight<100&&(this.tamanhoLista[e]+=10,this.listasFiltradas[e]=this.listas[e].filter(r=>r.mostra).slice(0,this.tamanhoLista[e]))},async atualiza(){try{const a=await $db.crm.leOnline({entregueInicio:this.entregueInicio,entregueFim:this.entregueFim,...this.diretivaContatosAcessaTodosContatos?{}:{codigoContato:$db.usuario.logado.codigoContato}});$utils.gconsole.log("FunilVendas","atualiza()",a.length),$utils.verificarAlerta(!a||!a.length,"N\xE3o h\xE1 or\xE7amentos");let e=await $db.configuracoes.le({nome:"vendas.crm.status"});e=e.filter(o=>!["Or\xE7amento","Conclu\xEDdo"].includes(o.texto));const l={Or\u00E7amento:[]};for(const o of $lodash.orderBy(e,"valor","asc").map(n=>n.texto))l[o]=[];l.Conclu\u00EDdo=[];const r={};for(const o of a){let n="bordaVerdeCRM";const i={id:o.id,codigoContatoDigitador:o.codigoContatoDigitador||0,codigoContatoVendedor:o.codigoContatoVendedor||0,codigoDocumento:o.codigoDocumento||0,codigoContato:o.codigoContato||0,codigoEmpresa:o.codigoEmpresa||0,descricaoEmpresa:o.descricaoEmpresa||"",corBorda:n,dataHoraEmissao:new Date(o.dataHoraEmissao||""),mostra:!0,nomeCliente:o.nomeCliente||"-",nomeVendedor:o.nomeVendedor||"-",nomeDigitador:o.nomeDigitador||"-",numeroVenda:o.numeroVenda||"-",status:o.status||"",crmFunilStatus:o.crmFunilStatus||"Or\xE7amento",totalDocumento:o.totalDocumento||0};l[i.crmFunilStatus]&&(l[i.crmFunilStatus].push(i),r[i.crmFunilStatus]=(r[i.crmFunilStatus]||0)+(i.totalDocumento||0))}this.listas=l,this.total=r,this.refazFiltro()}catch(a){this.$q.notifyError("Erro na consulta online de or\xE7amentos",a)}}},watch:{entregueInicio(){$utils.gconsole.log("FunilVendas","entregueInicio"),this.atualiza()},entregueFim(){$utils.gconsole.log("FunilVendas","entregueFim"),this.atualiza()}},created(){$utils.gconsole.log("FunilVendas","created()"),$db.permissao.objeto("Diretiva_RelatorioVenda_VerTodos").then(a=>{this.diretivaContatosAcessaTodosContatos=a,this.diretivaContatosAcessaTodosContatos&&(this.vendedoresDigitadoresOpcoes=[],$db.crm.leOnlineVendedoresDigitadores({entregueInicio:this.entregueInicio,entregueFim:this.entregueFim}).then(e=>{e.forEach(l=>{l.codigo&&this.vendedoresDigitadoresOpcoes.push({label:l.nome,value:l.codigo})})})),this.empresaOpcoesCarregar(),this.atualiza()})},beforeUnmount(){for(const a in E)!document.getElementById(a)||document.getElementById(a).removeEventListener("scroll",this.scrollHandler)}},uo={id:"FunilVendas"},mo={class:"row overflowXCRM"},go={class:"q-pa-none"},po={class:"float-left"},fo={key:0,class:"float-right text-body1"},ho={key:0,class:"row"},vo={class:"col-12 q-pl-none"},Co={class:"row q-mt-xs"},bo=c("div",{class:"col-6"},null,-1),_o={class:"col-6 justify-end q-pr-xs",style:{display:"flex"}},Vo={class:"text-subtitle1"},yo={class:"col-11"},Fo={style:{background:"rgb(236,239,241)","border-radius":"50px","text-align":"center",display:"inline-block",width:"22px",height:"22px","line-height":"22px","margin-right":"3px"}},Do={class:"text-caption",style:{display:"inline-block","margin-right":"6px"}},So={style:{background:"rgb(236,239,241)","border-radius":"50px","text-align":"center",display:"inline-block",width:"22px",height:"22px","line-height":"22px","margin-right":"3px"}},wo={class:"text-caption",style:{display:"inline-block","margin-right":"6px"}},xo={key:0,style:{background:"rgb(236,239,241)","border-radius":"50px","text-align":"center",display:"inline-block",width:"22px",height:"22px","line-height":"22px","margin-right":"3px"}},ko={key:1,class:"text-caption",style:{display:"inline-block"}},Eo={class:"col-1 self-end"};function qo(a,e,l,r,o,n){const i=v("barraTopo"),p=v("campo"),m=v("badge"),B=v("draggable"),L=v("crm-trocar-status"),N=v("modal-historico-status");return g(),C("div",uo,[t(z,{elevated:"",class:"bg-gradiente text-white"},{default:s(()=>[t(i),t(y,{class:"q-px-sm"},{default:s(()=>[t(f,{name:"view_week",size:"sm"}),t(F,null,{default:s(()=>[b("Funil de Vendas")]),_:1}),t(D,{onClick:e[0]||(e[0]=u=>o.showfilters=!o.showfilters),icon:"mdi-filter",round:"",dense:"",flat:""})]),_:1})]),_:1}),t(M,null,{default:s(()=>[t(T,null,{default:s(()=>[c("div",mo,[(g(!0),C(G,null,J(o.listasFiltradas,(u,_)=>(g(),C("div",{key:_,class:"no-shadow q-pa-none col coluna"},[c("div",go,[t(y,{class:"no-shadow q-py-none q-px-sm text-white"},{default:s(()=>[t(F,{class:"q-py-none"},{default:s(()=>[c("div",po,h(_),1),o.total[_]?(g(),C("div",fo,h(a.$filters.numero(o.total[_],2)),1)):V("",!0)]),_:2},1024)]),_:2},1024),_==="Conclu\xEDdo"?(g(),C("div",ho,[c("div",vo,[t(p,{modelValue:o.entregueInicio,"onUpdate:modelValue":e[1]||(e[1]=d=>o.entregueInicio=d),class:"q-mx-sm",rotulo:"In\xEDcio",tipo:"data"},null,8,["modelValue"]),t(p,{modelValue:o.entregueFim,"onUpdate:modelValue":e[2]||(e[2]=d=>o.entregueFim=d),class:"q-mx-sm",rotulo:"Fim",tipo:"data"},null,8,["modelValue"])])])):V("",!0),t(B,{class:"dragAreaCRM",delay:"250",list:u,group:"osGroup",draggable:".extratoCRM",onEnd:n.eventoEnd,itemKey:"codigoDocumento",id:_},{item:s(({element:d})=>[d.mostra&&(o.prazoSelecionado===null||o.prazoSelecionado.value===d.corBorda)?(g(),w(K,{key:0,class:X(["q-pa-sm q-pb-md q-my-sm q-mb-md shadow-1 bg-white extratoCRM",d.corBorda])},{default:s(()=>[c("div",Co,[bo,c("div",_o,[t(m,{cor:"grey-1",class:"q-mx-sm",icone:"shopping_cart",rotulo:a.$filters.numero(d.totalDocumento,2)},{default:s(()=>[t(U,null,{default:s(()=>[b(" Total: "+h(a.$filters.numero(d.totalDocumento,2)),1)]),_:2},1024)]),_:2},1032,["rotulo"]),t(m,{cor:"grey-8",escuro:"",icone:"assignment_turned_in",rotulo:d.numeroVenda},{default:s(()=>[t(U,null,{default:s(()=>[b(" Vendas: "+h(a.$filters.numero(d.numeroVenda,2)),1)]),_:2},1024)]),_:2},1032,["rotulo"])])]),t(x,{class:"q-pa-xs"},{default:s(()=>[c("div",Vo,h(d.nomeCliente),1)]),_:2},1024),t(x,{class:"row q-py-none"}),t(W,{class:"q-my-sm"}),t(x,{class:"row q-pa-none"},{default:s(()=>[c("div",yo,[c("div",Fo,[t(f,{name:"person",color:"grey-7",size:"14px"})]),c("div",Do,h(d.nomeVendedor),1),c("div",So,[t(f,{name:"business",color:"grey-7",size:"14px"})]),c("div",wo,h(d.descricaoEmpresa),1),d.dataHoraEmissao?(g(),C("div",xo,[t(f,{name:"calendar_today",color:"grey-7",size:"14px"})])):V("",!0),d.dataHoraEmissao?(g(),C("div",ko,h(a.$filters.data(d.dataHoraEmissao)),1)):V("",!0)]),c("div",Eo,[t(f,{name:"more_vert",onMouseOver:"this.style.color='black'",onMouseOut:"this.style.color='grey'",style:{color:"grey",float:"right","text-align":"right","font-size":"1.2rem",cursor:"pointer"}},{default:s(()=>[t(Y,null,{default:s(()=>[A((g(),w(Z,{link:"",separator:""},{default:s(()=>[t(I,{onClick:R=>a.$refs.modalHistoricoStatus.mostrar({idDocumento:d.codigoDocumento}),clickable:""},{default:s(()=>[t(S,{avatar:""},{default:s(()=>[t(f,{name:"history"})]),_:1}),t(S,null,{default:s(()=>[t(O,null,{default:s(()=>[b("Hist\xF3rico do Status")]),_:1})]),_:1})]),_:2},1032,["onClick"]),t(I,{clickable:"",onClick:R=>n.irParaAtendimento(d.codigoContato)},{default:s(()=>[t(S,{avatar:""},{default:s(()=>[t(f,{name:"launch"})]),_:1}),t(S,null,{default:s(()=>[t(O,null,{default:s(()=>[b("Ir para o Atendimento")]),_:1})]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[H]])]),_:2},1024)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["class"])):V("",!0)]),_:2},1032,["list","onEnd","id"])])]))),128))])]),_:1})]),_:1}),t(eo,{modelValue:o.showfilters,"onUpdate:modelValue":e[8]||(e[8]=u=>o.showfilters=u),bordered:"",side:"right",class:"hide-scrollbar"},{default:s(()=>[t(oo,{view:"hHh lpR lFr"},{default:s(()=>[t(z,{class:"bg-white"},{default:s(()=>[t(y,{class:"text-tertiary border-bottom"},{default:s(()=>[t(f,{class:"text-h5",name:"mdi-filter"}),t(F,null,{default:s(()=>[b("Filtro Avan\xE7ado")]),_:1}),t(D,{dense:"",flat:"",icon:"close",round:"",onClick:e[3]||(e[3]=u=>o.showfilters=!o.showfilters)})]),_:1})]),_:1}),t(M,null,{default:s(()=>[t(T,{class:"q-pa-md"},{default:s(()=>[t(p,{modelValue:o.fraseFiltro,"onUpdate:modelValue":[e[4]||(e[4]=u=>o.fraseFiltro=u),n.filtraDebounce],dense:"",rotulo:"Por cliente ou respons\xE1vel"},null,8,["modelValue","onUpdate:modelValue"]),o.diretivaContatosAcessaTodosContatos?(g(),w(k,{key:0,modelValue:o.vendedorDigitadorSelecionado,"onUpdate:modelValue":[e[5]||(e[5]=u=>o.vendedorDigitadorSelecionado=u),n.refazFiltro],options:o.vendedoresDigitadoresOpcoes,clearable:"",label:"Vendedor / Digitador"},null,8,["modelValue","onUpdate:modelValue","options"])):V("",!0),t(k,{modelValue:o.prazoSelecionado,"onUpdate:modelValue":e[6]||(e[6]=u=>o.prazoSelecionado=u),options:o.prazoOpcoes,clearable:"",label:"Por prazo"},null,8,["modelValue","options"]),t(k,{modelValue:o.empresaSelecionada,"onUpdate:modelValue":[e[7]||(e[7]=u=>o.empresaSelecionada=u),n.refazFiltro],options:o.empresaOpcoes,clearable:"",label:"Por empresa"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(L,{modelValue:o.trocarStatusModal,"onUpdate:modelValue":e[9]||(e[9]=u=>o.trocarStatusModal=u),dados:o.trocarStatusDados,onConfirmar:n.eventoConfirmarTroca,onCancelar:n.eventoCancelarTroca},null,8,["modelValue","dados","onConfirmar","onCancelar"]),t(N,{ref:"modalHistoricoStatus"},null,512)])}var Oo=Q(co,[["render",qo]]);export{Oo as default};
