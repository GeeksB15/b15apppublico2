import{_ as ne,a3 as Ce,r as gt,o as $,d as Y,w as n,f as t,M as Ht,G as Zt,h as Nt,i as Rt,k as A,t as tt,m as Vt,e as it,H as vt,Q as ut,N as Dt,I as Xt,J as Wt,p as _t,a_ as ke,a$ as le,b4 as Se,b5 as de,W as Mt,b6 as fe,d4 as pe,d5 as Ut,K as Yt,aU as re,D as $t,bh as ve,ar as zt,au as Ee,b3 as xt,s as ie,be as Lt,P as Pt,S as mt,T as K,j as ct,U as dt,A as De,F as St,u as Tt,C as ft,l as ue,aO as he,E as oe,bq as be,e0 as Ve,c as ee,bG as ae,e1 as Pe,as as xe,at as Fe,d6 as ze,aN as ge,z as Ne,O as Te}from"./index.b0eb417d.js";import{L as Ae}from"./Lista.1d333185.js";import{S as qe}from"./SeletorCfop.1c4187ab.js";import{C as Oe}from"./Campo.3bb9013d.js";import"./xlsx.381bf6be.js";const Be={components:{SeletorNcm:Ce,SeletorCfop:qe,Campo:Oe},data(){return{abaSelecionada:"tab1",historicoItem:[],tabelaHistoricoItem:{colunas:[{name:"fornecedor",label:"Fornecedor",align:"left"},{name:"dataCompra",label:"Data Compra",align:"right"},{name:"quantidade",label:"Quantidade",align:"right"},{name:"valorCusto",label:"Valor de Custo",align:"right"},{name:"valorTotal",label:"Valor Total (Custo)",align:"right"}],paginacao:{page:1,rowsPerPage:5}},estoqueItem:[],tabelaEstoqueItem:{colunas:[{name:"empresa",label:"Empresa",align:"left"},{name:"tipoEstoque",label:"Tipo estoque",align:"right"},{name:"lote",label:"Lote",align:"right"},{name:"quantidade",label:"Quantidade",align:"right"}],paginacao:{page:1,rowsPerPage:5}},compra:{},cfop:null,cstIcms:"",cstIpi:"",contaEstoque:[],impostoCstIpi:[],impostoIcmsModalidade:[],impostoCstIcms:[],impostoCstIcmsSt:[],documentoItem:{},imposto:{},item:{},visivel:!1,contasOpcoes:[],exibirIcms:!1,exibirIcmsSt:!1,exibirIpi:!1,somenteLeituraIcms:!1,somenteLeituraIcmsSt:!1,exibirHistorico:!1,exibirEstoque:!1,exibeCfop:!1}},emits:["salvar"],methods:{async mostrar(i,e,p){var a,c,v,b;this.compra=p,this.documentoItem=$utils.clonarV2(i),this.item=$utils.clonarV2(e),await this.consultarHistoricoItem(this.item),await this.consultarEstoqueItem(this.item);const y=await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:1}}),o=await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:21}});this.impostoCstIcms=y.concat(o).map(f=>({rotulo:f.numero.trim()+" - "+f.descr,valor:Number(f.numero)})).sort((f,_)=>Number(f.valor)-Number(_.valor)),this.impostoIcmsModalidade=(await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:3}})).map(f=>({rotulo:f.numero.trim()+" - "+f.descr,valor:Number(f.numero)})).sort((f,_)=>Number(f.valor)-Number(_.valor)),this.impostoCstIcmsSt=(await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:4}})).map(f=>({rotulo:f.numero.trim()+" - "+f.descr,valor:Number(f.numero)})).sort((f,_)=>Number(f.valor)-Number(_.valor)),this.impostoCstIpi=(await $db.hibrido.lista({table:"impostoParametro",where:{impParamTipoCod:5}})).map(f=>({rotulo:f.numero.trim()+" - "+f.descr,valor:Number(f.numero)})).sort((f,_)=>Number(f.valor)-Number(_.valor)),this.contaEstoque=(await $db.hibrido.lista({table:"financeiroPlanoConta"})).map(f=>{var _,l,C;return{rotulo:(C=(l=(_=f==null?void 0:f.descricao)!=null?_:" - "+(f==null?void 0:f.classificacao))!=null?l:" - "+(f==null?void 0:f.caminho))!=null?C:"",valor:f.id}}).sort((f,_)=>Number(f.valor)-Number(_.valor));let s;(a=this.documentoItem)!=null&&a.idCfop&&(s=await $erp().cfop.where({id:this.documentoItem.idCfop}).first()),s===void 0&&console.log("CFOP inv\xE1lido");const u=this.documentoItem.total/(this.documentoItem.quantidade||1)||0;this.documentoItem.cfop=(c=s==null?void 0:s.cfop.toString())!=null?c:"",this.documentoItem.codigoCfop=(v=s==null?void 0:s.codigoCfop)!=null?v:null,this.documentoItem.idCfop=(b=s==null?void 0:s.id)!=null?b:null,this.documentoItem.valorBaseIcms=this.documentoItem.valorBaseIcms||u,this.documentoItem.valorBaseIpi=this.documentoItem.valorBaseIpi||u,this.documentoItem.valorBaseIcmsSt=this.documentoItem.valorBaseIcmsSt||u,this.calcularImpostos(),this.exibeCfop=!0,this.visivel=!0},async salvar(){try{if(this.exibirIcms||(this.documentoItem.modalidadeBaseCalculo=null,this.documentoItem.codigoCst=null,this.documentoItem.percentualIcms=0,this.documentoItem.valorIcms=0),this.exibirIcmsSt||(this.documentoItem.modalidadeBaseCalculoST=null,this.documentoItem.percentualIcmsSt=0,this.documentoItem.valorIcmsSt=0),this.exibirIpi||(this.documentoItem.codigoCstIpi=null,this.documentoItem.percentualIpi=0,this.documentoItem.valorIpi=0),Object.keys(this.documentoItem.cfop).length>0){const i=await $db.hibrido.lista({table:"cfop",where:{cfop:Number(this.documentoItem.cfop)}});this.documentoItem.codigoCfop=i[0].codigoCfop,this.documentoItem.idCfop=i[0].id}this.documentoItem.cfop&&delete this.documentoItem.cfop,this.$emit("salvar",this.documentoItem),this.exibirIcms=!1,this.exibirIcmsSt=!1,this.exibirIpi=!1,this.visivel=!1}catch(i){$q.notifyError("Ocorreu um erro ao salvar o produto: ",i.message)}finally{$q.notifyPositive("Produto salvo com sucesso.")}},calcularImpostos(i){var f,_,l,C,h,w,r,g,S,D;let e=(f=this.documentoItem.valorBaseIcms)!=null?f:0,p=(_=this.documentoItem.valorBaseIpi)!=null?_:0,y=(l=this.documentoItem.valorBaseIcmsSt)!=null?l:0,o=(C=this.documentoItem.percentualIcms)!=null?C:0,s=(h=this.documentoItem.percentualIpi)!=null?h:0,u=(w=this.documentoItem.percentualIVA)!=null?w:0,a=(r=this.documentoItem.percentualIcmsSt)!=null?r:0,c=(g=this.documentoItem.valorIcms)!=null?g:0,v=(S=this.documentoItem.valorIpi)!=null?S:0,b=(D=this.documentoItem.valorIcmsSt)!=null?D:0;["valorBaseIcms","percentualIcms"].includes(i)&&(c=e*o/100),i==="valorIcms"&&(o=c/e*100),["valorBaseIpi","percentualIpi"].includes(i)&&(v=p*s/100),i==="valorIpi"&&(s=v/p*100),i==="valorBaseIcmsSt"&&(u=0,y>0&&e>0&&y>=e&&(u=(y-e)/e*100),b=y*a/100-c),i==="percentualIVA"&&(y=e*(1+u/100),b=y*a/100-c),i==="percentualIcmsSt"&&(b=y*a/100-c),i==="valorIcmsSt"&&(a=b/y*100),this.documentoItem.valorBaseIcmsSt=parseFloat(y.toFixed(2)),this.documentoItem.percentualIcms=parseFloat(o.toFixed(2)),this.documentoItem.percentualIcmsSt=parseFloat(a.toFixed(2)),this.documentoItem.percentualIpi=parseFloat(s.toFixed(2)),this.documentoItem.percentualIVA=parseFloat(u.toFixed(2)),this.documentoItem.valorIcms=parseFloat(c.toFixed(2)),this.documentoItem.valorIcmsSt=parseFloat(b.toFixed(2)),this.documentoItem.valorIpi=parseFloat(v.toFixed(2)),(this.documentoItem.modalidadeBaseCalculo||this.documentoItem.codigoCst||this.documentoItem.percentualIcms>0||this.documentoItem.valorIcms>0)&&(this.exibirIcms=!0),(this.documentoItem.modalidadeBaseCalculoST||this.documentoItem.percentualIcmsSt>0||this.documentoItem.valorIcmsSt>0)&&(this.exibirIcmsSt=!0),(this.documentoItem.codigoCstIpi||this.documentoItem.percentualIpi>0||this.documentoItem.valorIpi>0)&&(this.exibirIpi=!0)},async consultarCFOP(){var p,y;const i=this.documentoItem.cfop,e=await $erp().cfop.where({cfop:Number(i)}).first();e===void 0&&console.log("CFOP inv\xE1lido"),this.documentoItem.idCfop=(p=e==null?void 0:e.id)!=null?p:null,this.documentoItem.codigoCfop=(y=e==null?void 0:e.CodigoCFOP)!=null?y:null},async consultarHistoricoItem(i){const e={};(i==null?void 0:i.atual)&&Object.keys(i.atual).length>0&&(i=i.atual);const y=(await $db.hibrido.lista({table:"documentoItem",where:{idItem:i.id}})).filter(o=>(o.operacao==="Compra"||o.operacao==="Compra de Mercadoria")&&o.status==="Finalizado"&&o.operacaoFator===1&&o.quantidade>0);for(const o of y){const s=await $db.hibrido.le({table:"documento",id:o.idDocumento}),u=await $db.hibrido.le({table:"contato",id:s.idContato});e[o.idItem]||(e[o.idItem]={fornecedores:[]}),e[o.idItem].fornecedores.push({fornecedor:u.apelido||"",dataCompra:s.dataCompra||"",quantidade:o.quantidade||"",valorCusto:o.valorItem||"",valorTotal:o.valorItem*o.quantidade||""})}Object.keys(e).length>0?(this.historicoItem=e,this.historicoItem[i.id].fornecedores.sort((o,s)=>{const u=new Date(o.dataCompra||"1900-01-01");return new Date(s.dataCompra||"1900-01-01")-u})):this.historicoItem[i.id]={fornecedores:[]},this.exibirHistorico=!0},async consultarEstoqueItem(i){const e={};(i==null?void 0:i.atual)&&Object.keys(i.atual).length>0&&(i=i.atual);const p=await $db.hibrido.lista({table:"estoqueSaldoProdutoEmpresa",where:{idItem:i.id},whereFilter:{tipoEstoque:"Dispon\xEDvel"}});for(const y of p){const o=await $db.hibrido.le({table:"contato",id:y.idEmpresa});e[y.idItem]||(e[y.idItem]={estoques:[]}),e[y.idItem].estoques.push({empresa:o.apelido||"",tipoEstoque:y.tipoEstoque||"",lote:y.lote||"-",quantidade:y.saldo||""})}Object.keys(e).length>0?(this.estoqueItem=e,this.estoqueItem[i.id].estoques.sort((y,o)=>{const s=Number(y.quantidade||0);return Number(o.quantidade||0)-s})):this.estoqueItem[i.id]={estoques:[]},this.exibirEstoque=!0},async fechar(){this.documentoItem.cfop&&delete this.documentoItem.cfop,this.exibirIcms=!1,this.exibirIcmsSt=!1,this.exibirIpi=!1}}},Ue=["src"],Re={key:0},Le={key:0};function Me(i,e,p,y,o,s){const u=gt("badge"),a=gt("g-col"),c=gt("g-row"),v=gt("campo"),b=gt("SeletorNcm"),f=gt("SeletorCfop"),_=gt("g-label");return $(),Y($t,{modelValue:o.visivel,"onUpdate:modelValue":e[36]||(e[36]=l=>o.visivel=l),persistent:""},{default:n(()=>[t(Ht,{container:"",view:"hHh Lpr fFf",class:"bg-white",style:{"max-width":"980px"}},{default:n(()=>[t(Zt,{class:"bg-primary"},{default:n(()=>[t(Nt,{class:"bg-primary text-white"},{default:n(()=>[t(Rt,null,{default:n(()=>[A(tt(o.documentoItem.descricaoItem),1)]),_:1}),o.item.referencia?($(),Y(u,{key:0,cor:"tertiary",class:"q-mr-sm"},{default:n(()=>[A(tt(o.item.referencia)+" ",1),t(Vt,null,{default:n(()=>e[37]||(e[37]=[A(" Refer\xEAncia ")])),_:1})]),_:1})):it("",!0),o.item.codigoItem?($(),Y(u,{key:1,cor:"positive",class:"q-mr-sm"},{default:n(()=>[A(" #"+tt(o.item.codigoItem.toString().padStart(4,"0"))+" ",1),t(Vt,null,{default:n(()=>e[38]||(e[38]=[A(" C\xF3digo Item ")])),_:1})]),_:1})):it("",!0),vt(t(ut,{onClick:s.fechar,dense:"",flat:"",icon:"close",round:""},null,8,["onClick"]),[[Dt]])]),_:1})]),_:1}),t(Xt,null,{default:n(()=>[t(Wt,null,{default:n(()=>[t(c,{gutter:"md"},{default:n(()=>[t(a,null,{default:n(()=>[t(c,{class:"col-12 text-center"},{default:n(()=>[t(a,null,{default:n(()=>{var l,C,h,w,r,g;return[((l=o.item)==null?void 0:l.imagem)||((h=(C=o.item)==null?void 0:C.atual)==null?void 0:h.imagem)?($(),_t("img",{key:0,src:((w=o.item)==null?void 0:w.imagem)||((g=(r=o.item)==null?void 0:r.atual)==null?void 0:g.imagem),alt:"",style:{"max-width":"33%"}},null,8,Ue)):it("",!0)]}),_:1})]),_:1}),t(ke,{modelValue:o.abaSelecionada,"onUpdate:modelValue":e[0]||(e[0]=l=>o.abaSelecionada=l),align:"justify",dense:"","indicator-color":"light-blue-4",class:"text-primary q-px-sm"},{default:n(()=>[t(le,{default:"",name:"tab1",icon:"info",label:"Detalhes",class:"cinza"}),t(le,{name:"tab2",icon:"history",label:"Compras",class:"cinza"}),t(le,{name:"tab3",icon:"compare_arrows",label:"Estoque",class:"cinza"})]),_:1},8,["modelValue"]),t(Se,{modelValue:o.abaSelecionada,"onUpdate:modelValue":e[35]||(e[35]=l=>o.abaSelecionada=l),animated:"",class:"text-tertiary"},{default:n(()=>[t(de,{name:"tab1",class:"q-px-sm"},{default:n(()=>[t(c,null,{default:n(()=>[t(a,null,{default:n(()=>[t(v,{modelValue:o.documentoItem.observacao,"onUpdate:modelValue":e[1]||(e[1]=l=>o.documentoItem.observacao=l),tipo:"textoArea",rotulo:"Observa\xE7\xE3o",dense:"",rows:"4"},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{mg:"lg-t"},{default:n(()=>[t(a,{col:"12"},{default:n(()=>[t(v,{modelValue:o.documentoItem.referenciaFornecedor,"onUpdate:modelValue":e[2]||(e[2]=l=>o.documentoItem.referenciaFornecedor=l),rotulo:"Refer\xEAncia Fornecedor"},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{mg:"lg-t"},{default:n(()=>[t(a,{col:"12"},{default:n(()=>[t(b,{modelValue:o.documentoItem.ncm,"onUpdate:modelValue":e[3]||(e[3]=l=>o.documentoItem.ncm=l),class:"col-12 col-md-6",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{mg:"lg-t"},{default:n(()=>[t(a,{col:"12"},{default:n(()=>[t(f,{modelValue:o.documentoItem.cfop,"onUpdate:modelValue":e[4]||(e[4]=l=>o.documentoItem.cfop=l),class:"col-12 col-md-6",outlined:""},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{mg:"lg-t"},{default:n(()=>[t(a,null,{default:n(()=>[t(_,{text:"sub1 medium"},{default:n(()=>e[39]||(e[39]=[A("Estoque")])),_:1})]),_:1})]),_:1}),t(c,{items:"center"},{default:n(()=>[t(a,{col:"12"},{default:n(()=>[t(v,{modelValue:o.documentoItem.idPlanoContaEstoque,"onUpdate:modelValue":e[5]||(e[5]=l=>o.documentoItem.idPlanoContaEstoque=l),opcoes:o.contaEstoque,tipo:"seletor",ajuda:"Plano de Conta de Estoque para Entrada de Mercadoria",dense:"",outlined:"",rotulo:"Conta Estoque"},null,8,["modelValue","opcoes"])]),_:1})]),_:1}),t(c,{mg:"lg-t"},{default:n(()=>[t(a,null,{default:n(()=>[t(_,{text:"sub1 medium"},{default:n(()=>e[40]||(e[40]=[A("Impostos")])),_:1})]),_:1})]),_:1}),t(c,null,{default:n(()=>[t(Mt,{label:"ICMS",modelValue:o.exibirIcms,"onUpdate:modelValue":e[6]||(e[6]=l=>o.exibirIcms=l)},null,8,["modelValue"])]),_:1}),o.exibirIcms?($(),Y(c,{key:0,items:"center"},{default:n(()=>[t(a,{col:"12 sm6"},{default:n(()=>[t(v,{modelValue:o.documentoItem.modalidadeBaseCalculo,"onUpdate:modelValue":e[7]||(e[7]=l=>o.documentoItem.modalidadeBaseCalculo=l),opcoes:o.impostoIcmsModalidade,"somente-leitura":o.somenteLeituraIcms,tipo:"seletor",outlined:"",rotulo:"ICMS (Modalidade)"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),t(a,{col:"12 sm6"},{default:n(()=>[t(v,{modelValue:o.documentoItem.codigoCst,"onUpdate:modelValue":e[8]||(e[8]=l=>o.documentoItem.codigoCst=l),opcoes:o.impostoCstIcms,"somente-leitura":o.somenteLeituraIcms,tipo:"seletor",outlined:"",rotulo:"CST ICMS"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),t(a,{col:"12 sm4"},{default:n(()=>[t(v,{modelValue:o.documentoItem.valorBaseIcms,"onUpdate:modelValue":e[9]||(e[9]=l=>o.documentoItem.valorBaseIcms=l),onBlur:e[10]||(e[10]=l=>s.calcularImpostos("valorBaseIcms")),"somente-leitura":o.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base ICMS"},null,8,["modelValue","somente-leitura"])]),_:1}),t(a,{col:"12 sm4"},{default:n(()=>[t(v,{modelValue:o.documentoItem.percentualIcms,"onUpdate:modelValue":e[11]||(e[11]=l=>o.documentoItem.percentualIcms=l),onBlur:e[12]||(e[12]=l=>s.calcularImpostos("percentualIcms")),"somente-leitura":o.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"ICMS %"},null,8,["modelValue","somente-leitura"])]),_:1}),t(a,{col:"12 sm4"},{default:n(()=>[t(v,{modelValue:o.documentoItem.valorIcms,"onUpdate:modelValue":e[13]||(e[13]=l=>o.documentoItem.valorIcms=l),onBlur:e[14]||(e[14]=l=>s.calcularImpostos("valorIcms")),"somente-leitura":o.somenteLeituraIcms,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor ICMS"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})):it("",!0),t(c,null,{default:n(()=>[t(Mt,{label:"ICMS ST",modelValue:o.exibirIcmsSt,"onUpdate:modelValue":e[15]||(e[15]=l=>o.exibirIcmsSt=l)},null,8,["modelValue"])]),_:1}),o.exibirIcmsSt?($(),Y(c,{key:1,items:"center"},{default:n(()=>[t(a,{col:"12 sm6"},{default:n(()=>[t(v,{modelValue:o.documentoItem.modalidadeBaseCalculoST,"onUpdate:modelValue":e[16]||(e[16]=l=>o.documentoItem.modalidadeBaseCalculoST=l),opcoes:o.impostoCstIcmsSt,"somente-leitura":o.somenteLeituraIcmsSt,tipo:"seletor",outlined:"",rotulo:"ICMS ST (Modalidade)"},null,8,["modelValue","opcoes","somente-leitura"])]),_:1}),t(a,{col:"12 sm6"},{default:n(()=>[t(v,{modelValue:o.documentoItem.percentualIVA,"onUpdate:modelValue":e[17]||(e[17]=l=>o.documentoItem.percentualIVA=l),onBlur:e[18]||(e[18]=l=>s.calcularImpostos("percentualIVA")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"IVA (%)"},null,8,["modelValue"])]),_:1}),t(a,{col:"12 sm4"},{default:n(()=>[t(v,{modelValue:o.documentoItem.valorBaseIcmsSt,"onUpdate:modelValue":e[19]||(e[19]=l=>o.documentoItem.valorBaseIcmsSt=l),onBlur:e[20]||(e[20]=l=>s.calcularImpostos("valorBaseIcmsSt")),"somente-leitura":o.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base ICMS ST"},null,8,["modelValue","somente-leitura"])]),_:1}),t(a,{col:"12 sm4"},{default:n(()=>[t(v,{modelValue:o.documentoItem.percentualIcmsSt,"onUpdate:modelValue":e[21]||(e[21]=l=>o.documentoItem.percentualIcmsSt=l),onBlur:e[22]||(e[22]=l=>s.calcularImpostos("percentualIcmsSt")),"somente-leitura":o.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"ICMS ST (%)"},null,8,["modelValue","somente-leitura"])]),_:1}),t(a,{col:"12 sm4"},{default:n(()=>[t(v,{modelValue:o.documentoItem.valorIcmsSt,"onUpdate:modelValue":e[23]||(e[23]=l=>o.documentoItem.valorIcmsSt=l),onBlur:e[24]||(e[24]=l=>s.calcularImpostos("valorIcmsSt")),"somente-leitura":o.somenteLeituraIcmsSt,tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor ICMS ST"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})):it("",!0),t(c,null,{default:n(()=>[t(Mt,{label:"IPI",modelValue:o.exibirIpi,"onUpdate:modelValue":e[25]||(e[25]=l=>o.exibirIpi=l)},null,8,["modelValue"])]),_:1}),o.exibirIpi?($(),Y(c,{key:2,items:"center"},{default:n(()=>[t(a,{col:"12"},{default:n(()=>[t(v,{modelValue:o.documentoItem.codigoCstIpi,"onUpdate:modelValue":e[26]||(e[26]=l=>o.documentoItem.codigoCstIpi=l),opcoes:o.impostoCstIpi,tipo:"seletor",dense:"",outlined:"",rotulo:"CST IPI"},null,8,["modelValue","opcoes"])]),_:1}),t(a,{col:"12 sm4"},{default:n(()=>[t(v,{modelValue:o.documentoItem.valorBaseIpi,"onUpdate:modelValue":e[27]||(e[27]=l=>o.documentoItem.valorBaseIpi=l),onBlur:e[28]||(e[28]=l=>s.calcularImpostos("valorBaseIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Base IPI"},null,8,["modelValue"])]),_:1}),t(a,{col:"12 sm4"},{default:n(()=>[t(v,{modelValue:o.documentoItem.percentualIpi,"onUpdate:modelValue":e[29]||(e[29]=l=>o.documentoItem.percentualIpi=l),onBlur:e[30]||(e[30]=l=>s.calcularImpostos("percentualIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"IPI %"},null,8,["modelValue"])]),_:1}),t(a,{col:"12 sm4"},{default:n(()=>[t(v,{modelValue:o.documentoItem.valorIpi,"onUpdate:modelValue":e[31]||(e[31]=l=>o.documentoItem.valorIpi=l),onBlur:e[32]||(e[32]=l=>s.calcularImpostos("valorIpi")),tipo:"decimal",decimals:"2",zerosDireita:"2",dense:"",outlined:"",rotulo:"Valor IPI"},null,8,["modelValue"])]),_:1})]),_:1})):it("",!0)]),_:1}),t(de,{name:"tab2",class:"q-px-sm"},{default:n(()=>[o.exibirHistorico?($(),Y(fe,{key:0,rows:o.historicoItem[o.documentoItem.idItem].fornecedores,columns:o.tabelaHistoricoItem.colunas,pagination:o.tabelaHistoricoItem.paginacao,"onUpdate:pagination":e[33]||(e[33]=l=>o.tabelaHistoricoItem.paginacao=l),"row-key":"index",class:"no-shadow text-left"},{body:n(l=>[t(pe,{props:l},{default:n(()=>[t(Ut,{key:"fornecedor",props:l},{default:n(()=>[A(tt(l.row.fornecedor),1)]),_:2},1032,["props"]),t(Ut,{key:"dataCompra",props:l},{default:n(()=>[l.row.dataCompra!==""?($(),_t("span",Re,tt(i.$filters.data(l.row.dataCompra)),1)):it("",!0)]),_:2},1032,["props"]),t(Ut,{key:"quantidade",props:l},{default:n(()=>[A(tt(l.row.quantidade),1)]),_:2},1032,["props"]),t(Ut,{key:"valorCusto",props:l},{default:n(()=>[A(tt(i.$filters.numero(l.row.valorCusto,2)),1)]),_:2},1032,["props"]),t(Ut,{key:"valorTotal",props:l},{default:n(()=>[A(tt(i.$filters.numero(l.row.valorTotal,2)),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])):it("",!0)]),_:1}),t(de,{name:"tab3",class:"q-px-sm"},{default:n(()=>[o.exibirEstoque?($(),Y(fe,{key:0,rows:o.estoqueItem[o.documentoItem.idItem].estoques,columns:o.tabelaEstoqueItem.colunas,pagination:o.tabelaEstoqueItem.paginacao,"onUpdate:pagination":e[34]||(e[34]=l=>o.tabelaEstoqueItem.paginacao=l),"row-key":"index",class:"no-shadow text-left"},{body:n(l=>[t(pe,{props:l},{default:n(()=>[t(Ut,{key:"empresa",props:l},{default:n(()=>[A(tt(l.row.empresa),1)]),_:2},1032,["props"]),t(Ut,{key:"tipoEstoque",props:l},{default:n(()=>[A(tt(l.row.tipoEstoque),1)]),_:2},1032,["props"]),t(Ut,{key:"lote",props:l},{default:n(()=>[l.row.lote!==""?($(),_t("span",Le,tt(l.row.lote),1)):it("",!0)]),_:2},1032,["props"]),t(Ut,{key:"quantidade",props:l},{default:n(()=>[A(tt(l.row.quantidade),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])):it("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(Yt,{class:"bg-light q-pa-sm",bordered:""},{default:n(()=>[t(Nt,null,{default:n(()=>[t(re),vt(t(ut,{onClick:s.fechar,label:"Cancelar",size:"md",flat:"","no-ripple":"",color:"tertiary",class:"q-mr-sm"},null,8,["onClick"]),[[Dt]]),t(ut,{onClick:s.salvar,label:"Salvar",color:"primary","no-ripple":"",unelevated:""},null,8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])}var $e=ne(Be,[["render",Me]]);const je={components:{ModalEditarProdutoCompras:$e,PromptItemV2:ve},data(){const i={ehOrcamento:!0,adicionar:{modal:{value:!1,name:""}},dataPrevistaEntrega:"",horaPrevistaEntrega:"",contatos:{},produtos:[],formasDePagamento:[],visivel:!1,somenteLeitura:!1,condicaoPagamentoRules:[async()=>{const e=this.compra.condicaoPagamento;return/^[\d/]*$/.test(e)}],formaPagamentoRules:[async()=>{const e=this.compra.formaDePagamento;return/^[^\d\s][a-zA-Z\s]*[^\d\s]$/.test(e)}],comprasMigrar:[],erroDesconto:!1,erroFrete:!1,erroSeguro:!1,erroOutrasDespesas:!1,exibeInfNota:!1,documentoNovo:!1,valorTotalPagamento:0,sku:0,operacao:"",alterarPrevisaoEntrega:!1};return this.limpaCampos(i),i},emits:["atualizar","dialogImprimirEtiquetas"],computed:{skus(){return this.compraItens.length>0?`${Number(this.compraItens.length)}`:"0"}},methods:{editarProduto(i){const e=this.produtos[i.idItem],p=this.compra;this.$refs.ModalEditarProdutoCompras.mostrar(i,e,p)},removerItem(i){this.compraItens=this.compraItens.filter(e=>e.id!==i.id),this.calcularTotais()},async migrarParaOutraCompra(i,e){await $tryLoading(async()=>{const p=(e==null?void 0:e.id)||$utils.uuid(),y=e?{...e}:{...this.compra,id:p,codigoDocumento:void 0,numero:void 0,notaNumero:void 0,notaSerie:void 0,naturezaOperacao:void 0,dataCompra:void 0,chaveAcesso:void 0,totalDesconto:void 0,totalPercentualDesconto:void 0,valorFrete:void 0,valorSeguro:void 0,valorOutrasDespesas:void 0,dataHoraEmissao:$utils.dataAtual(),dataHoraFinalizado:void 0,dataHoraPrevisto:void 0,status:"Digita\xE7\xE3o"},o={...i,id:$utils.uuid(),codigoDocumentoItem:void 0,idDocumento:p,codigoDocumento:void 0,dataHoraEmissao:$utils.dataAtual(),dataHoraFinalizado:void 0,status:"Digita\xE7\xE3o"};this.calcularTotais("",y,[o]),await $db.hibrido.grava("documento",{atual:y,original:e}),await $db.hibrido.grava("documentoItem",{atual:o}),this.removerItem(i),this.salvar(),$q.notifyPositive("Item migrado com sucesso!")},{mensagem:"Migrando..."})},fecharEdicaoProduto(i){const e=this.compraItens.findIndex(p=>p.id===i.id);this.compraItens[e]=$utils.clonar(i),this.calcularTotaisItem(e)},async atualizar(){var o,s,u;this.compraOriginal=await $db.hibrido.le({table:"documento",id:this.compra.id}),this.compra=$utils.clonarV2(this.compraOriginal),$utils.verificarErro(!this.compra.id,"Compra n\xE3o encontrada"),this.compraItensOriginal=(await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:this.compra.id}})).sort((a,c)=>new Date(a.dataHoraEmissao||0)-new Date(c.dataHoraEmissao||0));const i=this.compraItensOriginal.map(a=>a.idItem),e=(o=await $db.hibrido.lista({table:"item",columns:["id","descricaoConcatenada"],whereIn:{id:i}}))!=null?o:{};for(const a of this.compraItensOriginal)a.descricaoConcatenada=(e==null?void 0:e.find(c=>c.id===a.idItem).descricaoConcatenada)||"";this.compraItens=$utils.clonarV2(this.compraItensOriginal),this.compraCondicoesDePagamentoOriginal=(await $db.hibrido.lista({table:"documentoCondicaoPagamento",where:{idDocumento:this.compra.id}})).sort((a,c)=>new Date(a.dataVencimento||0)-new Date(c.dataVencimento||0)),this.compraCondicoesDePagamento=$utils.clonarV2(this.compraCondicoesDePagamentoOriginal),this.compraTitulosOriginal=await $db.hibrido.lista({table:"financeiroTitulo",where:{documentoId:this.compra.id}}),this.compraTitulos=$utils.clonarV2(this.compraTitulosOriginal),this.compraMovimentacoesOriginal=await $db.hibrido.lista({table:"financeiroMovimentacao",where:{documentoId:this.compra.id}}),this.compraMovimentacoes=$utils.clonarV2(this.compraMovimentacoesOriginal),this.compraDocumentoXmlOriginal=await $db.hibrido.lista({table:"documentoXML",where:{idDocumento:this.compra.id}}),this.compraDocumentoXml=$utils.clonarV2(this.compraDocumentoXmlOriginal),this.compra.totalComImposto=!0,this.compra.calcularTributacao=(s=this.compra.calcularTributacao)!=null?s:!0,this.compra.naoGerarFinanceiro=(u=this.compra.naoGerarFinanceiro)!=null?u:!1;const p=[this.compra.idEmpresa,this.compra.idContato,this.compra.idContatoComprador,this.compra.idContatoVendedor,this.compra.idContatoTransportadora].filter(Boolean);this.carregarImagensContatos(p);const y=this.compraItens.map(({idItem:a})=>a).filter(Boolean);if(this.carregarImagensItens(y),this.valorTotalPagamento===0)for(const a of this.compraCondicoesDePagamento)this.valorTotalPagamento=this.valorTotalPagamento+a.valor;this.compra.dataHoraPrevisto&&(this.dataPrevistaEntrega=this.compra.dataHoraPrevisto.slice(0,10),this.horaPrevistaEntrega=this.compra.dataHoraPrevisto.slice(11,16)),this.carregarComprasMigrar(this.compra),this.calcularTotais(),this.exibeInfNota=!0},async carregarContatos(i){const e=await $db.hibrido.lista({table:"contato",columns:["id","apelido","imagem"],whereIn:{id:i}});for(const p of e)this.contatos[p.id]=p},async carregarImagensContatos(i){if(!!i.length){await $utils.dormir(200);try{await this.carregarContatos(i)}catch(e){console.error("Erro ao carregar imagens de contatos - ",e)}}},async carregarComprasMigrar(i){try{this.comprasMigrar=(await $db.hibrido.lista({table:"documento",where:{tipo:"Compra",idContato:i.idContato},whereFilter:{idEmpresa:i.idEmpresa,status:"Digita\xE7\xE3o"}})).filter(({id:e})=>e!==i.id)}catch(e){console.error("Erro ao carregar compras para migra\xE7\xE3o - ",e)}},async carregarItens(i){const e=await $db.hibrido.lista({table:"item",columns:["id","descricao","imagem","valorCustoReposicao","marca","referencia","codigoItem"],whereIn:{id:i}});for(const p of e)this.produtos[p.id]=p},async carregarImagensItens(i){if(!!i.length){await $utils.dormir(200);try{await this.carregarItens(i)}catch(e){console.error("Erro ao ler imagens de itens - ",e)}}},async salvar_click(){await $tryLoading(async()=>{if(this.compra.idContato||(this.compra.idContato=$db.usuario.logado.id),this.dataPrevistaEntrega){const i=`${this.dataPrevistaEntrega} ${this.horaPrevistaEntrega||"00:00:00"}`;this.compra.dataHoraPrevisto=zt.formatDate(i)}this.calcularTotais(),await this.salvar(),this.$emit("atualizar",{aba:"Digita\xE7\xE3o"}),this.ocultarModal(),$q.notifyPositive(this.compra.operacao==="Nota de Entrada"?"A Nota de Entrada foi salva com sucesso.":"O Pedido de Compra foi salvo com sucesso.")},{mensagem:"Salvando..."})},async excluir_click(){!await $q.dialogSimNao({title:"Excluir compra",message:`Deseja excluir ${this.compra.operacao==="Pedido de Compra"?`o ${this.compra.operacao}?`:`a ${this.compra.operacao}?`}`})||await $tryLoading(async()=>{this.visivel=!1,this.operacao=this.compra.operacao,this.compra={},this.compraCondicoesDePagamento=[],this.compraItens=[],this.compraMovimentacoes=[],this.compraTitulos=[],this.compraDocumentoXml=[],await this.salvar(),await this.fechar(),$q.notifyPositive(this.compra.operacao==="Nota de Entrada"?"A Nota de Entrada foi excluida com sucesso.":"O Pedido de Compra foi excluido com sucesso.")},{mensagem:"Excluindo..."})},async criar(){await $tryLoading(async()=>{const i=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;if(!(i.length>0)){this.$q.notify({message:"N\xE3o h\xE1 empresa configurada",timeout:0,type:"negative",closeBtn:!0});return}let e=i[0];if(i.length>1){const o={ativo:!0,empresas:!0};if(e=await $g.promptContato.show({filtro:o,placeholder:"Selecione a empresa"}),!e){this.ocultarModal();return}}const p=(await $db.hibrido.lista({table:"empresa",where:{idContato:e.id}}))[0];if(!p){this.ocultarModal(),this.$q.notifyError("Erro ao selecionar empresa");return}if(this.contatos[e.id]||await this.carregarContatos([e.id]),this.limpaCampos(this),this.compra={id:$utils.uuid(),tipo:"Compra",operacao:"Pedido de Compra",status:"Digita\xE7\xE3o",descricaoEmpresa:p.nome,numeroDocumentoEmpresa:p.numeroDocumentoNacional,descricaoContato:"",idContatoComprador:null,dataHoraEmissao:$utils.dataAtual(),tipoFrete:"CIF",tipoTransporte:null,idEmpresa:p.idContato,idContato:null,totalDesconto:0,totalPercentualDesconto:0,calcularTributacao:!0,totalComImposto:!0,naoGerarFinanceiro:!1,freteSeparado:!1,dataHoraPrevisto:null,valorBaseIcms:0,valorIcms:0,valorBaseIcmsSt:0,valorIcmsSt:0,valorOutrasDespesas:0},!await this.abrirModalFornecedor()){this.ocultarModal();return}this.documentoNovo=!0,this.exibeInfNota=!0,this.visivel=!0})},async validaCampos(){try{if($utils.verificarErro(!this.compra.descricaoContato,"N\xE3o \xE9 permitido finalizar a compra sem informar o fornecedor!"),$utils.verificarErro(!this.compraItens.length,"N\xE3o \xE9 permitido finalizar compra sem itens!"),!this.compra.naoGerarFinanceiro){const i=$utils.arredondar(this.compraCondicoesDePagamento.reduce((e,p)=>e+p.valor,0));$utils.verificarErro(!this.compra.formaDePagamento,"N\xE3o \xE9 permitido finalizar a compra sem informar a forma de pagamento!"),$utils.verificarErro(this.compraCondicoesDePagamento.length>0&&this.compra.totalDocumento!==i,"N\xE3o \xE9 permitido finalizar a compra se o valor total difere da soma das parcelas!"),$utils.verificarErro(this.compraCondicoesDePagamento.length===0,'Verifique se a op\xE7\xE3o "N\xE3o gerar financeiro" est\xE1 marcada, ou adicione as parcelas para finalizar a compra!')}return this.compra.operacao==="Nota de Entrada"&&($utils.verificarErro(!this.compra.notaNumero,"N\xE3o \xE9 permitido finalizar a compra sem informar o n\xFAmero da Nota de Entrada!"),$utils.verificarErro(!this.compra.notaSerie,"N\xE3o \xE9 permitido finalizar a compra sem informara s\xE9rie da Nota de Entrada!"),$utils.verificarErro(!this.compra.naturezaOperacao,"N\xE3o \xE9 permitido finalizar a compra sem informar natureza de opera\xE7\xE3o da Nota de Entrada!"),$utils.verificarErro(!this.compra.dataCompra,"N\xE3o \xE9 permitido finalizar a compra sem informar a data de compra da Nota de Entrada!"),$utils.verificarErro(!this.compra.chaveAcesso,"N\xE3o \xE9 permitido finalizar a compra sem informar a chave de acesso da Nota de Entrada!")),!0}catch(i){return $q.notifyError("Ocorreu um erro na valida\xE7\xE3o de campos",i),!1}},async finalizar_click(){if(!await this.validaCampos())return;let i=!1;this.compra.naoGerarFinanceiro||(i=await $q.dialogSimNao({title:"Gerar Financeiro",message:"Deseja gerar as provis\xF5es financeiras?"})),await $tryLoading(async()=>{this.compra.status="Finalizado",this.compra.dataHoraFinalizado=$utils.dataAtual(),this.compra.provisaoCompra=i?1:void 0,await this.finalizarItens(),i&&await this.gerarFinanceiro(),await this.salvar(),this.$emit("atualizar",{aba:"Finalizado"}),this.ocultarModal(),$q.notifyPositive(this.compra.operacao==="Nota de Entrada"?"A Nota de Entrada foi finalizada com sucesso!":"O Pedido de Compra foi finalizada com sucesso!"),i&&$q.notifyPositive("Provisionamento gerado com sucesso!")},{mensagem:"Finalizando Compra..."})},finalizarItens(){var s,u;let i=1,e=0,p=0,y=!1;const o=this.compra;if(o.subTotalProduto>0&&(o.tipoFrete==="FOB"&&o.freteSeparado===0&&(e=(o.valorFrete||0)+(o.valorSeguro||0)),i=((o.subTotalProduto||0)+(o.valorOutrasDespesas||0)-(o.totalDesconto||0)+(e||0))/(o.subTotalProduto||1)),p=this.compraItens.reduce((a,c)=>a+c.valorIcmsSt,p),p!==o.valorIcmsSt&&(y=!0),o.operacao==="Nota de Entrada")for(const a of this.compraItens)a.dataCompra=$utils.dataAtual(),y&&(a.valorIcmsSt=o.valorIcmsSt*((a==null?void 0:a.total)||0)/(o.subTotalProduto>0?o.subTotalProduto:1)),a.valorFreteRateado=o.valorFrete*(((a==null?void 0:a.total)||0)/(o.subTotalProduto||1)),a.valorSeguroRateado=o.valorSeguro*(((a==null?void 0:a.total)||0)/(o.subTotalProduto||1)),a.valorOutrasDespesasRateado=(o.valorOutrasDespesas||0)*(((a==null?void 0:a.total)||0)/(o.subTotalProduto||1)),a.descontoTotalRateado=(o.totalDesconto||0)*(((a==null?void 0:a.total)||0)/(o.subTotalProduto||1)),(a==null?void 0:a.valorIcmsSt)-(a==null?void 0:a.valorIcms)>0&&((a==null?void 0:a.valorIcmsSt)||0)-((a==null?void 0:a.valorIcms)||0),a.valorRealTotal=((a==null?void 0:a.total)||0)*i+((a==null?void 0:a.valorIpi)||0)+((a==null?void 0:a.valorIcms)||0),a.valorRealTotalImpostos=((a==null?void 0:a.total)||0)+a.valorFreteRateado+a.valorSeguroRateado+a.valorOutrasDespesasRateado-a.descontoTotalRateado+((a==null?void 0:a.valorIpi)||0)+((a==null?void 0:a.valorIcmsSt)||0),a.valorReal=a.valorRealTotalImpostos/((a==null?void 0:a.quantidade)||1),a.valorCustoReposicao=((s=this.produtos[a.idItem])==null?void 0:s.valorCustoReposicao)||0;if(o.operacao==="Pedido de Compra")for(const a of this.compraItens){y&&(a.valorIcmsSt=$utils.arredondar(o.valorIcmsSt*(a.total||0)/(o.subTotalProduto>0?o.subTotalProduto:1))),a.valorFreteRateado=$utils.arredondar((o.valorFrete||0)*(a.total||0)/(o.subTotalProduto||1),4),a.valorSeguroRateado=$utils.arredondar((o.valorSeguro||0)*(a.total||0)/(o.subTotalProduto||1),4),a.valorOutrasDespesasRateado=$utils.arredondar((o.valorOutrasDespesas||0)*(a.total||0)/(o.subTotalProduto||1),4),a.descontoTotalRateado=$utils.arredondar((o.totalDesconto||0)*(a.total||0)/(o.subTotalProduto||1),4);let c=0;a.valorIcmsSt-a.valorIcms>0&&(c=$utils.arredondar((a.valorIcmsSt||0)-(a.valorIcms||0),2)),a.valorRealTotal=$utils.arredondar((a.total||0)*i+(a.valorIpi||0)+(c>0?c:0),2),a.valorRealTotalImpostos=$utils.arredondar((a.total||0)+a.valorFreteRateado+a.valorSeguroRateado+a.valorOutrasDespesasRateado-a.descontoTotalRateado+(a.valorIpi||0)+(a.valorIcmsSt||0),4),a.valorReal=$utils.arredondar(a.valorRealTotalImpostos/(a.quantidade||1),4),a.valorCustoReposicao=$utils.arredondar(((u=this.produtos[a.idItem])==null?void 0:u.valorCustoReposicao)||0,2)}},async transformarEmNotaDeEntrada_click(){this.compra.operacao==="Pedido de Compra"&&await $tryLoading(async()=>{var p;const i=this.compraItens.map(({idItem:y})=>y).filter(Boolean),e=await $db.hibrido.lista({table:"itemFornecedor",whereIn:{idItem:i},whereFilter:{idContato:this.compra.idContato}});for(const y of this.compraItens)if(!e.some(({idItem:o})=>o===y.idItem)){const o={id:$utils.uuid(),idItem:y.idItem,idContato:this.compra.idContato,referencia:"",descricao:y.descricaoItem};await $db.hibrido.grava("itemFornecedor",{atual:o,original:{}})}for(const y of this.compraTitulos)y.formaDePagamento=(p=this.compra.formaDePagamento)!=null?p:"";this.compra.operacao="Nota de Entrada",this.compra.dataHoraFinalizado="",this.compra.status="Digita\xE7\xE3o",await this.salvar(),$q.notifyPositive("Nota de Entrada gerada com sucesso!")},{mensagem:"Processando..."})},async mostrar({id:i}){this.visivel=!0;const e=$utils.logarIni("ComprasFicha");await $tryLoading(async()=>{this.compra.id=i,await this.atualizar()}),$utils.logarFim(e,1)},fechar(){this.compra.status==="Finalizado"?this.$emit("atualizar",{aba:"Finalizado"}):this.$emit("atualizar",{aba:"Digita\xE7\xE3o"}),this.ocultarModal(),this.produtos=[],this.limpaCampos(this),this.formasDePagamento=[],this.documentoNovo=!1,this.exibeInfNota=!1,this.valorTotalPagamento=0},ocultarModal(){this.visivel=!1},async abrirModalEmpresa(){const i={ativo:!0,empresas:!0},e=await $g.promptContato.show({filtro:i,placeholder:"Selecione"});if(!e)return;let p=(await $db.hibrido.lista({table:"empresa",where:{idContato:e.id}}))[0];if(!p){this.ocultarModal(),this.$q.notifyError("Erro ao selecionar empresa");return}this.contatos[e.id]||await this.carregarContatos([e.id]),this.compra.descricaoEmpresa=p.nome,this.compra.idEmpresa=p.idContato,this.compra.numeroDocumentoEmpresa=p.numeroDocumentoNacional,this.compra.InscricaoMunicipalEmpresa=p.InscricaoMunicipalEmpresa},async abrirModalComprador(){const i=await this.selecionarContato({placeholder:"Selecione o comprador",filtro:{ativo:!0,compradores:!0}});i.id&&(this.compra.idContatoComprador=i.id),this.contatos[i.id]||await this.carregarContatos([i.id])},async abrirModalFornecedor(){const i={ativo:!0},e=await $g.promptContato.show({filtro:i,placeholder:"Selecione o fornecedor"});if(!e)return e;const p=await $db.contatoTelefone.le({idContato:e.id}),y=await $db.contatoEndereco.le({idContato:e.id}),o=p.find(a=>a.tipoTelefone==="Principal"||a.tipoTelefone==="WhatsApp")||p[0]||null,s=y.find(a=>a.grupo==="Principal")||y[0]||null;let u;return s&&Object.keys(s).length>0&&(u=`${s.logradouro}, ${s.numero} ${s.complemento} - ${s.bairro} - ${s.municipio}/${s.uf}`),e.id&&(this.compra.idContato=e.id,this.compra.descricaoContato=e.nome,this.compra.numeroDocumentoContato=e.numeroDocumentoNacional,this.compra.emailContato=(e==null?void 0:e.email)||null,this.compra.regimeContato=(e==null?void 0:e.regime)||null,this.compra.telefoneContato=(o==null?void 0:o.telefone)||null,this.compra.descricaoContatoEndereco=u||null),this.contatos[e.id]||await this.carregarContatos([e.id]),e},async abrirModalVendedor(){const i=(await $db.contato.leFilhos(this.compra.idContato)).map(p=>p.id),e=await this.selecionarContato({placeholder:"Selecione o vendedor",filtro:{ativo:!0,usuarios:i}});e.id&&(this.compra.idContatoVendedor=e.id),this.contatos[e.id]||await this.carregarContatos([e.id])},async abrirModalTransportador(){const i=await this.selecionarContato({placeholder:"Selecione o transportadora",filtro:{ativo:!0,transportadoras:!0}});i.id&&(this.compra.idContatoTransportadora=i.id),this.contatos[i.id]||await this.carregarContatos([i.id])},async selecionarContato(i){const{placeholder:e,filtro:p}={placeholder:"Selecione o contato",filtro:{ativo:!0},...i},y=await $g.promptContato.show({filtro:p,placeholder:e});if(!y)throw new Error("Contato n\xE3o selecionado");return y},async adicionarItem(){let i={},e=[];for(const p of e)i[p.idItem]={item:await $db.hibrido.le({table:"item",id:p.idItem}),quantidade:p.quantidade};this.adicionar.modal.value=!0,this.adicionar.modal.name="Item"},trocarItens(i){const e=Object.keys(i)[0],p=i[e].item;this.produtos[e]=p},async selecionarItens(i){var e,p;for(const y in i){let o=await $db.hibrido.lista({table:"estoqueSaldoProdutoEmpresa",whereFilter:{idEmpresa:this.compra.idEmpresa,tipoEstoque:"Dispon\xEDvel",idItem:y}});o=o[0];const s=await $db.configuracoes.porNome("vendas.checaestoque",this.compra.idEmpresa);Number((e=s.find(l=>l.id))==null?void 0:e.valor);const u=i[y].item||{},a=((p=(await $db.hibrido.lista({table:"itemFornecedor",whereFilter:{idItem:u.id}}))[0])==null?void 0:p.referencia)||null,c=i[y].quantidade||0,v=(u==null?void 0:u.valorCustoReposicao)||(o==null?void 0:o.valorCustoMedio)||0;let b=this.compraItens.find(l=>l.idItem===y);const f=(await $erp().cfop.where({cfop:5102}).toArray())[0],_=await $db.financeiroPlanoConta.lePorConfig("financeiro.planocontas.comprageral");if(b)b.quantidade=$utils.arredondar(c,4),b.quantidadeRealizado=$utils.arredondar(c,4),b.subTotal=$utils.arredondar(v,2),b.total=$utils.arredondar(c*v,2);else{const l={dataHoraEmissao:$utils.dataAtual(),dataHoraFinalizado:"",descricaoItem:u.descricao,id:$utils.uuid(),idDocumento:this.compra.id,idItem:u.id,referencia:u.referencia,referenciaFornecedor:a,ncm:u.ncm||null,operacao:"Compra de Mercadoria",operacaoFator:1,idCfop:f==null?void 0:f.id,idPlanoContaEstoque:_==null?void 0:_.id,quantidade:$utils.arredondar(c,4),quantidadeRealizado:$utils.arredondar(c,4),status:"Digita\xE7\xE3o",tipoItem:u.tipo,subTotal:$utils.arredondar(v,2),total:$utils.arredondar(c*v,2),unidade:u.unidade,valorCustoMedio:(o==null?void 0:o.valorCustoMedio)||0,valorItem:v,valorOriginal:v,observacao:""};this.compraItens.push(l),await this.carregarItens([u.id])}this.compra.subTotal=0,this.compra.subTotalProduto=0;for(let l in this.compraItens)this.compra.subTotal+=this.compraItens[l].total,this.compra.subTotalProduto+=this.compraItens[l].total;this.compra.subTotal=$utils.arredondar(this.compra.subTotal,2),this.compra.totalDocumento=this.compra.subTotal}},formatXml(i,e="  "){let p="",y="";return i.split(/>\s*</).forEach(o=>{o.match(/^\/\w/)&&(y=y.substring(e.length)),p+=y+"<"+o+`>
`,o.match(/^<?\w[^>]*[^\/]$/)&&(y+=e)}),p.substring(1,p.length-3)},calcularTotaisItem(i,e){const p=$utils.clonar(this.compraItens[i]),y=p.valorOriginal||0,o=p.quantidade||0;let s=p.valorItem||0,u=p.descontoPercentualItem||0,a=p.descontoItem||0,c=p.subTotal||0,v=p.total||0;e==="descontoPercentualItem"&&((u<0||u>100)&&(u=0),a=s*u/100,c=s-a),e==="descontoItem"&&((a<0||a>s)&&(a=0),u=a/s*100,c=s-a),e==="valorItem"&&(s<y&&(s=y),a>s&&(a=0,u=0),u=a/s*100,c=s-a),e==="subTotal"&&((c<0||c>s)&&(c=s),a=s-c,u=a/s*100),v=o*c,p.valorItem=s,p.descontoItem=a,p.descontoPercentualItem=u,p.subTotal=c,p.total=v,this.compraItens[i]=p,this.calcularTotais("totalDesconto")},calcularTotais(i,e,p){const y=e||$utils.clonar(this.compra),o=p||this.compraItens;let s=0,u=0,a=0,c=y.totalDesconto||0,v=y.totalPercentualDesconto||0,b=y.valorFrete||0,f=y.valorSeguro||0,_=y.valorOutrasDespesas||0,l=0,C=0,h=0,w=0,r=0;this.erroFrete=!1,this.erroSeguro=!1,this.erroOutrasDespesas=!1;for(const g of o)s+=g.total,l+=g.valorBaseIcms||0,C+=g.valorIcms||0,h+=g.valorBaseIcmsSt||0,w+=g.valorIcmsSt||0,r+=g.valorIpi||0;i==="totalPercentualDesconto"&&(this.erroDesconto=!1,(v<0||v>100)&&(this.erroDesconto=!0),c=s*v/100),i==="totalDesconto"&&(this.erroDesconto=!1,(c<0||c>s)&&(this.erroDesconto=!0),v=c/s*100),b<0&&(this.erroFrete=!0),b=y.tipoFrete==="FOB"?b:0,f<0&&(this.erroSeguro=!0),f=y.tipoFrete==="FOB"?f:0,_<0&&(this.erroOutrasDespesas=!0),y.calcularTributacao||(l=0,C=0,h=0,w=0),y.totalComImposto||(r=0),u=s-c+b+f+_,a=u+r+w,y.valorBaseIcms=$utils.arredondar(l,2),y.valorIcms=$utils.arredondar(C),y.valorBaseIcmsSt=$utils.arredondar(h),y.valorIcmsSt=$utils.arredondar(w),y.valorIpi=$utils.arredondar(r),y.totalDesconto=$utils.arredondar(c),y.totalPercentualDesconto=$utils.arredondar(v),y.subTotalProduto=$utils.arredondar(s),y.totalProduto=$utils.arredondar(s)-$utils.arredondar(c),y.subTotal=$utils.arredondar(u),y.totalDocumento=$utils.arredondar(a),e||(this.compra=y)},limpaCampos(i){i.compra={},i.compraOriginal={},i.compraItens=[],i.compraItensOriginal=[],i.compraCondicoesDePagamento=[],i.compraCondicoesDePagamentoOriginal=[],i.compraTitulos=[],i.compraTitulosOriginal=[],i.compraMovimentacoes=[],i.compraMovimentacoesOriginal=[],i.compraDocumentoXml=[],i.compraDocumentoXmlOriginal=[],i.dataPrevistaEntrega="",i.horaPrevistaEntrega=""},async salvar(){this.compra.totalComImposto&&delete this.compra.totalComImposto;for(const i of this.compraItens)i.dataHoraFinalizado=this.compra.dataHoraFinalizado,i.status=this.compra.status;this.compra.id?await $db.hibrido.grava("documento",{atual:this.compra,original:this.compraOriginal}):this.compraOriginal.id&&await $db.hibrido.remove("documento",this.compraOriginal),await $db.hibrido.gravaLista("documentoItem",{atual:this.compraItens,original:this.compraItensOriginal}),await $db.hibrido.gravaLista("documentoCondicaoPagamento",{atual:this.compraCondicoesDePagamento,original:this.compraCondicoesDePagamentoOriginal}),await $db.hibrido.gravaLista("financeiroTitulo",{atual:this.compraTitulos,original:this.compraTitulosOriginal}),await $db.hibrido.gravaLista("financeiroMovimentacao",{atual:this.compraMovimentacoes,original:this.compraMovimentacoesOriginal}),await $db.hibrido.gravaLista("documentoXML",{atual:this.compraDocumentoXml,original:this.compraDocumentoXmlOriginal}),this.compra.totalComImposto=!0,this.calculaKardex()},async calculaKardex(){const i=$utils.logarIni("calculaKardex"),e=this.compraItens.map(({idItem:p})=>p).filter(Boolean);try{e.length&&await $utils.geeksApi({calculaKardex:{funcao:"9913E9FD-24A5-4C0A-9F1E-AACCDC7EAB9D",idsItem:e}})}catch(p){console.error(`Erro ao calcular Kardex
`,p)}$utils.logarFim(i,e.length)},async reabrir_click(){!await $q.dialogSimNao({title:"Reabertura",message:`Deseja reabrir o documento?<br/>${this.compra.naoGerarFinanceiro?"":"<strong>O Financeiro ser\xE1 apagado!</strong>"}`,html:!0})||await $tryLoading(async()=>{await this.retornarParaDigitacao(),await this.salvar(),await this.atualizar(),$q.notifyPositive("Documento reaberto para digita\xE7\xE3o!")},{mensagem:"Reabrindo..."})},async retornarParaDigitacao(){$utils.verificarErro(this.compra.status!=="Finalizado","N\xE3o \xE9 poss\xEDvel realizar esta opera\xE7\xE3o em documento n\xE3o finalizado.");const i=this.compraTitulos.filter(({dataPagamento:e})=>e);$utils.verificarErro(i.length,"N\xE3o \xE9 poss\xEDvel excluir o Financeiro. Parcelas provisionadas j\xE1 pagas!"),this.compra.dataHoraFinalizado="",this.compra.status="Digita\xE7\xE3o",this.compra.operacao==="Pedido de Compra"&&(this.compraTitulos=[],this.compraMovimentacoes=[])},async removerPagamento_click(i){try{this.compraCondicoesDePagamento=this.compraCondicoesDePagamento.filter(e=>e.id!==i.id),this.compraCondicoesDePagamento.sort((e,p)=>{let y=new Date(e.dataVencimento),o=new Date(p.dataVencimento);return y-o}),await this.atualizaValorTotalPagamento({condicao:i,acao:"remover"})}catch(e){console.log(e.message)}},async gerarCondicoesDePagamento_click(){var i;try{let e=this.compra.id,p=this.compra.condicaoPagamento,y=(i=this.compra.notaNumero)!=null?i:null;this.compra.naoGerarFinanceiro||await this.gerarParcelamento(e,p,y),this.compra.naoGerarFinanceiro&&(this.compraCondicoesDePagamento=[])}catch(e){console.log(e.message)}},async gerarParcelamento(i,e,p){this.compraCondicoesDePagamento=[];const y=$utils.clonar(this.compra),o=`${this.dataPrevistaEntrega} ${this.horaPrevistaEntrega||"00:00:00"}`,s=zt.formatDate(o)||y.dataHoraPrevisto,u=y.dataCompra||s||$utils.dataAtual(),a=e.split("/"),c=a.length,v=(y==null?void 0:y.freteSeparado)||0;let b=$utils.arredondar(y==null?void 0:y.totalDocumento,2);const f=((y==null?void 0:y.valorFrete)||0)+((y==null?void 0:y.valorSeguro)||0);if(v&&(y==null?void 0:y.tipoFrete)==="FOB"&&f>0){let C;s?C=new Date(s):(C=new Date(u),C.setDate(C.getDate()+Number(a[0]||0)));let h={id:$utils.uuid(),idDocumento:y==null?void 0:y.id,dataVencimento:zt.formatDate(C),valor:f,observacao:"Valor Frete + Seguro",freteSeparado:!0};this.compraCondicoesDePagamento.push(h),b-=f}let _=0,l=b/c;for(let C in a){let h=new Date(u);h.setDate(h.getDate()+Number(a[C]||0));let w={id:$utils.uuid(),idDocumento:y==null?void 0:y.id,dataVencimento:zt.formatDate(h),valor:l,observacao:""};this.compraCondicoesDePagamento.push(w),_+=l||0}b!==_&&(this.compraCondicoesDePagamento[0].valor+=(b||0)-(_||0)),this.valorTotalPagamento=v&&(y==null?void 0:y.tipoFrete)==="FOB"?b+f:b},async gerarFinanceiro(){var u,a;const i=await $db.financeiroPlanoConta.lePorConfig("financeiro.planocontas.comprageral"),e=[];for(const c of this.compraItens){if(c.idPlanoContaEstoque===i.id)continue;const v=(c.total||0)-(c.descontoTotalRateado||0),b=e.findIndex(({idPlanoContaEstoque:f})=>f===c.idPlanoContaEstoque);b!==-1?e[b].valor+=v:e.push({idPlanoContaEstoque:c.idPlanoContaEstoque,idPlanoContaDestino:"",valor:v,porcentagem:0})}for(const c of e)c.valor=$utils.arredondar(c.valor),c.porcentagem=$utils.arredondar(c.valor/this.compra.totalDocumento,4);const p=await $db.financeiroPlanoConta.lePorConfig("financeiro.planocontas.freteaquisicao"),y=this.compraTitulos.filter(({dataPagamento:c})=>c);$utils.verificarErro(y.length,"N\xE3o \xE9 poss\xEDvel regerar o Financeiro. Parcelas provisionadas j\xE1 pagas!");const o=zt.formatDate(new Date().setHours(0,0,0,0));this.compraTitulos=[];for(const c in this.compraCondicoesDePagamento){const v=this.compraCondicoesDePagamento[c],b=[v.observacao,this.compra.codigoDocumento?`Pedido de Compra: ${this.compra.codigoDocumento}`:"",this.compra.notaNumero?`Nota nro: ${this.compra.notaNumero}`:""].filter(Boolean).join(" | "),f={id:$utils.uuid(),dataEmissao:o,dataCompetencia:o,dataVencimento:zt.formatDate(new Date(v.dataVencimento).setHours(0,0,0,0)),dataVencimentoOriginal:zt.formatDate(new Date(v.dataVencimento).setHours(0,0,0,0)),valor:$utils.arredondar(v.valor,2),tipoJuros:"dia",valorMulta:0,percentualJuros:0,documentoTipo:this.compra.operacao,parcela:`${Number(c)+1}/${this.compraCondicoesDePagamento.length}`,descricao:this.compra.operacao,observacao:b,formaDePagamento:this.compra.operacao==="Pedido de Compra"?`Provis\xE3o Pedido - ${(u=this.compra.formaDePagamento)!=null?u:""}`:(a=this.compra.formaDePagamento)!=null?a:"",receberPagar:0,valorOriginal:$utils.arredondar(v.valor,2),documentoVinculado:1,valorTotal:$utils.arredondar(v.valor,2),valorARealizar:$utils.arredondar(v.valor,2),valorDesconto:0,percentualDesconto:0,idEmpresa:this.compra.idEmpresa,idContato:(v==null?void 0:v.freteSeparado)&&!!this.compra.idContatoTransportadora?this.compra.idContatoTransportadora:this.compra.idContato,idFinanceiroPlanoConta:v.observacao==="Valor Frete + Seguro"?p.id:i==null?void 0:i.id,documentoId:this.compra.id,idFinanceiroMovimentacaoAgrupamentoAutomatico:$utils.uuid(),cobrancaAtivo:1};this.compraTitulos.push(f)}const s=$utils.uuid();this.compraMovimentacoes=[];for(const c of e){const v={id:$utils.uuid(),idFinanceiroMovimentacaoN:s,idEmpresa:this.compra.idEmpresa,idFinanceiroPlanoConta:i.id,dataEmissao:o,valorCredito:this.compra.totalDocumento*c.porcentagem,valorDebito:0,descricao:i.descricao.trim(),observacao:"",automatico:0,liquidando:0,dataCompetencia:o,dataVencimento:o,dataMovimento:o,documentoTipo:this.compra.operacao,documentoId:this.compra.id};this.compraMovimentacoes.push(v);const b=await $db.financeiroPlanoConta.leCache({id:c.idPlanoContaEstoque}),f={id:$utils.uuid(),idFinanceiroMovimentacaoN:s,idEmpresa:this.compra.idEmpresa,idFinanceiroPlanoConta:c.idPlanoContaEstoque,dataEmissao:o,valorCredito:0,valorDebito:this.compra.totalDocumento*c.porcentagem,descricao:b.descricao.trim(),observacao:"",automatico:0,liquidando:0,dataCompetencia:o,dataVencimento:o,dataMovimento:o,documentoTipo:this.compra.operacao,documentoId:this.compra.id};this.compraMovimentacoes.push(f)}},async atualizaValorTotalPagamento({condicao:i,acao:e}){!i||e==="remover"&&(this.valorTotalPagamento=this.valorTotalPagamento-i.valor)},async ajustarPrevisaoEntrega(i){i==="alterar"&&(this.alterarPrevisaoEntrega=!0),i==="salvar"&&(await $tryLoading(async()=>{const e=`${this.dataPrevistaEntrega} ${this.horaPrevistaEntrega||"00:00:00"}`;$utils.verificarErro(!this.dataPrevistaEntrega&&this.horaPrevistaEntrega,"\xC9 necess\xE1rio preencher uma data em conjunto com a hora."),zt.formatDate(e)!==zt.formatDate(this.compra.dataHoraPrevisto)?(this.compra.dataHoraPrevisto=zt.formatDate(e)||"",await this.salvar(),await this.atualizar(),$q.notifyPositive("A previs\xE3o foi salva com sucesso")):$q.notifyPositive("N\xE3o h\xE1 dados alterados.")}),this.alterarPrevisaoEntrega=!1)},dialogImprimirEtiquetas(i,e){this.$emit("dialogImprimirEtiquetas",{acao:i,item:e})}}},He={class:"row items-center"},Ze={class:"col-auto"},Xe={class:"col-auto"},We={class:"col-auto"};function Ge(i,e,p,y,o,s){const u=gt("g-label"),a=gt("g-col"),c=gt("Badge"),v=gt("BadgeCopiarUid"),b=gt("g-row"),f=gt("avatar"),_=gt("campo"),l=gt("SeletorItem"),C=gt("ModalEditarProdutoCompras"),h=gt("PromptItemV2"),w=Ee("mask");return $(),_t(St,null,[t($t,{modelValue:i.visivel,"onUpdate:modelValue":e[33]||(e[33]=r=>i.visivel=r),persistent:"",maximized:"",onKeyup:be(s.fechar,["esc"])},{default:n(()=>[t(Ht,{view:"hHh lpR lFr",container:"",class:"bg-light"},{default:n(()=>[t(Zt,null,{default:n(()=>[t(Nt,null,{default:n(()=>[t(ut,{onClick:s.fechar,icon:"arrow_back",flat:"",round:"",dense:""},null,8,["onClick"]),t(Rt,null,{default:n(()=>[A(tt(i.compra.operacao),1)]),_:1}),vt(t(ut,{onClick:s.salvar_click,label:"Salvar",color:"white","text-color":"primary",unelevated:"",class:"q-ml-sm"},null,8,["onClick"]),[[xt,i.compra.status==="Digita\xE7\xE3o"]])]),_:1})]),_:1}),t(Xt,{class:"u-container"},{default:n(()=>[t(Wt,null,{default:n(()=>[t(b,{gutter:"md",mg:"md",bg:"bg-white"},{default:n(()=>[t(a,{col:"12 sm12 md6"},{default:n(()=>[t(b,{items:"center",justify:"end",class:"hideondesktop"},{default:n(()=>[t(a,{col:"xs-shrink",order:"1 sm0"},{default:n(()=>[vt(t(u,{text:"caption",icon:"mdi-calendar-today sm tertiary left",tip:`Emitido \xE1s ${i.$filters.hora(i.compra.dataHoraEmissao)}`},{default:n(()=>[A(tt(i.$filters.data(i.compra.dataHoraEmissao)),1)]),_:1},8,["tip"]),[[xt,i.compra.dataHoraEmissao]])]),_:1}),t(a,{col:"xs-shrink",order:"1 sm0"},{default:n(()=>[vt(t(u,{text:"caption",icon:"mdi-calendar-today sm tertiary left",tip:`Finalizado \xE1s ${i.$filters.hora(i.compra.dataHoraFinalizado)}`},{default:n(()=>[A(tt(i.$filters.data(i.compra.dataHoraFinalizado)),1)]),_:1},8,["tip"]),[[xt,i.compra.dataHoraFinalizado]])]),_:1}),t(a,{col:"xs12 sm-shrink",order:"0 sm1",text:"right"},{default:n(()=>[t(c,{cor:i.compra.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:i.compra.status!=="Digita\xE7\xE3o",class:"q-ml-sm"},{default:n(()=>[A(tt(i.compra.status),1)]),_:1},8,["cor","escuro"]),t(v,{id:i.compra.id,numero:i.compra.numero,cor:"positive",class:"q-ml-sm"},null,8,["id","numero"])]),_:1})]),_:1}),t(b,null,{default:n(()=>[t(a,{col:"12 sm6"},{default:n(()=>[t(b,null,{default:n(()=>[t(a,{col:"xs-shrink"},{default:n(()=>{var r,g;return[t(f,{imagem:(r=i.contatos[i.compra.idContato])==null?void 0:r.imagem,rotulo:(g=i.contatos[i.compra.idContato])==null?void 0:g.apelido,tamanho:"50"},null,8,["imagem","rotulo"])]}),_:1}),t(a,{col:"xs"},{default:n(()=>{var r;return[t(_,{modelValue:(r=i.contatos[i.compra.idContato])==null?void 0:r.apelido,"somente-leitura":"",after:[{icon:"edit",handler(){s.abrirModalFornecedor()}}],disable:i.compra.status!=="Digita\xE7\xE3o",rotulo:"Fornecedor",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","after","disable"])]}),_:1})]),_:1})]),_:1}),t(a,{col:"12 sm6"},{default:n(()=>{var r;return[t(_,{modelValue:(r=i.contatos[i.compra.idContatoVendedor])==null?void 0:r.apelido,"somente-leitura":"",disable:i.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){s.abrirModalVendedor()}}],rotulo:"Vendedor",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]}),_:1}),t(a,{col:"12 sm6"},{default:n(()=>{var r;return[t(_,{modelValue:(r=i.contatos[i.compra.idEmpresa])==null?void 0:r.apelido,"somente-leitura":"",after:[{icon:"edit",handler(){s.abrirModalEmpresa()}}],disable:i.compra.status!=="Digita\xE7\xE3o",rotulo:"Empresa",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","after","disable"])]}),_:1}),t(a,{col:"12 sm6"},{default:n(()=>{var r;return[t(_,{modelValue:(r=i.contatos[i.compra.idContatoComprador])==null?void 0:r.apelido,"somente-leitura":"",disable:i.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){s.abrirModalComprador()}}],rotulo:"Comprador",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]}),_:1}),t(a,{col:"12 sm6"},{default:n(()=>{var r;return[t(_,{modelValue:(r=i.contatos[i.compra.idContatoTransportadora])==null?void 0:r.apelido,"somente-leitura":"",disable:i.compra.status!=="Digita\xE7\xE3o",after:[{icon:"edit",handler(){s.abrirModalTransportador()}}],rotulo:"Transportadora",dense:"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable","after"])]}),_:1}),t(a,{col:"12 sm6"},{default:n(()=>[t(b,null,{default:n(()=>[t(a,{col:"7"},{default:n(()=>[t(ie,{modelValue:i.dataPrevistaEntrega,"onUpdate:modelValue":e[0]||(e[0]=r=>i.dataPrevistaEntrega=r),disable:!this.alterarPrevisaoEntrega&&this.compra.status!=="Digita\xE7\xE3o",type:"date",label:"Data Prevista de Entrega",clearable:"",dense:"","stack-label":"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable"])]),_:1}),t(a,{col:"5"},{default:n(()=>[t(ie,{modelValue:i.horaPrevistaEntrega,"onUpdate:modelValue":e[1]||(e[1]=r=>i.horaPrevistaEntrega=r),disable:!this.alterarPrevisaoEntrega&&this.compra.status!=="Digita\xE7\xE3o",type:"time",label:"Hora Prevista de Entrega",clearable:"",dense:"","stack-label":"",borderless:"",class:"q-mb-sm"},null,8,["modelValue","disable"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(a,{col:"12 sm12 md6"},{default:n(()=>[t(b,{justify:"end",items:"center",text:"right",class:"hideonmobile"},{default:n(()=>[t(a,{col:"12"},{default:n(()=>[t(b,{justify:"end",items:"center"},{default:n(()=>[t(c,{cor:i.compra.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:i.compra.status!=="Digita\xE7\xE3o"},{default:n(()=>[A(tt(i.compra.status),1)]),_:1},8,["cor","escuro"]),t(v,{id:i.compra.id,numero:i.compra.numero,cor:"positive",class:"q-ml-sm"},null,8,["id","numero"]),t(ut,{color:"tertiary",flat:"",icon:"more_vert",round:""},{default:n(()=>[t(Lt,null,{default:n(()=>[vt(($(),Y(Pt,{link:"",separator:""},{default:n(()=>[i.alterarPrevisaoEntrega?($(),Y(mt,{key:1,clickable:"",onClick:e[3]||(e[3]=r=>s.ajustarPrevisaoEntrega("salvar"))},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"local_shipping"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>e[36]||(e[36]=[A("Salvar Previs\xE3o de Entrega")])),_:1})]),_:1})]),_:1})):($(),Y(mt,{key:0,disable:i.compra.status==="Digita\xE7\xE3o",clickable:"",onClick:e[2]||(e[2]=r=>s.ajustarPrevisaoEntrega("alterar"))},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"local_shipping"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>e[35]||(e[35]=[A("Alterar Previs\xE3o de Entrega")])),_:1})]),_:1})]),_:1},8,["disable"])),t(mt,{onClick:e[4]||(e[4]=r=>s.dialogImprimirEtiquetas("adicionar",i.compra)),clickable:""},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"print"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>e[37]||(e[37]=[A(" Adicionar Etiquetas ")])),_:1})]),_:1})]),_:1}),t(mt,{onClick:e[5]||(e[5]=r=>s.dialogImprimirEtiquetas("impressao",i.compra)),clickable:""},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"print"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>e[38]||(e[38]=[A(" Imprimir Etiquetas ")])),_:1})]),_:1})]),_:1})]),_:1})),[[Dt]])]),_:1})]),_:1})]),_:1})]),_:1}),t(a,{col:"shrink"},{default:n(()=>[vt(t(u,{text:"caption",icon:"mdi-calendar-today sm tertiary left",tip:`Emitido \xE1s ${i.$filters.hora(i.compra.dataHoraEmissao)}`},{default:n(()=>[A(tt(i.$filters.data(i.compra.dataHoraEmissao)),1)]),_:1},8,["tip"]),[[xt,i.compra.dataHoraEmissao]])]),_:1}),t(a,{col:"shrink"},{default:n(()=>[vt(t(u,{text:"caption",icon:"mdi-calendar sm tertiary left",tip:`Finalizado \xE1s ${i.$filters.hora(i.compra.dataHoraFinalizado)}`},{default:n(()=>[A(tt(i.$filters.data(i.compra.dataHoraFinalizado)),1)]),_:1},8,["tip"]),[[xt,i.compra.dataHoraFinalizado]])]),_:1})]),_:1}),t(b,null,{default:n(()=>[t(a,null,{default:n(()=>[t(_,{modelValue:i.compra.observacao,"onUpdate:modelValue":e[6]||(e[6]=r=>i.compra.observacao=r),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",tipo:"textoArea",rotulo:"Observa\xE7\xE3o",rows:"4"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})]),_:1})]),_:1}),t(b,{gutter:"md",mg:"md",bg:"bg-white"},{default:n(()=>[i.exibeInfNota?($(),Y(De,{key:0,"default-opened":i.compra.notaNumero>0||i.documentoNovo,"header-class":"q-px-sm",class:"notaEntrada g-col col-12"},{header:n(()=>[t(K,null,{default:n(()=>[t(u,{text:"sub1 medium",icon:"mdi-file-replace sm tertiary left"},{default:n(()=>e[39]||(e[39]=[A("Nota de Entrada")])),_:1})]),_:1})]),default:n(()=>[t(a,{col:"12"},{default:n(()=>[t(b,null,{default:n(()=>[t(a,{col:"12 sm6 md3"},{default:n(()=>[vt(t(_,{modelValue:i.compra.notaNumero,"onUpdate:modelValue":e[7]||(e[7]=r=>i.compra.notaNumero=r),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Numero",dense:""},null,8,["modelValue","somente-leitura"]),[[w,"##########"]])]),_:1}),t(a,{col:"12 sm6 md3"},{default:n(()=>[t(_,{modelValue:i.compra.notaSerie,"onUpdate:modelValue":e[8]||(e[8]=r=>i.compra.notaSerie=r),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Serie",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),t(a,{col:"12 sm6 md3"},{default:n(()=>[t(_,{modelValue:i.compra.naturezaOperacao,"onUpdate:modelValue":e[9]||(e[9]=r=>i.compra.naturezaOperacao=r),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Natureza da Opera\xE7\xE3o",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),t(a,{col:"12 sm6 md3"},{default:n(()=>[t(_,{modelValue:i.compra.dataCompra,"onUpdate:modelValue":e[10]||(e[10]=r=>i.compra.dataCompra=r),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Data compra",tipo:"data",dense:""},null,8,["modelValue","somente-leitura"])]),_:1}),t(a,{col:"12"},{default:n(()=>[t(_,{modelValue:i.compra.chaveAcesso,"onUpdate:modelValue":e[11]||(e[11]=r=>i.compra.chaveAcesso=r),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Chave",dense:""},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1})]),_:1})]),_:1},8,["default-opened"])):it("",!0)]),_:1}),t(b,{gutter:"md",mg:"md",bg:"bg-white"},{default:n(()=>[t(a,{col:"12"},{default:n(()=>[t(u,{text:"sub1 medium",icon:"shopping_cart sm tertiary left"},{default:n(()=>[e[40]||(e[40]=A("Carrinho ")),t(ut,{onClick:e[12]||(e[12]=r=>s.adicionarItem()),disable:i.compra.status!=="Digita\xE7\xE3o",icon:"add",label:"Produto",size:"md",color:"primary",flat:"",dense:"",class:"float-right q-px-sm"},null,8,["disable"])]),_:1})]),_:1}),($(!0),_t(St,null,Tt(i.compraItens,(r,g)=>($(),Y(a,{col:"12",key:g},{default:n(()=>[t(Pt,{class:"full-width"},{default:n(()=>[t(mt,{class:"q-px-none"},{default:n(()=>{var S;return[t(K,{avatar:"",class:"col-auto"},{default:n(()=>{var D;return[t(f,{imagem:(D=i.produtos[r.idItem])==null?void 0:D.imagem,rotulo:r.descricaoItem,tamanho:"50"},null,8,["imagem","rotulo"])]}),_:2},1024),t(K,{class:"q-px-none"},{default:n(()=>[t(l,{modelValue:r.idItem,"onUpdate:modelValue":D=>r.idItem=D,rotulo:"Produto at\xF4mico",onSelecionarItens:s.trocarItens,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onSelecionarItens","somente-leitura"]),t(dt,{caption:""},{default:n(()=>{var D,V;return[A(tt((V=(D=i.produtos[r.idItem])==null?void 0:D.marca)!=null?V:""),1)]}),_:2},1024)]),_:2},1024),vt(t(K,{avatar:""},{default:n(()=>[t(c,{denso:""},{default:n(()=>{var D,V;return[A(tt((V=(D=i.produtos[r.idItem])==null?void 0:D.referencia)!=null?V:""),1)]}),_:2},1024)]),_:2},1536),[[xt,(S=i.produtos[r.idItem])==null?void 0:S.referencia]]),t(K,{avatar:""},{default:n(()=>[ft("div",He,[ft("div",Ze,[t(ut,{color:"primary",dense:"",flat:"",icon:"edit",round:"",onClick:D=>s.editarProduto(r),disable:i.compra.status!=="Digita\xE7\xE3o"},null,8,["onClick","disable"])]),ft("div",Xe,[t(ut,{color:"tertiary",dense:"",flat:"",icon:"delete",round:"",onClick:D=>s.removerItem(r),disable:i.compra.status!=="Digita\xE7\xE3o"},{default:n(()=>[t(Vt,{anchor:"bottom middle",self:"center middle"},{default:n(()=>e[41]||(e[41]=[A("Remover Item")])),_:1})]),_:2},1032,["onClick","disable"])]),ft("div",We,[t(ut,{color:"tertiary",dense:"",flat:"",icon:"more_vert",round:"",disable:i.compra.status!=="Digita\xE7\xE3o"},{default:n(()=>[t(Lt,null,{default:n(()=>[vt(($(),Y(Pt,{link:"",separator:""},{default:n(()=>[i.compra.status==="Digita\xE7\xE3o"?($(),_t(St,{key:0},[($(!0),_t(St,null,Tt(i.comprasMigrar,D=>($(),Y(mt,{key:D.id,clickable:"",onClick:V=>s.migrarParaOutraCompra(r,D)},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"mdi-folder-move"})]),_:1}),t(K,null,{default:n(()=>[A(tt("Migrar para Compra #"+(D.numero||D.id.slice(-6))),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),t(mt,{clickable:"",onClick:D=>s.migrarParaOutraCompra(r)},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"mdi-folder-move"})]),_:1}),t(K,null,{default:n(()=>e[42]||(e[42]=[A("Migrar para nova Compra")])),_:1})]),_:2},1032,["onClick"])],64)):it("",!0)]),_:2},1024)),[[Dt]])]),_:2},1024)]),_:2},1032,["disable"])])])]),_:2},1024)]}),_:2},1024)]),_:2},1024),t(b,null,{default:n(()=>[t(a,{col:"4 md"},{default:n(()=>[t(_,{dense:"",align:"left",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"",rotulo:"Valor do produto",modelValue:r.valorItem,"onUpdate:modelValue":S=>r.valorItem=S,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",onBlur:S=>s.calcularTotaisItem(g,"valorItem")},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),_:2},1024),t(a,{col:"4 md"},{default:n(()=>[t(b,{items:"center"},{default:n(()=>[t(a,{col:"shrink"},{default:n(()=>[t(ct,{name:"mdi-minus",color:"primary"})]),_:1}),t(a,{col:"xs"},{default:n(()=>[t(_,{dense:"",opcoes:{maximumValue:100},tipo:"decimal",decimals:"2",rotulo:"Desconto percentual",modelValue:r.descontoPercentualItem,"onUpdate:modelValue":S=>r.descontoPercentualItem=S,outlined:"",suffix:"%","somente-leitura":i.compra.status!=="Digita\xE7\xE3o",onBlur:S=>s.calcularTotaisItem(g,"descontoPercentualItem")},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),_:2},1024)]),_:2},1024)]),_:2},1024),t(a,{col:"4 md"},{default:n(()=>[t(_,{dense:"",tipo:"decimal",modelValue:r.descontoItem,"onUpdate:modelValue":S=>r.descontoItem=S,decimals:"4",zerosDireita:"2",outlined:"",rotulo:"Desconto em reais",prefix:"R$",onBlur:S=>s.calcularTotaisItem(g,"descontoItem"),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","somente-leitura"])]),_:2},1024),t(a,{col:"6 md"},{default:n(()=>[t(b,{items:"center"},{default:n(()=>[t(a,{col:"shrink",class:"hideonmobile"},{default:n(()=>[t(ct,{name:"mdi-equal",color:"primary"})]),_:1}),t(a,{col:"xs"},{default:n(()=>[t(_,{dense:"",outlined:"",opcoes:{maximumValue:10,minimumValue:0},rotulo:"Subtotal",tipo:"decimal",decimals:"4",zerosDireita:"2",modelValue:r.subTotal,"onUpdate:modelValue":S=>r.subTotal=S,onBlur:S=>s.calcularTotaisItem(g,"subTotal"),"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","somente-leitura"])]),_:2},1024)]),_:2},1024)]),_:2},1024),t(a,{col:"6 md"},{default:n(()=>[t(b,{items:"center"},{default:n(()=>[t(a,{col:"shrink"},{default:n(()=>[t(ct,{name:"mdi-close",color:"primary"})]),_:1}),t(a,{col:"xs"},{default:n(()=>[t(_,{dense:"",max:"100",min:"0",outlined:"",modelValue:r.quantidade,"onUpdate:modelValue":S=>r.quantidade=S,decimals:"4",zerosDireita:"0",tipo:"quantidade",onBlur:S=>s.calcularTotaisItem(g),disable:i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","onBlur","disable"]),t(Vt,{anchor:"bottom middle",self:"center middle"},{default:n(()=>e[43]||(e[43]=[A("Quantidade")])),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1024),t(a,{col:"12 md"},{default:n(()=>[t(b,{items:"center"},{default:n(()=>[t(a,{col:"shrink",class:"hideonmobile"},{default:n(()=>[t(ct,{name:"mdi-equal",color:"primary"})]),_:1}),t(a,{col:"xs"},{default:n(()=>[t(_,{dense:"",tipo:"decimal",decimals:"2",rotulo:"Total","somente-leitura":"",modelValue:r.total,"onUpdate:modelValue":S=>r.total=S,outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),t(a,{col:"12"},{default:n(()=>[t(b,{gutter:"md",mg:"md-y",justify:"end",items:"center",bg:"bg-light","rounded-borders":"","min-height":"49px"},{default:n(()=>[t(a,{col:"3 sm2 md-shrink",text:"bold"},{default:n(()=>e[44]||(e[44]=[A(" Calcular ")])),_:1}),t(a,{col:"9 sm10 md"},{default:n(()=>[t(Mt,{modelValue:i.compra.calcularTributacao,"onUpdate:modelValue":[e[13]||(e[13]=r=>i.compra.calcularTributacao=r),s.calcularTotais],"checked-icon":"check",color:"green","unchecked-icon":"clear",disable:i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),t(a,{col:"6 md-shrink"},{default:n(()=>e[45]||(e[45]=[A(" Base ICMS ")])),_:1}),t(a,{col:"6 md",text:"right"},{default:n(()=>[t(_,{dense:"",outlined:"",decimals:"2",zerosDireita:"2",tipo:"decimal",modelValue:i.compra.valorBaseIcms,"onUpdate:modelValue":e[14]||(e[14]=r=>i.compra.valorBaseIcms=r),"somente-leitura":!!i.compra.calcularTributacao||i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somente-leitura"])]),_:1}),t(a,{col:"6 md-shrink"},{default:n(()=>e[46]||(e[46]=[A(" Valor ICMS ")])),_:1}),t(a,{col:"6 md",text:"right"},{default:n(()=>[t(_,{dense:"",outlined:"",modelValue:i.compra.valorIcms,"onUpdate:modelValue":e[15]||(e[15]=r=>i.compra.valorIcms=r),decimals:"2",zerosDireita:"2",tipo:"decimal","somente-leitura":!!i.compra.calcularTributacao||i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somente-leitura"])]),_:1}),t(a,{col:"6 md-shrink"},{default:n(()=>e[47]||(e[47]=[A(" Base ICMS ST ")])),_:1}),t(a,{col:"6 md",text:"right"},{default:n(()=>[t(_,{dense:"",outlined:"",modelValue:i.compra.valorBaseIcmsSt,"onUpdate:modelValue":e[16]||(e[16]=r=>i.compra.valorBaseIcmsSt=r),decimals:"2",zerosDireita:"2",tipo:"decimal","somente-leitura":!!i.compra.calcularTributacao||i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somente-leitura"])]),_:1}),t(a,{col:"6 md-shrink"},{default:n(()=>e[48]||(e[48]=[A(" ICMS ST ")])),_:1}),t(a,{col:"6 md",text:"right"},{default:n(()=>[t(_,{dense:"",outlined:"",modelValue:i.compra.valorIcmsSt,"onUpdate:modelValue":e[17]||(e[17]=r=>i.compra.valorIcmsSt=r),decimals:"2",zerosDireita:"2",tipo:"decimal","somente-leitura":!!i.compra.calcularTributacao||i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","somente-leitura"])]),_:1})]),_:1}),t(b,{mg:"lg-t",justify:"end"},{default:n(()=>[t(a,{col:"xs12 sm8 md4"},{default:n(()=>[t(b,{items:"center"},{default:n(()=>[t(a,{col:"3",text:"bold"},{default:n(()=>e[49]||(e[49]=[A(" Subtotal ")])),_:1}),t(a,{col:"xs",text:"right bold"},{default:n(()=>[A(tt(i.$filters.numero(i.compra.subTotalProduto,2)),1)]),_:1})]),_:1}),t(ue,{class:"q-mb-md q-mt-xs"}),t(b,{items:"center"},{default:n(()=>[t(a,{col:"xs3"},{default:n(()=>e[50]||(e[50]=[A(" Desconto ")])),_:1}),t(a,{col:"xs"},{default:n(()=>[t(_,{tipo:"decimal",decimals:"2",modelValue:i.compra.totalPercentualDesconto,"onUpdate:modelValue":e[18]||(e[18]=r=>i.compra.totalPercentualDesconto=r),onBlur:e[19]||(e[19]=r=>s.calcularTotais("totalPercentualDesconto")),suffix:"%",error:i.erroDesconto,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","error","somente-leitura"])]),_:1}),t(a,{col:"xs"},{default:n(()=>[t(_,{tipo:"decimal",decimals:"2",modelValue:i.compra.totalDesconto,"onUpdate:modelValue":e[20]||(e[20]=r=>i.compra.totalDesconto=r),onBlur:e[21]||(e[21]=r=>s.calcularTotais("totalDesconto")),error:i.erroDesconto,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","error","somente-leitura"])]),_:1})]),_:1}),t(b,{items:"center"},{default:n(()=>[t(a,{col:"xs3"},{default:n(()=>e[51]||(e[51]=[A(" Frete ")])),_:1}),t(a,{col:"xs"},{default:n(()=>[t(he,{class:"q-mr-md",label:"CIF",val:"CIF",modelValue:i.compra.tipoFrete,"onUpdate:modelValue":[e[22]||(e[22]=r=>i.compra.tipoFrete=r),s.calcularTotais],dense:"",disable:i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"]),t(he,{label:"FOB",val:"FOB",modelValue:i.compra.tipoFrete,"onUpdate:modelValue":[e[23]||(e[23]=r=>i.compra.tipoFrete=r),s.calcularTotais],dense:"",disable:i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),t(a,{col:"xs"},{default:n(()=>[t(_,{tipo:"decimal",decimals:"2",modelValue:i.compra.valorFrete,"onUpdate:modelValue":e[24]||(e[24]=r=>i.compra.valorFrete=r),onBlur:s.calcularTotais,error:i.erroFrete,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),t(b,{items:"center"},{default:n(()=>[t(a,{col:"xs3"},{default:n(()=>e[52]||(e[52]=[A(" Seguro ")])),_:1}),t(a,{col:"xs"},{default:n(()=>[t(_,{tipo:"decimal",decimals:"2",modelValue:i.compra.valorSeguro,"onUpdate:modelValue":e[25]||(e[25]=r=>i.compra.valorSeguro=r),onBlur:s.calcularTotais,error:i.erroSeguro,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),t(b,{items:"center"},{default:n(()=>[t(a,{col:"xs5"},{default:n(()=>e[53]||(e[53]=[A(" Outras despesas ")])),_:1}),t(a,{col:"xs"},{default:n(()=>[t(_,{tipo:"decimal",decimals:"2",modelValue:i.compra.valorOutrasDespesas,"onUpdate:modelValue":e[26]||(e[26]=r=>i.compra.valorOutrasDespesas=r),onBlur:s.calcularTotais,error:i.erroOutrasDespesas,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"},null,8,["modelValue","onBlur","error","somente-leitura"])]),_:1})]),_:1}),t(ue,{class:"q-mt-md q-mb-xs"}),t(b,{items:"center"},{default:n(()=>[t(a,{col:"xs4",text:"bold"},{default:n(()=>e[54]||(e[54]=[A(" Total ")])),_:1}),t(a,{col:"xs",text:"right bold"},{default:n(()=>[A(tt(i.$filters.numero(i.compra.totalProduto,2)),1)]),_:1})]),_:1}),i.compra.totalComImposto?($(),Y(b,{key:0,items:"center"},{default:n(()=>[t(a,{col:"xs4",text:"bold"},{default:n(()=>e[55]||(e[55]=[A(" Total IPI ")])),_:1}),t(a,{col:"xs",text:"right bold"},{default:n(()=>[A(tt(i.$filters.numero(i.compra.valorIpi,2)),1)]),_:1})]),_:1})):it("",!0),t(b,{items:"center"},{default:n(()=>[t(a,{col:"xs5",text:"bold"},{default:n(()=>e[56]||(e[56]=[A(" Total c/ Impostos ")])),_:1}),t(a,{col:"xs-shrink"},{default:n(()=>[t(Mt,{disable:i.compra.status!=="Digita\xE7\xE3o",modelValue:i.compra.totalComImposto,"onUpdate:modelValue":[e[27]||(e[27]=r=>i.compra.totalComImposto=r),s.calcularTotais],"checked-icon":"check",color:"green","unchecked-icon":"clear"},null,8,["disable","modelValue","onUpdate:modelValue"])]),_:1}),t(a,{col:"xs",text:"right bold"},{default:n(()=>[A(tt(i.$filters.numero(i.compra.totalDocumento,2)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(b,{gutter:"md",mg:"md",bg:"bg-white"},{default:n(()=>[t(a,{col:"12"},{default:n(()=>[t(u,{text:"sub1 medium",icon:"credit_card sm tertiary left"},{default:n(()=>e[57]||(e[57]=[A("Faturar")])),_:1})]),_:1}),t(a,{col:"12"},{default:n(()=>[t(_,{modelValue:i.compra.observacaoFaturamento,"onUpdate:modelValue":e[28]||(e[28]=r=>i.compra.observacaoFaturamento=r),tipo:"textoArea",rotulo:"Observa\xE7\xE3o faturamento",rows:"5"},null,8,["modelValue"])]),_:1}),t(a,{col:"12"},{default:n(()=>[t(oe,{ref:"formAdicionarPagamento"},{default:n(()=>[t(b,{mg:"md-y",items:"center"},{default:n(()=>[t(a,{col:"12 sm6 md"},{default:n(()=>[t(_,{modelValue:i.compra.formaDePagamento,"onUpdate:modelValue":e[29]||(e[29]=r=>i.compra.formaDePagamento=r),rules:i.formaPagamentoRules,ajuda:"Exemplo: Boleto","somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Forma de pagamento"},null,8,["modelValue","rules","somente-leitura"])]),_:1}),t(a,{col:"12 sm6 md"},{default:n(()=>[t(_,{modelValue:i.compra.condicaoPagamento,"onUpdate:modelValue":e[30]||(e[30]=r=>i.compra.condicaoPagamento=r),rules:i.condicaoPagamentoRules,ajuda:"Exemplo: 28/56/64","somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Cond. Pag",tipo:"numero"},null,8,["modelValue","rules","somente-leitura"])]),_:1}),t(a,{col:"12 sm4 md",text:"bold",class:"q-my-sm"},{default:n(()=>[e[58]||(e[58]=A(" Frete Separado ")),t(Mt,{modelValue:i.compra.freteSeparado,"onUpdate:modelValue":[e[31]||(e[31]=r=>i.compra.freteSeparado=r),s.calcularTotais],disable:i.compra.status!=="Digita\xE7\xE3o",dense:"",class:"q-ml-sm"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),t(a,{col:"12 sm4 md",text:"bold",class:"q-my-sm"},{default:n(()=>[e[59]||(e[59]=A(" N\xE3o gerar financeiro ")),t(Mt,{modelValue:i.compra.naoGerarFinanceiro,"onUpdate:modelValue":[e[32]||(e[32]=r=>i.compra.naoGerarFinanceiro=r),s.calcularTotais],disable:i.compra.status!=="Digita\xE7\xE3o",dense:"",class:"q-ml-sm"},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:1}),t(a,{col:"12 sm4 md",text:"center"},{default:n(()=>[t(ut,{onClick:s.gerarCondicoesDePagamento_click,disable:i.compra.status!=="Digita\xE7\xE3o",color:"positive",icon:"add",label:"Forma de pagamento",outline:"",size:"sm"},null,8,["onClick","disable"])]),_:1})]),_:1})]),_:1},512)]),_:1}),t(a,{col:"12"},{default:n(()=>[vt(t(u,{text:"sub1 medium"},{default:n(()=>e[60]||(e[60]=[A("Condi\xE7\xF5es de pagamento")])),_:1},512),[[xt,i.compraCondicoesDePagamento.length>0]]),($(!0),_t(St,null,Tt(i.compraCondicoesDePagamento,r=>($(),Y(Pt,{highlight:"",class:"q-pa-none",key:r.id},{default:n(()=>[t(b,{gutter:"md",mg:"sm-y",items:"center",bordered:"","rounded-borders":""},{default:n(()=>[t(a,{col:"xs6 md-shrink"},{default:n(()=>[t(_,{modelValue:r.dataVencimento,"onUpdate:modelValue":g=>r.dataVencimento=g,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",rotulo:"Data vencimento",tipo:"data",dense:""},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),t(a,{col:"xs6 md2"},{default:n(()=>[t(_,{modelValue:r.valor,"onUpdate:modelValue":g=>r.valor=g,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o",align:"left",rotulo:"Valor",decimals:"2",zerosDireita:"2",tipo:"decimal"},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),t(a,{col:"xs-grow"},{default:n(()=>[t(_,{modelValue:r.observacao,"onUpdate:modelValue":g=>r.observacao=g,"somente-leitura":i.compra.status!=="Digita\xE7\xE3o"||r.observacao==="Valor Frete + Seguro",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024),t(a,{col:"xs-shrink",text:"right"},{default:n(()=>[t(ut,{onClick:g=>s.removerPagamento_click(r),icon:"delete",round:"",dense:"",flat:"",color:"tertiary",disable:i.compra.status!=="Digita\xE7\xE3o"},null,8,["onClick","disable"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),i.valorTotalPagamento>0?($(),Y(b,{key:0,mg:"sm-t"},{default:n(()=>[t(a,{col:"xs-shrink",text:"bold"},{default:n(()=>[A(" Valor total: "+tt(i.$filters.numero(i.valorTotalPagamento,2)),1)]),_:1})]),_:1})):it("",!0)]),_:1})]),_:1}),i.$db.usuario.desenvolvedor()?($(),Y(b,{key:0,gutter:"md",mg:"md",bg:"bg-yellow"},{default:n(()=>[t(a,{col:"12"},{default:n(()=>[t(u,{text:"sub1 medium",icon:"credit_card sm tertiary left"},{default:n(()=>e[61]||(e[61]=[A("Contabilidade (apenas desenvolvedor)")])),_:1})]),_:1}),t(a,{col:"12"},{default:n(()=>[i.compraTitulos.length?($(),Y(u,{key:0,text:"sub1 medium"},{default:n(()=>e[62]||(e[62]=[A("Titulos")])),_:1})):it("",!0),t(Pt,{highlight:"",class:"q-pa-none"},{default:n(()=>[($(!0),_t(St,null,Tt(i.compraTitulos,r=>($(),Y(b,{key:r.id,items:"center"},{default:n(()=>[t(a,{col:"sm2"},{default:n(()=>[t(_,{modelValue:r.dataVencimento,"somente-leitura":"",rotulo:"Data vencimento",tipo:"data",dense:""},null,8,["modelValue"])]),_:2},1024),t(a,{col:"sm2"},{default:n(()=>[t(_,{modelValue:r.dataPagamento||"A pagar","somente-leitura":"",rotulo:"Data pagamento",tipo:r.dataPagamento?"data":"texto",dense:""},null,8,["modelValue","tipo"])]),_:2},1024),t(a,{col:"sm2"},{default:n(()=>[t(_,{modelValue:r.valor,"somente-leitura":"",align:"left",rotulo:"Valor",decimals:"2",tipo:"decimal"},null,8,["modelValue"])]),_:2},1024),t(a,{col:"sm2"},{default:n(()=>[t(_,{modelValue:r.parcela,"somente-leitura":"",align:"left",rotulo:"Parcela"},null,8,["modelValue"])]),_:2},1024),t(a,{col:"sm2"},{default:n(()=>[t(_,{modelValue:r.formaDePagamento,"somente-leitura":"",rotulo:"Forma de pagamento"},null,8,["modelValue"])]),_:2},1024),t(a,{col:"sm2"},{default:n(()=>[t(_,{modelValue:r.observacao,"somente-leitura":"",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(a,{col:"12"},{default:n(()=>[i.compraMovimentacoes.length?($(),Y(u,{key:0,text:"sub1 medium"},{default:n(()=>e[63]||(e[63]=[A("Movimenta\xE7\xF4es")])),_:1})):it("",!0),t(Pt,{highlight:"",class:"q-pa-none"},{default:n(()=>[($(!0),_t(St,null,Tt(i.compraMovimentacoes,r=>($(),Y(b,{key:r.id,gutter:"sm",mg:"sm-y",items:"center"},{default:n(()=>[t(a,{col:"xs-grow"},{default:n(()=>[t(_,{modelValue:r.descricao,"somente-leitura":"",rotulo:"Descri\xE7\xE3o"},null,8,["modelValue"])]),_:2},1024),r.valorCredito?($(),Y(a,{key:0,col:"xs6 md2"},{default:n(()=>[t(_,{modelValue:r.valorCredito,"somente-leitura":"",align:"left",rotulo:"Valor Credito",decimals:"2",tipo:"decimal"},null,8,["modelValue"])]),_:2},1024)):it("",!0),r.valorDebito?($(),Y(a,{key:1,col:"xs6 md2"},{default:n(()=>[t(_,{modelValue:r.valorDebito,"somente-leitura":"",align:"left",rotulo:"Valor Debito",decimals:"2",tipo:"decimal"},null,8,["modelValue"])]),_:2},1024)):it("",!0),t(a,{col:"xs6 md-shrink"},{default:n(()=>[t(_,{modelValue:r.dataCompetencia,"somente-leitura":"",rotulo:"Data competencia",tipo:"data",dense:""},null,8,["modelValue"])]),_:2},1024),t(a,{col:"xs-grow"},{default:n(()=>[t(_,{modelValue:r.observacao,"somente-leitura":"",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):it("",!0),i.$db.usuario.desenvolvedor()&&i.compraDocumentoXml.length?($(),Y(b,{key:1,gutter:"md",mg:"md",bg:"bg-yellow"},{default:n(()=>[t(a,{col:"12"},{default:n(()=>[t(u,{text:"sub1 medium",icon:"credit_card sm tertiary left"},{default:n(()=>e[64]||(e[64]=[A("XML importado (apenas desenvolvedor)")])),_:1})]),_:1}),t(a,{col:"12"},{default:n(()=>[t(Pt,{highlight:"",class:"q-pa-none"},{default:n(()=>[($(!0),_t(St,null,Tt(i.compraDocumentoXml,r=>($(),Y(b,{key:r.id},{default:n(()=>[ft("pre",null,tt(s.formatXml(r.xmlData)),1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})):it("",!0)]),_:1})]),_:1}),t(Yt,{class:"bg-light border-top"},{default:n(()=>[t(Nt,{class:"bg-light text-tertiary q-px-md u-container"},{default:n(()=>[t(Rt,{class:"text-subtitle2"},{default:n(()=>[A(" Valor Total: "+tt(i.$filters.numero(i.compra.totalDocumento,2))+" ",1),e[65]||(e[65]=ft("span",{class:"q-px-xs"},"|",-1)),A(" SKU: "+tt(s.skus),1)]),_:1}),t(re),vt(t(ut,{onClick:s.excluir_click,type:"submit",class:"q-ml-sm",color:"white","text-color":"negative",flat:"",label:"Excluir"},null,8,["onClick"]),[[xt,i.compra.status==="Digita\xE7\xE3o"]]),vt(t(ut,{onClick:s.finalizar_click,type:"submit",class:"q-ml-sm",color:"primary",unelevated:"",label:"Finalizar"},null,8,["onClick"]),[[xt,i.compra.status==="Digita\xE7\xE3o"]]),vt(t(ut,{onClick:s.reabrir_click,color:"tertiary",flat:"",label:"Reabrir",type:"submit",class:"q-ml-sm"},null,8,["onClick"]),[[xt,i.compra.status==="Finalizado"]]),vt(t(ut,{unelevated:"",onClick:s.transformarEmNotaDeEntrada_click,class:"q-ml-sm",color:"primary",label:"Transformar em Nota de Entrada",type:"submit"},null,8,["onClick"]),[[xt,i.compra.status==="Finalizado"&&i.compra.operacao==="Pedido de Compra"]])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onKeyup"]),t(C,{ref:"ModalEditarProdutoCompras",onSalvar:s.fecharEdicaoProduto},null,8,["onSalvar"]),t(h,{modelValue:i.adicionar.modal.value,"onUpdate:modelValue":e[34]||(e[34]=r=>i.adicionar.modal.value=r),filtro:{ativo:!0,idEmpresa:i.compra.idEmpresa},ref:"promptItem",habilitarQuantidade:!0,exibirValorVenda:!1,calculaItemCusto:!0,onSelecionarItens:s.selecionarItens},null,8,["modelValue","filtro","onSelecionarItens"])],64)}var Qe=ne(je,[["render",Ge]]);const Ke={components:{PromptItemV2:ve},data(){return{mostrarItemModal:!1,idxItem:0,compra:{},compraItens:[],compraItensNaoVinculados:[],visivel:!1,edicaoGeral:{marca:"",grupo:"",subGrupo:"",percentualMarkup:0}}},emits:["atualizar","concluirImportacao"],computed:{produtosNaoVinculados(){return this.compraItens.reduce((i,e)=>i+(e.vinculado?0:1),0)},quantProdutos(){return this.compraItens.reduce((i,e)=>i+1,0)}},methods:{async mostrar(i){for(const e of i.documentosItem)this.recalcularItem_blur(e);this.compra=i,this.compraItens=i.documentosItem,this.compraItensNaoVinculados=this.compraItens.filter(({vinculado:e})=>!e),this.visivel=!0},async fechar(){this.visivel=!1},async selecionarItens(i){await $tryLoading(async()=>{var u,a,c;const e=(u=Object.values(i)[0])==null?void 0:u.item;$utils.verificarErro(!(e!=null&&e.id),"Produto inv\xE1lido"),this.compraItensNaoVinculados[this.idxItem].item=e;const{documentoItem:p,item:y,nfeProd:o}=this.compraItensNaoVinculados[this.idxItem];p.idItem=y.id,p.descricaoItem=y.descricao;const s={id:$utils.uuid(),idItem:p.idItem,idContato:this.compra.documento.idContato,referencia:o.cProd,descricao:o.xProd};(c=(a=this.compra)==null?void 0:a.fornecedor)!=null&&c.contato&&$db.compra.gravaFornecedor({atual:this.compra.fornecedor}),await $db.hibrido.grava("itemFornecedor",{atual:s}),this.compraItensNaoVinculados[this.idxItem].vinculado=!0,this.compraItensNaoVinculados=this.compraItens.filter(({vinculado:v})=>!v),$q.notifyPositive(`Produto vinculado com sucesso: ${y.descricao}`)},{mensagem:"Vinculando produto..."}),this.mostrarItemModal=!1},aplicar_click(){for(const i of this.compraItens)i.vinculado||(this.edicaoGeral.marca&&(i.item.marca=this.edicaoGeral.marca),this.edicaoGeral.grupo&&(i.item.grupo=this.edicaoGeral.grupo),this.edicaoGeral.subGrupo&&(i.item.subGrupo=this.edicaoGeral.subGrupo),this.edicaoGeral.percentualMarkup&&(i.item.percentualMarkup=this.edicaoGeral.percentualMarkup,this.recalcularItem_blur(i)))},async recalcularItem_blur(i){const{item:e,documentoItem:p,itemAnterior:y=$utils.clonarV2(i.item)}=i,{valorFreteRateado:o=0,valorSeguroRateado:s=0,valorOutrasDespesasRateado:u=0}=p;i.valoresEdicao||(i.valoresEdicao={valorOutrasDespesas:o+s+u,percentualIpi:p.percentualIpi||0,percentualIcmsSt:p.percentualIcmsSt||0,percentualDifal:0});const{valorOutrasDespesas:a,percentualIpi:c,percentualIcmsSt:v,percentualDifal:b}=i.valoresEdicao,{valorCusto:f=0,percentualMarkup:_=0,valorVenda:l=0}=e,C=f+a,h=C*c/100,w=C*v/100,r=C*b/100;e.valorCustoReposicao=$utils.arredondar(C+h+w+r,2),l!==y.valorVenda?e.percentualMarkup=$utils.arredondar(100*(l-e.valorCustoReposicao)/l,2):e.valorVenda=$utils.arredondar(e.valorCustoReposicao/(1-_/100),2),i.itemAnterior=$utils.clonarV2(e)},async adicionarItem_click(i){i.buttonLoading=!0,await this.$nextTick(),await $tryLoading(async()=>{var o,s;const e=await $db.hibrido.lista({table:"item",where:{referencia:i.item.referencia}});$utils.verificarErro(e.length,"Referencia j\xE1 utilizada por outro produto"),i.documentoItem.descricaoItem=i.item.descricao,i.item.descricaoConcatenada=i.item.descricao;const p=i.nfeProd,y={id:$utils.uuid(),idItem:i.item.id,idContato:this.compra.documento.idContato,referencia:p.cProd,descricao:p.xProd};await $db.hibrido.grava("item",{atual:i.item}),await $db.item.carregarMemoria(i.item.id),(s=(o=this.compra)==null?void 0:o.fornecedor)!=null&&s.contato&&$db.compra.gravaFornecedor({atual:this.compra.fornecedor}),await $db.hibrido.grava("itemFornecedor",{atual:y}),i.vinculado=!0,$q.notifyPositive(`Item criado com sucesso: ${i.item.descricao}`)},{mensagem:"Cadastrando produto..."}),i.buttonLoading=!1},async salvar_click(){this.compraItens.some(({vinculado:i})=>!i)?$q.notifyError("Verifique todos os itens n\xE3o vinculados!"):(this.mostrarItemModal=!1,this.visivel=!1,this.$emit("concluirImportacao",this.compra))},async incluirTodos_click(){for(const i of this.compraItens)i.vinculado||await this.adicionarItem_click(i)}}},Ye={class:"layout-padding q-pa-none q-pb-md"},Je={class:"items-carrinho items-center row q-pa-none rounded-borders u-container",style:{"margin-top":"12px","margin-bottom":"12px"}},ta={class:"col-2"},ea=["id"],aa={class:"col-12"},oa={class:"col-4 col-md"},ra={class:"col-4 col-md"},ia={class:"col-4 col-md"},na={class:"col-4 col-md"},sa={class:"col-6 col-md"},la={class:"col-12 col-md"},da={class:"col-6 col-md"},ua={class:"col-12 col-md"},ca={key:0,class:"col-12"},ma={class:"col-12 col-md-4"},fa={class:"col-12 col-md-auto q-pl-none"},pa={key:1,class:"col-12 q-pt-md text-right text-bold"},ha={class:"text-positive"};function ga(i,e,p,y,o,s){const u=gt("ajuda"),a=gt("campo"),c=gt("row"),v=gt("card"),b=gt("PromptItemV2");return $(),_t(St,null,[t($t,{modelValue:o.visivel,"onUpdate:modelValue":e[4]||(e[4]=f=>o.visivel=f),persistent:"",maximized:"",onKeyup:be(s.fechar,["esc"])},{default:n(()=>[t(Ht,{container:"",view:"hHh LpR fFf",class:"bg-light"},{default:n(()=>[t(Zt,null,{default:n(()=>[t(Nt,null,{default:n(()=>[t(ut,{icon:"arrow_back",flat:"",round:"",dense:"",onClick:s.fechar},null,8,["onClick"]),t(Rt,null,{default:n(()=>e[6]||(e[6]=[A("Importar XML x Cadastro")])),_:1}),t(u)]),_:1})]),_:1}),t(Xt,null,{default:n(()=>[t(Wt,null,{default:n(()=>[ft("div",Ye,[ft("div",Je,[t(v,{icon:"mdi-set-none",label:"Propriedades para todos os produtos",class:"full-width"},{default:n(()=>[t(c,null,{default:n(()=>[t(a,{modelValue:o.edicaoGeral.marca,"onUpdate:modelValue":e[0]||(e[0]=f=>o.edicaoGeral.marca=f),rotulo:"Marca",dense:"",tipo:"texto",outlined:"",col:"4"},null,8,["modelValue"]),t(a,{modelValue:o.edicaoGeral.grupo,"onUpdate:modelValue":e[1]||(e[1]=f=>o.edicaoGeral.grupo=f),rotulo:"Grupo",dense:"",tipo:"texto",outlined:"",col:"4"},null,8,["modelValue"]),t(a,{modelValue:o.edicaoGeral.subGrupo,"onUpdate:modelValue":e[2]||(e[2]=f=>o.edicaoGeral.subGrupo=f),rotulo:"SubGrupo",dense:"",tipo:"texto",outlined:"",col:"4"},null,8,["modelValue"])]),_:1}),t(c,{class:"q-pt-sm"},{default:n(()=>[e[7]||(e[7]=ft("div",{class:"col-8"},null,-1)),t(a,{modelValue:o.edicaoGeral.percentualMarkup,"onUpdate:modelValue":e[3]||(e[3]=f=>o.edicaoGeral.percentualMarkup=f),rotulo:"Margem de Lucro",suffix:"%",opcoes:{maximumValue:100},dense:"",tipo:"decimal",decimals:"2",outlined:"",col:"2"},null,8,["modelValue"]),ft("div",ta,[t(ut,{class:"q-ml-sm no-shadow",color:"primary",icon:"play_arrow",unelevated:"",label:"Aplicar",onClick:s.aplicar_click},null,8,["onClick"])])]),_:1})]),_:1})]),t(Ve,{items:o.compraItensNaoVinculados,separator:""},{default:n(({item:f,index:_})=>[ft("div",{class:"items-carrinho items-center row q-pa-md bg-white rounded-borders u-container",style:{"margin-top":"12px","margin-bottom":"12px"},id:_},[t(Pt,{class:"full-width"},{default:n(()=>[t(mt,{class:"q-px-none"},{default:n(()=>[t(K,{class:"q-px-none"},{default:n(()=>[t(dt,null,{default:n(()=>[t(a,{dense:"",align:"left",tipo:"texto",outlined:"",rotulo:"Descri\xE7\xE3o Item",modelValue:f.item.descricao,"onUpdate:modelValue":l=>f.item.descricao=l,"somente-leitura":!!f.vinculado},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024)]),_:2},1024),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>[t(a,{dense:"",align:"left",tipo:"texto",outlined:"",rotulo:"Referencia",modelValue:f.item.referencia,"onUpdate:modelValue":l=>f.item.referencia=l,"somente-leitura":!!f.vinculado},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(Pt,{class:"full-width"},{default:n(()=>[t(mt,{class:"q-px-none"},{default:n(()=>[t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>[t(a,{dense:"",tipo:"texto",outlined:"",rotulo:"Marca",modelValue:f.item.marca,"onUpdate:modelValue":l=>f.item.marca=l,"somente-leitura":!!f.vinculado},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024)]),_:2},1024),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>[t(a,{dense:"",tipo:"texto",outlined:"",rotulo:"Grupo",modelValue:f.item.grupo,"onUpdate:modelValue":l=>f.item.grupo=l,"somente-leitura":!!f.vinculado},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024)]),_:2},1024),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>[t(a,{dense:"",tipo:"texto",outlined:"",rotulo:"SubGrupo",modelValue:f.item.subGrupo,"onUpdate:modelValue":l=>f.item.subGrupo=l,"somente-leitura":!!f.vinculado},null,8,["modelValue","onUpdate:modelValue","somente-leitura"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),ft("div",aa,[t(c,{class:"q-col-gutter-sm"},{default:n(()=>[ft("div",oa,[t(a,{modelValue:f.item.valorCusto,"onUpdate:modelValue":l=>f.item.valorCusto=l,rotulo:"Valor pr\xE9 custo",dense:"",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"","somente-leitura":""},null,8,["modelValue","onUpdate:modelValue"])]),ft("div",ra,[t(a,{modelValue:f.valoresEdicao.valorOutrasDespesas,"onUpdate:modelValue":l=>f.valoresEdicao.valorOutrasDespesas=l,rotulo:"Outras Despesas",dense:"",tipo:"decimal",decimals:"4","somente-leitura":!!f.vinculado,outlined:"",onBlur:l=>s.recalcularItem_blur(f)},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),ft("div",ia,[t(a,{modelValue:f.valoresEdicao.percentualIpi,"onUpdate:modelValue":l=>f.valoresEdicao.percentualIpi=l,rotulo:"IPI",suffix:"%",opcoes:{maximumValue:100},dense:"",tipo:"decimal",decimals:"2","somente-leitura":!!f.vinculado,outlined:"",onBlur:l=>s.recalcularItem_blur(f)},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),ft("div",na,[t(a,{modelValue:f.valoresEdicao.percentualIcmsSt,"onUpdate:modelValue":l=>f.valoresEdicao.percentualIcmsSt=l,rotulo:"ST",suffix:"%",opcoes:{maximumValue:100},dense:"",tipo:"decimal",decimals:"2","somente-leitura":!!f.vinculado,outlined:"",onBlur:l=>s.recalcularItem_blur(f)},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),ft("div",sa,[t(a,{modelValue:f.valoresEdicao.percentualDifal,"onUpdate:modelValue":l=>f.valoresEdicao.percentualDifal=l,rotulo:"DIFAL",suffix:"%",opcoes:{maximumValue:100},dense:"",tipo:"decimal",decimals:"2","somente-leitura":!!f.vinculado,outlined:"",onBlur:l=>s.recalcularItem_blur(f)},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),ft("div",la,[t(a,{modelValue:f.item.valorCustoReposicao,"onUpdate:modelValue":l=>f.item.valorCustoReposicao=l,rotulo:"Custo de reposi\xE7\xE3o",dense:"",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"","somente-leitura":""},null,8,["modelValue","onUpdate:modelValue"])]),ft("div",da,[t(a,{modelValue:f.item.percentualMarkup,"onUpdate:modelValue":l=>f.item.percentualMarkup=l,rotulo:"Margem de Lucro",suffix:"%",opcoes:{maximumValue:100},dense:"",tipo:"decimal",decimals:"2","somente-leitura":!!f.vinculado,outlined:"",onBlur:l=>s.recalcularItem_blur(f)},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])]),ft("div",ua,[t(a,{modelValue:f.item.valorVenda,"onUpdate:modelValue":l=>f.item.valorVenda=l,rotulo:"Valor de Venda",dense:"",tipo:"decimal",decimals:"4",zerosDireita:"2",outlined:"","somente-leitura":!!f.vinculado,onBlur:l=>s.recalcularItem_blur(f)},null,8,["modelValue","onUpdate:modelValue","somente-leitura","onBlur"])])]),_:2},1024)]),f.vinculado?($(),_t("div",pa," Produto vinculado ")):($(),_t("div",ca,[t(c,{class:"q-mt-lg text-right full-width justify-end items-center"},{default:n(()=>[ft("div",ma,[t(ut,{class:"q-ml-sm no-shadow",color:"primary",icon:"search",unelevated:"",label:"Vincular",onClick:()=>{o.mostrarItemModal=!o.mostrarItemModal,o.idxItem=_}},null,8,["onClick"])]),e[8]||(e[8]=ft("div",{class:"col-12 col-md-auto"},"ou",-1)),ft("div",fa,[t(ut,{loading:f.buttonLoading,class:"q-ml-sm no-shadow",color:"primary",icon:"add",unelevated:"",label:"Novo",onClick:l=>s.adicionarItem_click(f)},null,8,["loading","onClick"])])]),_:2},1024)]))],8,ea)]),_:1},8,["items"])])]),_:1})]),_:1}),t(Yt,{class:"bg-light"},{default:n(()=>[t(Nt,null,{default:n(()=>[t(Rt,null,{default:n(()=>[ft("span",ha,"Produtos: "+tt(s.quantProdutos)+" - N\xE3o vinculados: "+tt(s.produtosNaoVinculados),1)]),_:1}),s.produtosNaoVinculados?($(),Y(ut,{key:0,class:"q-ml-sm no-shadow float-right",color:"primary",label:"Incluir Todos",onClick:s.incluirTodos_click,unelevated:""},null,8,["onClick"])):($(),Y(ut,{key:1,class:"q-ml-sm no-shadow float-right",color:"primary",label:"Salvar",onClick:s.salvar_click,unelevated:""},null,8,["onClick"]))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onKeyup"]),t(b,{modelValue:o.mostrarItemModal,"onUpdate:modelValue":e[5]||(e[5]=f=>o.mostrarItemModal=f),habilitarQuantidade:!1,filtro:{ativo:!0,idEmpresa:o.compra.idEmpresa},exibirValorVenda:!1,onSelecionarItens:s.selecionarItens,ref:"promptItem"},null,8,["modelValue","filtro","onSelecionarItens"])],64)}var va=ne(Ke,[["render",ga]]),_e={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(i,e){(function(p){i.exports=p()})(function(){return function p(y,o,s){function u(v,b){if(!o[v]){if(!y[v]){var f=typeof ae=="function"&&ae;if(!b&&f)return f(v,!0);if(a)return a(v,!0);var _=new Error("Cannot find module '"+v+"'");throw _.code="MODULE_NOT_FOUND",_}var l=o[v]={exports:{}};y[v][0].call(l.exports,function(C){var h=y[v][1][C];return u(h||C)},l,l.exports,p,y,o,s)}return o[v].exports}for(var a=typeof ae=="function"&&ae,c=0;c<s.length;c++)u(s[c]);return u}({1:[function(p,y,o){var s=p("./utils"),u=p("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";o.encode=function(c){for(var v,b,f,_,l,C,h,w=[],r=0,g=c.length,S=g,D=s.getTypeOf(c)!=="string";r<c.length;)S=g-r,f=D?(v=c[r++],b=r<g?c[r++]:0,r<g?c[r++]:0):(v=c.charCodeAt(r++),b=r<g?c.charCodeAt(r++):0,r<g?c.charCodeAt(r++):0),_=v>>2,l=(3&v)<<4|b>>4,C=1<S?(15&b)<<2|f>>6:64,h=2<S?63&f:64,w.push(a.charAt(_)+a.charAt(l)+a.charAt(C)+a.charAt(h));return w.join("")},o.decode=function(c){var v,b,f,_,l,C,h=0,w=0,r="data:";if(c.substr(0,r.length)===r)throw new Error("Invalid base64 input, it looks like a data url.");var g,S=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===a.charAt(64)&&S--,c.charAt(c.length-2)===a.charAt(64)&&S--,S%1!=0)throw new Error("Invalid base64 input, bad content length.");for(g=u.uint8array?new Uint8Array(0|S):new Array(0|S);h<c.length;)v=a.indexOf(c.charAt(h++))<<2|(_=a.indexOf(c.charAt(h++)))>>4,b=(15&_)<<4|(l=a.indexOf(c.charAt(h++)))>>2,f=(3&l)<<6|(C=a.indexOf(c.charAt(h++))),g[w++]=v,l!==64&&(g[w++]=b),C!==64&&(g[w++]=f);return g}},{"./support":30,"./utils":32}],2:[function(p,y,o){var s=p("./external"),u=p("./stream/DataWorker"),a=p("./stream/Crc32Probe"),c=p("./stream/DataLengthProbe");function v(b,f,_,l,C){this.compressedSize=b,this.uncompressedSize=f,this.crc32=_,this.compression=l,this.compressedContent=C}v.prototype={getContentWorker:function(){var b=new u(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),f=this;return b.on("end",function(){if(this.streamInfo.data_length!==f.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),b},getCompressedWorker:function(){return new u(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},v.createWorkerFrom=function(b,f,_){return b.pipe(new a).pipe(new c("uncompressedSize")).pipe(f.compressWorker(_)).pipe(new c("compressedSize")).withStreamInfo("compression",f)},y.exports=v},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(p,y,o){var s=p("./stream/GenericWorker");o.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},o.DEFLATE=p("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(p,y,o){var s=p("./utils"),u=function(){for(var a,c=[],v=0;v<256;v++){a=v;for(var b=0;b<8;b++)a=1&a?3988292384^a>>>1:a>>>1;c[v]=a}return c}();y.exports=function(a,c){return a!==void 0&&a.length?s.getTypeOf(a)!=="string"?function(v,b,f,_){var l=u,C=_+f;v^=-1;for(var h=_;h<C;h++)v=v>>>8^l[255&(v^b[h])];return-1^v}(0|c,a,a.length,0):function(v,b,f,_){var l=u,C=_+f;v^=-1;for(var h=_;h<C;h++)v=v>>>8^l[255&(v^b.charCodeAt(h))];return-1^v}(0|c,a,a.length,0):0}},{"./utils":32}],5:[function(p,y,o){o.base64=!1,o.binary=!1,o.dir=!1,o.createFolders=!0,o.date=null,o.compression=null,o.compressionOptions=null,o.comment=null,o.unixPermissions=null,o.dosPermissions=null},{}],6:[function(p,y,o){var s=null;s=typeof Promise!="undefined"?Promise:p("lie"),y.exports={Promise:s}},{lie:37}],7:[function(p,y,o){var s=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Uint32Array!="undefined",u=p("pako"),a=p("./utils"),c=p("./stream/GenericWorker"),v=s?"uint8array":"array";function b(f,_){c.call(this,"FlateWorker/"+f),this._pako=null,this._pakoAction=f,this._pakoOptions=_,this.meta={}}o.magic="\b\0",a.inherits(b,c),b.prototype.processChunk=function(f){this.meta=f.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(v,f.data),!1)},b.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},b.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},b.prototype._createPako=function(){this._pako=new u[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var f=this;this._pako.onData=function(_){f.push({data:_,meta:f.meta})}},o.compressWorker=function(f){return new b("Deflate",f)},o.uncompressWorker=function(){return new b("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(p,y,o){function s(l,C){var h,w="";for(h=0;h<C;h++)w+=String.fromCharCode(255&l),l>>>=8;return w}function u(l,C,h,w,r,g){var S,D,V=l.file,B=l.compression,q=g!==v.utf8encode,j=a.transformTo("string",g(V.name)),T=a.transformTo("string",v.utf8encode(V.name)),X=V.comment,ot=a.transformTo("string",g(X)),E=a.transformTo("string",v.utf8encode(X)),O=T.length!==V.name.length,m=E.length!==X.length,R="",nt="",Z="",rt=V.dir,L=V.date,st={crc32:0,compressedSize:0,uncompressedSize:0};C&&!h||(st.crc32=l.crc32,st.compressedSize=l.compressedSize,st.uncompressedSize=l.uncompressedSize);var z=0;C&&(z|=8),q||!O&&!m||(z|=2048);var F=0,at=0;rt&&(F|=16),r==="UNIX"?(at=798,F|=function(Q,yt){var kt=Q;return Q||(kt=yt?16893:33204),(65535&kt)<<16}(V.unixPermissions,rt)):(at=20,F|=function(Q){return 63&(Q||0)}(V.dosPermissions)),S=L.getUTCHours(),S<<=6,S|=L.getUTCMinutes(),S<<=5,S|=L.getUTCSeconds()/2,D=L.getUTCFullYear()-1980,D<<=4,D|=L.getUTCMonth()+1,D<<=5,D|=L.getUTCDate(),O&&(nt=s(1,1)+s(b(j),4)+T,R+="up"+s(nt.length,2)+nt),m&&(Z=s(1,1)+s(b(ot),4)+E,R+="uc"+s(Z.length,2)+Z);var J="";return J+=`
\0`,J+=s(z,2),J+=B.magic,J+=s(S,2),J+=s(D,2),J+=s(st.crc32,4),J+=s(st.compressedSize,4),J+=s(st.uncompressedSize,4),J+=s(j.length,2),J+=s(R.length,2),{fileRecord:f.LOCAL_FILE_HEADER+J+j+R,dirRecord:f.CENTRAL_FILE_HEADER+s(at,2)+J+s(ot.length,2)+"\0\0\0\0"+s(F,4)+s(w,4)+j+R+ot}}var a=p("../utils"),c=p("../stream/GenericWorker"),v=p("../utf8"),b=p("../crc32"),f=p("../signature");function _(l,C,h,w){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=C,this.zipPlatform=h,this.encodeFileName=w,this.streamFiles=l,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(_,c),_.prototype.push=function(l){var C=l.meta.percent||0,h=this.entriesCount,w=this._sources.length;this.accumulate?this.contentBuffer.push(l):(this.bytesWritten+=l.data.length,c.prototype.push.call(this,{data:l.data,meta:{currentFile:this.currentFile,percent:h?(C+100*(h-w-1))/h:100}}))},_.prototype.openedSource=function(l){this.currentSourceOffset=this.bytesWritten,this.currentFile=l.file.name;var C=this.streamFiles&&!l.file.dir;if(C){var h=u(l,C,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:h.fileRecord,meta:{percent:0}})}else this.accumulate=!0},_.prototype.closedSource=function(l){this.accumulate=!1;var C=this.streamFiles&&!l.file.dir,h=u(l,C,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(h.dirRecord),C)this.push({data:function(w){return f.DATA_DESCRIPTOR+s(w.crc32,4)+s(w.compressedSize,4)+s(w.uncompressedSize,4)}(l),meta:{percent:100}});else for(this.push({data:h.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},_.prototype.flush=function(){for(var l=this.bytesWritten,C=0;C<this.dirRecords.length;C++)this.push({data:this.dirRecords[C],meta:{percent:100}});var h=this.bytesWritten-l,w=function(r,g,S,D,V){var B=a.transformTo("string",V(D));return f.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(r,2)+s(r,2)+s(g,4)+s(S,4)+s(B.length,2)+B}(this.dirRecords.length,h,l,this.zipComment,this.encodeFileName);this.push({data:w,meta:{percent:100}})},_.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},_.prototype.registerPrevious=function(l){this._sources.push(l);var C=this;return l.on("data",function(h){C.processChunk(h)}),l.on("end",function(){C.closedSource(C.previous.streamInfo),C._sources.length?C.prepareNextSource():C.end()}),l.on("error",function(h){C.error(h)}),this},_.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},_.prototype.error=function(l){var C=this._sources;if(!c.prototype.error.call(this,l))return!1;for(var h=0;h<C.length;h++)try{C[h].error(l)}catch{}return!0},_.prototype.lock=function(){c.prototype.lock.call(this);for(var l=this._sources,C=0;C<l.length;C++)l[C].lock()},y.exports=_},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(p,y,o){var s=p("../compressions"),u=p("./ZipFileWorker");o.generateWorker=function(a,c,v){var b=new u(c.streamFiles,v,c.platform,c.encodeFileName),f=0;try{a.forEach(function(_,l){f++;var C=function(g,S){var D=g||S,V=s[D];if(!V)throw new Error(D+" is not a valid compression method !");return V}(l.options.compression,c.compression),h=l.options.compressionOptions||c.compressionOptions||{},w=l.dir,r=l.date;l._compressWorker(C,h).withStreamInfo("file",{name:_,dir:w,date:r,comment:l.comment||"",unixPermissions:l.unixPermissions,dosPermissions:l.dosPermissions}).pipe(b)}),b.entriesCount=f}catch(_){b.error(_)}return b}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(p,y,o){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var u=new s;for(var a in this)typeof this[a]!="function"&&(u[a]=this[a]);return u}}(s.prototype=p("./object")).loadAsync=p("./load"),s.support=p("./support"),s.defaults=p("./defaults"),s.version="3.10.1",s.loadAsync=function(u,a){return new s().loadAsync(u,a)},s.external=p("./external"),y.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(p,y,o){var s=p("./utils"),u=p("./external"),a=p("./utf8"),c=p("./zipEntries"),v=p("./stream/Crc32Probe"),b=p("./nodejsUtils");function f(_){return new u.Promise(function(l,C){var h=_.decompressed.getContentWorker().pipe(new v);h.on("error",function(w){C(w)}).on("end",function(){h.streamInfo.crc32!==_.decompressed.crc32?C(new Error("Corrupted zip : CRC32 mismatch")):l()}).resume()})}y.exports=function(_,l){var C=this;return l=s.extend(l||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),b.isNode&&b.isStream(_)?u.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",_,!0,l.optimizedBinaryString,l.base64).then(function(h){var w=new c(l);return w.load(h),w}).then(function(h){var w=[u.Promise.resolve(h)],r=h.files;if(l.checkCRC32)for(var g=0;g<r.length;g++)w.push(f(r[g]));return u.Promise.all(w)}).then(function(h){for(var w=h.shift(),r=w.files,g=0;g<r.length;g++){var S=r[g],D=S.fileNameStr,V=s.resolve(S.fileNameStr);C.file(V,S.decompressed,{binary:!0,optimizedBinaryString:!0,date:S.date,dir:S.dir,comment:S.fileCommentStr.length?S.fileCommentStr:null,unixPermissions:S.unixPermissions,dosPermissions:S.dosPermissions,createFolders:l.createFolders}),S.dir||(C.file(V).unsafeOriginalName=D)}return w.zipComment.length&&(C.comment=w.zipComment),C})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(p,y,o){var s=p("../utils"),u=p("../stream/GenericWorker");function a(c,v){u.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(v)}s.inherits(a,u),a.prototype._bindStream=function(c){var v=this;(this._stream=c).pause(),c.on("data",function(b){v.push({data:b,meta:{percent:0}})}).on("error",function(b){v.isPaused?this.generatedError=b:v.error(b)}).on("end",function(){v.isPaused?v._upstreamEnded=!0:v.end()})},a.prototype.pause=function(){return!!u.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!u.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},y.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(p,y,o){var s=p("readable-stream").Readable;function u(a,c,v){s.call(this,c),this._helper=a;var b=this;a.on("data",function(f,_){b.push(f)||b._helper.pause(),v&&v(_)}).on("error",function(f){b.emit("error",f)}).on("end",function(){b.push(null)})}p("../utils").inherits(u,s),u.prototype._read=function(){this._helper.resume()},y.exports=u},{"../utils":32,"readable-stream":16}],14:[function(p,y,o){y.exports={isNode:typeof Buffer!="undefined",newBufferFrom:function(s,u){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,u);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,u)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var u=new Buffer(s);return u.fill(0),u},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(p,y,o){function s(V,B,q){var j,T=a.getTypeOf(B),X=a.extend(q||{},b);X.date=X.date||new Date,X.compression!==null&&(X.compression=X.compression.toUpperCase()),typeof X.unixPermissions=="string"&&(X.unixPermissions=parseInt(X.unixPermissions,8)),X.unixPermissions&&16384&X.unixPermissions&&(X.dir=!0),X.dosPermissions&&16&X.dosPermissions&&(X.dir=!0),X.dir&&(V=r(V)),X.createFolders&&(j=w(V))&&g.call(this,j,!0);var ot=T==="string"&&X.binary===!1&&X.base64===!1;q&&q.binary!==void 0||(X.binary=!ot),(B instanceof f&&B.uncompressedSize===0||X.dir||!B||B.length===0)&&(X.base64=!1,X.binary=!0,B="",X.compression="STORE",T="string");var E=null;E=B instanceof f||B instanceof c?B:C.isNode&&C.isStream(B)?new h(V,B):a.prepareContent(V,B,X.binary,X.optimizedBinaryString,X.base64);var O=new _(V,E,X);this.files[V]=O}var u=p("./utf8"),a=p("./utils"),c=p("./stream/GenericWorker"),v=p("./stream/StreamHelper"),b=p("./defaults"),f=p("./compressedObject"),_=p("./zipObject"),l=p("./generate"),C=p("./nodejsUtils"),h=p("./nodejs/NodejsStreamInputAdapter"),w=function(V){V.slice(-1)==="/"&&(V=V.substring(0,V.length-1));var B=V.lastIndexOf("/");return 0<B?V.substring(0,B):""},r=function(V){return V.slice(-1)!=="/"&&(V+="/"),V},g=function(V,B){return B=B!==void 0?B:b.createFolders,V=r(V),this.files[V]||s.call(this,V,null,{dir:!0,createFolders:B}),this.files[V]};function S(V){return Object.prototype.toString.call(V)==="[object RegExp]"}var D={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(V){var B,q,j;for(B in this.files)j=this.files[B],(q=B.slice(this.root.length,B.length))&&B.slice(0,this.root.length)===this.root&&V(q,j)},filter:function(V){var B=[];return this.forEach(function(q,j){V(q,j)&&B.push(j)}),B},file:function(V,B,q){if(arguments.length!==1)return V=this.root+V,s.call(this,V,B,q),this;if(S(V)){var j=V;return this.filter(function(X,ot){return!ot.dir&&j.test(X)})}var T=this.files[this.root+V];return T&&!T.dir?T:null},folder:function(V){if(!V)return this;if(S(V))return this.filter(function(T,X){return X.dir&&V.test(T)});var B=this.root+V,q=g.call(this,B),j=this.clone();return j.root=q.name,j},remove:function(V){V=this.root+V;var B=this.files[V];if(B||(V.slice(-1)!=="/"&&(V+="/"),B=this.files[V]),B&&!B.dir)delete this.files[V];else for(var q=this.filter(function(T,X){return X.name.slice(0,V.length)===V}),j=0;j<q.length;j++)delete this.files[q[j].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(V){var B,q={};try{if((q=a.extend(V||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:u.utf8encode})).type=q.type.toLowerCase(),q.compression=q.compression.toUpperCase(),q.type==="binarystring"&&(q.type="string"),!q.type)throw new Error("No output type specified.");a.checkSupport(q.type),q.platform!=="darwin"&&q.platform!=="freebsd"&&q.platform!=="linux"&&q.platform!=="sunos"||(q.platform="UNIX"),q.platform==="win32"&&(q.platform="DOS");var j=q.comment||this.comment||"";B=l.generateWorker(this,q,j)}catch(T){(B=new c("error")).error(T)}return new v(B,q.type||"string",q.mimeType)},generateAsync:function(V,B){return this.generateInternalStream(V).accumulate(B)},generateNodeStream:function(V,B){return(V=V||{}).type||(V.type="nodebuffer"),this.generateInternalStream(V).toNodejsStream(B)}};y.exports=D},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(p,y,o){y.exports=p("stream")},{stream:void 0}],17:[function(p,y,o){var s=p("./DataReader");function u(a){s.call(this,a);for(var c=0;c<this.data.length;c++)a[c]=255&a[c]}p("../utils").inherits(u,s),u.prototype.byteAt=function(a){return this.data[this.zero+a]},u.prototype.lastIndexOfSignature=function(a){for(var c=a.charCodeAt(0),v=a.charCodeAt(1),b=a.charCodeAt(2),f=a.charCodeAt(3),_=this.length-4;0<=_;--_)if(this.data[_]===c&&this.data[_+1]===v&&this.data[_+2]===b&&this.data[_+3]===f)return _-this.zero;return-1},u.prototype.readAndCheckSignature=function(a){var c=a.charCodeAt(0),v=a.charCodeAt(1),b=a.charCodeAt(2),f=a.charCodeAt(3),_=this.readData(4);return c===_[0]&&v===_[1]&&b===_[2]&&f===_[3]},u.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},y.exports=u},{"../utils":32,"./DataReader":18}],18:[function(p,y,o){var s=p("../utils");function u(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}u.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var c,v=0;for(this.checkOffset(a),c=this.index+a-1;c>=this.index;c--)v=(v<<8)+this.byteAt(c);return this.index+=a,v},readString:function(a){return s.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},y.exports=u},{"../utils":32}],19:[function(p,y,o){var s=p("./Uint8ArrayReader");function u(a){s.call(this,a)}p("../utils").inherits(u,s),u.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},y.exports=u},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(p,y,o){var s=p("./DataReader");function u(a){s.call(this,a)}p("../utils").inherits(u,s),u.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},u.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},u.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},u.prototype.readData=function(a){this.checkOffset(a);var c=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},y.exports=u},{"../utils":32,"./DataReader":18}],21:[function(p,y,o){var s=p("./ArrayReader");function u(a){s.call(this,a)}p("../utils").inherits(u,s),u.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,c},y.exports=u},{"../utils":32,"./ArrayReader":17}],22:[function(p,y,o){var s=p("../utils"),u=p("../support"),a=p("./ArrayReader"),c=p("./StringReader"),v=p("./NodeBufferReader"),b=p("./Uint8ArrayReader");y.exports=function(f){var _=s.getTypeOf(f);return s.checkSupport(_),_!=="string"||u.uint8array?_==="nodebuffer"?new v(f):u.uint8array?new b(s.transformTo("uint8array",f)):new a(s.transformTo("array",f)):new c(f)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(p,y,o){o.LOCAL_FILE_HEADER="PK",o.CENTRAL_FILE_HEADER="PK",o.CENTRAL_DIRECTORY_END="PK",o.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",o.ZIP64_CENTRAL_DIRECTORY_END="PK",o.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(p,y,o){var s=p("./GenericWorker"),u=p("../utils");function a(c){s.call(this,"ConvertWorker to "+c),this.destType=c}u.inherits(a,s),a.prototype.processChunk=function(c){this.push({data:u.transformTo(this.destType,c.data),meta:c.meta})},y.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(p,y,o){var s=p("./GenericWorker"),u=p("../crc32");function a(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}p("../utils").inherits(a,s),a.prototype.processChunk=function(c){this.streamInfo.crc32=u(c.data,this.streamInfo.crc32||0),this.push(c)},y.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(p,y,o){var s=p("../utils"),u=p("./GenericWorker");function a(c){u.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(a,u),a.prototype.processChunk=function(c){if(c){var v=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=v+c.data.length}u.prototype.processChunk.call(this,c)},y.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(p,y,o){var s=p("../utils"),u=p("./GenericWorker");function a(c){u.call(this,"DataWorker");var v=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(b){v.dataIsReady=!0,v.data=b,v.max=b&&b.length||0,v.type=s.getTypeOf(b),v.isPaused||v._tickAndRepeat()},function(b){v.error(b)})}s.inherits(a,u),a.prototype.cleanUp=function(){u.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!u.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,v=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,v);break;case"uint8array":c=this.data.subarray(this.index,v);break;case"array":case"nodebuffer":c=this.data.slice(this.index,v)}return this.index=v,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},y.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(p,y,o){function s(u){this.name=u||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(u){this.emit("data",u)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(u){this.emit("error",u)}return!0},error:function(u){return!this.isFinished&&(this.isPaused?this.generatedError=u:(this.isFinished=!0,this.emit("error",u),this.previous&&this.previous.error(u),this.cleanUp()),!0)},on:function(u,a){return this._listeners[u].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(u,a){if(this._listeners[u])for(var c=0;c<this._listeners[u].length;c++)this._listeners[u][c].call(this,a)},pipe:function(u){return u.registerPrevious(this)},registerPrevious:function(u){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=u.streamInfo,this.mergeStreamInfo(),this.previous=u;var a=this;return u.on("data",function(c){a.processChunk(c)}),u.on("end",function(){a.end()}),u.on("error",function(c){a.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var u=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),u=!0),this.previous&&this.previous.resume(),!u},flush:function(){},processChunk:function(u){this.push(u)},withStreamInfo:function(u,a){return this.extraStreamInfo[u]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var u in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,u)&&(this.streamInfo[u]=this.extraStreamInfo[u])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var u="Worker "+this.name;return this.previous?this.previous+" -> "+u:u}},y.exports=s},{}],29:[function(p,y,o){var s=p("../utils"),u=p("./ConvertWorker"),a=p("./GenericWorker"),c=p("../base64"),v=p("../support"),b=p("../external"),f=null;if(v.nodestream)try{f=p("../nodejs/NodejsStreamOutputAdapter")}catch{}function _(C,h){return new b.Promise(function(w,r){var g=[],S=C._internalType,D=C._outputType,V=C._mimeType;C.on("data",function(B,q){g.push(B),h&&h(q)}).on("error",function(B){g=[],r(B)}).on("end",function(){try{var B=function(q,j,T){switch(q){case"blob":return s.newBlob(s.transformTo("arraybuffer",j),T);case"base64":return c.encode(j);default:return s.transformTo(q,j)}}(D,function(q,j){var T,X=0,ot=null,E=0;for(T=0;T<j.length;T++)E+=j[T].length;switch(q){case"string":return j.join("");case"array":return Array.prototype.concat.apply([],j);case"uint8array":for(ot=new Uint8Array(E),T=0;T<j.length;T++)ot.set(j[T],X),X+=j[T].length;return ot;case"nodebuffer":return Buffer.concat(j);default:throw new Error("concat : unsupported type '"+q+"'")}}(S,g),V);w(B)}catch(q){r(q)}g=[]}).resume()})}function l(C,h,w){var r=h;switch(h){case"blob":case"arraybuffer":r="uint8array";break;case"base64":r="string"}try{this._internalType=r,this._outputType=h,this._mimeType=w,s.checkSupport(r),this._worker=C.pipe(new u(r)),C.lock()}catch(g){this._worker=new a("error"),this._worker.error(g)}}l.prototype={accumulate:function(C){return _(this,C)},on:function(C,h){var w=this;return C==="data"?this._worker.on(C,function(r){h.call(w,r.data,r.meta)}):this._worker.on(C,function(){s.delay(h,arguments,w)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(C){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new f(this,{objectMode:this._outputType!=="nodebuffer"},C)}},y.exports=l},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(p,y,o){if(o.base64=!0,o.array=!0,o.string=!0,o.arraybuffer=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined",o.nodebuffer=typeof Buffer!="undefined",o.uint8array=typeof Uint8Array!="undefined",typeof ArrayBuffer=="undefined")o.blob=!1;else{var s=new ArrayBuffer(0);try{o.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var u=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);u.append(s),o.blob=u.getBlob("application/zip").size===0}catch{o.blob=!1}}}try{o.nodestream=!!p("readable-stream").Readable}catch{o.nodestream=!1}},{"readable-stream":16}],31:[function(p,y,o){for(var s=p("./utils"),u=p("./support"),a=p("./nodejsUtils"),c=p("./stream/GenericWorker"),v=new Array(256),b=0;b<256;b++)v[b]=252<=b?6:248<=b?5:240<=b?4:224<=b?3:192<=b?2:1;v[254]=v[254]=1;function f(){c.call(this,"utf-8 decode"),this.leftOver=null}function _(){c.call(this,"utf-8 encode")}o.utf8encode=function(l){return u.nodebuffer?a.newBufferFrom(l,"utf-8"):function(C){var h,w,r,g,S,D=C.length,V=0;for(g=0;g<D;g++)(64512&(w=C.charCodeAt(g)))==55296&&g+1<D&&(64512&(r=C.charCodeAt(g+1)))==56320&&(w=65536+(w-55296<<10)+(r-56320),g++),V+=w<128?1:w<2048?2:w<65536?3:4;for(h=u.uint8array?new Uint8Array(V):new Array(V),g=S=0;S<V;g++)(64512&(w=C.charCodeAt(g)))==55296&&g+1<D&&(64512&(r=C.charCodeAt(g+1)))==56320&&(w=65536+(w-55296<<10)+(r-56320),g++),w<128?h[S++]=w:(w<2048?h[S++]=192|w>>>6:(w<65536?h[S++]=224|w>>>12:(h[S++]=240|w>>>18,h[S++]=128|w>>>12&63),h[S++]=128|w>>>6&63),h[S++]=128|63&w);return h}(l)},o.utf8decode=function(l){return u.nodebuffer?s.transformTo("nodebuffer",l).toString("utf-8"):function(C){var h,w,r,g,S=C.length,D=new Array(2*S);for(h=w=0;h<S;)if((r=C[h++])<128)D[w++]=r;else if(4<(g=v[r]))D[w++]=65533,h+=g-1;else{for(r&=g===2?31:g===3?15:7;1<g&&h<S;)r=r<<6|63&C[h++],g--;1<g?D[w++]=65533:r<65536?D[w++]=r:(r-=65536,D[w++]=55296|r>>10&1023,D[w++]=56320|1023&r)}return D.length!==w&&(D.subarray?D=D.subarray(0,w):D.length=w),s.applyFromCharCode(D)}(l=s.transformTo(u.uint8array?"uint8array":"array",l))},s.inherits(f,c),f.prototype.processChunk=function(l){var C=s.transformTo(u.uint8array?"uint8array":"array",l.data);if(this.leftOver&&this.leftOver.length){if(u.uint8array){var h=C;(C=new Uint8Array(h.length+this.leftOver.length)).set(this.leftOver,0),C.set(h,this.leftOver.length)}else C=this.leftOver.concat(C);this.leftOver=null}var w=function(g,S){var D;for((S=S||g.length)>g.length&&(S=g.length),D=S-1;0<=D&&(192&g[D])==128;)D--;return D<0||D===0?S:D+v[g[D]]>S?D:S}(C),r=C;w!==C.length&&(u.uint8array?(r=C.subarray(0,w),this.leftOver=C.subarray(w,C.length)):(r=C.slice(0,w),this.leftOver=C.slice(w,C.length))),this.push({data:o.utf8decode(r),meta:l.meta})},f.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:o.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},o.Utf8DecodeWorker=f,s.inherits(_,c),_.prototype.processChunk=function(l){this.push({data:o.utf8encode(l.data),meta:l.meta})},o.Utf8EncodeWorker=_},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(p,y,o){var s=p("./support"),u=p("./base64"),a=p("./nodejsUtils"),c=p("./external");function v(h){return h}function b(h,w){for(var r=0;r<h.length;++r)w[r]=255&h.charCodeAt(r);return w}p("setimmediate"),o.newBlob=function(h,w){o.checkSupport("blob");try{return new Blob([h],{type:w})}catch{try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return r.append(h),r.getBlob(w)}catch{throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(h,w,r){var g=[],S=0,D=h.length;if(D<=r)return String.fromCharCode.apply(null,h);for(;S<D;)w==="array"||w==="nodebuffer"?g.push(String.fromCharCode.apply(null,h.slice(S,Math.min(S+r,D)))):g.push(String.fromCharCode.apply(null,h.subarray(S,Math.min(S+r,D)))),S+=r;return g.join("")},stringifyByChar:function(h){for(var w="",r=0;r<h.length;r++)w+=String.fromCharCode(h[r]);return w},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function _(h){var w=65536,r=o.getTypeOf(h),g=!0;if(r==="uint8array"?g=f.applyCanBeUsed.uint8array:r==="nodebuffer"&&(g=f.applyCanBeUsed.nodebuffer),g)for(;1<w;)try{return f.stringifyByChunk(h,r,w)}catch{w=Math.floor(w/2)}return f.stringifyByChar(h)}function l(h,w){for(var r=0;r<h.length;r++)w[r]=h[r];return w}o.applyFromCharCode=_;var C={};C.string={string:v,array:function(h){return b(h,new Array(h.length))},arraybuffer:function(h){return C.string.uint8array(h).buffer},uint8array:function(h){return b(h,new Uint8Array(h.length))},nodebuffer:function(h){return b(h,a.allocBuffer(h.length))}},C.array={string:_,array:v,arraybuffer:function(h){return new Uint8Array(h).buffer},uint8array:function(h){return new Uint8Array(h)},nodebuffer:function(h){return a.newBufferFrom(h)}},C.arraybuffer={string:function(h){return _(new Uint8Array(h))},array:function(h){return l(new Uint8Array(h),new Array(h.byteLength))},arraybuffer:v,uint8array:function(h){return new Uint8Array(h)},nodebuffer:function(h){return a.newBufferFrom(new Uint8Array(h))}},C.uint8array={string:_,array:function(h){return l(h,new Array(h.length))},arraybuffer:function(h){return h.buffer},uint8array:v,nodebuffer:function(h){return a.newBufferFrom(h)}},C.nodebuffer={string:_,array:function(h){return l(h,new Array(h.length))},arraybuffer:function(h){return C.nodebuffer.uint8array(h).buffer},uint8array:function(h){return l(h,new Uint8Array(h.length))},nodebuffer:v},o.transformTo=function(h,w){if(w=w||"",!h)return w;o.checkSupport(h);var r=o.getTypeOf(w);return C[r][h](w)},o.resolve=function(h){for(var w=h.split("/"),r=[],g=0;g<w.length;g++){var S=w[g];S==="."||S===""&&g!==0&&g!==w.length-1||(S===".."?r.pop():r.push(S))}return r.join("/")},o.getTypeOf=function(h){return typeof h=="string"?"string":Object.prototype.toString.call(h)==="[object Array]"?"array":s.nodebuffer&&a.isBuffer(h)?"nodebuffer":s.uint8array&&h instanceof Uint8Array?"uint8array":s.arraybuffer&&h instanceof ArrayBuffer?"arraybuffer":void 0},o.checkSupport=function(h){if(!s[h.toLowerCase()])throw new Error(h+" is not supported by this platform")},o.MAX_VALUE_16BITS=65535,o.MAX_VALUE_32BITS=-1,o.pretty=function(h){var w,r,g="";for(r=0;r<(h||"").length;r++)g+="\\x"+((w=h.charCodeAt(r))<16?"0":"")+w.toString(16).toUpperCase();return g},o.delay=function(h,w,r){setImmediate(function(){h.apply(r||null,w||[])})},o.inherits=function(h,w){function r(){}r.prototype=w.prototype,h.prototype=new r},o.extend=function(){var h,w,r={};for(h=0;h<arguments.length;h++)for(w in arguments[h])Object.prototype.hasOwnProperty.call(arguments[h],w)&&r[w]===void 0&&(r[w]=arguments[h][w]);return r},o.prepareContent=function(h,w,r,g,S){return c.Promise.resolve(w).then(function(D){return s.blob&&(D instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(D))!==-1)&&typeof FileReader!="undefined"?new c.Promise(function(V,B){var q=new FileReader;q.onload=function(j){V(j.target.result)},q.onerror=function(j){B(j.target.error)},q.readAsArrayBuffer(D)}):D}).then(function(D){var V=o.getTypeOf(D);return V?(V==="arraybuffer"?D=o.transformTo("uint8array",D):V==="string"&&(S?D=u.decode(D):r&&g!==!0&&(D=function(B){return b(B,s.uint8array?new Uint8Array(B.length):new Array(B.length))}(D))),D):c.Promise.reject(new Error("Can't read the data of '"+h+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(p,y,o){var s=p("./reader/readerFor"),u=p("./utils"),a=p("./signature"),c=p("./zipEntry"),v=p("./support");function b(f){this.files=[],this.loadOptions=f}b.prototype={checkSignature:function(f){if(!this.reader.readAndCheckSignature(f)){this.reader.index-=4;var _=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+u.pretty(_)+", expected "+u.pretty(f)+")")}},isSignature:function(f,_){var l=this.reader.index;this.reader.setIndex(f);var C=this.reader.readString(4)===_;return this.reader.setIndex(l),C},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var f=this.reader.readData(this.zipCommentLength),_=v.uint8array?"uint8array":"array",l=u.transformTo(_,f);this.zipComment=this.loadOptions.decodeFileName(l)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var f,_,l,C=this.zip64EndOfCentralSize-44;0<C;)f=this.reader.readInt(2),_=this.reader.readInt(4),l=this.reader.readData(_),this.zip64ExtensibleData[f]={id:f,length:_,value:l}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var f,_;for(f=0;f<this.files.length;f++)_=this.files[f],this.reader.setIndex(_.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),_.readLocalPart(this.reader),_.handleUTF8(),_.processAttributes()},readCentralDir:function(){var f;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(f=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(f);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var f=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(f<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(f);var _=f;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===u.MAX_VALUE_16BITS||this.diskWithCentralDirStart===u.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===u.MAX_VALUE_16BITS||this.centralDirRecords===u.MAX_VALUE_16BITS||this.centralDirSize===u.MAX_VALUE_32BITS||this.centralDirOffset===u.MAX_VALUE_32BITS){if(this.zip64=!0,(f=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(f),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var l=this.centralDirOffset+this.centralDirSize;this.zip64&&(l+=20,l+=12+this.zip64EndOfCentralSize);var C=_-l;if(0<C)this.isSignature(_,a.CENTRAL_FILE_HEADER)||(this.reader.zero=C);else if(C<0)throw new Error("Corrupted zip: missing "+Math.abs(C)+" bytes.")},prepareReader:function(f){this.reader=s(f)},load:function(f){this.prepareReader(f),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},y.exports=b},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(p,y,o){var s=p("./reader/readerFor"),u=p("./utils"),a=p("./compressedObject"),c=p("./crc32"),v=p("./utf8"),b=p("./compressions"),f=p("./support");function _(l,C){this.options=l,this.loadOptions=C}_.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(l){var C,h;if(l.skip(22),this.fileNameLength=l.readInt(2),h=l.readInt(2),this.fileName=l.readData(this.fileNameLength),l.skip(h),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((C=function(w){for(var r in b)if(Object.prototype.hasOwnProperty.call(b,r)&&b[r].magic===w)return b[r];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+u.pretty(this.compressionMethod)+" unknown (inner file : "+u.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,C,l.readData(this.compressedSize))},readCentralPart:function(l){this.versionMadeBy=l.readInt(2),l.skip(2),this.bitFlag=l.readInt(2),this.compressionMethod=l.readString(2),this.date=l.readDate(),this.crc32=l.readInt(4),this.compressedSize=l.readInt(4),this.uncompressedSize=l.readInt(4);var C=l.readInt(2);if(this.extraFieldsLength=l.readInt(2),this.fileCommentLength=l.readInt(2),this.diskNumberStart=l.readInt(2),this.internalFileAttributes=l.readInt(2),this.externalFileAttributes=l.readInt(4),this.localHeaderOffset=l.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");l.skip(C),this.readExtraFields(l),this.parseZIP64ExtraField(l),this.fileComment=l.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var l=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),l==0&&(this.dosPermissions=63&this.externalFileAttributes),l==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var l=s(this.extraFields[1].value);this.uncompressedSize===u.MAX_VALUE_32BITS&&(this.uncompressedSize=l.readInt(8)),this.compressedSize===u.MAX_VALUE_32BITS&&(this.compressedSize=l.readInt(8)),this.localHeaderOffset===u.MAX_VALUE_32BITS&&(this.localHeaderOffset=l.readInt(8)),this.diskNumberStart===u.MAX_VALUE_32BITS&&(this.diskNumberStart=l.readInt(4))}},readExtraFields:function(l){var C,h,w,r=l.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});l.index+4<r;)C=l.readInt(2),h=l.readInt(2),w=l.readData(h),this.extraFields[C]={id:C,length:h,value:w};l.setIndex(r)},handleUTF8:function(){var l=f.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=v.utf8decode(this.fileName),this.fileCommentStr=v.utf8decode(this.fileComment);else{var C=this.findExtraFieldUnicodePath();if(C!==null)this.fileNameStr=C;else{var h=u.transformTo(l,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(h)}var w=this.findExtraFieldUnicodeComment();if(w!==null)this.fileCommentStr=w;else{var r=u.transformTo(l,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(r)}}},findExtraFieldUnicodePath:function(){var l=this.extraFields[28789];if(l){var C=s(l.value);return C.readInt(1)!==1||c(this.fileName)!==C.readInt(4)?null:v.utf8decode(C.readData(l.length-5))}return null},findExtraFieldUnicodeComment:function(){var l=this.extraFields[25461];if(l){var C=s(l.value);return C.readInt(1)!==1||c(this.fileComment)!==C.readInt(4)?null:v.utf8decode(C.readData(l.length-5))}return null}},y.exports=_},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(p,y,o){function s(C,h,w){this.name=C,this.dir=w.dir,this.date=w.date,this.comment=w.comment,this.unixPermissions=w.unixPermissions,this.dosPermissions=w.dosPermissions,this._data=h,this._dataBinary=w.binary,this.options={compression:w.compression,compressionOptions:w.compressionOptions}}var u=p("./stream/StreamHelper"),a=p("./stream/DataWorker"),c=p("./utf8"),v=p("./compressedObject"),b=p("./stream/GenericWorker");s.prototype={internalStream:function(C){var h=null,w="string";try{if(!C)throw new Error("No output type specified.");var r=(w=C.toLowerCase())==="string"||w==="text";w!=="binarystring"&&w!=="text"||(w="string"),h=this._decompressWorker();var g=!this._dataBinary;g&&!r&&(h=h.pipe(new c.Utf8EncodeWorker)),!g&&r&&(h=h.pipe(new c.Utf8DecodeWorker))}catch(S){(h=new b("error")).error(S)}return new u(h,w,"")},async:function(C,h){return this.internalStream(C).accumulate(h)},nodeStream:function(C,h){return this.internalStream(C||"nodebuffer").toNodejsStream(h)},_compressWorker:function(C,h){if(this._data instanceof v&&this._data.compression.magic===C.magic)return this._data.getCompressedWorker();var w=this._decompressWorker();return this._dataBinary||(w=w.pipe(new c.Utf8EncodeWorker)),v.createWorkerFrom(w,C,h)},_decompressWorker:function(){return this._data instanceof v?this._data.getContentWorker():this._data instanceof b?this._data:new a(this._data)}};for(var f=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],_=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},l=0;l<f.length;l++)s.prototype[f[l]]=_;y.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(p,y,o){(function(s){var u,a,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var v=0,b=new c(C),f=s.document.createTextNode("");b.observe(f,{characterData:!0}),u=function(){f.data=v=++v%2}}else if(s.setImmediate||s.MessageChannel===void 0)u="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var h=s.document.createElement("script");h.onreadystatechange=function(){C(),h.onreadystatechange=null,h.parentNode.removeChild(h),h=null},s.document.documentElement.appendChild(h)}:function(){setTimeout(C,0)};else{var _=new s.MessageChannel;_.port1.onmessage=C,u=function(){_.port2.postMessage(0)}}var l=[];function C(){var h,w;a=!0;for(var r=l.length;r;){for(w=l,l=[],h=-1;++h<r;)w[h]();r=l.length}a=!1}y.exports=function(h){l.push(h)!==1||a||u()}}).call(this,typeof ee!="undefined"?ee:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],37:[function(p,y,o){var s=p("immediate");function u(){}var a={},c=["REJECTED"],v=["FULFILLED"],b=["PENDING"];function f(r){if(typeof r!="function")throw new TypeError("resolver must be a function");this.state=b,this.queue=[],this.outcome=void 0,r!==u&&h(this,r)}function _(r,g,S){this.promise=r,typeof g=="function"&&(this.onFulfilled=g,this.callFulfilled=this.otherCallFulfilled),typeof S=="function"&&(this.onRejected=S,this.callRejected=this.otherCallRejected)}function l(r,g,S){s(function(){var D;try{D=g(S)}catch(V){return a.reject(r,V)}D===r?a.reject(r,new TypeError("Cannot resolve promise with itself")):a.resolve(r,D)})}function C(r){var g=r&&r.then;if(r&&(typeof r=="object"||typeof r=="function")&&typeof g=="function")return function(){g.apply(r,arguments)}}function h(r,g){var S=!1;function D(q){S||(S=!0,a.reject(r,q))}function V(q){S||(S=!0,a.resolve(r,q))}var B=w(function(){g(V,D)});B.status==="error"&&D(B.value)}function w(r,g){var S={};try{S.value=r(g),S.status="success"}catch(D){S.status="error",S.value=D}return S}(y.exports=f).prototype.finally=function(r){if(typeof r!="function")return this;var g=this.constructor;return this.then(function(S){return g.resolve(r()).then(function(){return S})},function(S){return g.resolve(r()).then(function(){throw S})})},f.prototype.catch=function(r){return this.then(null,r)},f.prototype.then=function(r,g){if(typeof r!="function"&&this.state===v||typeof g!="function"&&this.state===c)return this;var S=new this.constructor(u);return this.state!==b?l(S,this.state===v?r:g,this.outcome):this.queue.push(new _(S,r,g)),S},_.prototype.callFulfilled=function(r){a.resolve(this.promise,r)},_.prototype.otherCallFulfilled=function(r){l(this.promise,this.onFulfilled,r)},_.prototype.callRejected=function(r){a.reject(this.promise,r)},_.prototype.otherCallRejected=function(r){l(this.promise,this.onRejected,r)},a.resolve=function(r,g){var S=w(C,g);if(S.status==="error")return a.reject(r,S.value);var D=S.value;if(D)h(r,D);else{r.state=v,r.outcome=g;for(var V=-1,B=r.queue.length;++V<B;)r.queue[V].callFulfilled(g)}return r},a.reject=function(r,g){r.state=c,r.outcome=g;for(var S=-1,D=r.queue.length;++S<D;)r.queue[S].callRejected(g);return r},f.resolve=function(r){return r instanceof this?r:a.resolve(new this(u),r)},f.reject=function(r){var g=new this(u);return a.reject(g,r)},f.all=function(r){var g=this;if(Object.prototype.toString.call(r)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=r.length,D=!1;if(!S)return this.resolve([]);for(var V=new Array(S),B=0,q=-1,j=new this(u);++q<S;)T(r[q],q);return j;function T(X,ot){g.resolve(X).then(function(E){V[ot]=E,++B!==S||D||(D=!0,a.resolve(j,V))},function(E){D||(D=!0,a.reject(j,E))})}},f.race=function(r){var g=this;if(Object.prototype.toString.call(r)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=r.length,D=!1;if(!S)return this.resolve([]);for(var V=-1,B=new this(u);++V<S;)q=r[V],g.resolve(q).then(function(j){D||(D=!0,a.resolve(B,j))},function(j){D||(D=!0,a.reject(B,j))});var q;return B}},{immediate:36}],38:[function(p,y,o){var s={};(0,p("./lib/utils/common").assign)(s,p("./lib/deflate"),p("./lib/inflate"),p("./lib/zlib/constants")),y.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(p,y,o){var s=p("./zlib/deflate"),u=p("./utils/common"),a=p("./utils/strings"),c=p("./zlib/messages"),v=p("./zlib/zstream"),b=Object.prototype.toString,f=0,_=-1,l=0,C=8;function h(r){if(!(this instanceof h))return new h(r);this.options=u.assign({level:_,method:C,chunkSize:16384,windowBits:15,memLevel:8,strategy:l,to:""},r||{});var g=this.options;g.raw&&0<g.windowBits?g.windowBits=-g.windowBits:g.gzip&&0<g.windowBits&&g.windowBits<16&&(g.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new v,this.strm.avail_out=0;var S=s.deflateInit2(this.strm,g.level,g.method,g.windowBits,g.memLevel,g.strategy);if(S!==f)throw new Error(c[S]);if(g.header&&s.deflateSetHeader(this.strm,g.header),g.dictionary){var D;if(D=typeof g.dictionary=="string"?a.string2buf(g.dictionary):b.call(g.dictionary)==="[object ArrayBuffer]"?new Uint8Array(g.dictionary):g.dictionary,(S=s.deflateSetDictionary(this.strm,D))!==f)throw new Error(c[S]);this._dict_set=!0}}function w(r,g){var S=new h(g);if(S.push(r,!0),S.err)throw S.msg||c[S.err];return S.result}h.prototype.push=function(r,g){var S,D,V=this.strm,B=this.options.chunkSize;if(this.ended)return!1;D=g===~~g?g:g===!0?4:0,typeof r=="string"?V.input=a.string2buf(r):b.call(r)==="[object ArrayBuffer]"?V.input=new Uint8Array(r):V.input=r,V.next_in=0,V.avail_in=V.input.length;do{if(V.avail_out===0&&(V.output=new u.Buf8(B),V.next_out=0,V.avail_out=B),(S=s.deflate(V,D))!==1&&S!==f)return this.onEnd(S),!(this.ended=!0);V.avail_out!==0&&(V.avail_in!==0||D!==4&&D!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(u.shrinkBuf(V.output,V.next_out))):this.onData(u.shrinkBuf(V.output,V.next_out)))}while((0<V.avail_in||V.avail_out===0)&&S!==1);return D===4?(S=s.deflateEnd(this.strm),this.onEnd(S),this.ended=!0,S===f):D!==2||(this.onEnd(f),!(V.avail_out=0))},h.prototype.onData=function(r){this.chunks.push(r)},h.prototype.onEnd=function(r){r===f&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=u.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg},o.Deflate=h,o.deflate=w,o.deflateRaw=function(r,g){return(g=g||{}).raw=!0,w(r,g)},o.gzip=function(r,g){return(g=g||{}).gzip=!0,w(r,g)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(p,y,o){var s=p("./zlib/inflate"),u=p("./utils/common"),a=p("./utils/strings"),c=p("./zlib/constants"),v=p("./zlib/messages"),b=p("./zlib/zstream"),f=p("./zlib/gzheader"),_=Object.prototype.toString;function l(h){if(!(this instanceof l))return new l(h);this.options=u.assign({chunkSize:16384,windowBits:0,to:""},h||{});var w=this.options;w.raw&&0<=w.windowBits&&w.windowBits<16&&(w.windowBits=-w.windowBits,w.windowBits===0&&(w.windowBits=-15)),!(0<=w.windowBits&&w.windowBits<16)||h&&h.windowBits||(w.windowBits+=32),15<w.windowBits&&w.windowBits<48&&(15&w.windowBits)==0&&(w.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new b,this.strm.avail_out=0;var r=s.inflateInit2(this.strm,w.windowBits);if(r!==c.Z_OK)throw new Error(v[r]);this.header=new f,s.inflateGetHeader(this.strm,this.header)}function C(h,w){var r=new l(w);if(r.push(h,!0),r.err)throw r.msg||v[r.err];return r.result}l.prototype.push=function(h,w){var r,g,S,D,V,B,q=this.strm,j=this.options.chunkSize,T=this.options.dictionary,X=!1;if(this.ended)return!1;g=w===~~w?w:w===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof h=="string"?q.input=a.binstring2buf(h):_.call(h)==="[object ArrayBuffer]"?q.input=new Uint8Array(h):q.input=h,q.next_in=0,q.avail_in=q.input.length;do{if(q.avail_out===0&&(q.output=new u.Buf8(j),q.next_out=0,q.avail_out=j),(r=s.inflate(q,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&T&&(B=typeof T=="string"?a.string2buf(T):_.call(T)==="[object ArrayBuffer]"?new Uint8Array(T):T,r=s.inflateSetDictionary(this.strm,B)),r===c.Z_BUF_ERROR&&X===!0&&(r=c.Z_OK,X=!1),r!==c.Z_STREAM_END&&r!==c.Z_OK)return this.onEnd(r),!(this.ended=!0);q.next_out&&(q.avail_out!==0&&r!==c.Z_STREAM_END&&(q.avail_in!==0||g!==c.Z_FINISH&&g!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(S=a.utf8border(q.output,q.next_out),D=q.next_out-S,V=a.buf2string(q.output,S),q.next_out=D,q.avail_out=j-D,D&&u.arraySet(q.output,q.output,S,D,0),this.onData(V)):this.onData(u.shrinkBuf(q.output,q.next_out)))),q.avail_in===0&&q.avail_out===0&&(X=!0)}while((0<q.avail_in||q.avail_out===0)&&r!==c.Z_STREAM_END);return r===c.Z_STREAM_END&&(g=c.Z_FINISH),g===c.Z_FINISH?(r=s.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===c.Z_OK):g!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(q.avail_out=0))},l.prototype.onData=function(h){this.chunks.push(h)},l.prototype.onEnd=function(h){h===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=u.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.msg=this.strm.msg},o.Inflate=l,o.inflate=C,o.inflateRaw=function(h,w){return(w=w||{}).raw=!0,C(h,w)},o.ungzip=C},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(p,y,o){var s=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";o.assign=function(c){for(var v=Array.prototype.slice.call(arguments,1);v.length;){var b=v.shift();if(b){if(typeof b!="object")throw new TypeError(b+"must be non-object");for(var f in b)b.hasOwnProperty(f)&&(c[f]=b[f])}}return c},o.shrinkBuf=function(c,v){return c.length===v?c:c.subarray?c.subarray(0,v):(c.length=v,c)};var u={arraySet:function(c,v,b,f,_){if(v.subarray&&c.subarray)c.set(v.subarray(b,b+f),_);else for(var l=0;l<f;l++)c[_+l]=v[b+l]},flattenChunks:function(c){var v,b,f,_,l,C;for(v=f=0,b=c.length;v<b;v++)f+=c[v].length;for(C=new Uint8Array(f),v=_=0,b=c.length;v<b;v++)l=c[v],C.set(l,_),_+=l.length;return C}},a={arraySet:function(c,v,b,f,_){for(var l=0;l<f;l++)c[_+l]=v[b+l]},flattenChunks:function(c){return[].concat.apply([],c)}};o.setTyped=function(c){c?(o.Buf8=Uint8Array,o.Buf16=Uint16Array,o.Buf32=Int32Array,o.assign(o,u)):(o.Buf8=Array,o.Buf16=Array,o.Buf32=Array,o.assign(o,a))},o.setTyped(s)},{}],42:[function(p,y,o){var s=p("./common"),u=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{u=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var c=new s.Buf8(256),v=0;v<256;v++)c[v]=252<=v?6:248<=v?5:240<=v?4:224<=v?3:192<=v?2:1;function b(f,_){if(_<65537&&(f.subarray&&a||!f.subarray&&u))return String.fromCharCode.apply(null,s.shrinkBuf(f,_));for(var l="",C=0;C<_;C++)l+=String.fromCharCode(f[C]);return l}c[254]=c[254]=1,o.string2buf=function(f){var _,l,C,h,w,r=f.length,g=0;for(h=0;h<r;h++)(64512&(l=f.charCodeAt(h)))==55296&&h+1<r&&(64512&(C=f.charCodeAt(h+1)))==56320&&(l=65536+(l-55296<<10)+(C-56320),h++),g+=l<128?1:l<2048?2:l<65536?3:4;for(_=new s.Buf8(g),h=w=0;w<g;h++)(64512&(l=f.charCodeAt(h)))==55296&&h+1<r&&(64512&(C=f.charCodeAt(h+1)))==56320&&(l=65536+(l-55296<<10)+(C-56320),h++),l<128?_[w++]=l:(l<2048?_[w++]=192|l>>>6:(l<65536?_[w++]=224|l>>>12:(_[w++]=240|l>>>18,_[w++]=128|l>>>12&63),_[w++]=128|l>>>6&63),_[w++]=128|63&l);return _},o.buf2binstring=function(f){return b(f,f.length)},o.binstring2buf=function(f){for(var _=new s.Buf8(f.length),l=0,C=_.length;l<C;l++)_[l]=f.charCodeAt(l);return _},o.buf2string=function(f,_){var l,C,h,w,r=_||f.length,g=new Array(2*r);for(l=C=0;l<r;)if((h=f[l++])<128)g[C++]=h;else if(4<(w=c[h]))g[C++]=65533,l+=w-1;else{for(h&=w===2?31:w===3?15:7;1<w&&l<r;)h=h<<6|63&f[l++],w--;1<w?g[C++]=65533:h<65536?g[C++]=h:(h-=65536,g[C++]=55296|h>>10&1023,g[C++]=56320|1023&h)}return b(g,C)},o.utf8border=function(f,_){var l;for((_=_||f.length)>f.length&&(_=f.length),l=_-1;0<=l&&(192&f[l])==128;)l--;return l<0||l===0?_:l+c[f[l]]>_?l:_}},{"./common":41}],43:[function(p,y,o){y.exports=function(s,u,a,c){for(var v=65535&s|0,b=s>>>16&65535|0,f=0;a!==0;){for(a-=f=2e3<a?2e3:a;b=b+(v=v+u[c++]|0)|0,--f;);v%=65521,b%=65521}return v|b<<16|0}},{}],44:[function(p,y,o){y.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(p,y,o){var s=function(){for(var u,a=[],c=0;c<256;c++){u=c;for(var v=0;v<8;v++)u=1&u?3988292384^u>>>1:u>>>1;a[c]=u}return a}();y.exports=function(u,a,c,v){var b=s,f=v+c;u^=-1;for(var _=v;_<f;_++)u=u>>>8^b[255&(u^a[_])];return-1^u}},{}],46:[function(p,y,o){var s,u=p("../utils/common"),a=p("./trees"),c=p("./adler32"),v=p("./crc32"),b=p("./messages"),f=0,_=4,l=0,C=-2,h=-1,w=4,r=2,g=8,S=9,D=286,V=30,B=19,q=2*D+1,j=15,T=3,X=258,ot=X+T+1,E=42,O=113,m=1,R=2,nt=3,Z=4;function rt(d,U){return d.msg=b[U],U}function L(d){return(d<<1)-(4<d?9:0)}function st(d){for(var U=d.length;0<=--U;)d[U]=0}function z(d){var U=d.state,N=U.pending;N>d.avail_out&&(N=d.avail_out),N!==0&&(u.arraySet(d.output,U.pending_buf,U.pending_out,N,d.next_out),d.next_out+=N,U.pending_out+=N,d.total_out+=N,d.avail_out-=N,U.pending-=N,U.pending===0&&(U.pending_out=0))}function F(d,U){a._tr_flush_block(d,0<=d.block_start?d.block_start:-1,d.strstart-d.block_start,U),d.block_start=d.strstart,z(d.strm)}function at(d,U){d.pending_buf[d.pending++]=U}function J(d,U){d.pending_buf[d.pending++]=U>>>8&255,d.pending_buf[d.pending++]=255&U}function Q(d,U){var N,k,I=d.max_chain_length,P=d.strstart,M=d.prev_length,H=d.nice_match,x=d.strstart>d.w_size-ot?d.strstart-(d.w_size-ot):0,W=d.window,et=d.w_mask,G=d.prev,lt=d.strstart+X,wt=W[P+M-1],ht=W[P+M];d.prev_length>=d.good_match&&(I>>=2),H>d.lookahead&&(H=d.lookahead);do if(W[(N=U)+M]===ht&&W[N+M-1]===wt&&W[N]===W[P]&&W[++N]===W[P+1]){P+=2,N++;do;while(W[++P]===W[++N]&&W[++P]===W[++N]&&W[++P]===W[++N]&&W[++P]===W[++N]&&W[++P]===W[++N]&&W[++P]===W[++N]&&W[++P]===W[++N]&&W[++P]===W[++N]&&P<lt);if(k=X-(lt-P),P=lt-X,M<k){if(d.match_start=U,H<=(M=k))break;wt=W[P+M-1],ht=W[P+M]}}while((U=G[U&et])>x&&--I!=0);return M<=d.lookahead?M:d.lookahead}function yt(d){var U,N,k,I,P,M,H,x,W,et,G=d.w_size;do{if(I=d.window_size-d.lookahead-d.strstart,d.strstart>=G+(G-ot)){for(u.arraySet(d.window,d.window,G,G,0),d.match_start-=G,d.strstart-=G,d.block_start-=G,U=N=d.hash_size;k=d.head[--U],d.head[U]=G<=k?k-G:0,--N;);for(U=N=G;k=d.prev[--U],d.prev[U]=G<=k?k-G:0,--N;);I+=G}if(d.strm.avail_in===0)break;if(M=d.strm,H=d.window,x=d.strstart+d.lookahead,W=I,et=void 0,et=M.avail_in,W<et&&(et=W),N=et===0?0:(M.avail_in-=et,u.arraySet(H,M.input,M.next_in,et,x),M.state.wrap===1?M.adler=c(M.adler,H,et,x):M.state.wrap===2&&(M.adler=v(M.adler,H,et,x)),M.next_in+=et,M.total_in+=et,et),d.lookahead+=N,d.lookahead+d.insert>=T)for(P=d.strstart-d.insert,d.ins_h=d.window[P],d.ins_h=(d.ins_h<<d.hash_shift^d.window[P+1])&d.hash_mask;d.insert&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[P+T-1])&d.hash_mask,d.prev[P&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=P,P++,d.insert--,!(d.lookahead+d.insert<T)););}while(d.lookahead<ot&&d.strm.avail_in!==0)}function kt(d,U){for(var N,k;;){if(d.lookahead<ot){if(yt(d),d.lookahead<ot&&U===f)return m;if(d.lookahead===0)break}if(N=0,d.lookahead>=T&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+T-1])&d.hash_mask,N=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),N!==0&&d.strstart-N<=d.w_size-ot&&(d.match_length=Q(d,N)),d.match_length>=T)if(k=a._tr_tally(d,d.strstart-d.match_start,d.match_length-T),d.lookahead-=d.match_length,d.match_length<=d.max_lazy_match&&d.lookahead>=T){for(d.match_length--;d.strstart++,d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+T-1])&d.hash_mask,N=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart,--d.match_length!=0;);d.strstart++}else d.strstart+=d.match_length,d.match_length=0,d.ins_h=d.window[d.strstart],d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+1])&d.hash_mask;else k=a._tr_tally(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++;if(k&&(F(d,!1),d.strm.avail_out===0))return m}return d.insert=d.strstart<T-1?d.strstart:T-1,U===_?(F(d,!0),d.strm.avail_out===0?nt:Z):d.last_lit&&(F(d,!1),d.strm.avail_out===0)?m:R}function pt(d,U){for(var N,k,I;;){if(d.lookahead<ot){if(yt(d),d.lookahead<ot&&U===f)return m;if(d.lookahead===0)break}if(N=0,d.lookahead>=T&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+T-1])&d.hash_mask,N=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),d.prev_length=d.match_length,d.prev_match=d.match_start,d.match_length=T-1,N!==0&&d.prev_length<d.max_lazy_match&&d.strstart-N<=d.w_size-ot&&(d.match_length=Q(d,N),d.match_length<=5&&(d.strategy===1||d.match_length===T&&4096<d.strstart-d.match_start)&&(d.match_length=T-1)),d.prev_length>=T&&d.match_length<=d.prev_length){for(I=d.strstart+d.lookahead-T,k=a._tr_tally(d,d.strstart-1-d.prev_match,d.prev_length-T),d.lookahead-=d.prev_length-1,d.prev_length-=2;++d.strstart<=I&&(d.ins_h=(d.ins_h<<d.hash_shift^d.window[d.strstart+T-1])&d.hash_mask,N=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),--d.prev_length!=0;);if(d.match_available=0,d.match_length=T-1,d.strstart++,k&&(F(d,!1),d.strm.avail_out===0))return m}else if(d.match_available){if((k=a._tr_tally(d,0,d.window[d.strstart-1]))&&F(d,!1),d.strstart++,d.lookahead--,d.strm.avail_out===0)return m}else d.match_available=1,d.strstart++,d.lookahead--}return d.match_available&&(k=a._tr_tally(d,0,d.window[d.strstart-1]),d.match_available=0),d.insert=d.strstart<T-1?d.strstart:T-1,U===_?(F(d,!0),d.strm.avail_out===0?nt:Z):d.last_lit&&(F(d,!1),d.strm.avail_out===0)?m:R}function bt(d,U,N,k,I){this.good_length=d,this.max_lazy=U,this.nice_length=N,this.max_chain=k,this.func=I}function Et(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new u.Buf16(2*q),this.dyn_dtree=new u.Buf16(2*(2*V+1)),this.bl_tree=new u.Buf16(2*(2*B+1)),st(this.dyn_ltree),st(this.dyn_dtree),st(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new u.Buf16(j+1),this.heap=new u.Buf16(2*D+1),st(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new u.Buf16(2*D+1),st(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function It(d){var U;return d&&d.state?(d.total_in=d.total_out=0,d.data_type=r,(U=d.state).pending=0,U.pending_out=0,U.wrap<0&&(U.wrap=-U.wrap),U.status=U.wrap?E:O,d.adler=U.wrap===2?0:1,U.last_flush=f,a._tr_init(U),l):rt(d,C)}function qt(d){var U=It(d);return U===l&&function(N){N.window_size=2*N.w_size,st(N.head),N.max_lazy_match=s[N.level].max_lazy,N.good_match=s[N.level].good_length,N.nice_match=s[N.level].nice_length,N.max_chain_length=s[N.level].max_chain,N.strstart=0,N.block_start=0,N.lookahead=0,N.insert=0,N.match_length=N.prev_length=T-1,N.match_available=0,N.ins_h=0}(d.state),U}function At(d,U,N,k,I,P){if(!d)return C;var M=1;if(U===h&&(U=6),k<0?(M=0,k=-k):15<k&&(M=2,k-=16),I<1||S<I||N!==g||k<8||15<k||U<0||9<U||P<0||w<P)return rt(d,C);k===8&&(k=9);var H=new Et;return(d.state=H).strm=d,H.wrap=M,H.gzhead=null,H.w_bits=k,H.w_size=1<<H.w_bits,H.w_mask=H.w_size-1,H.hash_bits=I+7,H.hash_size=1<<H.hash_bits,H.hash_mask=H.hash_size-1,H.hash_shift=~~((H.hash_bits+T-1)/T),H.window=new u.Buf8(2*H.w_size),H.head=new u.Buf16(H.hash_size),H.prev=new u.Buf16(H.w_size),H.lit_bufsize=1<<I+6,H.pending_buf_size=4*H.lit_bufsize,H.pending_buf=new u.Buf8(H.pending_buf_size),H.d_buf=1*H.lit_bufsize,H.l_buf=3*H.lit_bufsize,H.level=U,H.strategy=P,H.method=N,qt(d)}s=[new bt(0,0,0,0,function(d,U){var N=65535;for(N>d.pending_buf_size-5&&(N=d.pending_buf_size-5);;){if(d.lookahead<=1){if(yt(d),d.lookahead===0&&U===f)return m;if(d.lookahead===0)break}d.strstart+=d.lookahead,d.lookahead=0;var k=d.block_start+N;if((d.strstart===0||d.strstart>=k)&&(d.lookahead=d.strstart-k,d.strstart=k,F(d,!1),d.strm.avail_out===0)||d.strstart-d.block_start>=d.w_size-ot&&(F(d,!1),d.strm.avail_out===0))return m}return d.insert=0,U===_?(F(d,!0),d.strm.avail_out===0?nt:Z):(d.strstart>d.block_start&&(F(d,!1),d.strm.avail_out),m)}),new bt(4,4,8,4,kt),new bt(4,5,16,8,kt),new bt(4,6,32,32,kt),new bt(4,4,16,16,pt),new bt(8,16,32,32,pt),new bt(8,16,128,128,pt),new bt(8,32,128,256,pt),new bt(32,128,258,1024,pt),new bt(32,258,258,4096,pt)],o.deflateInit=function(d,U){return At(d,U,g,15,8,0)},o.deflateInit2=At,o.deflateReset=qt,o.deflateResetKeep=It,o.deflateSetHeader=function(d,U){return d&&d.state?d.state.wrap!==2?C:(d.state.gzhead=U,l):C},o.deflate=function(d,U){var N,k,I,P;if(!d||!d.state||5<U||U<0)return d?rt(d,C):C;if(k=d.state,!d.output||!d.input&&d.avail_in!==0||k.status===666&&U!==_)return rt(d,d.avail_out===0?-5:C);if(k.strm=d,N=k.last_flush,k.last_flush=U,k.status===E)if(k.wrap===2)d.adler=0,at(k,31),at(k,139),at(k,8),k.gzhead?(at(k,(k.gzhead.text?1:0)+(k.gzhead.hcrc?2:0)+(k.gzhead.extra?4:0)+(k.gzhead.name?8:0)+(k.gzhead.comment?16:0)),at(k,255&k.gzhead.time),at(k,k.gzhead.time>>8&255),at(k,k.gzhead.time>>16&255),at(k,k.gzhead.time>>24&255),at(k,k.level===9?2:2<=k.strategy||k.level<2?4:0),at(k,255&k.gzhead.os),k.gzhead.extra&&k.gzhead.extra.length&&(at(k,255&k.gzhead.extra.length),at(k,k.gzhead.extra.length>>8&255)),k.gzhead.hcrc&&(d.adler=v(d.adler,k.pending_buf,k.pending,0)),k.gzindex=0,k.status=69):(at(k,0),at(k,0),at(k,0),at(k,0),at(k,0),at(k,k.level===9?2:2<=k.strategy||k.level<2?4:0),at(k,3),k.status=O);else{var M=g+(k.w_bits-8<<4)<<8;M|=(2<=k.strategy||k.level<2?0:k.level<6?1:k.level===6?2:3)<<6,k.strstart!==0&&(M|=32),M+=31-M%31,k.status=O,J(k,M),k.strstart!==0&&(J(k,d.adler>>>16),J(k,65535&d.adler)),d.adler=1}if(k.status===69)if(k.gzhead.extra){for(I=k.pending;k.gzindex<(65535&k.gzhead.extra.length)&&(k.pending!==k.pending_buf_size||(k.gzhead.hcrc&&k.pending>I&&(d.adler=v(d.adler,k.pending_buf,k.pending-I,I)),z(d),I=k.pending,k.pending!==k.pending_buf_size));)at(k,255&k.gzhead.extra[k.gzindex]),k.gzindex++;k.gzhead.hcrc&&k.pending>I&&(d.adler=v(d.adler,k.pending_buf,k.pending-I,I)),k.gzindex===k.gzhead.extra.length&&(k.gzindex=0,k.status=73)}else k.status=73;if(k.status===73)if(k.gzhead.name){I=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>I&&(d.adler=v(d.adler,k.pending_buf,k.pending-I,I)),z(d),I=k.pending,k.pending===k.pending_buf_size)){P=1;break}P=k.gzindex<k.gzhead.name.length?255&k.gzhead.name.charCodeAt(k.gzindex++):0,at(k,P)}while(P!==0);k.gzhead.hcrc&&k.pending>I&&(d.adler=v(d.adler,k.pending_buf,k.pending-I,I)),P===0&&(k.gzindex=0,k.status=91)}else k.status=91;if(k.status===91)if(k.gzhead.comment){I=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>I&&(d.adler=v(d.adler,k.pending_buf,k.pending-I,I)),z(d),I=k.pending,k.pending===k.pending_buf_size)){P=1;break}P=k.gzindex<k.gzhead.comment.length?255&k.gzhead.comment.charCodeAt(k.gzindex++):0,at(k,P)}while(P!==0);k.gzhead.hcrc&&k.pending>I&&(d.adler=v(d.adler,k.pending_buf,k.pending-I,I)),P===0&&(k.status=103)}else k.status=103;if(k.status===103&&(k.gzhead.hcrc?(k.pending+2>k.pending_buf_size&&z(d),k.pending+2<=k.pending_buf_size&&(at(k,255&d.adler),at(k,d.adler>>8&255),d.adler=0,k.status=O)):k.status=O),k.pending!==0){if(z(d),d.avail_out===0)return k.last_flush=-1,l}else if(d.avail_in===0&&L(U)<=L(N)&&U!==_)return rt(d,-5);if(k.status===666&&d.avail_in!==0)return rt(d,-5);if(d.avail_in!==0||k.lookahead!==0||U!==f&&k.status!==666){var H=k.strategy===2?function(x,W){for(var et;;){if(x.lookahead===0&&(yt(x),x.lookahead===0)){if(W===f)return m;break}if(x.match_length=0,et=a._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++,et&&(F(x,!1),x.strm.avail_out===0))return m}return x.insert=0,W===_?(F(x,!0),x.strm.avail_out===0?nt:Z):x.last_lit&&(F(x,!1),x.strm.avail_out===0)?m:R}(k,U):k.strategy===3?function(x,W){for(var et,G,lt,wt,ht=x.window;;){if(x.lookahead<=X){if(yt(x),x.lookahead<=X&&W===f)return m;if(x.lookahead===0)break}if(x.match_length=0,x.lookahead>=T&&0<x.strstart&&(G=ht[lt=x.strstart-1])===ht[++lt]&&G===ht[++lt]&&G===ht[++lt]){wt=x.strstart+X;do;while(G===ht[++lt]&&G===ht[++lt]&&G===ht[++lt]&&G===ht[++lt]&&G===ht[++lt]&&G===ht[++lt]&&G===ht[++lt]&&G===ht[++lt]&&lt<wt);x.match_length=X-(wt-lt),x.match_length>x.lookahead&&(x.match_length=x.lookahead)}if(x.match_length>=T?(et=a._tr_tally(x,1,x.match_length-T),x.lookahead-=x.match_length,x.strstart+=x.match_length,x.match_length=0):(et=a._tr_tally(x,0,x.window[x.strstart]),x.lookahead--,x.strstart++),et&&(F(x,!1),x.strm.avail_out===0))return m}return x.insert=0,W===_?(F(x,!0),x.strm.avail_out===0?nt:Z):x.last_lit&&(F(x,!1),x.strm.avail_out===0)?m:R}(k,U):s[k.level].func(k,U);if(H!==nt&&H!==Z||(k.status=666),H===m||H===nt)return d.avail_out===0&&(k.last_flush=-1),l;if(H===R&&(U===1?a._tr_align(k):U!==5&&(a._tr_stored_block(k,0,0,!1),U===3&&(st(k.head),k.lookahead===0&&(k.strstart=0,k.block_start=0,k.insert=0))),z(d),d.avail_out===0))return k.last_flush=-1,l}return U!==_?l:k.wrap<=0?1:(k.wrap===2?(at(k,255&d.adler),at(k,d.adler>>8&255),at(k,d.adler>>16&255),at(k,d.adler>>24&255),at(k,255&d.total_in),at(k,d.total_in>>8&255),at(k,d.total_in>>16&255),at(k,d.total_in>>24&255)):(J(k,d.adler>>>16),J(k,65535&d.adler)),z(d),0<k.wrap&&(k.wrap=-k.wrap),k.pending!==0?l:1)},o.deflateEnd=function(d){var U;return d&&d.state?(U=d.state.status)!==E&&U!==69&&U!==73&&U!==91&&U!==103&&U!==O&&U!==666?rt(d,C):(d.state=null,U===O?rt(d,-3):l):C},o.deflateSetDictionary=function(d,U){var N,k,I,P,M,H,x,W,et=U.length;if(!d||!d.state||(P=(N=d.state).wrap)===2||P===1&&N.status!==E||N.lookahead)return C;for(P===1&&(d.adler=c(d.adler,U,et,0)),N.wrap=0,et>=N.w_size&&(P===0&&(st(N.head),N.strstart=0,N.block_start=0,N.insert=0),W=new u.Buf8(N.w_size),u.arraySet(W,U,et-N.w_size,N.w_size,0),U=W,et=N.w_size),M=d.avail_in,H=d.next_in,x=d.input,d.avail_in=et,d.next_in=0,d.input=U,yt(N);N.lookahead>=T;){for(k=N.strstart,I=N.lookahead-(T-1);N.ins_h=(N.ins_h<<N.hash_shift^N.window[k+T-1])&N.hash_mask,N.prev[k&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=k,k++,--I;);N.strstart=k,N.lookahead=T-1,yt(N)}return N.strstart+=N.lookahead,N.block_start=N.strstart,N.insert=N.lookahead,N.lookahead=0,N.match_length=N.prev_length=T-1,N.match_available=0,d.next_in=H,d.input=x,d.avail_in=M,N.wrap=P,l},o.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(p,y,o){y.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(p,y,o){y.exports=function(s,u){var a,c,v,b,f,_,l,C,h,w,r,g,S,D,V,B,q,j,T,X,ot,E,O,m,R;a=s.state,c=s.next_in,m=s.input,v=c+(s.avail_in-5),b=s.next_out,R=s.output,f=b-(u-s.avail_out),_=b+(s.avail_out-257),l=a.dmax,C=a.wsize,h=a.whave,w=a.wnext,r=a.window,g=a.hold,S=a.bits,D=a.lencode,V=a.distcode,B=(1<<a.lenbits)-1,q=(1<<a.distbits)-1;t:do{S<15&&(g+=m[c++]<<S,S+=8,g+=m[c++]<<S,S+=8),j=D[g&B];e:for(;;){if(g>>>=T=j>>>24,S-=T,(T=j>>>16&255)===0)R[b++]=65535&j;else{if(!(16&T)){if((64&T)==0){j=D[(65535&j)+(g&(1<<T)-1)];continue e}if(32&T){a.mode=12;break t}s.msg="invalid literal/length code",a.mode=30;break t}X=65535&j,(T&=15)&&(S<T&&(g+=m[c++]<<S,S+=8),X+=g&(1<<T)-1,g>>>=T,S-=T),S<15&&(g+=m[c++]<<S,S+=8,g+=m[c++]<<S,S+=8),j=V[g&q];a:for(;;){if(g>>>=T=j>>>24,S-=T,!(16&(T=j>>>16&255))){if((64&T)==0){j=V[(65535&j)+(g&(1<<T)-1)];continue a}s.msg="invalid distance code",a.mode=30;break t}if(ot=65535&j,S<(T&=15)&&(g+=m[c++]<<S,(S+=8)<T&&(g+=m[c++]<<S,S+=8)),l<(ot+=g&(1<<T)-1)){s.msg="invalid distance too far back",a.mode=30;break t}if(g>>>=T,S-=T,(T=b-f)<ot){if(h<(T=ot-T)&&a.sane){s.msg="invalid distance too far back",a.mode=30;break t}if(O=r,(E=0)===w){if(E+=C-T,T<X){for(X-=T;R[b++]=r[E++],--T;);E=b-ot,O=R}}else if(w<T){if(E+=C+w-T,(T-=w)<X){for(X-=T;R[b++]=r[E++],--T;);if(E=0,w<X){for(X-=T=w;R[b++]=r[E++],--T;);E=b-ot,O=R}}}else if(E+=w-T,T<X){for(X-=T;R[b++]=r[E++],--T;);E=b-ot,O=R}for(;2<X;)R[b++]=O[E++],R[b++]=O[E++],R[b++]=O[E++],X-=3;X&&(R[b++]=O[E++],1<X&&(R[b++]=O[E++]))}else{for(E=b-ot;R[b++]=R[E++],R[b++]=R[E++],R[b++]=R[E++],2<(X-=3););X&&(R[b++]=R[E++],1<X&&(R[b++]=R[E++]))}break}}break}}while(c<v&&b<_);c-=X=S>>3,g&=(1<<(S-=X<<3))-1,s.next_in=c,s.next_out=b,s.avail_in=c<v?v-c+5:5-(c-v),s.avail_out=b<_?_-b+257:257-(b-_),a.hold=g,a.bits=S}},{}],49:[function(p,y,o){var s=p("../utils/common"),u=p("./adler32"),a=p("./crc32"),c=p("./inffast"),v=p("./inftrees"),b=1,f=2,_=0,l=-2,C=1,h=852,w=592;function r(E){return(E>>>24&255)+(E>>>8&65280)+((65280&E)<<8)+((255&E)<<24)}function g(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function S(E){var O;return E&&E.state?(O=E.state,E.total_in=E.total_out=O.total=0,E.msg="",O.wrap&&(E.adler=1&O.wrap),O.mode=C,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new s.Buf32(h),O.distcode=O.distdyn=new s.Buf32(w),O.sane=1,O.back=-1,_):l}function D(E){var O;return E&&E.state?((O=E.state).wsize=0,O.whave=0,O.wnext=0,S(E)):l}function V(E,O){var m,R;return E&&E.state?(R=E.state,O<0?(m=0,O=-O):(m=1+(O>>4),O<48&&(O&=15)),O&&(O<8||15<O)?l:(R.window!==null&&R.wbits!==O&&(R.window=null),R.wrap=m,R.wbits=O,D(E))):l}function B(E,O){var m,R;return E?(R=new g,(E.state=R).window=null,(m=V(E,O))!==_&&(E.state=null),m):l}var q,j,T=!0;function X(E){if(T){var O;for(q=new s.Buf32(512),j=new s.Buf32(32),O=0;O<144;)E.lens[O++]=8;for(;O<256;)E.lens[O++]=9;for(;O<280;)E.lens[O++]=7;for(;O<288;)E.lens[O++]=8;for(v(b,E.lens,0,288,q,0,E.work,{bits:9}),O=0;O<32;)E.lens[O++]=5;v(f,E.lens,0,32,j,0,E.work,{bits:5}),T=!1}E.lencode=q,E.lenbits=9,E.distcode=j,E.distbits=5}function ot(E,O,m,R){var nt,Z=E.state;return Z.window===null&&(Z.wsize=1<<Z.wbits,Z.wnext=0,Z.whave=0,Z.window=new s.Buf8(Z.wsize)),R>=Z.wsize?(s.arraySet(Z.window,O,m-Z.wsize,Z.wsize,0),Z.wnext=0,Z.whave=Z.wsize):(R<(nt=Z.wsize-Z.wnext)&&(nt=R),s.arraySet(Z.window,O,m-R,nt,Z.wnext),(R-=nt)?(s.arraySet(Z.window,O,m-R,R,0),Z.wnext=R,Z.whave=Z.wsize):(Z.wnext+=nt,Z.wnext===Z.wsize&&(Z.wnext=0),Z.whave<Z.wsize&&(Z.whave+=nt))),0}o.inflateReset=D,o.inflateReset2=V,o.inflateResetKeep=S,o.inflateInit=function(E){return B(E,15)},o.inflateInit2=B,o.inflate=function(E,O){var m,R,nt,Z,rt,L,st,z,F,at,J,Q,yt,kt,pt,bt,Et,It,qt,At,d,U,N,k,I=0,P=new s.Buf8(4),M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!E||!E.state||!E.output||!E.input&&E.avail_in!==0)return l;(m=E.state).mode===12&&(m.mode=13),rt=E.next_out,nt=E.output,st=E.avail_out,Z=E.next_in,R=E.input,L=E.avail_in,z=m.hold,F=m.bits,at=L,J=st,U=_;t:for(;;)switch(m.mode){case C:if(m.wrap===0){m.mode=13;break}for(;F<16;){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}if(2&m.wrap&&z===35615){P[m.check=0]=255&z,P[1]=z>>>8&255,m.check=a(m.check,P,2,0),F=z=0,m.mode=2;break}if(m.flags=0,m.head&&(m.head.done=!1),!(1&m.wrap)||(((255&z)<<8)+(z>>8))%31){E.msg="incorrect header check",m.mode=30;break}if((15&z)!=8){E.msg="unknown compression method",m.mode=30;break}if(F-=4,d=8+(15&(z>>>=4)),m.wbits===0)m.wbits=d;else if(d>m.wbits){E.msg="invalid window size",m.mode=30;break}m.dmax=1<<d,E.adler=m.check=1,m.mode=512&z?10:12,F=z=0;break;case 2:for(;F<16;){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}if(m.flags=z,(255&m.flags)!=8){E.msg="unknown compression method",m.mode=30;break}if(57344&m.flags){E.msg="unknown header flags set",m.mode=30;break}m.head&&(m.head.text=z>>8&1),512&m.flags&&(P[0]=255&z,P[1]=z>>>8&255,m.check=a(m.check,P,2,0)),F=z=0,m.mode=3;case 3:for(;F<32;){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}m.head&&(m.head.time=z),512&m.flags&&(P[0]=255&z,P[1]=z>>>8&255,P[2]=z>>>16&255,P[3]=z>>>24&255,m.check=a(m.check,P,4,0)),F=z=0,m.mode=4;case 4:for(;F<16;){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}m.head&&(m.head.xflags=255&z,m.head.os=z>>8),512&m.flags&&(P[0]=255&z,P[1]=z>>>8&255,m.check=a(m.check,P,2,0)),F=z=0,m.mode=5;case 5:if(1024&m.flags){for(;F<16;){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}m.length=z,m.head&&(m.head.extra_len=z),512&m.flags&&(P[0]=255&z,P[1]=z>>>8&255,m.check=a(m.check,P,2,0)),F=z=0}else m.head&&(m.head.extra=null);m.mode=6;case 6:if(1024&m.flags&&(L<(Q=m.length)&&(Q=L),Q&&(m.head&&(d=m.head.extra_len-m.length,m.head.extra||(m.head.extra=new Array(m.head.extra_len)),s.arraySet(m.head.extra,R,Z,Q,d)),512&m.flags&&(m.check=a(m.check,R,Q,Z)),L-=Q,Z+=Q,m.length-=Q),m.length))break t;m.length=0,m.mode=7;case 7:if(2048&m.flags){if(L===0)break t;for(Q=0;d=R[Z+Q++],m.head&&d&&m.length<65536&&(m.head.name+=String.fromCharCode(d)),d&&Q<L;);if(512&m.flags&&(m.check=a(m.check,R,Q,Z)),L-=Q,Z+=Q,d)break t}else m.head&&(m.head.name=null);m.length=0,m.mode=8;case 8:if(4096&m.flags){if(L===0)break t;for(Q=0;d=R[Z+Q++],m.head&&d&&m.length<65536&&(m.head.comment+=String.fromCharCode(d)),d&&Q<L;);if(512&m.flags&&(m.check=a(m.check,R,Q,Z)),L-=Q,Z+=Q,d)break t}else m.head&&(m.head.comment=null);m.mode=9;case 9:if(512&m.flags){for(;F<16;){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}if(z!==(65535&m.check)){E.msg="header crc mismatch",m.mode=30;break}F=z=0}m.head&&(m.head.hcrc=m.flags>>9&1,m.head.done=!0),E.adler=m.check=0,m.mode=12;break;case 10:for(;F<32;){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}E.adler=m.check=r(z),F=z=0,m.mode=11;case 11:if(m.havedict===0)return E.next_out=rt,E.avail_out=st,E.next_in=Z,E.avail_in=L,m.hold=z,m.bits=F,2;E.adler=m.check=1,m.mode=12;case 12:if(O===5||O===6)break t;case 13:if(m.last){z>>>=7&F,F-=7&F,m.mode=27;break}for(;F<3;){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}switch(m.last=1&z,F-=1,3&(z>>>=1)){case 0:m.mode=14;break;case 1:if(X(m),m.mode=20,O!==6)break;z>>>=2,F-=2;break t;case 2:m.mode=17;break;case 3:E.msg="invalid block type",m.mode=30}z>>>=2,F-=2;break;case 14:for(z>>>=7&F,F-=7&F;F<32;){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}if((65535&z)!=(z>>>16^65535)){E.msg="invalid stored block lengths",m.mode=30;break}if(m.length=65535&z,F=z=0,m.mode=15,O===6)break t;case 15:m.mode=16;case 16:if(Q=m.length){if(L<Q&&(Q=L),st<Q&&(Q=st),Q===0)break t;s.arraySet(nt,R,Z,Q,rt),L-=Q,Z+=Q,st-=Q,rt+=Q,m.length-=Q;break}m.mode=12;break;case 17:for(;F<14;){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}if(m.nlen=257+(31&z),z>>>=5,F-=5,m.ndist=1+(31&z),z>>>=5,F-=5,m.ncode=4+(15&z),z>>>=4,F-=4,286<m.nlen||30<m.ndist){E.msg="too many length or distance symbols",m.mode=30;break}m.have=0,m.mode=18;case 18:for(;m.have<m.ncode;){for(;F<3;){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}m.lens[M[m.have++]]=7&z,z>>>=3,F-=3}for(;m.have<19;)m.lens[M[m.have++]]=0;if(m.lencode=m.lendyn,m.lenbits=7,N={bits:m.lenbits},U=v(0,m.lens,0,19,m.lencode,0,m.work,N),m.lenbits=N.bits,U){E.msg="invalid code lengths set",m.mode=30;break}m.have=0,m.mode=19;case 19:for(;m.have<m.nlen+m.ndist;){for(;bt=(I=m.lencode[z&(1<<m.lenbits)-1])>>>16&255,Et=65535&I,!((pt=I>>>24)<=F);){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}if(Et<16)z>>>=pt,F-=pt,m.lens[m.have++]=Et;else{if(Et===16){for(k=pt+2;F<k;){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}if(z>>>=pt,F-=pt,m.have===0){E.msg="invalid bit length repeat",m.mode=30;break}d=m.lens[m.have-1],Q=3+(3&z),z>>>=2,F-=2}else if(Et===17){for(k=pt+3;F<k;){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}F-=pt,d=0,Q=3+(7&(z>>>=pt)),z>>>=3,F-=3}else{for(k=pt+7;F<k;){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}F-=pt,d=0,Q=11+(127&(z>>>=pt)),z>>>=7,F-=7}if(m.have+Q>m.nlen+m.ndist){E.msg="invalid bit length repeat",m.mode=30;break}for(;Q--;)m.lens[m.have++]=d}}if(m.mode===30)break;if(m.lens[256]===0){E.msg="invalid code -- missing end-of-block",m.mode=30;break}if(m.lenbits=9,N={bits:m.lenbits},U=v(b,m.lens,0,m.nlen,m.lencode,0,m.work,N),m.lenbits=N.bits,U){E.msg="invalid literal/lengths set",m.mode=30;break}if(m.distbits=6,m.distcode=m.distdyn,N={bits:m.distbits},U=v(f,m.lens,m.nlen,m.ndist,m.distcode,0,m.work,N),m.distbits=N.bits,U){E.msg="invalid distances set",m.mode=30;break}if(m.mode=20,O===6)break t;case 20:m.mode=21;case 21:if(6<=L&&258<=st){E.next_out=rt,E.avail_out=st,E.next_in=Z,E.avail_in=L,m.hold=z,m.bits=F,c(E,J),rt=E.next_out,nt=E.output,st=E.avail_out,Z=E.next_in,R=E.input,L=E.avail_in,z=m.hold,F=m.bits,m.mode===12&&(m.back=-1);break}for(m.back=0;bt=(I=m.lencode[z&(1<<m.lenbits)-1])>>>16&255,Et=65535&I,!((pt=I>>>24)<=F);){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}if(bt&&(240&bt)==0){for(It=pt,qt=bt,At=Et;bt=(I=m.lencode[At+((z&(1<<It+qt)-1)>>It)])>>>16&255,Et=65535&I,!(It+(pt=I>>>24)<=F);){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}z>>>=It,F-=It,m.back+=It}if(z>>>=pt,F-=pt,m.back+=pt,m.length=Et,bt===0){m.mode=26;break}if(32&bt){m.back=-1,m.mode=12;break}if(64&bt){E.msg="invalid literal/length code",m.mode=30;break}m.extra=15&bt,m.mode=22;case 22:if(m.extra){for(k=m.extra;F<k;){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}m.length+=z&(1<<m.extra)-1,z>>>=m.extra,F-=m.extra,m.back+=m.extra}m.was=m.length,m.mode=23;case 23:for(;bt=(I=m.distcode[z&(1<<m.distbits)-1])>>>16&255,Et=65535&I,!((pt=I>>>24)<=F);){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}if((240&bt)==0){for(It=pt,qt=bt,At=Et;bt=(I=m.distcode[At+((z&(1<<It+qt)-1)>>It)])>>>16&255,Et=65535&I,!(It+(pt=I>>>24)<=F);){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}z>>>=It,F-=It,m.back+=It}if(z>>>=pt,F-=pt,m.back+=pt,64&bt){E.msg="invalid distance code",m.mode=30;break}m.offset=Et,m.extra=15&bt,m.mode=24;case 24:if(m.extra){for(k=m.extra;F<k;){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}m.offset+=z&(1<<m.extra)-1,z>>>=m.extra,F-=m.extra,m.back+=m.extra}if(m.offset>m.dmax){E.msg="invalid distance too far back",m.mode=30;break}m.mode=25;case 25:if(st===0)break t;if(Q=J-st,m.offset>Q){if((Q=m.offset-Q)>m.whave&&m.sane){E.msg="invalid distance too far back",m.mode=30;break}yt=Q>m.wnext?(Q-=m.wnext,m.wsize-Q):m.wnext-Q,Q>m.length&&(Q=m.length),kt=m.window}else kt=nt,yt=rt-m.offset,Q=m.length;for(st<Q&&(Q=st),st-=Q,m.length-=Q;nt[rt++]=kt[yt++],--Q;);m.length===0&&(m.mode=21);break;case 26:if(st===0)break t;nt[rt++]=m.length,st--,m.mode=21;break;case 27:if(m.wrap){for(;F<32;){if(L===0)break t;L--,z|=R[Z++]<<F,F+=8}if(J-=st,E.total_out+=J,m.total+=J,J&&(E.adler=m.check=m.flags?a(m.check,nt,J,rt-J):u(m.check,nt,J,rt-J)),J=st,(m.flags?z:r(z))!==m.check){E.msg="incorrect data check",m.mode=30;break}F=z=0}m.mode=28;case 28:if(m.wrap&&m.flags){for(;F<32;){if(L===0)break t;L--,z+=R[Z++]<<F,F+=8}if(z!==(4294967295&m.total)){E.msg="incorrect length check",m.mode=30;break}F=z=0}m.mode=29;case 29:U=1;break t;case 30:U=-3;break t;case 31:return-4;case 32:default:return l}return E.next_out=rt,E.avail_out=st,E.next_in=Z,E.avail_in=L,m.hold=z,m.bits=F,(m.wsize||J!==E.avail_out&&m.mode<30&&(m.mode<27||O!==4))&&ot(E,E.output,E.next_out,J-E.avail_out)?(m.mode=31,-4):(at-=E.avail_in,J-=E.avail_out,E.total_in+=at,E.total_out+=J,m.total+=J,m.wrap&&J&&(E.adler=m.check=m.flags?a(m.check,nt,J,E.next_out-J):u(m.check,nt,J,E.next_out-J)),E.data_type=m.bits+(m.last?64:0)+(m.mode===12?128:0)+(m.mode===20||m.mode===15?256:0),(at==0&&J===0||O===4)&&U===_&&(U=-5),U)},o.inflateEnd=function(E){if(!E||!E.state)return l;var O=E.state;return O.window&&(O.window=null),E.state=null,_},o.inflateGetHeader=function(E,O){var m;return E&&E.state?(2&(m=E.state).wrap)==0?l:((m.head=O).done=!1,_):l},o.inflateSetDictionary=function(E,O){var m,R=O.length;return E&&E.state?(m=E.state).wrap!==0&&m.mode!==11?l:m.mode===11&&u(1,O,R,0)!==m.check?-3:ot(E,O,R,R)?(m.mode=31,-4):(m.havedict=1,_):l},o.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(p,y,o){var s=p("../utils/common"),u=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],v=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];y.exports=function(b,f,_,l,C,h,w,r){var g,S,D,V,B,q,j,T,X,ot=r.bits,E=0,O=0,m=0,R=0,nt=0,Z=0,rt=0,L=0,st=0,z=0,F=null,at=0,J=new s.Buf16(16),Q=new s.Buf16(16),yt=null,kt=0;for(E=0;E<=15;E++)J[E]=0;for(O=0;O<l;O++)J[f[_+O]]++;for(nt=ot,R=15;1<=R&&J[R]===0;R--);if(R<nt&&(nt=R),R===0)return C[h++]=20971520,C[h++]=20971520,r.bits=1,0;for(m=1;m<R&&J[m]===0;m++);for(nt<m&&(nt=m),E=L=1;E<=15;E++)if(L<<=1,(L-=J[E])<0)return-1;if(0<L&&(b===0||R!==1))return-1;for(Q[1]=0,E=1;E<15;E++)Q[E+1]=Q[E]+J[E];for(O=0;O<l;O++)f[_+O]!==0&&(w[Q[f[_+O]]++]=O);if(q=b===0?(F=yt=w,19):b===1?(F=u,at-=257,yt=a,kt-=257,256):(F=c,yt=v,-1),E=m,B=h,rt=O=z=0,D=-1,V=(st=1<<(Z=nt))-1,b===1&&852<st||b===2&&592<st)return 1;for(;;){for(j=E-rt,X=w[O]<q?(T=0,w[O]):w[O]>q?(T=yt[kt+w[O]],F[at+w[O]]):(T=96,0),g=1<<E-rt,m=S=1<<Z;C[B+(z>>rt)+(S-=g)]=j<<24|T<<16|X|0,S!==0;);for(g=1<<E-1;z&g;)g>>=1;if(g!==0?(z&=g-1,z+=g):z=0,O++,--J[E]==0){if(E===R)break;E=f[_+w[O]]}if(nt<E&&(z&V)!==D){for(rt===0&&(rt=nt),B+=m,L=1<<(Z=E-rt);Z+rt<R&&!((L-=J[Z+rt])<=0);)Z++,L<<=1;if(st+=1<<Z,b===1&&852<st||b===2&&592<st)return 1;C[D=z&V]=nt<<24|Z<<16|B-h|0}}return z!==0&&(C[B+z]=E-rt<<24|64<<16|0),r.bits=nt,0}},{"../utils/common":41}],51:[function(p,y,o){y.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(p,y,o){var s=p("../utils/common"),u=0,a=1;function c(I){for(var P=I.length;0<=--P;)I[P]=0}var v=0,b=29,f=256,_=f+1+b,l=30,C=19,h=2*_+1,w=15,r=16,g=7,S=256,D=16,V=17,B=18,q=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],j=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ot=new Array(2*(_+2));c(ot);var E=new Array(2*l);c(E);var O=new Array(512);c(O);var m=new Array(256);c(m);var R=new Array(b);c(R);var nt,Z,rt,L=new Array(l);function st(I,P,M,H,x){this.static_tree=I,this.extra_bits=P,this.extra_base=M,this.elems=H,this.max_length=x,this.has_stree=I&&I.length}function z(I,P){this.dyn_tree=I,this.max_code=0,this.stat_desc=P}function F(I){return I<256?O[I]:O[256+(I>>>7)]}function at(I,P){I.pending_buf[I.pending++]=255&P,I.pending_buf[I.pending++]=P>>>8&255}function J(I,P,M){I.bi_valid>r-M?(I.bi_buf|=P<<I.bi_valid&65535,at(I,I.bi_buf),I.bi_buf=P>>r-I.bi_valid,I.bi_valid+=M-r):(I.bi_buf|=P<<I.bi_valid&65535,I.bi_valid+=M)}function Q(I,P,M){J(I,M[2*P],M[2*P+1])}function yt(I,P){for(var M=0;M|=1&I,I>>>=1,M<<=1,0<--P;);return M>>>1}function kt(I,P,M){var H,x,W=new Array(w+1),et=0;for(H=1;H<=w;H++)W[H]=et=et+M[H-1]<<1;for(x=0;x<=P;x++){var G=I[2*x+1];G!==0&&(I[2*x]=yt(W[G]++,G))}}function pt(I){var P;for(P=0;P<_;P++)I.dyn_ltree[2*P]=0;for(P=0;P<l;P++)I.dyn_dtree[2*P]=0;for(P=0;P<C;P++)I.bl_tree[2*P]=0;I.dyn_ltree[2*S]=1,I.opt_len=I.static_len=0,I.last_lit=I.matches=0}function bt(I){8<I.bi_valid?at(I,I.bi_buf):0<I.bi_valid&&(I.pending_buf[I.pending++]=I.bi_buf),I.bi_buf=0,I.bi_valid=0}function Et(I,P,M,H){var x=2*P,W=2*M;return I[x]<I[W]||I[x]===I[W]&&H[P]<=H[M]}function It(I,P,M){for(var H=I.heap[M],x=M<<1;x<=I.heap_len&&(x<I.heap_len&&Et(P,I.heap[x+1],I.heap[x],I.depth)&&x++,!Et(P,H,I.heap[x],I.depth));)I.heap[M]=I.heap[x],M=x,x<<=1;I.heap[M]=H}function qt(I,P,M){var H,x,W,et,G=0;if(I.last_lit!==0)for(;H=I.pending_buf[I.d_buf+2*G]<<8|I.pending_buf[I.d_buf+2*G+1],x=I.pending_buf[I.l_buf+G],G++,H===0?Q(I,x,P):(Q(I,(W=m[x])+f+1,P),(et=q[W])!==0&&J(I,x-=R[W],et),Q(I,W=F(--H),M),(et=j[W])!==0&&J(I,H-=L[W],et)),G<I.last_lit;);Q(I,S,P)}function At(I,P){var M,H,x,W=P.dyn_tree,et=P.stat_desc.static_tree,G=P.stat_desc.has_stree,lt=P.stat_desc.elems,wt=-1;for(I.heap_len=0,I.heap_max=h,M=0;M<lt;M++)W[2*M]!==0?(I.heap[++I.heap_len]=wt=M,I.depth[M]=0):W[2*M+1]=0;for(;I.heap_len<2;)W[2*(x=I.heap[++I.heap_len]=wt<2?++wt:0)]=1,I.depth[x]=0,I.opt_len--,G&&(I.static_len-=et[2*x+1]);for(P.max_code=wt,M=I.heap_len>>1;1<=M;M--)It(I,W,M);for(x=lt;M=I.heap[1],I.heap[1]=I.heap[I.heap_len--],It(I,W,1),H=I.heap[1],I.heap[--I.heap_max]=M,I.heap[--I.heap_max]=H,W[2*x]=W[2*M]+W[2*H],I.depth[x]=(I.depth[M]>=I.depth[H]?I.depth[M]:I.depth[H])+1,W[2*M+1]=W[2*H+1]=x,I.heap[1]=x++,It(I,W,1),2<=I.heap_len;);I.heap[--I.heap_max]=I.heap[1],function(ht,Ft){var Gt,Ot,Qt,Ct,Jt,se,Bt=Ft.dyn_tree,ce=Ft.max_code,ye=Ft.stat_desc.static_tree,we=Ft.stat_desc.has_stree,Ie=Ft.stat_desc.extra_bits,me=Ft.stat_desc.extra_base,Kt=Ft.stat_desc.max_length,te=0;for(Ct=0;Ct<=w;Ct++)ht.bl_count[Ct]=0;for(Bt[2*ht.heap[ht.heap_max]+1]=0,Gt=ht.heap_max+1;Gt<h;Gt++)Kt<(Ct=Bt[2*Bt[2*(Ot=ht.heap[Gt])+1]+1]+1)&&(Ct=Kt,te++),Bt[2*Ot+1]=Ct,ce<Ot||(ht.bl_count[Ct]++,Jt=0,me<=Ot&&(Jt=Ie[Ot-me]),se=Bt[2*Ot],ht.opt_len+=se*(Ct+Jt),we&&(ht.static_len+=se*(ye[2*Ot+1]+Jt)));if(te!==0){do{for(Ct=Kt-1;ht.bl_count[Ct]===0;)Ct--;ht.bl_count[Ct]--,ht.bl_count[Ct+1]+=2,ht.bl_count[Kt]--,te-=2}while(0<te);for(Ct=Kt;Ct!==0;Ct--)for(Ot=ht.bl_count[Ct];Ot!==0;)ce<(Qt=ht.heap[--Gt])||(Bt[2*Qt+1]!==Ct&&(ht.opt_len+=(Ct-Bt[2*Qt+1])*Bt[2*Qt],Bt[2*Qt+1]=Ct),Ot--)}}(I,P),kt(W,wt,I.bl_count)}function d(I,P,M){var H,x,W=-1,et=P[1],G=0,lt=7,wt=4;for(et===0&&(lt=138,wt=3),P[2*(M+1)+1]=65535,H=0;H<=M;H++)x=et,et=P[2*(H+1)+1],++G<lt&&x===et||(G<wt?I.bl_tree[2*x]+=G:x!==0?(x!==W&&I.bl_tree[2*x]++,I.bl_tree[2*D]++):G<=10?I.bl_tree[2*V]++:I.bl_tree[2*B]++,W=x,wt=(G=0)===et?(lt=138,3):x===et?(lt=6,3):(lt=7,4))}function U(I,P,M){var H,x,W=-1,et=P[1],G=0,lt=7,wt=4;for(et===0&&(lt=138,wt=3),H=0;H<=M;H++)if(x=et,et=P[2*(H+1)+1],!(++G<lt&&x===et)){if(G<wt)for(;Q(I,x,I.bl_tree),--G!=0;);else x!==0?(x!==W&&(Q(I,x,I.bl_tree),G--),Q(I,D,I.bl_tree),J(I,G-3,2)):G<=10?(Q(I,V,I.bl_tree),J(I,G-3,3)):(Q(I,B,I.bl_tree),J(I,G-11,7));W=x,wt=(G=0)===et?(lt=138,3):x===et?(lt=6,3):(lt=7,4)}}c(L);var N=!1;function k(I,P,M,H){J(I,(v<<1)+(H?1:0),3),function(x,W,et,G){bt(x),G&&(at(x,et),at(x,~et)),s.arraySet(x.pending_buf,x.window,W,et,x.pending),x.pending+=et}(I,P,M,!0)}o._tr_init=function(I){N||(function(){var P,M,H,x,W,et=new Array(w+1);for(x=H=0;x<b-1;x++)for(R[x]=H,P=0;P<1<<q[x];P++)m[H++]=x;for(m[H-1]=x,x=W=0;x<16;x++)for(L[x]=W,P=0;P<1<<j[x];P++)O[W++]=x;for(W>>=7;x<l;x++)for(L[x]=W<<7,P=0;P<1<<j[x]-7;P++)O[256+W++]=x;for(M=0;M<=w;M++)et[M]=0;for(P=0;P<=143;)ot[2*P+1]=8,P++,et[8]++;for(;P<=255;)ot[2*P+1]=9,P++,et[9]++;for(;P<=279;)ot[2*P+1]=7,P++,et[7]++;for(;P<=287;)ot[2*P+1]=8,P++,et[8]++;for(kt(ot,_+1,et),P=0;P<l;P++)E[2*P+1]=5,E[2*P]=yt(P,5);nt=new st(ot,q,f+1,_,w),Z=new st(E,j,0,l,w),rt=new st(new Array(0),T,0,C,g)}(),N=!0),I.l_desc=new z(I.dyn_ltree,nt),I.d_desc=new z(I.dyn_dtree,Z),I.bl_desc=new z(I.bl_tree,rt),I.bi_buf=0,I.bi_valid=0,pt(I)},o._tr_stored_block=k,o._tr_flush_block=function(I,P,M,H){var x,W,et=0;0<I.level?(I.strm.data_type===2&&(I.strm.data_type=function(G){var lt,wt=4093624447;for(lt=0;lt<=31;lt++,wt>>>=1)if(1&wt&&G.dyn_ltree[2*lt]!==0)return u;if(G.dyn_ltree[18]!==0||G.dyn_ltree[20]!==0||G.dyn_ltree[26]!==0)return a;for(lt=32;lt<f;lt++)if(G.dyn_ltree[2*lt]!==0)return a;return u}(I)),At(I,I.l_desc),At(I,I.d_desc),et=function(G){var lt;for(d(G,G.dyn_ltree,G.l_desc.max_code),d(G,G.dyn_dtree,G.d_desc.max_code),At(G,G.bl_desc),lt=C-1;3<=lt&&G.bl_tree[2*X[lt]+1]===0;lt--);return G.opt_len+=3*(lt+1)+5+5+4,lt}(I),x=I.opt_len+3+7>>>3,(W=I.static_len+3+7>>>3)<=x&&(x=W)):x=W=M+5,M+4<=x&&P!==-1?k(I,P,M,H):I.strategy===4||W===x?(J(I,2+(H?1:0),3),qt(I,ot,E)):(J(I,4+(H?1:0),3),function(G,lt,wt,ht){var Ft;for(J(G,lt-257,5),J(G,wt-1,5),J(G,ht-4,4),Ft=0;Ft<ht;Ft++)J(G,G.bl_tree[2*X[Ft]+1],3);U(G,G.dyn_ltree,lt-1),U(G,G.dyn_dtree,wt-1)}(I,I.l_desc.max_code+1,I.d_desc.max_code+1,et+1),qt(I,I.dyn_ltree,I.dyn_dtree)),pt(I),H&&bt(I)},o._tr_tally=function(I,P,M){return I.pending_buf[I.d_buf+2*I.last_lit]=P>>>8&255,I.pending_buf[I.d_buf+2*I.last_lit+1]=255&P,I.pending_buf[I.l_buf+I.last_lit]=255&M,I.last_lit++,P===0?I.dyn_ltree[2*M]++:(I.matches++,P--,I.dyn_ltree[2*(m[M]+f+1)]++,I.dyn_dtree[2*F(P)]++),I.last_lit===I.lit_bufsize-1},o._tr_align=function(I){J(I,2,3),Q(I,S,ot),function(P){P.bi_valid===16?(at(P,P.bi_buf),P.bi_buf=0,P.bi_valid=0):8<=P.bi_valid&&(P.pending_buf[P.pending++]=255&P.bi_buf,P.bi_buf>>=8,P.bi_valid-=8)}(I)}},{"../utils/common":41}],53:[function(p,y,o){y.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(p,y,o){(function(s){(function(u,a){if(!u.setImmediate){var c,v,b,f,_=1,l={},C=!1,h=u.document,w=Object.getPrototypeOf&&Object.getPrototypeOf(u);w=w&&w.setTimeout?w:u,c={}.toString.call(u.process)==="[object process]"?function(D){process.nextTick(function(){g(D)})}:function(){if(u.postMessage&&!u.importScripts){var D=!0,V=u.onmessage;return u.onmessage=function(){D=!1},u.postMessage("","*"),u.onmessage=V,D}}()?(f="setImmediate$"+Math.random()+"$",u.addEventListener?u.addEventListener("message",S,!1):u.attachEvent("onmessage",S),function(D){u.postMessage(f+D,"*")}):u.MessageChannel?((b=new MessageChannel).port1.onmessage=function(D){g(D.data)},function(D){b.port2.postMessage(D)}):h&&"onreadystatechange"in h.createElement("script")?(v=h.documentElement,function(D){var V=h.createElement("script");V.onreadystatechange=function(){g(D),V.onreadystatechange=null,v.removeChild(V),V=null},v.appendChild(V)}):function(D){setTimeout(g,0,D)},w.setImmediate=function(D){typeof D!="function"&&(D=new Function(""+D));for(var V=new Array(arguments.length-1),B=0;B<V.length;B++)V[B]=arguments[B+1];var q={callback:D,args:V};return l[_]=q,c(_),_++},w.clearImmediate=r}function r(D){delete l[D]}function g(D){if(C)setTimeout(g,0,D);else{var V=l[D];if(V){C=!0;try{(function(B){var q=B.callback,j=B.args;switch(j.length){case 0:q();break;case 1:q(j[0]);break;case 2:q(j[0],j[1]);break;case 3:q(j[0],j[1],j[2]);break;default:q.apply(a,j)}})(V)}finally{r(D),C=!1}}}}function S(D){D.source===u&&typeof D.data=="string"&&D.data.indexOf(f)===0&&g(+D.data.slice(f.length))}})(typeof self=="undefined"?s===void 0?this:s:self)}).call(this,typeof ee!="undefined"?ee:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}]},{},[10])(10)})})(_e);var ba=_e.exports;const jt={paginacao:{atual:1,maximo:1,total:1,limite:25},filtros:{numero:"",numeroCompra:null,destinatario:null,periodoEmissao:{ini:"",fim:""},periodoFinalizado:{ini:"",fim:""},fornecedor:{nome:""},ordenacao:"dataHoraFinalizado",direcao:"desc",ordenacaoSefaz:"dhRecbto",direcaoSefaz:"desc"}},_a={components:{Lista:Ae,ComprasFicha:Qe,ComprasImportacaoXML:va},data(){return{usuario:"",clienteSistema:"",lista:[],contatos:{},destinatarioOpcoes:[],destinatarioSelecionado:null,mostrar:{header:!0,barraTopo:!0,toolbarTitulo:!0,icone:"factory",titulo:"Compras",filtroAvancado:!0,buscar:!0,btnAjuda:!0,btnAtualizar:!0,btnNovo:!0,toolbarAcoes:!0,checkBox:!1,btnRemover:!1,btnRestaurar:!1,centralizaTabs:!1,btnDetalhes:!1,btnExportaXLS:!1,btnMenuMais:!1,toolbarAdicao:!1,bannerMsg:""},resultado:{},busca:"",filtros:$utils.clonar(jt.filtros),ordenacaoOpcoes:[{value:"dataHoraEmissao",label:"Data Emiss\xE3o"},{value:"dataHoraFinalizado",label:"Data Finalizado"}],ordenacaoSefaz:[{value:"dhRecbto",label:"Data Recebimento"}],direcaoOpcoes:[{value:"desc",label:"Decrescente"},{value:"asc",label:"Crescente"}],tabSelecionada2:{valor:"Digita\xE7\xE3o"},tabs2:[{valor:"Digita\xE7\xE3o",rotulo:"Digita\xE7\xE3o"},{valor:"Finalizado",rotulo:"Finalizado"},{valor:"Todos",rotulo:"Todos"}],tabSelecionada:{},tabs:[],paginacao:$utils.clonar(jt.paginacao),xmlDevolucao:!1,xmlEstrangeiro:!1,modalXMLNotaEntrada:!1,xmlNotaEntrada:{},abrirNotadeEntrada:null,modalPrevisaoEntrega:{},configImpressao:[],configImpressaoPedidoCompra:[{valor:"ped_compra",texto:"Pedido de Compra",observacao:"Modelo 1"},{valor:"pedidoCompra",texto:"Pedido de Compra",observacao:"Modelo 2"}],dialogEtiquetas:{impressao:!1,adicionar:!1,limpar:!1,item:{}},opcoesModelo:[],modeloSelecionado:"",emBranco:0,opcoesEmpresas:[],empresaSelecionada:"",tabelasPreco:[],opcoesTabelasPreco:[],tabelaPrecoSelecionada:""}},methods:{aoSelecionarDestinatario(){this.filtros.destinatario=$utils.clonar(this.destinatarioSelecionado)},async atualizar(i){var p;const e=$utils.logarIni("ComprasLista");await $tryLoading(async()=>{var c,v,b,f,_,l,C,h,w,r,g,S,D,V,B,q,j,T,X,ot,E,O;let{buscarDadosRecentes:y}=i!=null?i:{},o,s,u,a;if(this.tabSelecionada2Ant!==this.tabSelecionada2.valor&&(this.paginacao.atual=1),this.tabSelecionada2Ant=this.tabSelecionada2.valor,i!=null&&i.aba2&&(this.tabSelecionada.valor=i.aba2),this.tabSelecionadaAnterior&&this.tabSelecionadaAnterior!==this.tabSelecionada.valor&&(this.setOpcoesTabs(this.tabSelecionada.valor),this.filtros=$utils.clonarV2(jt.filtros),this.paginacao=$utils.clonarV2(jt.paginacao),this.busca="",y=!0),this.tabSelecionadaAnterior=this.tabSelecionada.valor,y&&(o=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:"ComprasLista_"+this.tabSelecionada.valor+((c=this.usuario)==null?void 0:c.id)}),o!=null&&o._id&&(this.tabSelecionada.valor=o==null?void 0:o.tabSelecionada,this.tabSelecionada2.valor=o==null?void 0:o.tabSelecionada2,this.destinatarioSelecionado=o.filtros.destinatario,this.busca=o.busca||"",this.filtros={numero:((v=o==null?void 0:o.filtros)==null?void 0:v.numero)||"",numeroCompra:((b=o==null?void 0:o.filtros)==null?void 0:b.numeroCompra)||null,destinatario:((f=o==null?void 0:o.filtros)==null?void 0:f.destinatario)||null,periodoEmissao:{ini:((l=(_=o==null?void 0:o.filtros)==null?void 0:_.periodoEmissao)==null?void 0:l.ini)||"",fim:((h=(C=o==null?void 0:o.filtros)==null?void 0:C.periodoEmissao)==null?void 0:h.fim)||""},periodoFinalizado:{ini:((r=(w=o==null?void 0:o.filtros)==null?void 0:w.periodoFinalizado)==null?void 0:r.ini)||"",fim:((S=(g=o==null?void 0:o.filtros)==null?void 0:g.periodoFinalizado)==null?void 0:S.fim)||""},fornecedor:{nome:((V=(D=o==null?void 0:o.filtros)==null?void 0:D.fornecedor)==null?void 0:V.nome)||""},ordenacao:((B=o==null?void 0:o.filtros)==null?void 0:B.ordenacao)||"dataHoraFinalizado",direcao:((q=o==null?void 0:o.filtros)==null?void 0:q.direcao)||"desc",ordenacaoSefaz:((j=o==null?void 0:o.filtros)==null?void 0:j.ordenacaoSefaz)||"dhRecbto",direcaoSefaz:((T=o==null?void 0:o.filtros)==null?void 0:T.direcaoSefaz)||"desc"},this.compareObject(jt.filtros,this.filtros,["ordenacao","direcao","ordenacaoSefaz","direcaoSefaz"])&&(this.$refs.comprasLista.filtros=!0))),i!=null&&i.aba&&(this.tabSelecionada2.valor=i.aba),s=$utils.eliminarVazios(this.filtros),u=this.paginacao.limite,a=this.paginacao.atual,s.status=this.tabSelecionada2.valor,s.operacao=this.tabSelecionada.valor,delete s.termoBusca,this.busca&&(s.termoBusca=this.busca,this.paginacao.atual=1),this.tabSelecionada2.valor==="Todos"&&delete s.status,s.operacao==="Nota na SEFAZ"){let m=await $db.hibrido.lista({table:"documentoFiscalEletronico",columns:["id","xNomeEmitente","cpfCnpjEmitente","xNomeDestinatario","cpfCnpjDestinatario","vNF","situacao","nNF"],where:{tipo:"DFe",...this.tabSelecionada2.valor!=="Todos"?{situacao:this.tabSelecionada2.valor}:{}}});if(s.numero&&(m=m.filter(rt=>parseInt(rt.nNF)===parseInt(s.numero))),(X=s.fornecedor)!=null&&X.nome&&(m=m.filter(rt=>rt.xNomeEmitente.toLowerCase().includes(s.fornecedor.nome.toLowerCase()))),(ot=s.destinatario)!=null&&ot.numeroDocumentoNacional&&(m=m.filter(rt=>{var L;return((L=rt.cpfCnpjDestinatario)==null?void 0:L.replace(/\D/g,""))===s.destinatario.numeroDocumentoNacional.replace(/\D/g,"")})),s.termoBusca)if(/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/.test(s.termoBusca))m=m.filter(L=>L.id===s.termoBusca);else{const L=$utils.removerAcentos(s.termoBusca.toUpperCase()).split(" ").filter(Boolean),st=L.filter(at=>at.match(/^\d+$/)),z=L.filter(at=>!at.match(/^\d+$/)),F=[];for(const at of m){const J=$utils.removerAcentos([at.xNomeEmitente,at.xNomeDestinatario,at.cpfCnpjEmitente,at.cpfCnpjDestinatario].join(" ").toUpperCase()),Q=[at.nNF].map(String);let yt=!0;for(const kt of st)yt=yt&&Q.includes(kt);for(const kt of z)yt=yt&&J.includes(kt);yt&&F.push(at)}m=F}const R=await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",columns:["idDocumentoFiscalEletronico","dhRecbto"],whereIn:{idDocumentoFiscalEletronico:m.map(rt=>rt.id)}}),nt=[];R.forEach(rt=>{var at,J;const L=m.find(Q=>Q.id===rt.idDocumentoFiscalEletronico),st=new Date(rt.dhRecbto).setHours(0,0,0,0),z=new Date((at=s.periodoEmissao)==null?void 0:at.ini).setHours(0,0,0,0),F=new Date((J=s.periodoEmissao)==null?void 0:J.fim).setHours(0,0,0,0);(z||F)&&st&&(z&&st<z||F&&st>F)||L&&nt.push({id:L.id,descricaoContato:L.xNomeEmitente,numeroDocumentoContato:this.$filters.cpfCnpj(L.cpfCnpjEmitente)||"",descricaoEmpresa:L.xNomeDestinatario,numeroDocumentoEmpresa:this.$filters.cpfCnpj(L.cpfCnpjDestinatario)||"",dhRecbto:rt.dhRecbto,totalDocumento:L.vNF,status:L.situacao,notaNumero:L.nNF})});const Z=(a-1)*u;this.paginacao.total=nt.length,this.paginacao.maximo=Math.ceil(this.paginacao.total/u)||1,s.direcaoSefaz==="desc"?nt.sort((rt,L)=>rt[s.ordenacaoSefaz]<L[s.ordenacaoSefaz]?1:-1):nt.sort((rt,L)=>rt[s.ordenacaoSefaz]>L[s.ordenacaoSefaz]?1:-1),this.lista=nt.splice(Z,u)}else{const m=[s.ordenacao],R=[s.direcao];(E=s.destinatario)!=null&&E.value&&(s.idContatoEmpresa=s.destinatario.value);const nt=await $db.compra.leListaCompleta({filtros:s,limit:u,page:a,sort:m,dir:R});this.paginacao.total=nt.total,this.paginacao.maximo=nt.totalPages,this.lista=nt.data.compras}for(const{idContato:m}of this.lista)m&&!this.contatos[m]&&(this.contatos[m]={});this.carregarImagensContatos(this.contatos),o={_id:"ComprasLista_"+this.tabSelecionada.valor+((O=this.usuario)==null?void 0:O.id),tabSelecionada:this.tabSelecionada.valor,tabSelecionada2:this.tabSelecionada2.valor,filtros:$utils.clonar(this.filtros),busca:this.busca},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:o}),this.configuraImpressao(s.idEmpresa)}),$utils.logarFim(e,((p=this.paginacao)==null?void 0:p.total)||1)},async carregarImagensContatos(i){const e=Object.keys(i);if(!!e.length){await $utils.dormir(200);try{const p=await $db.hibrido.lista({table:"contato",columns:["id","apelido","imagem"],whereIn:{id:e}});for(const y of p)i[y.id].imagem=y.imagem||""}catch(p){console.error("Erro ao carregar imagens de contatos - ",p)}}},adicionarXml(i){this.xmlNotaEntrada.arquivo=i[0]},async concluirImportacao(i){await $tryLoading(async()=>{await $db.compra.grava({atual:i}),$q.notifyPositive("Importa\xE7\xE3o realizada com sucesso!"),this.tabSelecionada2.valor="Digita\xE7\xE3o",this.tabSelecionada.valor="Nota de Entrada",await this.$refs.comprasFicha.mostrar({id:i.documento.id})},{mensagem:"Gravando importa\xE7\xE3o..."})},async importarXmlNotaDeEntrada(){var y,o,s,u,a,c;let i;try{$utils.verificarErro(!this.xmlNotaEntrada.arquivo,"Adicione um arquivo XML antes de enviar!"),i=await new Promise((v,b)=>{const f=new FileReader;f.readAsText(this.xmlNotaEntrada.arquivo,"UTF-8"),f.onload=()=>v(f.result),f.onerror=_=>b(_)})}catch(v){return console.error(v),$q.notifyError("Ocorreu um erro na importa\xE7\xE3o"),!1}let e;try{e=await Pe.parseStringPromise(i)}catch(v){return console.error(v),$q.notifyError("Arquivo inv\xE1lido ou corrompido"),!1}if(!((c=(a=(u=(s=(o=(y=e==null?void 0:e.nfeProc)==null?void 0:y.protNFe)==null?void 0:o[0])==null?void 0:s.infProt)==null?void 0:u[0])==null?void 0:a.nProt)==null?void 0:c[0])&&!await $q.dialogSimNao({title:"Aviso importante",message:"O XML que est\xE1 sendo importado n\xE3o foi protocolado pela Sefaz, gostaria de importar o XML sem o protocolo?",html:!0})){$q.notifyError("Opera\xE7\xE3o para importa\xE7\xE3o de XML n\xE3o realizada!",erro);return}await $tryLoading(async()=>{const v=(await $db.hibrido.lista({table:"documentoXML",whereFilter:{xmlAux:i}}))[0];$utils.verificarErro(v==null?void 0:v.id,"Esse xml j\xE1 foi importado!");const b=await $db.compra.importaXml({xmlString:i,xmlEstrangeiro:Boolean(this.xmlEstrangeiro)});b.documentosItem.find(({vinculado:f})=>!f)?this.$refs.comprasImportacaoXML.mostrar(b):await this.concluirImportacao(b)},{mensagem:"Importando..."}),delete this.xmlNotaEntrada.arquivo,this.modalXMLNotaEntrada=!1,this.xmlEstrangeiro=!1},async fecharXmlNotaDeEntrada(){delete this.xmlNotaEntrada.arquivo},async abrir(i){this.tabSelecionada.valor!=="Nota na SEFAZ"&&this.$refs.comprasFicha.mostrar({id:i})},criarClick(){this.$refs.comprasFicha.criar()},importarXmlClick(){this.modalXMLNotaEntrada=!0},async limparFiltrosClick(){this.filtros=$utils.clonarV2(jt.filtros),this.destinatarioSelecionado=null,await this.atualizar()},compareObject(i,e,p=[]){const y=Object.keys(i);for(const o of y)if(!p.includes(o)){if(typeof i[o]=="object"&&i[o]!==null){if(!this.compareObject(i[o],e[o],p))continue;return!0}else if(i[o]!==e[o])return!0}return!1},setOpcoesTabs(i){i!=="Nota na SEFAZ"?(this.tabSelecionada2.valor="Digita\xE7\xE3o",this.tabs2=[{valor:"Digita\xE7\xE3o",rotulo:"Digita\xE7\xE3o"},{valor:"Finalizado",rotulo:"Finalizado"},{valor:"Todos",rotulo:"Todos"}]):(this.tabSelecionada2.valor="N\xE3o Importada",this.tabs2=[{valor:"N\xE3o Importada",rotulo:"N\xE3o Importada"},{valor:"Importada",rotulo:"Importada"},{valor:"Todos",rotulo:"Todas"}])},async duplicarDocumento_click(i){!await $q.dialogSimNao({title:"Duplicar",message:"Deseja prosseguir com a opera\xE7\xE3o?"})||await $tryLoading(async()=>{const e=await $db.hibrido.le({table:"documento",id:i.id});$utils.verificarErro(!e.id,"Compra n\xE3o encontrada");const p=(await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:i.id}})).sort((o,s)=>new Date(o.dataHoraEmissao||0)-new Date(s.dataHoraEmissao||0)),y=$utils.uuid();await $db.hibrido.grava("documento",{atual:{...e,id:y,codigoDocumento:void 0,numero:void 0,notaNumero:void 0,notaSerie:void 0,naturezaOperacao:void 0,dataCompra:void 0,chaveAcesso:void 0,dataHoraEmissao:$utils.dataAtual(),dataHoraFinalizado:void 0,dataHoraPrevisto:void 0,status:"Digita\xE7\xE3o",operacao:"Pedido de Compra"}}),await $db.hibrido.gravaLista("documentoItem",{atual:p.map(o=>({...o,id:$utils.uuid(),codigoDocumentoItem:void 0,idDocumento:y,codigoDocumento:void 0,dataHoraEmissao:$utils.dataAtual(),dataHoraFinalizado:void 0,status:"Digita\xE7\xE3o"}))}),$q.notifyPositive("Duplica\xE7\xE3o realizada com sucesso!"),this.tabSelecionada2.valor="Digita\xE7\xE3o",this.tabSelecionada.valor="Pedido de Compra",await this.$refs.comprasFicha.mostrar({id:y})},{mensagem:"Duplicando..."})},async trocarCfop_click(i){!await $q.dialogSimNao({title:"Confirma\xE7\xE3o",message:"Deseja trocar os CFOP iniciados em 5 e 6 para 1 e 2 correspondentes?"})||await $tryLoading(async()=>{var s;const e=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:i.id}}),p=$utils.clonarV2(e),y=await $db.hibrido.lista({table:"cfop",whereIn:{id:$utils.unicos(p,"idCfop")}});let o=0;for(const u of y){const a=String(u.cfop),c=a[0]==="5"?"1"+a.substr(1):a[0]==="6"?"2"+a.substr(1):a;if(c!==a){const v=(s=(await $db.hibrido.lista({table:"cfop",where:{cfop:c}}))[0])==null?void 0:s.id;$utils.verificarErro(!v,`CFOP ${c} n\xE3o encontrado`);for(const b of p)b.idCfop===u.id&&(b.idCfop=v,o++)}}$utils.verificarErro(!o,"N\xE3o h\xE1 CFOPs com inicial 5 ou 6 para realizar trocas"),await $db.hibrido.gravaLista("documentoItem",{atual:p,original:e}),$q.notifyPositive(`Troca de CFOP realizada com sucesso em ${o} itens!`)},{mensagem:"Processando..."})},async alterarPrevisaoEntrega_click(i){var e,p;this.modalPrevisaoEntrega={visivel:!0,dataPrevistaEntrega:(e=i.dataHoraPrevisto)==null?void 0:e.slice(0,10),horaPrevistaEntrega:(p=i.dataHoraPrevisto)==null?void 0:p.slice(11,16),compra:i}},async alterarPrevisaoEntrega(){await $tryLoading(async()=>{const{compra:i,dataPrevistaEntrega:e,horaPrevistaEntrega:p}=this.modalPrevisaoEntrega;$utils.verificarErro(!e,"\xC9 necess\xE1rio preencher a data");const y=zt.formatDate(`${e} ${p||"00:00:00"}`);$utils.verificarErro(!y,"Data Inv\xE1lida"),y!==zt.formatDate(i.dataHoraPrevisto)?(await $db.hibrido.grava("documento",{atual:{id:i.id,dataHoraPrevisto:y}}),i.dataHoraPrevisto=y,$q.notifyPositive("A previs\xE3o foi salva com sucesso"),this.modalPrevisaoEntrega={}):$q.notifyPositive("N\xE3o h\xE1 dados alterados.")})},async downloadXmlDFeFiltrados(){var i,e,p,y,o;if(!!await $q.dialogSimNao({title:"Download XML's filtrados",message:"Deseja prosseguir com a opera\xE7\xE3o?"}))try{$q.loading.show();let s=[];if($db.hibrido.isOnline())s=(o=(y=(p=await $utils.geeksApi({downloadDFe:{funcao:"2D9F9B43-47D3-491E-AD49-528EC9547BDC",...this.tabSelecionada2.valor!=="Todos"?{situacao:this.tabSelecionada2.valor}:{},fornecedor:(i=this.filtros.fornecedor)==null?void 0:i.nome,numeroDocumentoNacionalDestinatario:(e=this.filtros.destinatario)==null?void 0:e.numeroDocumentoNacional,periodoRecbto:this.filtros.periodoEmissao}}))==null?void 0:p.data)==null?void 0:y.downloadDFe)!=null?o:[];else{let u=await $db.hibrido.lista({table:"documentoFiscalEletronico",columns:["id","dhEmi","cpfCnpjEmitente","cpfCnpjDestinatario","xNomeEmitente","xNomeDestinatario"],where:{tipo:"DFe",...this.tabSelecionada2.valor!=="Todos"?{situacao:this.tabSelecionada2.valor}:{}}});u=u.filter(c=>{var v,b,f;return!(((v=this.filtros.fornecedor)==null?void 0:v.nome)&&!c.xNomeEmitente.toLowerCase().includes(this.filtros.fornecedor.nome.toLowerCase())||((b=this.filtros.destinatario)==null?void 0:b.numeroDocumentoNacional)&&((f=c.cpfCnpjDestinatario)==null?void 0:f.replace(/\D/g,""))!==this.filtros.destinatario.numeroDocumentoNacional.replace(/\D/g,""))}),(await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",columns:["idDocumentoFiscalEletronico","chNFe","dhRecbto","xmlProt"],whereIn:{idDocumentoFiscalEletronico:u.map(c=>c.id)}})).forEach(c=>{var l,C;const v=u.find(h=>h.id===c.idDocumentoFiscalEletronico),b=new Date(c.dhRecbto).setHours(0,0,0,0),f=new Date((l=this.filtros.periodoEmissao)==null?void 0:l.ini).setHours(0,0,0,0),_=new Date((C=this.filtros.periodoEmissao)==null?void 0:C.fim).setHours(0,0,0,0);(f||_)&&b&&(f&&b<f||_&&b>_)||v&&s.push({chNFe:c.chNFe,xml:c.xmlProt,cnpj:v.cpfCnpjDestinatario})})}if((s==null?void 0:s.length)>0){const u=Array.from(new Set(s.filter(c=>c.cnpj).map(c=>c.cnpj))),a=new ba;for(const c of u)for(const v of s.filter(b=>b.cnpj===c))a.file(`${c}/${v.chNFe}.procNFe.xml`,v.xml);a.generateAsync({type:"blob"}).then(function(c){const v=new Date,b=document.createElement("a");b.href=window.URL.createObjectURL(c),b.download=`${v.getFullYear()}-${String(v.getMonth()+1).padStart(2,"0")}-${String(v.getDate()).padStart(2,"0")}_NotasEntradaSEFAZ.zip`,b.click()})}}catch{$q.notify({message:"N\xE3o foi poss\xEDvel realizar o download",type:"negative"})}finally{$q.loading.hide()}},async downloadXmlDFe(i,e){!await $q.dialogSimNao({title:"Download XML",message:"Deseja prosseguir com a opera\xE7\xE3o?"})||await $tryLoading(async()=>{var c;const y=(e==="Nota de Entrada"?await $db.hibrido.lista({table:"documentoXML",where:{idDocumento:i}}):await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:i}}))[0],o=(y==null?void 0:y.xmlProt)||(y==null?void 0:y.xmlData),s=(y==null?void 0:y.chNFe)||((c=/<chNFe>(\d+)<\/chNFe>/i.exec(o))==null?void 0:c[1]);$utils.verificarErro(!o,"N\xE3o foi poss\xEDvel recuperar o XML");const u=document.createElement("a"),a=new Blob([o],{type:"text/plain"});u.setAttribute("href",window.URL.createObjectURL(a)),u.setAttribute("download",`${s||i}-procNFe.xml`),u.click()})},async importarXmlDFe(i){!await $q.dialogSimNao({title:"Importar XML",message:"Deseja prosseguir com a opera\xE7\xE3o?"})||await $tryLoading(async()=>{const e=await $db.hibrido.le({table:"documentoFiscalEletronico",id:i}),p=(await $db.hibrido.lista({table:"documentoFiscalEletronicoXml",where:{idDocumentoFiscalEletronico:i}}))[0];if((e==null?void 0:e.id)&&(p==null?void 0:p.xmlProt)){const y=(await $db.hibrido.lista({table:"documento",whereFilter:{chaveAcesso:p==null?void 0:p.chNFe}}))[0];$utils.verificarErro(y==null?void 0:y.id,"Esse xml j\xE1 foi importado!");const o=await $db.compra.importaXml({xmlString:p.xmlProt});o.documentoFiscalEletronico={id:i,situacao:"Importada"},o.documentosItem.find(({vinculado:s})=>!s)?this.$refs.comprasImportacaoXML.mostrar(o):await this.concluirImportacao(o)}},{mensagem:"Importando..."})},async destinatarioOpcoesCarregar(){const i=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.destinatarioOpcoes=i.map(e=>({label:e.nome,value:e.id,numeroDocumentoNacional:e.numeroDocumentoNacional}))},async configuraImpressao(i){const e=await $db.configuracoes.porNome("impressao.compra",i);this.configImpressao=[...e.length?e.map(p=>({valor:p.valor,texto:p.texto,observacao:p.observacao})):[{valor:"invoice",texto:"Pedido de Compra",observacao:"Invoice"}]]},imprimirPedidoCompra(i,e){i==="pedidoCompra"&&this.abrirImpressao(`
            https://rel.storage.b15.com.br/Relatorios/OptiSoul/pedidoCompra.html
            ?CodigoDocumento=${e}
            &hfCodigoSistema=${encodeURIComponent(JSON.stringify({data:{CodigoUsuario:this.usuario.codigoUsuario,CodigoSistema:this.clienteSistema.codigoSistema,CodigoClienteSistema:this.clienteSistema.codigoClienteSistema,Sistema:this.clienteSistema.sistema,URLServidor:this.clienteSistema.urlServidor,BancoDeDados:this.clienteSistema.bancoDeDados,CodigoCliente:this.clienteSistema.codigoCliente,Cliente:this.clienteSistema.cliente,Administrador:this.clienteSistema.administrador,GrupoInterno:this.clienteSistema.grupoInterno}}))}
          `),i==="ped_compra"&&this.abrirImpressao(`
            https://rel.storage.b15.com.br/Relatorios/distribuidor/email.html
            ?CodigoDocumento=${e}
            &URLServidor=${encodeURIComponent(this.clienteSistema.urlServidor)}
            &Banco=${encodeURIComponent(this.clienteSistema.bancoDeDados)}
            &NomeReport=ped_compra
            &CodigoUsuario=${this.usuario.codigoUsuario}
            &hfCodigoSistema=${encodeURIComponent(JSON.stringify({data:{CodigoUsuario:this.usuario.codigoUsuario,CodigoSistema:this.clienteSistema.codigoSistema,CodigoClienteSistema:this.clienteSistema.codigoClienteSistema,Sistema:this.clienteSistema.sistema,Versao:this.clienteSistema.versao,URLServidor:this.clienteSistema.urlServidor,BancoDeDados:this.clienteSistema.bancoDeDados,CodigoCliente:this.clienteSistema.codigoCliente,Cliente:this.clienteSistema.cliente,Padrao:this.clienteSistema.padrao?this.clienteSistema.padrao:null,Administrador:this.clienteSistema.administrador,GrupoInterno:this.clienteSistema.grupoInterno}}))}
          `)},async configuraEtiqueta(){const i=await $db.configuracoes.le({nome:"impressao.etiqueta"});this.opcoesModelo=[],i.length?i.forEach(e=>{this.opcoesModelo.push({rotulo:e.texto,valor:e.observacao&&e.observacao.trim()!==""?e.observacao:e.valor,modelo:e.valor})}):this.opcoesModelo.push({rotulo:"Etiqueta Carta (EBF-23)",valor:"etiqueta-carta-ebf23",modelo:"imprimir-etiquetas"},{rotulo:"Etiqueta Fila Joias",valor:"etiqueta-fila-joias",modelo:"imprimir-etiquetas"},{rotulo:"Etiqueta Fila 3 Colunas",valor:"etiqueta-fila-3colunas",modelo:"imprimir-etiquetas"},{rotulo:"Etiqueta Pimaco (A4 96)",valor:"etiqueta-pimaco-a496",modelo:"imprimir-etiquetas"}),this.opcoesModelo=[...this.opcoesModelo,{rotulo:"Modelos antigos:",value:"modelos-antigos",disable:!0},{rotulo:"Folha Argox",valor:"etiqueta-fila"},{rotulo:"Folha Carta",valor:"etiqueta-carta"},{rotulo:"Folha Pimaco",valor:"EtiquetaPimaco6Col"},{rotulo:"Personaliz\xE1vel",valor:"etiqueta_generica_ajustavel"},{rotulo:"Etiqueta Fila",valor:"etiquetaFila",modelo:"etiquetaFila"}],this.modeloSelecionado=this.opcoesModelo[0].valor},async configuraEmpresas(){const i=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.opcoesEmpresas=i.map(e=>({rotulo:e.apelido||e.nome,valor:e.id,codigoEmpresa:e.codigoContato})),this.empresaSelecionada=""},async configuraTabelasPreco(){this.tabelasPreco=await $db.itemTabelaPreco.le({ativo:!0,tabelaMaster:!0})||[],this.opcoesTabelasPreco=this.tabelasPreco.map(i=>({rotulo:i.descricao,valor:i.id,codigoItemTabelaPreco:i.codigoItemTabelaPreco})),this.tabelaPrecoSelecionada=""},async dialogImprimirEtiquetas({acao:i,item:e}){try{await this.configuraEtiqueta(),await this.configuraEmpresas(),await this.configuraTabelasPreco(),this.dialogEtiquetas={[i]:!0,item:e||{},limpar:!1}}catch(p){console.error("Erro ao configurar impress\xE3o de etiquetas",p)}},imprimirEtiquetas(i){var e,p,y,o,s;if(i==="etiqueta_generica_ajustavel"||i==="etiqueta-fila"||i==="etiqueta-carta"||i==="EtiquetaPimaco6Col"){const u=i==="etiqueta_generica_ajustavel"?"":"OptiSoul/";this.abrirImpressao(`
            https://rel.storage.b15.com.br/Relatorios/${u}${i}.html
            ?Banco=${encodeURIComponent(this.clienteSistema.bancoDeDados)}
            &URLServidor=${encodeURIComponent(this.clienteSistema.urlServidor)}
            &CodigoUsuario=${this.usuario.codigoUsuario}
            &EmBranco=${this.emBranco}
            &CodigoPedido=${(p=(e=this.dialogEtiquetas)==null?void 0:e.item)==null?void 0:p.codigoDocumento}
            &TabelaPreco=${this.tabelaPrecoSelecionada?encodeURIComponent(this.opcoesTabelasPreco.find(a=>a.valor===this.tabelaPrecoSelecionada).codigoItemTabelaPreco):""}
            &CodigoContatoEmpresa=${this.empresaSelecionada?encodeURIComponent(this.opcoesEmpresas.find(a=>a.valor===this.empresaSelecionada).codigoEmpresa):""}
            &cpfUsuarioLogado=${encodeURIComponent(this.usuario.cpf)}
            &hfCodigoSistema=${encodeURIComponent(JSON.stringify({data:{CodigoUsuario:this.usuario.codigoUsuario,CodigoSistema:this.clienteSistema.codigoSistema,CodigoClienteSistema:this.clienteSistema.codigoClienteSistema,Sistema:this.clienteSistema.sistema,URLServidor:this.clienteSistema.urlServidor,BancoDeDados:this.clienteSistema.bancoDeDados,CodigoCliente:this.clienteSistema.codigoCliente,Cliente:this.clienteSistema.cliente,Administrador:this.clienteSistema.administrador,GrupoInterno:this.clienteSistema.grupoInterno}}))}
          `)}else{const u=(y=this.opcoesModelo)==null?void 0:y.find(v=>v.valor===i),a=(u==null?void 0:u.modelo)||"",c=(u==null?void 0:u.valor)||"";$imprimir(a,{id:(s=(o=this.dialogEtiquetas)==null?void 0:o.item)==null?void 0:s.id,impressao:"etiquetas"},{modelo:c,idEmpresa:this.empresaSelecionada,idTabelaPreco:this.tabelaPrecoSelecionada,emBranco:this.emBranco})}},abrirImpressao(i){window.open(i.replace(/[\s\n]/g,""),"_blank").focus()},async adicionarEtiquetas(){var i;try{$q.loading.show();const e=this.dialogEtiquetas;let p=await $db.etiqueta.ler({cpfUsuarioLogado:this.usuario.numeroDocumentoNacional})||[];if(e!=null&&e.limpar){for(const u of p)await $db.etiqueta.remover(u.id);p=[]}const y=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:(i=e==null?void 0:e.item)==null?void 0:i.id}});if(!y.length){$q.notifyError("N\xE3o foi poss\xEDvel encontrar itens para carregar a impress\xE3o etiquetas");return}const o=y.map(u=>u.idItem),s=await $db.hibrido.lista({table:"item",columns:["id","codigoItem","descricaoConcatenada","valorVenda"],whereIn:{id:o}});if(!s.length){$q.notifyError("N\xE3o foi poss\xEDvel encontrar itens para carregar a impress\xE3o etiquetas");return}for(const u of s){if(p.length){const c=p.find(v=>v.idItem===u.id)||null;c&&await $db.etiqueta.remover(c==null?void 0:c.id)}const a={id:$utils.uuid(),idItem:u.id,nomeProduto:u.descricaoConcatenada,valor:u.valorVenda||0,quantidadeEtiquetas:y.find(c=>c.idItem===u.id).quantidade||0,cpfUsuarioLogado:this.usuario.numeroDocumentoNacional,dataHoraEmissao:$utils.dataAtual()};await $db.etiqueta.gravar({atual:a})}$q.loading.hide(),this.$q.dialog({title:"",message:"Ir para tela de impress\xE3o de etiquetas?",noRefocus:!0,preventClose:!0,ok:{label:"SIM",push:!0,class:"bg-primary",textColor:"white",flat:!0},cancel:{label:"N\xC3O",push:!0,color:"tertiary",flat:!0}}).onOk(()=>{this.$router.push({name:"EtiquetasLista"})}).onCancel(()=>{this.dialogEtiquetas.adicionar=!1})}catch(e){$q.loading.hide(),$q.notifyError("Erro ao adicionar etiquetas",e)}}},watch:{"tabSelecionada.valor"(){this.tabSelecionada.valor==="Nota na SEFAZ"?this.mostrar.btnMenuMais=!0:this.mostrar.btnMenuMais=!1}},async created(){await this.destinatarioOpcoesCarregar();const i=[{valor:"Pedido de Compra",rotulo:"Pedido de Compra"},{valor:"Nota de Entrada",rotulo:"Nota de Entrada"}];[52,53,62].includes(Number(this.clienteSistema.codigoSistema))&&i.push({valor:"Nota na SEFAZ",rotulo:"Nota na SEFAZ"}),this.tabSelecionada={valor:"Pedido de Compra"},this.tabs=i},async mounted(){this.usuario=JSON.parse(localStorage.getItem("usuario")),this.clienteSistema=JSON.parse(localStorage.getItem("clienteSistema")),this.tabSelecionada.valor=this.$route.name,this.atualizar({buscarDadosRecentes:!0})}},ya={id:"ComprasLista"},wa={class:"mw80 text-center"},Ia={key:0,class:"text-weight-medium"},Ca={class:"row q-ma-md"},ka={key:0,class:"row q-ma-md"},Sa={class:"certificado-error-messages"},Ea={class:"col-12"},Da={class:"col-12"},Va={class:"q-mt-lg text-right"};function Pa(i,e,p,y,o,s){const u=gt("campo"),a=gt("BadgeCopiarUid"),c=gt("avatar"),v=gt("g-label"),b=gt("badge"),f=gt("g-col"),_=gt("g-row"),l=gt("Lista"),C=gt("ComprasFicha"),h=gt("ComprasImportacaoXML"),w=gt("row");return $(),_t("div",ya,[t(l,{ref:"comprasLista",busca:o.busca,"onUpdate:busca":e[15]||(e[15]=r=>o.busca=r),onAtualizar:s.atualizar,onLimparFiltrosClick:s.limparFiltrosClick,onCriarClick:s.criarClick,lista:o.lista,tabSelecionada:o.tabSelecionada,tabs:o.tabs,tabSelecionada2:o.tabSelecionada2,tabs2:o.tabs2,paginacao:o.paginacao,mostrar:o.mostrar},{menuExtras:n(()=>[vt(($(),Y(mt,{onClick:s.downloadXmlDFeFiltrados,clickable:""},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"download"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>e[31]||(e[31]=[A("Download")])),_:1}),t(dt,{caption:""},{default:n(()=>e[32]||(e[32]=[A("XML's filtrados")])),_:1})]),_:1})]),_:1},8,["onClick"])),[[Dt]])]),botaoNovo:n(()=>[t(ut,{label:"Novo",icon:"add",unelevated:"",color:"primary","text-color":"white",class:"hideonmobile"},{default:n(()=>[t(Lt,null,{default:n(()=>[t(Pt,{link:"","no-border":"",separator:""},{default:n(()=>[vt(($(),Y(mt,{onClick:s.criarClick,clickable:""},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"add"})]),_:1}),t(K,null,{default:n(()=>e[33]||(e[33]=[A("Incluir Manual")])),_:1})]),_:1},8,["onClick"])),[[Dt]]),vt(($(),Y(mt,{onClick:s.importarXmlClick,clickable:""},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"add"})]),_:1}),t(K,null,{default:n(()=>e[34]||(e[34]=[A("Importar XML")])),_:1})]),_:1},8,["onClick"])),[[Dt]])]),_:1})]),_:1})]),_:1}),t(ut,{icon:"add",flat:"",round:"",color:"primary","text-color":"white",class:"hideondesktop"},{default:n(()=>[t(Lt,null,{default:n(()=>[t(Pt,{link:"","no-border":"",separator:""},{default:n(()=>[vt(($(),Y(mt,{onClick:s.criarClick,clickable:""},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"add"})]),_:1}),t(K,null,{default:n(()=>e[35]||(e[35]=[A("Incluir Manual")])),_:1})]),_:1},8,["onClick"])),[[Dt]]),vt(($(),Y(mt,{onClick:s.importarXmlClick,clickable:""},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"add"})]),_:1}),t(K,null,{default:n(()=>e[36]||(e[36]=[A("Importar XML")])),_:1})]),_:1},8,["onClick"])),[[Dt]])]),_:1})]),_:1})]),_:1})]),filtroCampos:n(()=>[t(u,{modelValue:o.filtros.numero,"onUpdate:modelValue":e[0]||(e[0]=r=>o.filtros.numero=r),dense:"",rotulo:"N\xBA Nota",class:"q-mt-md"},null,8,["modelValue"]),t(u,{modelValue:o.filtros.numeroCompra,"onUpdate:modelValue":e[1]||(e[1]=r=>o.filtros.numeroCompra=r),dense:"",rotulo:"Ordem de compra",class:"q-mt-lg"},null,8,["modelValue"]),t(xe,{modelValue:o.destinatarioSelecionado,"onUpdate:modelValue":[e[2]||(e[2]=r=>o.destinatarioSelecionado=r),s.aoSelecionarDestinatario],options:o.destinatarioOpcoes,clearable:"",dense:"",label:"Destinat\xE1rio",class:"q-mt-lg"},null,8,["modelValue","onUpdate:modelValue","options"]),t(u,{modelValue:o.filtros.fornecedor.nome,"onUpdate:modelValue":e[3]||(e[3]=r=>o.filtros.fornecedor.nome=r),dense:"",rotulo:"Fornecedor",class:"q-mt-lg"},null,8,["modelValue"]),this.tabSelecionada.valor==="Nota na SEFAZ"?($(),_t(St,{key:0},[t(u,{modelValue:o.filtros.periodoEmissao.ini,"onUpdate:modelValue":e[4]||(e[4]=r=>o.filtros.periodoEmissao.ini=r),dense:"",rotulo:"Data Emiss\xE3o",tipo:"data",class:"q-mt-xl"},null,8,["modelValue"]),t(u,{modelValue:o.filtros.periodoEmissao.fim,"onUpdate:modelValue":e[5]||(e[5]=r=>o.filtros.periodoEmissao.fim=r),dense:"",tipo:"data",rotulo:"at\xE9",class:"q-mt-sm"},null,8,["modelValue"]),t(u,{modelValue:o.filtros.ordenacaoSefaz,"onUpdate:modelValue":e[6]||(e[6]=r=>o.filtros.ordenacaoSefaz=r),options:o.ordenacaoSefaz,dense:"",rotuloFixo:"Ordenar por",tipo:"seletor",class:"q-mt-xl"},null,8,["modelValue","options"]),t(u,{modelValue:o.filtros.direcaoSefaz,"onUpdate:modelValue":e[7]||(e[7]=r=>o.filtros.direcaoSefaz=r),options:o.direcaoOpcoes,dense:"",rotuloFixo:"Dire\xE7\xE3o",tipo:"seletor",class:"q-mt-sm"},null,8,["modelValue","options"])],64)):($(),_t(St,{key:1},[t(u,{modelValue:o.filtros.periodoEmissao.ini,"onUpdate:modelValue":e[8]||(e[8]=r=>o.filtros.periodoEmissao.ini=r),dense:"",tipo:"data",rotulo:"Data Emiss\xE3o",class:"q-mt-xl"},null,8,["modelValue"]),t(u,{modelValue:o.filtros.periodoEmissao.fim,"onUpdate:modelValue":e[9]||(e[9]=r=>o.filtros.periodoEmissao.fim=r),dense:"",rotulo:"at\xE9",tipo:"data",class:"q-mt-sm"},null,8,["modelValue"]),t(u,{modelValue:o.filtros.periodoFinalizado.ini,"onUpdate:modelValue":e[10]||(e[10]=r=>o.filtros.periodoFinalizado.ini=r),dense:"",tipo:"data",rotulo:"Data Finalizado",class:"q-mt-xl"},null,8,["modelValue"]),t(u,{modelValue:o.filtros.periodoFinalizado.fim,"onUpdate:modelValue":e[11]||(e[11]=r=>o.filtros.periodoFinalizado.fim=r),dense:"",tipo:"data",rotulo:"at\xE9",class:"q-mt-sm"},null,8,["modelValue"]),t(u,{modelValue:o.filtros.ordenacao,"onUpdate:modelValue":e[12]||(e[12]=r=>o.filtros.ordenacao=r),options:o.ordenacaoOpcoes,dense:"",rotuloFixo:"Ordenar por",tipo:"seletor",class:"q-mt-xl"},null,8,["modelValue","options"]),t(u,{modelValue:o.filtros.direcao,"onUpdate:modelValue":e[13]||(e[13]=r=>o.filtros.direcao=r),options:o.direcaoOpcoes,dense:"",rotuloFixo:"Dire\xE7\xE3o",tipo:"seletor",class:"q-mt-sm"},null,8,["modelValue","options"])],64)),t(u,{modelValue:o.paginacao.limite,"onUpdate:modelValue":e[14]||(e[14]=r=>o.paginacao.limite=r),dense:"",min:"1",tipo:"quantidade",rotulo:"Quantidade por p\xE1gina",class:"q-mt-xl q-mb-lg"},null,8,["modelValue"])]),itemLista:n(()=>[t(Pt,{bordered:"",class:"bg-white q-mb-xs rounded-borders",style:{"min-height":"calc(100vh - 200px)"}},{default:n(()=>[($(!0),_t(St,null,Tt(o.lista,r=>($(),_t("div",{key:r.id,class:"itemHover"},[t(mt,{"manual-focus":"",class:"q-py-sm q-px-xs items-center"},{default:n(()=>[t(K,{class:"hideonmobile col-auto q-px-sm no-margin"},{default:n(()=>[ft("div",wa,[t(a,{id:r.id,numero:r.numero,cor:"positive",escuro:""},null,8,["id","numero"])])]),_:2},1024),t(K,{class:"col-md col-lg col-xl no-margin"},{default:n(()=>[t(mt,{class:"q-pa-none"},{default:n(()=>[t(K,{onClick:g=>s.abrir(r.id),class:"col-auto items-center cursor-pointer"},{default:n(()=>[t(c,{imagem:(o.contatos[r.idContato]||{}).imagem,rotulo:r.descricaoContato,tamanho:"40"},null,8,["imagem","rotulo"])]),_:2},1032,["onClick"]),t(K,{class:"col"},{default:n(()=>[t(dt,{onClick:g=>s.abrir(r.id),lines:"2",class:"text-weight-bold cursor-pointer"},{default:n(()=>[A(tt(r.descricaoContato)+" ",1),t(Vt,{anchor:"bottom middle",self:"center middle"},{default:n(()=>e[37]||(e[37]=[A("Fornecedor")])),_:1})]),_:2},1032,["onClick"]),r.descricaoEmpresa?($(),Y(dt,{key:0,onClick:g=>s.abrir(r.id),caption:"",class:"cursor-pointer"},{default:n(()=>[r.descricaoEmpresa?($(),Y(v,{key:0,icon:"business 14px tertiary left"},{default:n(()=>[A(tt(r.descricaoEmpresa)+" ",1),r.numeroDocumentoEmpresa?($(),_t("span",Ia,"("+tt(r.numeroDocumentoEmpresa)+")",1)):it("",!0)]),_:2},1024)):it("",!0)]),_:2},1032,["onClick"])):it("",!0),t(mt,{class:"q-pa-none hideonmobile q-mt-xs",style:{"min-height":"unset"}},{default:n(()=>[r.notaNumero?($(),Y(b,{key:0,cor:"tertiary",class:"mw50 text-center",escuro:""},{default:n(()=>[A(tt(r.notaNumero)+" ",1),t(Vt,{anchor:"bottom middle",self:"center middle"},{default:n(()=>e[38]||(e[38]=[A("N\xFAmero da Nota")])),_:1})]),_:2},1024)):($(),Y(b,{key:1,cor:"warning",class:"mw50 text-center",escuro:""},{default:n(()=>[e[40]||(e[40]=A(" S/N ")),t(Vt,{anchor:"bottom middle",self:"center middle"},{default:n(()=>e[39]||(e[39]=[A("N\xFAmero da Nota")])),_:1})]),_:1}))]),_:2},1024),t(K,{class:"hideondesktop q-mt-sm"},{default:n(()=>[t(_,{mg:"xs-b"},{default:n(()=>[r.dataHoraEmissao?($(),Y(f,{key:0,col:"shrink"},{default:n(()=>[t(v,{icon:"mdi-calendar-today xs tertiary left",tip:`Emitido \xE0s ${i.$filters.hora(r.dataHoraEmissao)}`},{default:n(()=>[A(tt(i.$filters.data(r.dataHoraEmissao)),1)]),_:2},1032,["tip"])]),_:2},1024)):it("",!0),r.dataHoraFinalizado?($(),Y(f,{key:1,col:"shrink",class:"q-ml-sm"},{default:n(()=>[t(v,{icon:"mdi-calendar xs tertiary left",tip:`Finalizado \xE1s ${i.$filters.hora(r.dataHoraFinalizado)}`},{default:n(()=>[A(tt(i.$filters.data(r.dataHoraFinalizado)),1)]),_:2},1032,["tip"])]),_:2},1024)):it("",!0)]),_:2},1024),t(_,{mg:"xs-b"},{default:n(()=>[t(f,{col:"shrink"},{default:n(()=>[t(a,{id:r.id,numero:r.numero,cor:"positive",escuro:""},null,8,["id","numero"])]),_:2},1024),t(f,{col:"shrink",class:"q-ml-sm"},{default:n(()=>[r.notaNumero?($(),Y(b,{key:0,cor:"tertiary",class:"mw50",escuro:""},{default:n(()=>[A(tt(r.notaNumero)+" ",1),t(Vt,{anchor:"bottom middle",self:"center middle"},{default:n(()=>e[41]||(e[41]=[A("N\xFAmero da Nota")])),_:1})]),_:2},1024)):($(),Y(b,{key:1,cor:"warning",class:"mw50",escuro:""},{default:n(()=>[e[43]||(e[43]=A(" S/N ")),t(Vt,{anchor:"bottom middle",self:"center middle"},{default:n(()=>e[42]||(e[42]=[A("N\xFAmero da Nota")])),_:1})]),_:1}))]),_:2},1024),t(f,{col:"shrink",class:"q-ml-sm"},{default:n(()=>[t(b,{rotulo:r.status,cor:r.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:r.status!=="Digita\xE7\xE3o"},null,8,["rotulo","cor","escuro"])]),_:2},1024)]),_:2},1024),t(_,null,{default:n(()=>[t(f,{col:"shrink",text:"bold"},{default:n(()=>[A(tt(i.$filters.numero(r.totalDocumento,2)),1)]),_:2},1024),vt(t(f,{col:"grow",text:"center",class:"q-ml-sm"},{default:n(()=>[A(tt(r.qtdeContatos)+" Itens ",1)]),_:2},1536),[[xt,r.qtdeContatos>0]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(K,{onClick:g=>s.abrir(r.id),class:"hideonmobile maxw110 q-pl-sm no-margin cursor-pointer"},{default:n(()=>[this.tabSelecionada.valor==="Nota na SEFAZ"?($(),_t(St,{key:0},[r.dhRecbto?($(),Y(dt,{key:0,color:"tertiary",class:"ellipsis"},{default:n(()=>[t(ct,{name:"mdi-calendar-today"}),A(" "+tt(i.$filters.data(r.dhRecbto))+" ",1),t(Vt,{anchor:"bottom middle",self:"center middle"},{default:n(()=>[A(" Autorizado \xE0s "+tt(i.$filters.hora(r.dhRecbto)),1)]),_:2},1024)]),_:2},1024)):it("",!0)],64)):($(),_t(St,{key:1},[r.dataHoraEmissao?($(),Y(dt,{key:0,color:"tertiary",class:"ellipsis"},{default:n(()=>[t(ct,{name:"mdi-calendar-today"}),A(" "+tt(i.$filters.data(r.dataHoraEmissao))+" ",1),t(Vt,{anchor:"bottom middle",self:"center middle"},{default:n(()=>[A(" Emitido \xE0s "+tt(i.$filters.hora(r.dataHoraEmissao)),1)]),_:2},1024)]),_:2},1024)):it("",!0),r.dataHoraFinalizado?($(),Y(dt,{key:1,color:"tertiary",class:"ellipsis"},{default:n(()=>[t(ct,{name:"mdi-calendar"}),A(" "+tt(i.$filters.data(r.dataHoraFinalizado))+" ",1),t(Vt,{anchor:"bottom middle",self:"center middle"},{default:n(()=>[A(" Finalizado \xE1s "+tt(i.$filters.hora(r.dataHoraFinalizado)),1)]),_:2},1024)]),_:2},1024)):it("",!0)],64))]),_:2},1032,["onClick"]),t(K,{onClick:g=>s.abrir(r.id),class:"hideonmobile maxw100 q-pl-sm no-margin cursor-pointer"},{default:n(()=>[t(b,{cor:r.status!=="Digita\xE7\xE3o"?"tertiary":"light",escuro:r.status!=="Digita\xE7\xE3o",class:"col-auto q-mx-auto"},{default:n(()=>[A(tt(r.status)+" ",1),t(Vt,{anchor:"bottom middle",self:"center middle"},{default:n(()=>e[44]||(e[44]=[A(" Status ")])),_:1})]),_:2},1032,["cor","escuro"])]),_:2},1032,["onClick"]),t(K,{onClick:g=>s.abrir(r.id),class:"hideonmobile maxw120 q-pl-sm no-margin cursor-pointer"},{default:n(()=>[t(dt,{class:"text-tertiary text-weight-bold text-right"},{default:n(()=>[A(tt(i.$filters.numero(r.totalDocumento,2)),1)]),_:2},1024),vt(t(dt,{class:"text-tertiary text-right"},{default:n(()=>[A(tt(r.qtdeContatos)+" Itens ",1)]),_:2},1536),[[xt,r.qtdeContatos>0]])]),_:2},1032,["onClick"]),t(K,{class:"hideonmobile col-auto q-pl-sm no-margin"},{default:n(()=>[t(mt,{class:"q-pa-none"},{default:n(()=>[o.tabSelecionada.valor!=="Nota na SEFAZ"?($(),Y(K,{key:0,class:"no-margin"},{default:n(()=>[t(ut,{onClick:g=>s.abrir(r.id),icon:"edit",size:"md",color:"primary",round:"",flat:"",dense:""},null,8,["onClick"])]),_:2},1024)):it("",!0),o.tabSelecionada.valor==="Nota na SEFAZ"?($(),Y(K,{key:1,class:"no-margin",style:{width:"33.6px"}},{default:n(()=>[r.status==="N\xE3o Importada"?($(),Y(ut,{key:0,onClick:g=>s.importarXmlDFe(r.id),flat:"",round:"",dense:"",icon:"mdi-upload",size:"md",color:"tertiary",class:"buttons"},{default:n(()=>[t(Vt,{anchor:"bottom middle",self:"center middle"},{default:n(()=>e[45]||(e[45]=[A("Importar XML")])),_:1})]),_:2},1032,["onClick"])):it("",!0)]),_:2},1024)):it("",!0),["Nota na SEFAZ","Nota de Entrada"].includes(o.tabSelecionada.valor)?($(),Y(K,{key:2,class:"no-margin",style:{width:"33.6px"}},{default:n(()=>[t(ut,{onClick:g=>s.downloadXmlDFe(r.id,o.tabSelecionada.valor),flat:"",round:"",dense:"",icon:"mdi-download",color:"tertiary",size:"md",class:"buttons"},{default:n(()=>[t(Vt,{anchor:"bottom middle",self:"center middle"},{default:n(()=>e[46]||(e[46]=[A("Download XML")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):it("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?($(),Y(K,{key:3,class:"no-margin"},{default:n(()=>[t(ut,{icon:"print",size:"md",color:"tertiary",round:"",flat:"",dense:""},{default:n(()=>[t(Lt,null,{default:n(()=>[vt(($(),Y(Pt,{link:"","no-border":"",separator:""},{default:n(()=>[($(!0),_t(St,null,Tt(o.configImpressao,g=>($(),Y(mt,{key:g.valor,onClick:S=>i.$imprimir(g.valor,r.id),clickable:""},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"print"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>[A(tt(g.texto),1)]),_:2},1024),g.observacao?($(),Y(dt,{key:0,caption:""},{default:n(()=>[A(tt(g.observacao),1)]),_:2},1024)):it("",!0)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),($(!0),_t(St,null,Tt(o.configImpressaoPedidoCompra,g=>($(),Y(mt,{key:g.valor,onClick:S=>s.imprimirPedidoCompra(g.valor,r==null?void 0:r.codigoDocumento),clickable:""},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"print"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>[A(tt(g.texto),1)]),_:2},1024),g.observacao?($(),Y(dt,{key:0,caption:""},{default:n(()=>[A(tt(g.observacao),1)]),_:2},1024)):it("",!0)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),t(mt,{onClick:g=>s.dialogImprimirEtiquetas({acao:"adicionar",item:r}),clickable:""},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"print"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>e[47]||(e[47]=[A(" Etiquetas ")])),_:1}),t(dt,{caption:""},{default:n(()=>e[48]||(e[48]=[A(" Adicionar \xE1 Fila ")])),_:1})]),_:1})]),_:2},1032,["onClick"]),t(mt,{onClick:g=>s.dialogImprimirEtiquetas({acao:"impressao",item:r}),clickable:""},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"print"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>e[49]||(e[49]=[A(" Etiquetas ")])),_:1}),t(dt,{caption:""},{default:n(()=>e[50]||(e[50]=[A(" Impress\xE3o Direta ")])),_:1})]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[Dt]])]),_:2},1024)]),_:2},1024)]),_:2},1024)):it("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?($(),Y(K,{key:4,class:"no-margin"},{default:n(()=>[t(ut,{icon:"more_vert",size:"md",color:"tertiary",round:"",flat:"",dense:""},{default:n(()=>[t(Lt,null,{default:n(()=>[vt(($(),Y(Pt,{link:"","no-border":"",separator:""},{default:n(()=>[o.tabSelecionada.valor!=="Nota na SEFAZ"?($(),Y(mt,{key:0,onClick:g=>s.duplicarDocumento_click(r),clickable:""},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"content_copy"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>e[51]||(e[51]=[A(" Duplicar ")])),_:1})]),_:1})]),_:2},1032,["onClick"])):it("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?($(),Y(mt,{key:1,onClick:g=>s.alterarPrevisaoEntrega_click(r),clickable:""},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"local_shipping"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>e[52]||(e[52]=[A("Alterar Previs\xE3o de Entrega")])),_:1})]),_:1})]),_:2},1032,["onClick"])):it("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?($(),Y(mt,{key:2,onClick:g=>s.trocarCfop_click(r),clickable:""},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"sync_alt"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>e[53]||(e[53]=[A("Trocar CFOP para consumo")])),_:1})]),_:1})]),_:2},1032,["onClick"])):it("",!0),it("",!0)]),_:2},1024)),[[Dt]])]),_:2},1024)]),_:2},1024)]),_:2},1024)):it("",!0)]),_:2},1024)]),_:2},1024),t(K,{class:"hideondesktop col-auto q-pl-sm no-margin"},{default:n(()=>[t(ut,{icon:"more_vert",size:"md",color:"tertiary",round:"",flat:"",dense:""},{default:n(()=>[t(Lt,null,{default:n(()=>[vt(($(),Y(Pt,{link:"","no-border":"",separator:""},{default:n(()=>[it("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?($(),Y(mt,{key:1,onClick:g=>s.abrir(r.id),clickable:"",class:"itemHover"},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"edit"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>e[58]||(e[58]=[A(" Editar ")])),_:1})]),_:1})]),_:2},1032,["onClick"])):it("",!0),o.tabSelecionada.valor==="Nota na SEFAZ"&&r.status==="N\xE3o Importada"?($(),Y(mt,{key:2,onClick:g=>s.importarXmlDFe(r.id),clickable:"",class:"itemHover"},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"mdi-upload"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>e[59]||(e[59]=[A(" Importar XML ")])),_:1})]),_:1})]),_:2},1032,["onClick"])):it("",!0),["Nota na SEFAZ","Nota de Entrada"].includes(o.tabSelecionada.valor)?($(),Y(mt,{key:3,onClick:g=>s.downloadXmlDFe(r.id,o.tabSelecionada.valor),clickable:"",class:"itemHover"},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"mdi-download"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>e[60]||(e[60]=[A(" Download XML ")])),_:1})]),_:1})]),_:2},1032,["onClick"])):it("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?($(!0),_t(St,{key:4},Tt(o.configImpressao,g=>($(),Y(mt,{key:g.valor,onClick:S=>i.$imprimir(g.valor,r.id),clickable:""},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"print"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>[A(tt(g.texto),1)]),_:2},1024),g.observacao?($(),Y(dt,{key:0,caption:""},{default:n(()=>[A(tt(g.observacao),1)]),_:2},1024)):it("",!0)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):it("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?($(!0),_t(St,{key:5},Tt(o.configImpressaoPedidoCompra,g=>($(),Y(mt,{clickable:"",key:g.valor,onClick:S=>s.imprimirPedidoCompra(g.valor,r==null?void 0:r.codigoDocumento)},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"print"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>[A(tt(g.texto),1)]),_:2},1024),g.observacao?($(),Y(dt,{key:0,caption:""},{default:n(()=>[A(tt(g.observacao),1)]),_:2},1024)):it("",!0)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):it("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?($(),Y(mt,{key:6,clickable:"",onClick:g=>s.dialogImprimirEtiquetas({acao:"adicionar",item:r})},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"print"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>e[61]||(e[61]=[A(" Etiquetas ")])),_:1}),t(dt,{caption:""},{default:n(()=>e[62]||(e[62]=[A(" Adicionar \xE1 Fila ")])),_:1})]),_:1})]),_:2},1032,["onClick"])):it("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?($(),Y(mt,{key:7,clickable:"",onClick:g=>s.dialogImprimirEtiquetas({acao:"impressao",item:r})},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"print"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>e[63]||(e[63]=[A(" Etiquetas ")])),_:1}),t(dt,{caption:""},{default:n(()=>e[64]||(e[64]=[A(" Impress\xE3o Direta ")])),_:1})]),_:1})]),_:2},1032,["onClick"])):it("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?($(),Y(mt,{key:8,onClick:g=>s.duplicarDocumento_click(r),clickable:"",class:"itemHover"},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"content_copy"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>e[65]||(e[65]=[A(" Duplicar ")])),_:1})]),_:1})]),_:2},1032,["onClick"])):it("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?($(),Y(mt,{key:9,onClick:g=>s.alterarPrevisaoEntrega_click(r),clickable:""},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"local_shipping"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>e[66]||(e[66]=[A("Alterar Previs\xE3o de Entrega")])),_:1})]),_:1})]),_:2},1032,["onClick"])):it("",!0),o.tabSelecionada.valor!=="Nota na SEFAZ"?($(),Y(mt,{key:10,onClick:g=>s.trocarCfop_click(r),clickable:""},{default:n(()=>[t(K,{avatar:""},{default:n(()=>[t(ct,{name:"sync_alt"})]),_:1}),t(K,null,{default:n(()=>[t(dt,null,{default:n(()=>e[67]||(e[67]=[A("Trocar CFOP para consumo")])),_:1})]),_:1})]),_:2},1032,["onClick"])):it("",!0)]),_:2},1024)),[[Dt]])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(ue)]))),128))]),_:1})]),_:1},8,["busca","onAtualizar","onLimparFiltrosClick","onCriarClick","lista","tabSelecionada","tabs","tabSelecionada2","tabs2","paginacao","mostrar"]),t(C,{ref:"comprasFicha",onAtualizar:s.atualizar,onDialogImprimirEtiquetas:s.dialogImprimirEtiquetas},null,8,["onAtualizar","onDialogImprimirEtiquetas"]),t(h,{ref:"comprasImportacaoXML",onAtualizar:s.atualizar,onConcluirImportacao:s.concluirImportacao},null,8,["onAtualizar","onConcluirImportacao"]),t($t,{modelValue:o.modalXMLNotaEntrada,"onUpdate:modelValue":e[19]||(e[19]=r=>o.modalXMLNotaEntrada=r),persistent:""},{default:n(()=>[t(Ht,{container:"",class:"bg-light",style:{height:"40vh",width:"50vw","max-width":"100vw"}},{default:n(()=>[ft("form",{onSubmit:e[18]||(e[18]=Fe((...r)=>s.importarXmlNotaDeEntrada&&s.importarXmlNotaDeEntrada(...r),["prevent"]))},[t(Zt,null,{default:n(()=>[t(Nt,null,{default:n(()=>[vt(t(ut,{onClick:s.fecharXmlNotaDeEntrada,flat:"",round:"",dense:"",icon:"close"},null,8,["onClick"]),[[Dt]]),t(Rt,null,{default:n(()=>e[68]||(e[68]=[A("Importar XML Nota de Entrada")])),_:1}),t(ut,{color:"white","text-color":"primary",label:"Enviar",type:"submit",unelevated:""})]),_:1})]),_:1}),t(Xt,{class:"u-container"},{default:n(()=>[t(Wt,{style:{"min-height":"300px"}},{default:n(()=>{var r,g,S;return[ft("div",Ca,[t(ze,{class:"col-12","hide-upload-btn":"","auto-upload":"",factory:s.adicionarXml,filter:D=>D.filter(V=>V.type==="text/xml")},null,8,["factory","filter"]),t(ge,{modelValue:o.xmlDevolucao,"onUpdate:modelValue":e[16]||(e[16]=D=>o.xmlDevolucao=D),label:"Devolu\xE7\xE3o"},null,8,["modelValue"]),t(ge,{modelValue:o.xmlEstrangeiro,"onUpdate:modelValue":e[17]||(e[17]=D=>o.xmlEstrangeiro=D),label:"Importa\xE7\xE3o do exterior"},null,8,["modelValue"])]),Object.keys((S=(g=(r=o.xmlNotaEntrada.error)==null?void 0:r.data)==null?void 0:g.fields)!=null?S:{}).length?($(),_t("div",ka,[ft("ul",Sa,[($(!0),_t(St,null,Tt(Object.keys(o.xmlNotaEntrada.error.data.fields),D=>($(),_t("li",{key:D},[ft("span",null,tt(D),1),ft("span",null,tt(o.xmlNotaEntrada.error.data.fields[D]),1)]))),128))])])):it("",!0)]}),_:1})]),_:1})],32)]),_:1})]),_:1},8,["modelValue"]),t($t,{modelValue:o.modalPrevisaoEntrega.visivel,"onUpdate:modelValue":e[22]||(e[22]=r=>o.modalPrevisaoEntrega.visivel=r),"content-css":{minWidth:"50vw"}},{default:n(()=>[t(Ne,null,{default:n(()=>[t(Nt,{class:"bg-primary text-white"},{default:n(()=>[t(Rt,null,{default:n(()=>e[69]||(e[69]=[A("Alterar Previs\xE3o de Entrega")])),_:1}),vt(t(ut,{dense:"",flat:"",icon:"close",round:""},null,512),[[Dt]])]),_:1}),t(Te,null,{default:n(()=>[t(oe,{onSubmit:s.alterarPrevisaoEntrega},{default:n(()=>[t(w,{class:"q-col-gutter-md"},{default:n(()=>[ft("div",Ea,[t(ie,{modelValue:o.modalPrevisaoEntrega.dataPrevistaEntrega,"onUpdate:modelValue":e[20]||(e[20]=r=>o.modalPrevisaoEntrega.dataPrevistaEntrega=r),type:"date",label:"Data Prevista de Entrega",clearable:"",dense:"","stack-label":"",borderless:""},null,8,["modelValue"])]),ft("div",Da,[t(ie,{modelValue:o.modalPrevisaoEntrega.horaPrevistaEntrega,"onUpdate:modelValue":e[21]||(e[21]=r=>o.modalPrevisaoEntrega.horaPrevistaEntrega=r),type:"time",label:"Hora Prevista de Entrega",clearable:"",dense:"","stack-label":"",borderless:""},null,8,["modelValue"])])]),_:1}),ft("div",Va,[vt(t(ut,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[Dt]]),t(ut,{color:"primary",class:"q-ml-sm no-shadow",unelevated:"",label:"Alterar",type:"submit"})])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t($t,{modelValue:o.dialogEtiquetas.impressao,"onUpdate:modelValue":e[28]||(e[28]=r=>o.dialogEtiquetas.impressao=r)},{default:n(()=>[t(Ht,{container:"",view:"hHh LpR fFf",class:"bg-white rounded-borders",style:{height:"100%","max-height":"425px"}},{default:n(()=>[t(oe,{onSubmit:e[27]||(e[27]=r=>s.imprimirEtiquetas(o.modeloSelecionado)),autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:"false",novalidate:""},{default:n(()=>[t(Zt,null,{default:n(()=>[t(Nt,{class:"bg-primary text-white"},{default:n(()=>[t(Rt,null,{default:n(()=>[t(ct,{name:"mdi-tag-plus",size:"sm",class:"q-mr-sm"}),e[70]||(e[70]=A(" Imprimir Etiquetas "))]),_:1})]),_:1})]),_:1}),t(Xt,null,{default:n(()=>[t(Wt,{class:"q-pa-md"},{default:n(()=>[t(v,{class:"q-pb-lg"},{default:n(()=>{var r,g,S,D,V,B,q,j,T,X,ot,E,O;return[e[71]||(e[71]=A(" Imprimir os itens: ")),ft("strong",null,tt((r=o.tabSelecionada)==null?void 0:r.valor)+" "+tt((S=(g=o.dialogEtiquetas)==null?void 0:g.item)!=null&&S.numero?", #"+((V=(D=o.dialogEtiquetas)==null?void 0:D.item)==null?void 0:V.numero):"")+" "+tt((q=(B=o.dialogEtiquetas)==null?void 0:B.item)!=null&&q.descricaoContato?" - "+((T=(j=o.dialogEtiquetas)==null?void 0:j.item)==null?void 0:T.descricaoContato):"")+" "+tt((ot=(X=o.dialogEtiquetas)==null?void 0:X.item)!=null&&ot.notaNumero?", Nota #"+((O=(E=o.dialogEtiquetas)==null?void 0:E.item)==null?void 0:O.notaNumero):""),1),e[72]||(e[72]=A(". "))]}),_:1}),t(u,{modelValue:o.modeloSelecionado,"onUpdate:modelValue":e[23]||(e[23]=r=>o.modeloSelecionado=r),opcoes:o.opcoesModelo,dense:"",filled:"",tipo:"seletor",rotulo:"Modelo",cor:"white","popup-content-class":"etiquetas-modelo-selecionado",class:"q-field--with-bottom"},null,8,["modelValue","opcoes"]),t(u,{modelValue:o.empresaSelecionada,"onUpdate:modelValue":e[24]||(e[24]=r=>o.empresaSelecionada=r),opcoes:o.opcoesEmpresas,dense:"",filled:"",clearable:"",tipo:"seletor",rotulo:"Empresa",color:"tertiary",class:"q-field--with-bottom"},null,8,["modelValue","opcoes"]),t(u,{modelValue:o.tabelaPrecoSelecionada,"onUpdate:modelValue":e[25]||(e[25]=r=>o.tabelaPrecoSelecionada=r),opcoes:o.opcoesTabelasPreco,dense:"",filled:"",clearable:"",tipo:"seletor",rotulo:"Tabela de Pre\xE7o",color:"tertiary",class:"q-field--with-bottom"},null,8,["modelValue","opcoes"]),t(u,{modelValue:o.emBranco,"onUpdate:modelValue":e[26]||(e[26]=r=>o.emBranco=r),min:0,tipo:"quantidade",dense:"",filled:"",rotulo:"Etiquetas em branco",color:"tertiary","text-color":"red"},null,8,["modelValue"])]),_:1})]),_:1}),t(Yt,{class:"bg-light"},{default:n(()=>[t(Nt,null,{default:n(()=>[t(re),vt(t(ut,{label:"Cancelar",color:"tertiary",flat:"",class:"q-mr-sm"},null,512),[[Dt]]),t(ut,{label:"Confirmar",color:"primary",type:"submit",unelevated:""})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t($t,{modelValue:o.dialogEtiquetas.adicionar,"onUpdate:modelValue":e[30]||(e[30]=r=>o.dialogEtiquetas.adicionar=r)},{default:n(()=>[t(Ht,{container:"",view:"hHh LpR fFf",class:"bg-white rounded-borders",style:{height:"100%","max-height":"250px"}},{default:n(()=>[t(oe,{onSubmit:s.adicionarEtiquetas,autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:"false",novalidate:""},{default:n(()=>[t(Zt,null,{default:n(()=>[t(Nt,{class:"bg-primary text-white"},{default:n(()=>[t(Rt,null,{default:n(()=>[t(ct,{name:"mdi-tag-plus",size:"sm",class:"q-mr-sm"}),e[73]||(e[73]=A(" Adicionar os itens a lista de etiquetas "))]),_:1})]),_:1})]),_:1}),t(Xt,null,{default:n(()=>[t(Wt,{class:"q-pa-md"},{default:n(()=>[t(v,{class:"q-pb-lg"},{default:n(()=>{var r,g,S,D,V,B,q,j,T,X,ot,E,O;return[e[74]||(e[74]=A(" Adicionar os itens: ")),ft("strong",null,tt((r=o.tabSelecionada)==null?void 0:r.valor)+" "+tt((S=(g=o.dialogEtiquetas)==null?void 0:g.item)!=null&&S.numero?", #"+((V=(D=o.dialogEtiquetas)==null?void 0:D.item)==null?void 0:V.numero):"")+" "+tt((q=(B=o.dialogEtiquetas)==null?void 0:B.item)!=null&&q.descricaoContato?" - "+((T=(j=o.dialogEtiquetas)==null?void 0:j.item)==null?void 0:T.descricaoContato):"")+" "+tt((ot=(X=o.dialogEtiquetas)==null?void 0:X.item)!=null&&ot.notaNumero?", Nota #"+((O=(E=o.dialogEtiquetas)==null?void 0:E.item)==null?void 0:O.notaNumero):""),1),e[75]||(e[75]=A(" \xE0 lista de etiquetas para impress\xE3o. "))]}),_:1}),t(u,{modelValue:o.dialogEtiquetas.limpar,"onUpdate:modelValue":e[29]||(e[29]=r=>o.dialogEtiquetas.limpar=r),tipo:"logico",rotulo:"Limpar lista de etiquetas anterior."},null,8,["modelValue"])]),_:1})]),_:1}),t(Yt,{class:"bg-light"},{default:n(()=>[t(Nt,null,{default:n(()=>[t(re),vt(t(ut,{label:"Cancelar",color:"tertiary",flat:"",class:"q-mr-sm"},null,512),[[Dt]]),t(ut,{label:"Confirmar",color:"primary",type:"submit",unelevated:""})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])])}var Aa=ne(_a,[["render",Pa]]);export{Aa as default};
