import{_ as H,$ as L,Z as T,r as v,o as r,p as _,d as f,w as a,f as e,T as m,C as g,U as y,k as c,t as h,j as N,m as S,Q as V,be as z,P as w,F,u as D,S as C,H as P,N as A,e as k,l as j,bb as q,aY as B,aX as M,bR as R,z as W,h as O,a_ as X,a$ as U,b5 as Q,b4 as Y}from"./index.2cdadbf3.js";import{a as Z,n as G}from"./nfePrincipal.2845e7b2.js";import"./compactarValidarNFe.8e1d2e37.js";import"./obterItens.e94ccafc.js";import"./codigosANP.a6c1a264.js";const J={components:{BadgeCopiarUid:L,Badge:T},data(){return{detalhesVisivel:!1,configImpressaoNFe:[]}},methods:{abrirNFe(){$utils.emitter.emit("abrirNFe",this.nota.id)},async configuraImpressao(i){const t=await $db.configuracoes.porNome("impressao.nfe",i);this.configImpressaoNFe=t.length?t.map(l=>({texto:"Imprimir DANFE",...l})):[{valor:"nfe-danfe",texto:"DANFE"},{valor:"nfe-danfe-simplificado",texto:"DANFE Simplificado"},{valor:"duplicata-mercantil",texto:"Duplicata Mercantil"}]}},mixins:[Z],props:{nota:{required:!0,type:Object}},async created(){var u,o,s;const i=(u=this.nota)==null?void 0:u.idDocumento,t=(s=(o=this.nota)==null?void 0:o.cpfCnpjEmitente)==null?void 0:s.replace(/\D/g,"");let l;if(i){const p=await $db.hibrido.le({table:"documento",id:i});l=p==null?void 0:p.idEmpresa}if(!l&&t){const b=(await $erp().empresa.toArray()).find(E=>{var d;return((d=E.numeroDocumentoNacional)==null?void 0:d.replace(/\D/g,""))===t});l=b==null?void 0:b.idContato}await this.configuraImpressao(l)}},K={class:"col-12"},$={class:"col-12"},ee={class:"text-tertiary q-col-gutter-xs"};function ae(i,t,l,u,o,s){const p=v("BadgeCopiarUid"),b=v("badge"),E=v("row");return r(),_(F,null,[l.nota.id?(r(),f(C,{key:0,"manual-focus":"",clickable:"",class:"items-center d-flex q-pa-xs"},{default:a(()=>[e(m,{avatar:"",center:"",class:"mw120"},{default:a(()=>[e(p,{id:l.nota.id,numero:l.nota.nNF,class:"q-mr-sm",cor:"positive"},null,8,["id","numero"])]),_:1}),e(m,{clickable:""},{default:a(()=>[e(E,{class:"items-center q-col-gutter-x-sm"},{default:a(()=>[g("div",{class:"col",onClick:t[0]||(t[0]=(...d)=>s.abrirNFe&&s.abrirNFe(...d))},[e(y,{class:"text-tertiary text-weight-bold"},{default:a(()=>[c(h(l.nota.xNomeDestinatario||"Destinat\xE1rio n\xE3o preenchido"),1)]),_:1}),e(E,{class:"hideondesktop items-center q-my-sm"},{default:a(()=>[g("div",K,[e(y,{caption:"",class:"text-tertiary"},{default:a(()=>[e(N,{name:"event"}),c(" "+h(i.$filters.data(l.nota.dataHoraEmissao)),1)]),_:1}),e(b,{cor:"tertiary",escuro:""},{default:a(()=>[c(h(l.nota.situacao)+h(l.nota.tpAmb==="2"?" - Homologa\xE7\xE3o":""),1)]),_:1})]),g("div",$,[e(y,{caption:"",class:"text-tertiary text-weight-bold q-mt-sm"},{default:a(()=>[c(h(i.$filters.numero(l.nota.vNF,2))+" ",1),e(S,null,{default:a(()=>t[3]||(t[3]=[c("Valor da nota")])),_:1})]),_:1})])]),_:1})])]),_:1})]),_:1}),e(m,{onClick:s.abrirNFe,avatar:"",class:"mw100 hideonmobile"},{default:a(()=>[e(y,{class:"text-tertiary"},{default:a(()=>[e(N,{name:"event"}),c(" "+h(i.$filters.data(l.nota.dataHoraEmissao)),1)]),_:1})]),_:1},8,["onClick"]),e(m,{onClick:s.abrirNFe,avatar:"",class:"mw100 hideonmobile"},{default:a(()=>[e(b,{cor:"tertiary",escuro:""},{default:a(()=>[c(h(l.nota.situacao)+h(l.nota.tpAmb==="2"?" - Homologa\xE7\xE3o":""),1)]),_:1})]),_:1},8,["onClick"]),e(m,{onClick:s.abrirNFe,class:"hideonmobile"},{default:a(()=>[e(y,{caption:"",class:"text-right text-tertiary text-weight-bold"},{default:a(()=>[c(h(i.$filters.numero(l.nota.vNF,2))+" ",1),e(S,null,{default:a(()=>t[4]||(t[4]=[c("Valor da nota")])),_:1})]),_:1})]),_:1},8,["onClick"]),e(m,{side:"",top:""},{default:a(()=>[g("div",ee,[e(V,{rounded:"",dense:"",flat:"",icon:i.emDigitacao?"edit":"remove_red_eye",color:"tertiary",class:"no-shadow q-ma-xs hideonmobile",size:"md",onClick:s.abrirNFe,style:{float:"right"}},null,8,["icon","onClick"]),e(V,{rounded:"",dense:"",flat:"",icon:"print",color:"primary",class:"no-shadow q-ma-xs hideonmobile",size:"md",style:{float:"right"}},{default:a(()=>[e(z,null,{default:a(()=>[e(w,{link:"",separator:""},{default:a(()=>[(r(!0),_(F,null,D(o.configImpressaoNFe,d=>(r(),f(C,{clickable:"",key:d.valor,onClick:I=>{var n,x;return i.$imprimir(d.valor,(x=(n=l.nota)==null?void 0:n.id)!=null?x:"0")}},{default:a(()=>[e(m,{avatar:""},{default:a(()=>[e(N,{name:"mdi-printer"})]),_:1}),e(m,null,{default:a(()=>[e(y,null,{default:a(()=>[c(h(d.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}),e(V,{rounded:"",dense:"",flat:"",icon:o.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down",size:"md",class:"no-shadow q-ma-xs hideonmobile",color:"tertiary",style:{float:"right"},onClick:t[1]||(t[1]=d=>o.detalhesVisivel=!o.detalhesVisivel)},null,8,["icon"]),e(V,{dense:"",flat:"",icon:"more_vert",round:"",size:"md",class:"hideondesktop"},{default:a(()=>[e(z,null,{default:a(()=>[P((r(),f(w,{link:"","no-border":"",separator:""},{default:a(()=>[e(C,{class:"hideondesktop",clickable:"",onClick:s.abrirNFe},{default:a(()=>[e(m,{avatar:""},{default:a(()=>[e(N,{name:i.emDigitacao?"edit":"remove_red_eye"},null,8,["name"])]),_:1}),e(m,null,{default:a(()=>[c(h(i.emDigitacao?"Editar":"Consultar"),1)]),_:1})]),_:1},8,["onClick"]),(r(!0),_(F,null,D(o.configImpressaoNFe,d=>(r(),f(C,{class:"hideondesktop",clickable:"",key:d.valor,onClick:I=>{var n,x;return i.$imprimir(d.valor,(x=(n=l.nota)==null?void 0:n.id)!=null?x:"0")}},{default:a(()=>[e(m,{avatar:""},{default:a(()=>[e(N,{name:"mdi-printer"})]),_:1}),e(m,null,{default:a(()=>[e(y,null,{default:a(()=>[c(h(d.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),e(C,{class:"hideondesktop",clickable:"",onClick:t[2]||(t[2]=d=>o.detalhesVisivel=!o.detalhesVisivel)},{default:a(()=>[e(m,{avatar:""},{default:a(()=>[e(N,{name:o.detalhesVisivel?"keyboard_arrow_up":"keyboard_arrow_down"},null,8,["name"])]),_:1}),e(m,null,{default:a(()=>t[5]||(t[5]=[c(" Detalhes ")])),_:1})]),_:1})]),_:1})),[[A]])]),_:1})]),_:1})])]),_:1})]),_:1})):k("",!0),o.detalhesVisivel?(r(),f(C,{key:1,class:"q-px-xs"},{default:a(()=>[e(m,{class:"q-px-none fullWidth"},{default:a(()=>[e(N,{name:"business"}),c(" "+h(l.nota.xFantEmitente||l.nota.xNomeEmitente),1)]),_:1})]),_:1})):k("",!0),e(j)],64)}var te=H(J,[["render",ae]]);const oe={components:{nfeCard:te,nfePrincipal:G},data(){return{dataFim:null,dataIni:null,grupos:[],notasEmDigitacao:[],notasEmitidas:[],notasOutras:[],tabSelecionada:""}},methods:{async atualizar(){q.log("NFeLista","atualizar()");try{this.$q.loading.show();let i=await $db.hibrido.lista({table:"documentoFiscalEletronico",where:{tipo:"NFe"}});if(this.dataIni&&this.dataFim){const l=new Date(this.dataIni).setHours(0,0,0,0),u=new Date(this.dataFim).setHours(23,59,59,0);i=i.filter(o=>{const s=new Date(o.dataHoraEmissao);return s>=l&&s<=u})}if(this.grupos.length){const l=this.grupos.map(u=>B(u.label).toUpperCase());i=i.filter(u=>{const o=B(u.chNFe.toUpperCase()+u.xNomeEmitente.toUpperCase()+u.xFantEmitente.toUpperCase()+u.cpfCnpjDestinatario.toUpperCase()+u.xNomeDestinatario.toUpperCase()+" "+String(u.nNF)+" ");let s=!0;for(const p of l)p.length>9||isNaN(Number(p))?s=s&&o.includes(p):s=s&&o.includes(" "+p+" ");return s})}i=M.exports.orderBy(i,["dataHoraEmissao"],["desc"]),this.notasEmDigitacao=i.filter(l=>["Em digita\xE7\xE3o"].includes(l.situacao)).slice(0,30),this.notasEmitidas=i.filter(l=>["Emitido","Carta de Corre\xE7\xE3o"].includes(l.situacao)).slice(0,30),this.notasOutras=i.filter(l=>!["Em digita\xE7\xE3o","Carta de Corre\xE7\xE3o","Emitido"].includes(l.situacao)).slice(0,30);let t=this.notasEmDigitacao.length?"notasEmDigitacao":"";t||(t=this.notasEmitidas.length?"notasEmitidas":""),t||(t=this.notasOutras.length?"notasEmitidas":""),this.tabSelecionada=t}catch(i){this.$q.notifyError("Erro ao carregar notas",i)}finally{this.$q.loading.hide()}},fechouNFe(i){q.log("NFeLista","fechouNFe()",i),i&&this.atualizar()},limparFiltro(){this.grupos=[],this.dataFim=new Date,this.dataIni=new Date(R().add(-7,"days"))}},created(){q.log("NFeLista","created()")},mounted(){q.log("NFeLista","mounted()"),this.limparFiltro(),this.atualizar()}},le={class:"NFeLista q-pb-md q-px-none"},ie={class:"col-12 col-md-6"},se={class:"col"},ne={class:"col"},re={key:1,class:"q-pa-lg text-center"};function de(i,t,l,u,o,s){const p=v("gchips"),b=v("campo"),E=v("row"),d=v("nfeCard"),I=v("nfePrincipal");return r(),_("div",le,[e(O,{class:"bg-light"},{default:a(()=>[e(W,{class:"no-shadow bg-light full-width"},{default:a(()=>[e(E,{class:"items-center"},{default:a(()=>[g("div",ie,[e(p,{modelValue:o.grupos,"onUpdate:modelValue":[t[0]||(t[0]=n=>o.grupos=n),s.atualizar],placeholder:o.grupos.length?"":"Filtre por Empresa, Destinat\xE1rio, N\xFAmero...",before:[{icon:"mdi-filter",handler(){i.filtrar()}}]},null,8,["modelValue","onUpdate:modelValue","placeholder","before"])]),g("div",se,[e(b,{modelValue:o.dataIni,"onUpdate:modelValue":[t[1]||(t[1]=n=>o.dataIni=n),s.atualizar],tipo:"data",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),t[5]||(t[5]=g("div",{class:"col-auto",style:{"align-items":"center",display:"flex"}},[g("label",null,"at\xE9")],-1)),g("div",ne,[e(b,{modelValue:o.dataFim,"onUpdate:modelValue":[t[2]||(t[2]=n=>o.dataFim=n),s.atualizar],tipo:"data",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])])]),_:1})]),_:1})]),_:1}),o.tabSelecionada?(r(),_(F,{key:0},[e(O,{class:"bg-light q-px-sm"},{default:a(()=>[e(X,{modelValue:o.tabSelecionada,"onUpdate:modelValue":t[3]||(t[3]=n=>o.tabSelecionada=n),class:"text-primary",align:"left",style:{"border-bottom":"1px solid #0000001f"}},{default:a(()=>[o.notasEmDigitacao.length?(r(),f(U,{key:0,label:"Em digita\xE7\xE3o",name:"notasEmDigitacao",active:""})):k("",!0),o.notasEmitidas.length?(r(),f(U,{key:1,label:"Emitidas",name:"notasEmitidas"})):k("",!0),o.notasOutras.length?(r(),f(U,{key:2,label:"Outras",name:"notasOutras"})):k("",!0)]),_:1},8,["modelValue"])]),_:1}),e(Y,{modelValue:o.tabSelecionada,"onUpdate:modelValue":t[4]||(t[4]=n=>o.tabSelecionada=n),animated:"",class:"transparent q-pa-none"},{default:a(()=>[o.notasEmDigitacao.length?(r(),f(Q,{key:0,name:"notasEmDigitacao",class:"q-pa-none transparent"},{default:a(()=>[e(w,{class:"rounded-borders"},{default:a(()=>[(r(!0),_(F,null,D(o.notasEmDigitacao,n=>(r(),f(d,{key:n.id,nota:n},null,8,["nota"]))),128))]),_:1})]),_:1})):k("",!0),o.notasEmitidas.length?(r(),f(Q,{key:1,name:"notasEmitidas",class:"q-pa-none transparent"},{default:a(()=>[e(w,{class:"rounded-borders"},{default:a(()=>[(r(!0),_(F,null,D(o.notasEmitidas,n=>(r(),f(d,{key:n.id,nota:n},null,8,["nota"]))),128))]),_:1})]),_:1})):k("",!0),o.notasOutras.length?(r(),f(Q,{key:2,name:"notasOutras",class:"q-pa-none transparent"},{default:a(()=>[e(w,{class:"rounded-borders"},{default:a(()=>[(r(!0),_(F,null,D(o.notasOutras,n=>(r(),f(d,{key:n.id,nota:n},null,8,["nota"]))),128))]),_:1})]),_:1})):k("",!0)]),_:1},8,["modelValue"])],64)):(r(),_("div",re,t[6]||(t[6]=[g("p",null,[g("small",null,"N\xE3o h\xE1 notas com o filtro selecionado")],-1)]))),e(I,{onFechar:s.fechouNFe},null,8,["onFechar"])])}var he=H(oe,[["render",de]]);export{he as default};
