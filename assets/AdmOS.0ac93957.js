import{_ as M,a0 as j,bl as A,bd as g,ay as D,aZ as k,a_ as E,cC as Z,az as G,r as v,o as m,p as w,f as a,w as s,h as V,i as z,k as f,Q as q,G as H,J as P,C as d,F as J,u as K,t as h,e as F,d as x,z as X,v as W,O as Q,j as b,m as U,bg as Y,H as $,P as oo,S as T,T as y,U as N,N as ao,I,M as eo,au as B,b2 as to}from"./index.05370f25.js";import{C as so}from"./Campo.5bec5cdd.js";import{O as ro}from"./OSTrocarStatus.3ccc6416.js";import{M as lo}from"./ModalHistoricoStatus.85ebba70.js";import{d as no}from"./vuedraggable.umd.7d789514.js";const io={components:{Badge:j,Campo:so,OSTrocarStatus:ro,ModalHistoricoStatus:lo,draggable:no},data(){return{drawer:!0,showfilters:!1,empresaOpcoes:[],empresaSelecionada:null,entregueInicio:new Date(new Date(A()).toDateString()),entregueFim:new Date(new Date(A()).toDateString()),fraseFiltro:"",listas:{Processando:[],Entregue:[]},trocarStatusDados:{},trocarStatusModal:!1,periodoOpcoes:[{label:"Hoje",value:0},{label:"Uma semana",value:7},{label:"Um m\xEAs",value:30}],prazoSelecionado:null,prazoOpcoes:[{label:"Em dia",value:"bordaVerdeOS"},{label:"Entrega para esta semana",value:"bordaAmarelaOS"},{label:"Entrega atrasada",value:"bordaVermelhaOS"}]}},methods:{async eventoEnd(){for(const r in this.listas)for(const o of this.listas[r])if(o.status!==r){g.log("AdmOS","eventoEnd De:",o.status,"Para:",r,"codigo:",o.codigoDocumento),this.trocarStatusDados={codigoContatoResponsavel:o.codigoContatoResponsavel,codigoDocumento:o.codigoDocumento,codigoUsuario:null,nomeCliente:o.nomeCliente,observacao:"",statusAtual:o.status,statusNovo:r},this.trocarStatusModal=!0;return}},async eventoConfirmarTroca(r){g.log("AdmOS","eventoConfirmaTroca",{...r}),this.$q.loading.show();try{let o;$db.usuario.logado.cpf&&(o=(await $db.contato.ler({filtros:{termoBusca:$db.usuario.logado.cpf}})).data.find(t=>{var e;return t.numeroDocumentoNacional.replace(/\D/g,"")===((e=$db.usuario.logado.cpf)==null?void 0:e.replace(/\D/g,""))})),r.cpfUsuario=o==null?void 0:o.numeroDocumentoNacional,await D.os.trocaStatusOnline(r),this.$q.notifyPositive("Status trocado com sucesso"),this.atualiza()}catch(o){this.$q.notifyError("Erro na troca de status",o)}finally{this.$q.loading.hide()}},eventoCancelarTroca(r){g.log("AdmOS","eventoCancelarTroca",r),this.atualiza()},async empresaOpcoesCarregar(){const r=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;this.empresaOpcoes=r.map(o=>({label:o.nome,value:o.codigoContato,id:o.id}))},filtraDebounce(){k.exports.debounce(this.refazFiltro,700)()},refazFiltro(){g.log("AdmOSs","refazFiltro()",this.fraseFiltro,this.empresaSelecionada);const r=E(this.fraseFiltro.toUpperCase()).split(" ").filter(o=>o!=="");for(const o in this.listas)for(const n of this.listas[o]){const t=E(n.id.toUpperCase()+n.nomeCliente.toUpperCase()+n.nomeResponsavel.toUpperCase()+" "+String(n.numeroVenda)+"  "+String(n.numeroOS)+" ");let e=!0;for(const c of r)isNaN(Number(c))?e=e&&t.includes(c):e=e&&t.includes(" "+c+" ");this.empresaSelecionada&&(e=e&&this.empresaSelecionada.value===n.codigoEmpresa),n.mostra=e}},async atualiza(){try{const r=await D.os.leAdmOSOnline({entregueInicio:this.entregueInicio,entregueFim:this.entregueFim,empresas:this.empresaOpcoes.map(t=>t.id)});g.log("AdmOS","atualiza()",r.length),Z(!r||!r.length,"N\xE3o h\xE1 ordens de servi\xE7o");let o=await D.configuracoes.le({nome:"vendas.os.status"});o=o.filter(t=>!["Processando","Entregue"].includes(t.texto));const n={Processando:[]};for(const t of k.exports.orderBy(o,"valor","asc").map(e=>e.texto))n[t]=[];n.Entregue=[];for(const t of r){let e="bordaVerdeOS",c="",_="Normal";if(t.status==="Entregue"){if(!!t.dataHoraPrevisto&&!!t.dataHoraFinalizado){const p=new Date(new Date(t.dataHoraPrevisto).toDateString()),i=(new Date(new Date(t.dataHoraFinalizado).toDateString())-p)/(1e3*60*60*24);e=i>=0?"bordaVermelhaOS":i>-7?"bordaAmarelaOS":"bordaVerdeOS",c=i>=0?"negative":i>-7?"warning":"",_=i>=0?"Atrasado":i>-7?"Aten\xE7\xE3o":"Normal"}}else if(t.dataHoraPrevisto){const p=new Date(new Date(t.dataHoraPrevisto).toDateString()),i=(new Date(new Date().toDateString())-p)/(1e3*60*60*24);e=i>=0?"bordaVermelhaOS":i>-7?"bordaAmarelaOS":"bordaVerdeOS",c=i>=0?"negative":i>-7?"warning":"",_=i>=0?"Atrasado":i>-7?"Aten\xE7\xE3o":"Normal"}const S={id:t.id,codigoCompra:t.codigoCompra||"-",codigoContatoResponsavel:t.codigoContatoResponsavel,codigoDocumento:t.codigoDocumento,codigoContato:t.codigoContato,codigoEmpresa:t.codigoEmpresa,descricaoEmpresa:t.descricaoEmpresa,descricao:t.descricao,corBorda:e,corLabel:c,txtLabel:_,dataHoraEmissao:new Date(t.dataHoraEmissao),dataHoraFinalizado:new Date(t.dataHoraFinalizado),dataHoraRetorno:new Date(t.dataHoraRetorno),dataHoraPrevisto:new Date(t.dataHoraPrevisto),mostra:!0,nomeCliente:t.nomeCliente||"-",nomeResponsavel:t.nomeResponsavel||"-",numeroVenda:t.numeroVenda?String(t.numeroVenda):"-",numeroOS:t.numeroOS?String(t.numeroOS):"-",status:t.status};n[t.status]&&n[t.status].push(S)}this.listas=n,this.refazFiltro()}catch(r){this.$q.notifyError("Erro na consulta online de oss",r)}},async irParaAtendimento(r){const o=await G().contato.where({codigoContato:r}).first()||{};o.id&&this.$router.push({name:"Atendimento",params:{id:o.id}})}},watch:{entregueInicio(){g.log("AdmOSs","entregueInicio"),this.atualiza()},entregueFim(){g.log("AdmOSs","entregueFim"),this.atualiza()}},async created(){g.log("AdmOSs","created()"),await this.empresaOpcoesCarregar(),this.atualiza()}},co={id:"AdmOS"},uo={class:"row overflowXOS filterfalse"},mo={class:"q-pa-none"},po={key:0,class:"row"},go={class:"col-12"},fo={class:"q-pa-md"},ho={class:"row q-mt-xs"},bo={class:"col-6"},vo={class:"col-6 justify-end q-pr-xs",style:{display:"flex"}},_o={class:"text-subtitle1"},So={class:"text-caption"},wo={class:"col-11"},xo={key:0,style:{background:"rgb(236,239,241)","border-radius":"50px","text-align":"center",display:"inline-block",width:"22px",height:"22px","line-height":"22px","margin-right":"3px"}},yo={style:{background:"rgb(236,239,241)","border-radius":"50px","text-align":"center",display:"inline-block",width:"22px",height:"22px","line-height":"22px","margin-right":"3px"}},Co={class:"text-caption",style:{display:"inline-block","margin-right":"6px"}},Oo={style:{background:"rgb(236,239,241)","border-radius":"50px","text-align":"center",display:"inline-block",width:"22px",height:"22px","line-height":"22px","margin-right":"3px"}},Do={class:"text-caption",style:{display:"inline-block"}},Vo={class:"col-1 self-end"};function zo(r,o,n,t,e,c){const _=v("barraTopo"),S=v("campo"),p=v("badge"),C=v("draggable"),i=v("OS-trocar-status"),L=v("modal-historico-status");return m(),w("div",co,[a(H,{elevated:"",class:"bg-gradiente text-tertiary"},{default:s(()=>[a(_),a(V,{class:"q-px-sm"},{default:s(()=>[a(z,null,{default:s(()=>[f("Adm. OS")]),_:1}),a(q,{onClick:o[0]||(o[0]=u=>e.showfilters=!e.showfilters),icon:"mdi-filter",round:"",dense:"",flat:""})]),_:1})]),_:1}),a(I,null,{default:s(()=>[a(P,null,{default:s(()=>[d("div",uo,[(m(!0),w(J,null,K(e.listas,(u,O)=>(m(),w("div",{key:O,class:"no-shadow col q-px-none coluna"},[d("div",mo,[a(V,{class:"no-shadow q-py-none q-px-sm text-white"},{default:s(()=>[a(z,{class:"q-py-none"},{default:s(()=>[f(h(O),1)]),_:2},1024)]),_:2},1024),O==="Entregue"?(m(),w("div",po,[d("div",go,[d("div",fo,[a(S,{modelValue:e.entregueInicio,"onUpdate:modelValue":o[1]||(o[1]=l=>e.entregueInicio=l),rotulo:"In\xEDcio",tipo:"data"},null,8,["modelValue"]),a(S,{modelValue:e.entregueFim,"onUpdate:modelValue":o[2]||(o[2]=l=>e.entregueFim=l),rotulo:"Fim",tipo:"data"},null,8,["modelValue"])])])])):F("",!0),a(C,{onEnd:c.eventoEnd,list:u,draggable:".extratoOS",delay:"250",group:"osGroup",itemKey:"id",class:"dragAreaOS"},{item:s(({element:l})=>[l.mostra&&(e.prazoSelecionado===null||e.prazoSelecionado===l.corBorda)?(m(),x(X,{key:0,class:W([l.corBorda,"q-pa-sm q-pb-md q-my-sm q-mb-md shadow-1 extratoOS bg-white"])},{default:s(()=>[d("div",ho,[d("div",bo,[l.corLabel?(m(),x(p,{key:0,cor:l.corLabel,rotulo:l.txtLabel,escuro:"",class:"q-mx-xs"},null,8,["cor","rotulo"])):(m(),x(p,{key:1,class:"q-mx-xs",rotulo:l.txtLabel},null,8,["rotulo"]))]),d("div",vo,[a(p,{cor:"grey-1",class:"q-mx-sm",icone:"shopping_cart",rotulo:l.numeroVenda},null,8,["rotulo"]),a(p,{cor:"grey-8",escuro:"",icone:"assignment_turned_in",rotulo:l.numeroOS},null,8,["rotulo"])])]),a(Q,{class:"q-pa-xs"},{default:s(()=>[d("div",_o,h(l.nomeCliente),1),d("span",So,h(l.descricao),1)]),_:2},1024),a(Q,{class:"row q-pa-xs q-pb-none q-mt-md"},{default:s(()=>[d("div",wo,[l.descricaoEmpresa?(m(),w("div",xo,[a(b,{name:"business",color:"grey-7",size:"14px"}),a(U,null,{default:s(()=>[f(h(l.descricaoEmpresa),1)]),_:2},1024)])):F("",!0),d("div",yo,[a(b,{name:"person",color:"grey-7",size:"14px"})]),d("div",Co,h(l.nomeResponsavel),1),d("div",Oo,[a(b,{name:"calendar_today",color:"grey-7",size:"14px"})]),d("div",Do,[f(h(r.$filters.data(l.dataHoraFinalizado>new Date("1970-01-01T00:00:00.000Z")?l.dataHoraFinalizado:l.dataHoraPrevisto))+" ",1),a(U,{anchor:"bottom middle",self:"center middle"},{default:s(()=>[f(h(l.dataHoraFinalizado>new Date("1970-01-01T00:00:00.000Z")?"Finalizado em":"Previsto para"),1)]),_:2},1024)])]),d("div",Vo,[a(b,{name:"more_vert",color:"blue-grey-6",onMouseOver:"this.style.color='black'",onMouseOut:"this.style.color='grey'",style:{color:"grey",float:"right","text-align":"right","font-size":"1.2rem",cursor:"pointer"}},{default:s(()=>[a(Y,null,{default:s(()=>[$((m(),x(oo,{link:"",separator:""},{default:s(()=>[a(T,{onClick:R=>r.$refs.modalHistoricoStatus.mostrar({idDocumento:l.id}),clickable:""},{default:s(()=>[a(y,{avatar:""},{default:s(()=>[a(b,{name:"history"})]),_:1}),a(y,null,{default:s(()=>[a(N,null,{default:s(()=>[f("Hist\xF3rico do Status")]),_:1})]),_:1})]),_:2},1032,["onClick"]),a(T,{onClick:R=>c.irParaAtendimento(l.codigoContato),clickable:""},{default:s(()=>[a(y,{avatar:""},{default:s(()=>[a(b,{name:"launch"})]),_:1}),a(y,null,{default:s(()=>[a(N,null,{default:s(()=>[f("Ir para o Atendimentos")]),_:1})]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)),[[ao]])]),_:2},1024)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["class"])):F("",!0)]),_:2},1032,["onEnd","list"])])]))),128))])]),_:1})]),_:1}),a(to,{modelValue:e.showfilters,"onUpdate:modelValue":o[7]||(o[7]=u=>e.showfilters=u),bordered:"",side:"right",class:"hide-scrollbar"},{default:s(()=>[a(eo,{view:"hHh lpR lFr"},{default:s(()=>[a(H,{class:"bg-white"},{default:s(()=>[a(V,{class:"text-tertiary border-bottom"},{default:s(()=>[a(b,{class:"text-h5",name:"mdi-filter"}),a(z,null,{default:s(()=>[f("Filtro Avan\xE7ado")]),_:1}),a(q,{dense:"",flat:"",icon:"close",round:"",onClick:o[3]||(o[3]=u=>e.showfilters=!e.showfilters)})]),_:1})]),_:1}),a(I,null,{default:s(()=>[a(P,{class:"q-pa-md"},{default:s(()=>[a(S,{modelValue:e.fraseFiltro,"onUpdate:modelValue":[o[4]||(o[4]=u=>e.fraseFiltro=u),c.filtraDebounce],rotulo:"Por cliente ou respons\xE1vel",dense:""},null,8,["modelValue","onUpdate:modelValue"]),a(B,{modelValue:e.prazoSelecionado,"onUpdate:modelValue":o[5]||(o[5]=u=>e.prazoSelecionado=u),options:e.prazoOpcoes,clearable:"",label:"Por prazo"},null,8,["modelValue","options"]),a(B,{modelValue:e.empresaSelecionada,"onUpdate:modelValue":[o[6]||(o[6]=u=>e.empresaSelecionada=u),c.refazFiltro],options:e.empresaOpcoes,clearable:"",label:"Por empresa"},null,8,["modelValue","options","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(i,{modelValue:e.trocarStatusModal,"onUpdate:modelValue":o[8]||(o[8]=u=>e.trocarStatusModal=u),dados:e.trocarStatusDados,onConfirmar:c.eventoConfirmarTroca,onCancelar:c.eventoCancelarTroca},null,8,["modelValue","dados","onConfirmar","onCancelar"]),a(L,{ref:"modalHistoricoStatus"},null,512)])}var Ho=M(io,[["render",zo]]);export{Ho as default};
