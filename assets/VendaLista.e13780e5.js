import{_ as B,bb as N,r as g,o as c,p as b,f as n,w as v,d as I,e as _,H as P,P as j,F as H,u as Q,b5 as J}from"./index.741dd87a.js";import"./xlsx.6fa435df.js";import{L as X}from"./lista.2b038fd9.js";import{V as G}from"./VendaCard.2f0d22f0.js";import"./emitirNFe.35117289.js";import"./DocumentosFiscais.56ef5268.js";import"./Campo.6ffff242.js";import"./compactarValidarNFe.c51051dc.js";import"./obterItens.52360607.js";import"./codigosANP.a6c1a264.js";import"./ModalHistoricoStatus.a7f3fc7f.js";const K={components:{Lista:X,VendaCard:G,VendaModal:N},data(){return{usuario:"",permissao:{vendedoresDigitadores:!1,outrasEmpresas:!1},carregar:!1,itens:[],mostrar:{barraTopo:!0,toolbarTitulo:!0,icone:"mdi-cart-arrow-up",titulo:"Vendas",buscar:!0,filtroAvancado:!0,btnAjuda:!0,btnAtualizar:!0,btnNovo:!0,toolbarAcoes:!0,checkBox:!1,btnRemover:!1,btnRestaurar:!1,centralizaTabs:!1,btnDetalhes:!0,btnExportaXLS:!1,btnMenuMais:!1,toolbarAdicao:!1,bannerMsg:""},lista:[],busca:"",detalhesVisivel:!1,tabSelecionada:{valor:""},tabs:[{valor:"Or\xE7amento",rotulo:"Or\xE7amento"},{valor:"Aguardando Estoque",rotulo:"Ag. Estoque"},{valor:"Aguardando Financeiro",rotulo:"Ag. Financeiro"},{valor:"Aguardando Libera\xE7\xE3o",rotulo:"Ag. Libera\xE7\xE3o"},{valor:"Aguardando Pagamento,Aguardando Faturamento",rotulo:"Ag. Pagamento"},{valor:"Finalizado,Faturado,Entregue",rotulo:"Finalizado"},{valor:"N\xE3o Aprovado",rotulo:"N\xE3o Aprovado"},{valor:"",rotulo:"Todas"}],usaExpedicao:!1,filtrosOriginal:{},filtros:{cliente:null,idEmpresa:null,idContatoVendedor:null,idContatoDigitador:null,statusEnvio:null,tipoData:"emissao",data:{ini:"",fim:""},valorTotal:0},empresaOpcoes:[],opcoesVendedores:[],statusEnvioOpcoes:[{value:"Enviados",label:"Enviados"},{value:"N\xE3o Enviados",label:"N\xE3o Enviados"}],dataOpcoes:[{value:"emissao",label:"Data Emiss\xE3o"},{value:"finalizado",label:"Data Finalizado"},{value:"faturado",label:"Data Faturado"}],paginacao:{atual:1,maximo:1,total:1,limite:25}}},methods:{async atualizar(o){var t,s,r,a,d,l,f,p,h,e,V,C,E,D,A,k,w,L,F,x,y,q,S,O,z,T,M;try{$q.loading.show(),this.carregar=!1,this.itens=[];let{buscarDadosRecentes:U}=o!=null?o:{},i={},u={};U&&(i=await $utils.localIDB.getItem({objectStore:"dadosRecentes",id:"VendaLista_"+((t=this.usuario)==null?void 0:t.id)}),i!=null&&i._id&&(this.tabSelecionada.valor=i==null?void 0:i.tabSelecionada,this.busca=(i==null?void 0:i.busca)||null,this.filtros={cliente:((s=i==null?void 0:i.filtros)==null?void 0:s.cliente)||null,idEmpresa:((r=i==null?void 0:i.filtros)==null?void 0:r.idEmpresa)||null,idContatoVendedor:((a=i==null?void 0:i.filtros)==null?void 0:a.idContatoVendedor)||null,idContatoDigitador:((d=i==null?void 0:i.filtros)==null?void 0:d.idContatoDigitador)||null,statusEnvio:((l=i==null?void 0:i.filtros)==null?void 0:l.statusEnvio)||null,tipoData:((f=i==null?void 0:i.filtros)==null?void 0:f.tipoData)||"emissao",data:{ini:((h=(p=i==null?void 0:i.filtros)==null?void 0:p.data)==null?void 0:h.ini)||"",fim:((V=(e=i==null?void 0:i.filtros)==null?void 0:e.data)==null?void 0:V.fim)||""},valorTotal:((C=i==null?void 0:i.filtros)==null?void 0:C.valorTotal)||0},this.compareObject(this.filtrosOriginal,this.filtros)&&(this.$refs.vendaLista.filtros=!0))),this.busca=((E=this.busca)==null?void 0:E.trim())||"",this.filtros.termoBusca=this.busca,this.filtros.cliente=(A=(D=this.filtros)==null?void 0:D.cliente)==null?void 0:A.trim(),this.filtros=$utils.eliminarVazios(this.filtros),this.filtros.status=this.tabSelecionada.valor,u=$utils.clonarV2(this.filtros),this.filtros.tipoData==="emissao"&&(u.emissao={ini:(w=(k=this.filtros)==null?void 0:k.data)==null?void 0:w.ini,fim:(F=(L=this.filtros)==null?void 0:L.data)==null?void 0:F.fim}),this.filtros.tipoData==="finalizado"&&(u.finalizado={ini:(y=(x=this.filtros)==null?void 0:x.data)==null?void 0:y.ini,fim:(S=(q=this.filtros)==null?void 0:q.data)==null?void 0:S.fim}),this.filtros.tipoData==="faturado"&&(u.faturado={ini:(z=(O=this.filtros)==null?void 0:O.data)==null?void 0:z.ini,fim:(M=(T=this.filtros)==null?void 0:T.data)==null?void 0:M.fim}),this.permissao.vendedoresDigitadores||(u.idContatoVendedor=this.usuario.id),delete u.tipoData,delete u.data,/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/.test(this.busca)&&(delete u.termoBusca,this.tabSelecionada.valor="",this.filtros.status="",u.status="",u.idVenda=this.busca);const m=await $db.venda.leListaCompleta({filtros:u,limit:this.paginacao.limite,page:this.paginacao.atual,sort:["dataHoraFinalizado","dataHoraEmissao"],dir:["desc","desc"]});this.lista=m==null?void 0:m.data,this.paginacao.total=m==null?void 0:m.total,this.paginacao.maximo=m==null?void 0:m.totalPages,i={_id:"VendaLista_"+this.usuario.id,tabSelecionada:this.tabSelecionada.valor,busca:this.busca,filtros:$utils.clonarV2(this.filtros)},await $utils.localIDB.setItem({objectStore:"dadosRecentes",data:i})}catch{$q.notify({message:"Erro ao carregar vendas.",type:"negative"}),$q.loading.hide()}finally{if(this.lista.length===0){this.carregar=!0,$q.loading.hide(),this.$nextTick(()=>{this.$refs.vendaLista.detalhes&&this.detalhesClick()});return}this.carregar||setTimeout(()=>{this.carregar=!0,$q.loading.hide(),this.$nextTick(()=>{this.$refs.vendaLista.detalhes&&this.detalhesClick()})},3500)}},criarClick(){this.$refs.vendaModal.mostrar()},detalhesClick(){this.detalhesVisivel=!this.detalhesVisivel,this.lista.forEach(o=>{this.$refs[o.id][0].detalhesVisivel=this.detalhesVisivel})},async abrirModalContatos(){const o=await $g.promptContato.show({filtro:{ativo:!0}});!(o!=null&&o.id)||(this.filtros.cliente=o.nome)},async limparFiltrosClick(){this.filtros=$utils.clonar(this.filtrosOriginal),this.paginacao.total=25,this.paginacao.maximo=1,await this.atualizar()},compareObject(o,t,s=[]){const r=Object.keys(o);for(const a of r)if(!s.includes(a)){if(typeof o[a]=="object"&&o[a]!==null){if(!this.compareObject(o[a],t[a],s))continue;return!0}else if(o[a]!==t[a])return!0}return!1},async configurarPermissao(){this.permissao={vendedoresDigitadores:await $db.permissao.objeto("Diretiva_RelatorioVenda_VerTodos"),outrasEmpresas:await $db.permissao.objeto("Diretiva_Venda/Fatura_OutrasLojas_VerTodos")}},async configurarEmpresas(){const o=[];let t=[];if(!this.permissao.outrasEmpresas){t=(await $db.contato.ler({filtros:{ativo:!0,empresas:!0}})).data;for(const s of t)o.push({label:s.nome,value:s.id})}if(this.permissao.outrasEmpresas){t=await $db.empresa.ler({filtro:{ativo:!0}});for(const s of t)o.push({label:s.nome,value:s.idContato})}this.empresaOpcoes=o==null?void 0:o.sort((s,r)=>{var a;return(a=s==null?void 0:s.label)==null?void 0:a.localeCompare(r==null?void 0:r.label)})},async configurarVendedores(){const o=(await $db.contato.ler({filtros:{ativo:!0,vendedores:!0}})).data;o==null||o.sort((t,s)=>{var r;return(r=t==null?void 0:t.nome)==null?void 0:r.localeCompare(s==null?void 0:s.nome)}),o.forEach(t=>{this.opcoesVendedores.push({label:t.nome,value:t.id})})},async configurarExpedicao(){var t;const o=await $db.configuracoes.le({nome:"vendas.usaExpedicao"});this.usaExpedicao=((t=o==null?void 0:o[0])==null?void 0:t.valor)==="1",this.usaExpedicao&&this.tabs.splice(4,0,{valor:"Aguardando Confer\xEAncia,Aguardando Corre\xE7\xE3o,Aguardando Embalagem,Aguardando Entrega,Aguardando Separa\xE7\xE3o,Em Confer\xEAncia,Em Embalagem,Em Separa\xE7\xE3o",rotulo:"Ag. Log\xEDstica"})},async abrirItem(o){this.$router.replace({params:{id:o}}).finally(()=>{this.$refs.vendaModal.mostrar({id:o})})},carregou(o){if(this.itens.push({id:o}),this.itens.length>=25||this.itens.length===this.lista.length){this.carregar=!0,$q.loading.hide(),this.$nextTick(()=>{this.$refs.vendaLista.detalhes&&this.detalhesClick()});return}}},async created(){this.usuario=JSON.parse(localStorage.getItem("usuario")),this.filtrosOriginal=$utils.clonar(this.filtros),await this.configurarPermissao(),await this.configurarEmpresas(),await this.configurarVendedores(),await this.configurarExpedicao(),this.$route.params.id&&this.$route.params.id.length?(this.abrirItem(this.$route.params.id),this.busca=this.$route.params.id,await this.atualizar()):await this.atualizar({buscarDadosRecentes:!0})}},W={id:"VendaLista"};function Y(o,t,s,r,a,d){const l=g("campo"),f=g("VendaCard"),p=g("Lista"),h=g("VendaModal");return c(),b("div",W,[n(p,{ref:"vendaLista",busca:a.busca,"onUpdate:busca":t[10]||(t[10]=e=>a.busca=e),onAtualizar:d.atualizar,onLimparFiltrosClick:d.limparFiltrosClick,onDetalhesClick:d.detalhesClick,onCriarClick:d.criarClick,lista:a.lista,tabSelecionada:a.tabSelecionada,tabs:a.tabs,paginacao:a.paginacao,mostrar:a.mostrar},{filtroCampos:v(()=>[n(l,{modelValue:a.filtros.cliente,"onUpdate:modelValue":t[0]||(t[0]=e=>a.filtros.cliente=e),debounce:500,dense:"",before:[{icon:"search",handler:d.abrirModalContatos}],rotulo:"Por cliente ou respons\xE1vel",class:"col-12 q-mt-md"},null,8,["modelValue","before"]),n(l,{modelValue:a.filtros.idEmpresa,"onUpdate:modelValue":t[1]||(t[1]=e=>a.filtros.idEmpresa=e),options:a.empresaOpcoes,clearable:"",dense:"",tipo:"seletor",rotulo:"Por empresa",class:"col-12 q-mt-lg"},null,8,["modelValue","options"]),a.permissao.vendedoresDigitadores?(c(),I(l,{key:0,modelValue:a.filtros.idContatoVendedor,"onUpdate:modelValue":t[2]||(t[2]=e=>a.filtros.idContatoVendedor=e),options:a.opcoesVendedores,clearable:"",dense:"",tipo:"seletor",rotulo:"Vendedor",class:"col-12 q-mt-lg"},null,8,["modelValue","options"])):_("",!0),a.permissao.vendedoresDigitadores?(c(),I(l,{key:1,modelValue:a.filtros.idContatoDigitador,"onUpdate:modelValue":t[3]||(t[3]=e=>a.filtros.idContatoDigitador=e),options:a.opcoesVendedores,clearable:"",dense:"",tipo:"seletor",rotulo:"Digitador",class:"col-12 q-mt-lg"},null,8,["modelValue","options"])):_("",!0),n(l,{modelValue:a.filtros.statusEnvio,"onUpdate:modelValue":t[4]||(t[4]=e=>a.filtros.statusEnvio=e),options:a.statusEnvioOpcoes,clearable:"",dense:"",tipo:"seletor",rotulo:"Status Envio",class:"col-12 q-mt-lg"},null,8,["modelValue","options"]),n(l,{modelValue:a.filtros.tipoData,"onUpdate:modelValue":t[5]||(t[5]=e=>a.filtros.tipoData=e),options:a.dataOpcoes,dense:"",tipo:"seletor",rotulo:"Selecione o tipo de data",class:"col-12 q-mt-xl"},null,8,["modelValue","options"]),n(l,{modelValue:a.filtros.data.ini,"onUpdate:modelValue":t[6]||(t[6]=e=>a.filtros.data.ini=e),clearable:"",dense:"",tipo:"data",rotulo:"De",class:"col-12 q-mt-md"},null,8,["modelValue"]),n(l,{modelValue:a.filtros.data.fim,"onUpdate:modelValue":t[7]||(t[7]=e=>a.filtros.data.fim=e),clearable:"",dense:"",tipo:"data",rotulo:"at\xE9",class:"col-12 q-mt-xs"},null,8,["modelValue"]),n(l,{modelValue:a.filtros.valorTotal,"onUpdate:modelValue":t[8]||(t[8]=e=>a.filtros.valorTotal=e),debounce:500,dense:"",tipo:"decimal",min:"0",decimals:"4",zerosDireita:"2",rotulo:"Valor total maior que",class:"col-12 q-mt-xl"},null,8,["modelValue"]),n(l,{modelValue:a.paginacao.limite,"onUpdate:modelValue":t[9]||(t[9]=e=>a.paginacao.limite=e),tipo:"quantidade",dense:"",min:"1",rotulo:"Quantidade por p\xE1gina",class:"col-12 q-mt-xl"},null,8,["modelValue"])]),itemLista:v(()=>[P(n(j,{bordered:"",class:"bg-white q-mb-xs rounded-borders"},{default:v(()=>[(c(!0),b(H,null,Q(a.lista,e=>(c(),b("div",{key:e.id,class:"itemHover"},[n(f,{onCarregou:d.carregou,ref_for:!0,ref:e.id,id:e.id,layout:"lista"},null,8,["onCarregou","id"])]))),128))]),_:1},512),[[J,a.carregar]])]),_:1},8,["busca","onAtualizar","onLimparFiltrosClick","onDetalhesClick","onCriarClick","lista","tabSelecionada","tabs","paginacao","mostrar"]),n(h,{continueMesmaTela:!1,ref:"vendaModal"},null,512)])}var da=B(K,[["render",Y]]);export{da as default};
