import{_ as w,r as u,o as m,d as v,w as l,f as e,z as F,h as A,i as q,k as P,H as g,Q as C,N as D,O as z,C as d,at as j,p as x,t as B,D as O,E as U,cA as _,bx as M,bj as W,bi as y,as as G,cG as J,cH as V,F as $,u as E,A as S,P as T,e as k}from"./index.4ec51216.js";import{C as K}from"./CaixaFechar.9e88000a.js";import{S as X}from"./SeletorFinanceiroPlanoContas.2490c0e9.js";import{F as Y}from"./FaturaCard.e96e3e13.js";import{V as Z}from"./VendaCard.d75219b2.js";import"./emitirNFe.35117289.js";import"./nfePrincipal.8ed5c9a5.js";import"./compactarValidarNFe.b89e29b1.js";import"./obterItens.e64adc22.js";import"./codigosANP.a6c1a264.js";import"./FaturaModal.4f3df994.js";import"./DocumentosFiscais.2fe15075.js";import"./Campo.ea197bcb.js";import"./EnvelopeCard.2a99b6e5.js";import"./ModalHistoricoStatus.7543838e.js";const aa={computed:{documentosCaixaEncontrados(){return!!this.documentosCaixa.filter(o=>o.valor).length}},data(){return{abrindo:!1,documentosCaixa:[],empresa:{},idDocumentoCaixa:"",msg:"",periodo:{},visivel:!1}},methods:{async abrir(){this.idDocumentoCaixa&&(this.abrindo=!0,this.$imprimir("conferencia-de-caixa",this.idDocumentoCaixa),this.visivel=!1)},async abrirModalContatoEmpresas(){if(this.abrindo)return;const o=await $g.promptContato.show({filtro:{ativo:!0,empresas:!0},placeholder:"Selecione a empresa"});this.selecionarEmpresa((o||{}).id)},async getDocumentosCaixa(){try{if(!this.empresa.id)return;this.documentosCaixa=[],this.idDocumentoCaixa="",this.msg="Carregando caixas...",await $utils.dormir(500);const o=await $db.hibrido.lista({table:"documento",where:{tipo:"Caixa",idEmpresa:this.empresa.id}}),a=new Date(new Date(this.periodo.de).toDateString()),t=new Date(new Date(this.periodo.ate).toDateString());let s=o.filter(i=>{const r=new Date(new Date(i.dataHoraEmissao).toDateString());return["Aguardando Confer\xEAncia","Fechado"].includes(i.status)&&r>=a&&r<=t});s=$lodash.orderBy(s,"dataHoraEmissao","desc");for(const i of s)i.rotulo=((await $db.caixa.leCache({id:i.idCaixa})||{}).descricao||"")+" - Aberto em "+this.$filters.dataHora(i.dataHoraEmissao)+" - Fechado em "+this.$filters.dataHora(i.dataHoraFinalizado),i.valor=i.id;this.documentosCaixa=[{rotulo:"Selecione um caixa",valor:""},...s],this.documentosCaixaEncontrados||(this.msg="Nenhum caixa encontrado para este filtro")}catch{this.$q.notifyError("Erro ao carregar caixas.")}},limparSeletor(){this.documentosCaixa=this.documentosCaixa.filter(o=>o.valor)},async selecionarEmpresa(o){try{if(!o)return;const a=await $db.empresa.le({idContato:o});$utils.verificarErro(!a.length||!a[0].id,"N\xE3o foi poss\xEDvel recuperar os dados da empresa."),this.empresa={id:o,descricao:a[0].nome||"Empresa sem nome"},this.getDocumentosCaixa()}catch(a){this.limpar(),this.$q.notifyError("Erro ao selecionar a empresa.",a)}},mostrar(){this.visivel=!0},onShow(){this.limpar()},limpar(){this.abrindo=!1,this.empresa={id:"",descricao:""},this.idDocumentoCaixa="",this.documentosCaixa=[];const o=new Date;this.periodo={de:new Date(o.setDate(o.getDate()-7)),ate:new Date},this.msg="Preencha o filtro para buscar caixas"}}},oa={class:"row"},ia={class:"col-6"},ea={class:"col-6"},ta={key:1,class:"text-center q-mt-md"},sa={style:{"font-size":"80%"}},na={class:"q-mt-lg text-center"};function ra(o,a,t,s,i,r){const n=u("campo");return m(),v(O,{modelValue:i.visivel,"onUpdate:modelValue":a[7]||(a[7]=c=>i.visivel=c),onShow:r.onShow,"content-css":{minWidth:"30vw"}},{default:l(()=>[e(F,null,{default:l(()=>[e(A,{class:"bg-primary text-white"},{default:l(()=>[e(q,null,{default:l(()=>a[8]||(a[8]=[P("Confer\xEAncia de Caixa")])),_:1}),g(e(C,{dense:"",flat:"",icon:"close",round:""},null,512),[[D]])]),_:1}),e(z,null,{default:l(()=>[d("form",{class:"layout-padding",onSubmit:a[6]||(a[6]=j((...c)=>r.abrir&&r.abrir(...c),["prevent"]))},[e(n,{modelValue:i.empresa.descricao,"onUpdate:modelValue":a[0]||(a[0]=c=>i.empresa.descricao=c),before:[{icon:"search",handler:r.abrirModalContatoEmpresas}],placeholder:"Selecione","rotulo-fixo":i.empresa.descricao?"Empresa":"","somente-leitura":"",disable:i.abrindo},null,8,["modelValue","before","rotulo-fixo","disable"]),d("div",oa,[a[9]||(a[9]=d("div",{class:"col-12 q-mt-md"},[d("span",null,"Data de abertura do caixa")],-1)),d("div",ia,[e(n,{modelValue:i.periodo.de,"onUpdate:modelValue":[a[1]||(a[1]=c=>i.periodo.de=c),a[2]||(a[2]=c=>r.getDocumentosCaixa())],tipo:"data",rotulo:"De",disable:i.abrindo},null,8,["modelValue","disable"])]),d("div",ea,[e(n,{modelValue:i.periodo.ate,"onUpdate:modelValue":[a[3]||(a[3]=c=>i.periodo.ate=c),a[4]||(a[4]=c=>r.getDocumentosCaixa())],tipo:"data",rotulo:"At\xE9",disable:i.abrindo},null,8,["modelValue","disable"])])]),r.documentosCaixaEncontrados?(m(),v(n,{key:0,modelValue:i.idDocumentoCaixa,"onUpdate:modelValue":[a[5]||(a[5]=c=>i.idDocumentoCaixa=c),r.limparSeletor],opcoes:i.documentosCaixa,tipo:"seletor",disable:i.abrindo},null,8,["modelValue","opcoes","disable","onUpdate:modelValue"])):(m(),x("div",ta,[d("span",sa,B(i.msg),1)])),d("div",na,[e(C,{loading:i.abrindo,color:"primary",class:"q-ml-sm no-shadow",label:"Abrir",type:"submit",disable:!i.idDocumentoCaixa},null,8,["loading","disable"])])],32)]),_:1})]),_:1})]),_:1},8,["modelValue","onShow"])}var la=w(aa,[["render",ra]]);const ca={data(){return{visivel:!1,campos:{},contaOrigem:"",contaDestino:""}},methods:{async atualizar(){try{let o={},a={};o=await $db.hibrido.le({table:"documento",id:this.idDocumentoCaixa}),$utils.verificarAlerta(!(o.tipo==="Caixa"&&["Aberto","Reaberto"].includes(o.status)),"Selecione um caixa aberto"),$utils.verificarErro(!o.idEmpresa,"Caixa sem empresa"),a=await $db.caixa.leCache({id:o.idCaixa}),$utils.verificarErro(!a.id,"Caixa n\xE3o existe"),this.contaOrigem=await $db.financeiroPlanoConta.le({id:a.idPlanoConta}),this.contaDestino=await $db.financeiroPlanoConta.le({id:a.idPlanoContaSangria}),this.campos.valor=0,this.campos.descricao=`Transf. de ${this.contaOrigem.descricao.trim()||""} para ${this.contaDestino.descricao.trim()||""}`,this.idContatoEmpresa=o.idEmpresa;const t=await $db.empresa.le({idContato:this.idContatoEmpresa});$utils.verificarErro(!t||!t.length||!t[0].id,"Caixa sem empresa v\xE1lida"),this.idEmpresa=t[0].idContato,this.visivel=!0}catch(o){this.$q.notifyError("Erro no lancamento de Sangria",o)}},async lancar(){try{$q.loading.show({message:"Processando..."});const o=$utils.dataAtual(),a=(await $db.contato.le({numeroDocumentoNacional:$db.usuario.logado.numeroDocumentoNacional}))[0];$utils.verificarAlerta(!a,"Usu\xE1rio n\xE3o cadastrado"),$utils.verificarAlerta(!this.campos.valor,"Valor n\xE3o preenchido");const t={id:$utils.uuid(),idEmpresa:this.idEmpresa,tipo:"Financeiro",operacao:"Sangria",status:"Finalizado",dataHoraEmissao:o,dataHoraFinalizado:o,totalDocumento:this.campos.valor,idContato:a.id,descricao:`Sangria de ${a.nome} no Caixa #${this.idDocumentoCaixa}`,observacao:this.campos.observacao,idDocumentoAdicional:this.idDocumentoCaixa,idDocumentoOperacao:""},s=$utils.uuid(),i={id:$utils.uuid(),idFinanceiroMovimentacaoN:s,idEmpresa:this.idEmpresa,idContato:a.id,idFinanceiroPlanoConta:this.contaOrigem.id,dataEmissao:o,dataCompetencia:o,dataVencimento:o,dataMovimento:o,valorDebito:0,valorCredito:this.campos.valor,descricao:`${t.observacao?t.observacao+" | ":""}Sangria de ${a.nome} no Caixa #${this.idDocumentoCaixa}`,observacao:"Transfer\xEAncia entre contas",documentoTipo:"Sangria",documentoId:t.id,idDocumentoCaixa:this.idDocumentoCaixa},r={id:$utils.uuid(),idFinanceiroMovimentacaoN:s,idEmpresa:this.idEmpresa,idContato:a.id,idFinanceiroPlanoConta:this.contaDestino.id,dataEmissao:o,dataCompetencia:o,dataVencimento:o,dataMovimento:o,valorDebito:this.campos.valor,valorCredito:0,descricao:`${t.observacao?t.observacao+" | ":""}Sangria de ${a.nome} no Caixa #${this.idDocumentoCaixa}`,observacao:"Transfer\xEAncia entre contas",documentoTipo:"Sangria",documentoId:t.id,idDocumentoCaixa:this.idDocumentoCaixa};await $db.financeiroMovimentacaoN.grava({atual:{id:s}}),await $db.documento.grava({atual:t}),await $db.financeiroMovimentacao.grava({atual:i}),await $db.financeiroMovimentacao.grava({atual:r}),this.visivel=!1,$q.notifyPositive("Sangria lan\xE7ada com sucesso"),this.$imprimir("recibo-sangria-suprimento",{id:i.id})}catch(o){$q.notifyError("Erro no lancamento de Sangria",o)}finally{$q.loading.hide()}},mostrar(o){const{idDocumentoCaixa:a}=o;this.campos={valor:0,descricao:""},this.contaOrigem="",this.contaDestino="",this.idDocumentoCaixa=a,this.atualizar()}}},da={class:"col-12"},ma={class:"col-12"},ua={class:"q-mt-lg text-right"};function pa(o,a,t,s,i,r){const n=u("campo"),c=u("row");return m(),v(O,{modelValue:i.visivel,"onUpdate:modelValue":a[2]||(a[2]=p=>i.visivel=p)},{default:l(()=>[e(F,null,{default:l(()=>[e(A,{class:"bg-primary text-white"},{default:l(()=>[e(q,null,{default:l(()=>a[3]||(a[3]=[P("Lan\xE7ar Sangria")])),_:1}),g(e(C,{dense:"",flat:"",icon:"close",round:""},null,512),[[D]])]),_:1}),e(z,null,{default:l(()=>[e(U,{onSubmit:r.lancar},{default:l(()=>[e(c,{class:"q-col-gutter-md"},{default:l(()=>[d("div",da,[e(n,{modelValue:i.campos.valor,"onUpdate:modelValue":a[0]||(a[0]=p=>i.campos.valor=p),before:[{icon:"attach_money"}],rotulo:"Valor",tipo:"decimal",decimals:"2"},null,8,["modelValue"])]),d("div",ma,[e(n,{modelValue:i.campos.observacao,"onUpdate:modelValue":a[1]||(a[1]=p=>i.campos.observacao=p),before:[{icon:"message"}],rotulo:"Observa\xE7\xE3o",tipo:"textoArea",rows:"3"},null,8,["modelValue"])])]),_:1}),d("div",ua,[g(e(C,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[D]]),e(C,{color:"primary",class:"q-ml-sm",unelevated:"",label:"Lan\xE7ar",type:"submit"})])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var ha=w(ca,[["render",pa]]);const fa={data(){return{visivel:!1,campos:{},contaOrigem:"",contaDestino:"",idDocumentoCaixa:""}},methods:{async atualizar(){try{let o={},a={};o=await $db.hibrido.le({table:"documento",id:this.idDocumentoCaixa}),$utils.verificarAlerta(!(o.tipo==="Caixa"&&["Aberto","Reaberto"].includes(o.status)),"Selecione um caixa aberto"),$utils.verificarErro(!o.idEmpresa,"Caixa sem empresa"),a=await $db.caixa.leCache({id:o.idCaixa}),$utils.verificarErro(!a.id,"Caixa n\xE3o existe"),this.contaOrigem=await $db.financeiroPlanoConta.le({id:a.idPlanoContaSangria}),this.contaDestino=await $db.financeiroPlanoConta.le({id:a.idPlanoConta}),this.campos.valor=0,this.campos.descricao=`Transf. de ${this.contaOrigem.descricao.trim()||""} para ${this.contaDestino.descricao.trim()||""}`,this.idContatoEmpresa=o.idEmpresa;const t=await $db.empresa.le({idContato:this.idContatoEmpresa});$utils.verificarErro(!t||!t.length||!t[0].id,"Caixa sem empresa v\xE1lida"),this.idEmpresa=t[0].idContato,this.visivel=!0}catch(o){this.$q.notifyError("Erro no lancamento de Suprimento",o),this.eventoInput(!1)}},async lancar(o){o.preventDefault();try{$q.loading.show({message:"Processando..."});const a=$utils.dataAtual(),t=(await $db.contato.le({numeroDocumentoNacional:$db.usuario.logado.numeroDocumentoNacional}))[0];$utils.verificarAlerta(!t,"Usu\xE1rio n\xE3o cadastrado"),$utils.verificarAlerta(!this.campos.valor,"Valor n\xE3o preenchido");const s={id:$utils.uuid(),idEmpresa:this.idEmpresa,tipo:"Financeiro",operacao:"Suprimento",status:"Finalizado",dataHoraEmissao:a,dataHoraFinalizado:a,totalDocumento:this.campos.valor,idContato:t.id,descricao:`Suprimento de ${t.nome} no Caixa #${this.idDocumentoCaixa}`,observacao:this.campos.observacao,idDocumentoAdicional:this.idDocumentoCaixa,idDocumentoOperacao:""},i=$utils.uuid(),r={id:$utils.uuid(),idFinanceiroMovimentacaoN:i,idEmpresa:this.idEmpresa,idContato:t.id,idFinanceiroPlanoConta:this.contaOrigem.id,dataEmissao:a,dataCompetencia:a,dataVencimento:a,dataMovimento:a,valorDebito:0,valorCredito:this.campos.valor,descricao:`${s.observacao?s.observacao+" | ":""}Suprimento de ${t.nome} no Caixa #${this.idDocumentoCaixa}`,observacao:"Transfer\xEAncia entre contas",documentoTipo:"Suprimento",documentoId:s.id,idDocumentoCaixa:this.idDocumentoCaixa},n={id:$utils.uuid(),idFinanceiroMovimentacaoN:i,idEmpresa:this.idEmpresa,idContato:t.id,idFinanceiroPlanoConta:this.contaDestino.id,dataEmissao:a,dataCompetencia:a,dataVencimento:a,dataMovimento:a,valorDebito:this.campos.valor,valorCredito:0,descricao:`${s.observacao?s.observacao+" | ":""}Suprimento de ${t.nome} no Caixa #${this.idDocumentoCaixa}`,observacao:"Transfer\xEAncia entre contas",documentoTipo:"Suprimento",documentoId:s.id,idDocumentoCaixa:this.idDocumentoCaixa};await $db.financeiroMovimentacaoN.grava({atual:{id:i}}),await $db.documento.grava({atual:s}),await $db.financeiroMovimentacao.grava({atual:r}),await $db.financeiroMovimentacao.grava({atual:n}),this.visivel=!1,$q.notifyPositive("Suprimento lan\xE7ado com sucesso"),this.$imprimir("recibo-sangria-suprimento",{id:r.id})}catch(a){$q.notifyError("Erro no lancamento de Suprimento",a)}finally{$q.loading.hide()}},mostrar(o){const{idDocumentoCaixa:a}=o;this.campos={valor:0,descricao:""},this.contaOrigem="",this.contaDestino="",this.idDocumentoCaixa=a,this.atualizar()}}},Ca={class:"col-12"},va={class:"col-12"},xa={class:"q-mt-lg text-right"};function ba(o,a,t,s,i,r){const n=u("campo"),c=u("row");return m(),v(O,{modelValue:i.visivel,"onUpdate:modelValue":a[2]||(a[2]=p=>i.visivel=p),"content-css":{minWidth:"30vw"}},{default:l(()=>[e(F,null,{default:l(()=>[e(A,{class:"bg-primary text-white"},{default:l(()=>[e(q,null,{default:l(()=>a[3]||(a[3]=[P("Lan\xE7ar Suprimento")])),_:1}),g(e(C,{dense:"",flat:"",icon:"close",round:""},null,512),[[D]])]),_:1}),e(z,null,{default:l(()=>[e(U,{onSubmit:r.lancar},{default:l(()=>[e(c,{class:"q-col-gutter-md"},{default:l(()=>[d("div",Ca,[e(n,{modelValue:i.campos.valor,"onUpdate:modelValue":a[0]||(a[0]=p=>i.campos.valor=p),before:[{icon:"attach_money"}],rotulo:"Valor",tipo:"decimal",decimals:"2"},null,8,["modelValue"])]),d("div",va,[e(n,{modelValue:i.campos.observacao,"onUpdate:modelValue":a[1]||(a[1]=p=>i.campos.observacao=p),before:[{icon:"message"}],rotulo:"Observa\xE7\xE3o",tipo:"textoArea",rows:"3"},null,8,["modelValue"])])]),_:1}),d("div",xa,[g(e(C,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[D]]),e(C,{color:"primary",class:"q-ml-sm",unelevated:"",label:"Lan\xE7ar",type:"submit"})])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var ga=w(fa,[["render",ba]]);const Da={components:{seletorFinContas:X},data(){return{campos:{idFinanceiroPlanoConta:"",valor:0,descricao:""},contaOrigem:{},contato:{nome:""},idEmpresa:"",idContatoEmpresa:"",idDocumentoCaixa:"",visivel:!1}},methods:{async atualizar(){try{let o=await $db.hibrido.le({table:"documento",id:this.idDocumentoCaixa});_(!(o.tipo==="Caixa"&&["Aberto","Reaberto"].includes(o.status)),"Selecione um caixa aberto"),M(!o.idEmpresa,"Caixa sem empresa");let a=await $db.caixa.leCache({id:o.idCaixa});M(!a.id,"Caixa n\xE3o existe"),this.contaOrigem=await $db.financeiroPlanoConta.le({id:a.idPlanoConta}),this.contato={},this.campos.valor=0,this.campos.descricao="",this.idContatoEmpresa=o.idEmpresa;const t=await $db.empresa.le({idContato:this.idContatoEmpresa});M(!t||!t.length||!t[0].id,"Caixa sem empresa v\xE1lida"),this.idEmpresa=t[0].idContato,this.visivel=!0}catch(o){this.$q.notifyError("Erro no lancamento de Despesa",o)}},async lancar(){try{$q.loading.show({message:"Processando..."});const o=W(),a=y(),t=await $db.configuracoes.le({nome:"financeiro.planocontas.duplicatapagar"});_(!t||!t.length,"Falta configura\xE7\xE3o para 'financeiro.planocontas.duplicatapagar'");const s=await $db.financeiroPlanoConta.le({codigoFinanceiroPlanoConta:Number(t[0].valor)});_(!s||!s.id,"Falta plano de conta para 'financeiro.planocontas.duplicatapagar'"),_(!this.campos.idFinanceiroPlanoConta,"Conta destino n\xE3o selecionada"),_(!this.contato||!this.contato.id,"Contato para pagamento n\xE3o selecionado"),_(!this.campos.valor,"Valor n\xE3o preenchido");const i={id:y(),idEmpresa:this.idEmpresa,idContato:this.contato.id,idFinanceiroPlanoConta:this.campos.idFinanceiroPlanoConta,dataEmissao:o,dataCompetencia:o,dataVencimento:o,dataVencimentoOriginal:o,dataPagamento:o,dataMovimento:o,valor:this.campos.valor,descricao:(this.campos.descricao||"").substr(0,100),observacao:this.campos.descricao||"",receberPagar:0,valorOriginal:this.campos.valor,valorTotal:this.campos.valor,valorARealizar:this.campos.valor,valorRealizado:this.campos.valor,documentoTipo:"DespesaSimples",formaDePagamento:"Caixa",documentoId:this.idDocumentoCaixa,idDocumentoCaixa:this.idDocumentoCaixa,idDocumentoCaixaLiquidacao:this.idDocumentoCaixa,idFinanceiroMovimentacaoAgrupamento:a},r={id:y(),idFinanceiroMovimentacaoN:a,idEmpresa:this.idEmpresa,idFinanceiroPlanoConta:s.id,dataEmissao:o,dataCompetencia:o,dataVencimento:o,dataMovimento:o,valorDebito:this.campos.valor,valorCredito:0,descricao:`Pagamento de despesa simples por ${$db.usuario.logado.nome} no Caixa #${this.idDocumentoCaixa}`,observacao:"Liquida\xE7\xE3o Despesa Simples - T\xEDtulo",documentoTipo:"DespesaSimples",automatico:0,liquidando:0,documentoId:this.idDocumentoCaixa,idDocumentoCaixa:this.idDocumentoCaixa},n={id:y(),idFinanceiroMovimentacaoN:a,idEmpresa:this.idEmpresa,idFinanceiroPlanoConta:this.contaOrigem.id,dataEmissao:o,dataCompetencia:o,dataVencimento:o,dataMovimento:o,valorDebito:0,valorCredito:this.campos.valor,descricao:`Pagamento de despesa simples por ${$db.usuario.logado.nome} no Caixa #${this.idDocumentoCaixa}`,observacao:"Liquida\xE7\xE3o Despesa Simples - T\xEDtulo",documentoTipo:"DespesaSimples",automatico:0,liquidando:0,documentoId:this.idDocumentoCaixa,idDocumentoCaixa:this.idDocumentoCaixa};await $db.financeiroMovimentacaoN.grava({atual:{id:a}}),await $db.financeiroTitulo.grava({atual:i}),await $db.financeiroMovimentacao.grava({atual:r}),await $db.financeiroMovimentacao.grava({atual:n}),$q.notifyPositive("Despesa lan\xE7ada com sucesso"),this.$imprimir("titulo-recibo",i.id),this.visivel=!1}catch(o){$q.notifyError("Erro no lancamento de Despesa",o)}finally{$q.loading.hide()}},async abrirModalFinanceiroContas(){this.modalFinanceiroContas.filtros.despesa={idContatoEmpresa:this.idContatoEmpresa}},async abrirModalContato(){const o=await $g.promptContato.show({filtro:{ativo:!0},placeholder:"Selecione "});$lodash.get(o,"id")&&(this.contato=o)},mostrar(o){const{idDocumentoCaixa:a}=o;this.campos={idFinanceiroPlanoConta:"",valor:0,descricao:""},this.contaOrigem={},this.contato={nome:""},this.idEmpresa="",this.idContatoEmpresa="",this.idDocumentoCaixa=a,this.atualizar()}}},_a={class:"col-12"},$a={class:"col-12"},Ea={class:"col-12"},wa={class:"col-12"},ya={class:"q-mt-lg text-right"};function Va(o,a,t,s,i,r){const n=u("seletorFinContas"),c=u("campo"),p=u("row");return m(),v(O,{modelValue:i.visivel,"onUpdate:modelValue":a[4]||(a[4]=h=>i.visivel=h),"content-css":{minWidth:"30vw"}},{default:l(()=>[e(F,null,{default:l(()=>[e(A,{class:"bg-primary text-white"},{default:l(()=>[e(q,null,{default:l(()=>a[5]||(a[5]=[P("Lan\xE7ar Despesa")])),_:1}),g(e(C,{dense:"",flat:"",icon:"close",round:""},null,512),[[D]])]),_:1}),e(z,null,{default:l(()=>[e(U,{onSubmit:r.lancar},{default:l(()=>[e(p,{class:"q-col-gutter-md"},{default:l(()=>[d("div",_a,[e(n,{modelValue:i.campos.idFinanceiroPlanoConta,"onUpdate:modelValue":a[0]||(a[0]=h=>i.campos.idFinanceiroPlanoConta=h),class:"q-pb-none",rules:[h=>h&&h.length>2||"obrigat\xF3rio."],rotulo:"Destino",filtro:{despesa:{idContatoEmpresa:i.idContatoEmpresa}}},null,8,["modelValue","rules","filtro"])]),d("div",$a,[e(G,{dense:"",rounded:"",modelValue:i.contato.nome,"onUpdate:modelValue":a[1]||(a[1]=h=>i.contato.nome=h),label:"Pagar a",options:["a","b"],onFilter:r.abrirModalContato},null,8,["modelValue","onFilter"])]),d("div",Ea,[e(c,{modelValue:i.campos.valor,"onUpdate:modelValue":a[2]||(a[2]=h=>i.campos.valor=h),before:[{icon:"attach_money"}],rotulo:"Valor",tipo:"decimal",decimals:"2"},null,8,["modelValue"])]),d("div",wa,[e(c,{modelValue:i.campos.descricao,"onUpdate:modelValue":a[3]||(a[3]=h=>i.campos.descricao=h),before:[{icon:"message"}],rotulo:"Descri\xE7\xE3o",tipo:"texto",autogrow:""},null,8,["modelValue"])])]),_:1}),d("div",ya,[g(e(C,{color:"tertiary",flat:"",label:"Cancelar"},null,512),[[D]]),e(C,{color:"primary",class:"q-ml-sm",unelevated:"",label:"Lan\xE7ar",type:"submit"})])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var Sa=w(Da,[["render",Va]]);const Fa={components:{CaixaAbrir:J,CaixaConferencia:la,CaixaFechar:K,CaixaSangriaLancar:ha,CaixaSuprimentoLancar:ga,CaixaDespesaLancar:Sa,FaturaCard:Y,VendaCard:Z},data(){return{idDocumentoCaixa:"",caixas:[],vendas:{},faturas:{},intervaloAtualizar:void 0,intervaloCarregaCaixas:void 0,menuFaturamento:[{icone:"lock_open",rotulo:"Abrir caixa",manipulador:()=>{this.$refs.Abrir.mostrar()}},{icone:"attach_money",rotulo:"Suprimento",manipulador:()=>{this.$refs.Suprimento.mostrar({idDocumentoCaixa:this.idDocumentoCaixa})}},{icone:"money_off",rotulo:"Sangria",manipulador:()=>{this.$refs.Sangria.mostrar({idDocumentoCaixa:this.idDocumentoCaixa})}},{icone:"payment",rotulo:"Despesa",manipulador:()=>{this.$refs.Despesa.mostrar({idDocumentoCaixa:this.idDocumentoCaixa})}},{icone:"lock",rotulo:"Fechar caixa",manipulador:()=>{this.$refs.Fechar.mostrar({idDocumentoCaixa:this.idDocumentoCaixa})}}]}},methods:{async admTef(){const o=await V.oper("adm");if(o.fileContent){const a=await V.extrairCampo("mensagemOperador",o.fileContent),t=await V.extrairComprovantes(o.fileContent,{todos:!0});for(const s of t)await V.oper("print",{content:s,opts:{txt:!0}});a&&$q.notify({message:a,type:"positive"})}},async atualizar(){const o=await $db.formaPagamento.listaCache();!this.menuFaturamento.find(a=>a.rotulo==="Imprimir Confer\xEAncia de caixa")&&await $db.permissao.objeto("Diretiva_Caixa_ImprimirConferenciaCaixa")&&(this.menuFaturamento=[...this.menuFaturamento,{icone:"print",rotulo:"Imprimir Confer\xEAncia de caixa",manipulador:()=>{this.idDocumentoCaixa?this.$imprimir("conferencia-de-caixa",this.idDocumentoCaixa):this.$q.notifyError("Caixa n\xE3o selecionada")}}]),!this.menuFaturamento.find(a=>a.rotulo==="Reimprimir Confer\xEAncia de caixa")&&await $db.permissao.objeto("Diretiva_Caixa_VisualizaDiferenca")&&(this.menuFaturamento=[...this.menuFaturamento,{icone:"print",rotulo:"Reimprimir Confer\xEAncia de caixa",manipulador:()=>{this.$refs.Conferencia.mostrar()}}]),o.some(a=>a.ativo&&a.tef)&&(this.menuFaturamento=[...this.menuFaturamento,{icone:"payment",rotulo:"TEF",manipulador:async()=>{await this.admTef()}}]),this.vendas={},this.faturas={},this.idDocumentoCaixa="",this.caixas=[],await this.carregaCaixasAberto(),this.idDocumentoCaixa=(this.caixas[0]||{}).valor||"",this.idDocumentoCaixa&&this.carregarDocumentos()},async carregaCaixasAberto(){let o=await $db.contatoCpf.leCache($db.usuario.logado.cpf);try{await $db.permissao.objeto("Diretiva_Caixa_LivreUtilizacao")&&(o=null)}catch{this.$q.notify("N\xE3o foi poss\xEDvel recuperar informa\xE7\xF5es de permiss\xE3o.")}let a=await $db.hibrido.lista({table:"documento",columns:["id","idCaixa","idEmpresa","dataHoraEmissao","status"],where:{tipo:"Caixa"},whereFilter:{status:["Aberto","Reaberto"],idContato:o?o==null?void 0:o.id:null}}),t=(await $db.contatoEmpresa.listaCache()).map(s=>s.id);if(a=a.filter(s=>t.includes(s.idEmpresa)),a.length)for(const s of a)s.rotulo=((await $db.caixa.leCache({id:s.idCaixa})||{}).descricao||"")+" - Aberto em "+this.$filters.dataHora(s.dataHoraEmissao)+(s.status==="Reaberto"?" - Reaberto":""),s.valor=s.id;this.caixas=a.length?$lodash.orderBy(a,"dataHoraEmissao","desc"):[{rotulo:"N\xE3o h\xE1 caixas abertos",valor:""}]},carregarDocumentos(){$db.hibrido.lista({table:"documentoCondicaoPagamento",where:{idDocumentoCaixa:this.idDocumentoCaixa}}).then(async a=>{const t=[];a.reduce((n,c)=>(n.includes(c.idDocumento)||(n.push(c.idDocumento),t.push($db.hibrido.le({table:"documento",id:c.idDocumento}))),n),[]);let s=[];for await(const n of t)s.push(n);s=$lodash.orderBy(s,"dataHoraEmissao","desc");const i={},r={};for(const n of s)n.tipo==="Venda"&&n.status&&(i[n.status]||(i[n.status]=[]),i[n.status].push(n)),n.tipo==="Fatura"&&n.status&&(r[n.status]||(r[n.status]=[]),r[n.status].push(n));this.vendas=i,this.vendas.encontradas=!!Object.keys(i).length,this.vendas.status=Object.keys(i).filter(n=>n!=="encontradas"),this.faturas=r,this.faturas.encontradas=!!Object.keys(r).length,this.faturas.status=Object.keys(r).filter(n=>n!=="encontradas")});const o=this.caixas.find(a=>a.id===this.idDocumentoCaixa).status;this.menuFaturamento.forEach(a=>{["Suprimento","Sangria","Despesa"].includes(a.rotulo)&&(o==="Reaberto"?a.desabilitar=!0:a.desabilitar=!1)})}},async mounted(){this.caixas=[{rotulo:"Carregando caixas...",valor:""}];let o=!1,a=await $db.contatoEmpresa.listaCache();if(a.length)this.atualizar(),o=!0;else{let r=0;this.intervaloAtualizar=setInterval(async()=>{r++,(r>60||a.length)&&(clearInterval(this.intervaloAtualizar),this.atualizar(),o=!0),a=await $db.contatoEmpresa.listaCache()},3e3)}let t=0,s=5e4;const i=()=>{this.intervaloCarregaCaixas=setInterval(async()=>{o&&(t++,t>5&&(s=5e3,clearInterval(this.intervaloCarregaCaixas),i()),await this.carregaCaixasAberto(),this.caixas.find(n=>n.valor===this.idDocumentoCaixa)||(this.idDocumentoCaixa=(this.caixas[0]||{}).valor||"",this.idDocumentoCaixa&&await this.carregarDocumentos()))},s)};i()},beforeUnmount(){this.intervaloAtualizar&&clearInterval(this.intervaloAtualizar),this.intervaloCarregaCaixas&&clearInterval(this.intervaloCarregaCaixas)}},Aa={class:"CaixaEmpresas"},qa={class:"q-pb-md"},Pa={class:"no-shadow"};function za(o,a,t,s,i,r){const n=u("campo"),c=u("row"),p=u("venda-card"),h=u("fatura-card"),N=u("caixa-abrir"),L=u("CaixaFechar"),I=u("caixa-sangria-lancar"),H=u("caixa-suprimento-lancar"),Q=u("caixa-despesa-lancar"),R=u("caixa-conferencia");return m(),x("div",Aa,[d("div",qa,[e(n,{modelValue:i.idDocumentoCaixa,"onUpdate:modelValue":[a[0]||(a[0]=f=>i.idDocumentoCaixa=f),r.carregarDocumentos],opcoes:i.caixas,class:"q-mx-md",tipo:"seletor"},null,8,["modelValue","onUpdate:modelValue","opcoes"]),e(c,{class:"q-col-gutter-md q-pa-md"},{default:l(()=>[(m(!0),x($,null,E(i.menuFaturamento,(f,b)=>(m(),x("div",{class:"col-6 col-md",key:b},[e(C,{onClick:f.manipulador,icon:f.icone,label:f.rotulo,outline:"",disabled:f.desabilitar,size:"lg",class:"botaoAcesso full-width",color:"primary"},null,8,["onClick","icon","label","disabled"])]))),128))]),_:1}),d("div",Pa,[i.vendas.encontradas?(m(),v(T,{key:0},{default:l(()=>[e(S,{"default-opened":"",label:"Vendas"},{default:l(()=>[(m(!0),x($,null,E(i.vendas.status,f=>(m(),v(S,{key:f,"default-opened":"",label:f},{default:l(()=>[(m(!0),x($,null,E(i.vendas[f],b=>(m(),v(p,{key:b.id,id:b.id,onAtualizar:r.atualizar,class:"q-mb-md q-mx-md"},null,8,["id","onAtualizar"]))),128))]),_:2},1032,["label"]))),128))]),_:1})]),_:1})):k("",!0),i.faturas.encontradas?(m(),v(T,{key:1},{default:l(()=>[e(S,{"default-opened":"",label:"Faturas"},{default:l(()=>[(m(!0),x($,null,E(i.faturas.status,f=>(m(),v(S,{key:f,"default-opened":"",label:f},{default:l(()=>[(m(!0),x($,null,E(i.faturas[f],b=>(m(),v(h,{key:b.id,id:b.id,onAtualizar:r.atualizar,class:"q-mb-md q-mx-md"},null,8,["id","onAtualizar"]))),128))]),_:2},1032,["label"]))),128))]),_:1})]),_:1})):k("",!0)])]),e(N,{ref:"Abrir",onAberto:r.atualizar},null,8,["onAberto"]),e(L,{ref:"Fechar",onFechado:r.atualizar},null,8,["onFechado"]),e(I,{ref:"Sangria"},null,512),e(H,{ref:"Suprimento"},null,512),e(Q,{ref:"Despesa"},null,512),e(R,{ref:"Conferencia"},null,512)])}var Ja=w(Fa,[["render",za]]);export{Ja as default};
