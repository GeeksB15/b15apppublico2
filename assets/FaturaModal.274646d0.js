import{_ as za,r as G,o as c,p as _,f as t,w as e,C as F,h as va,i as $a,k as M,t as V,d as y,cL as ro,e as P,j as H,m as ba,Q as K,s as Ha,be as Pa,H as ia,P as ma,F as U,x as J,S as W,T as z,U as Z,N as na,l as Qa,A as so,O as lo,E as uo,bq as Ba,D as Na,q as co,a as mo,cN as fo,cO as po,cP as vo,cQ as ho,B as Ia,M as Ja,G as Ga,I as Ka,J as Wa,K as go,aU as Co}from"./index.27953b8f.js";import{D as bo,C as $o}from"./DocumentosFiscais.3a8fafe1.js";import{e as Fo}from"./emitirNFe.35117289.js";import{V as Do}from"./VendaCard.3a47243e.js";import{E as Eo}from"./EnvelopeCard.fb9bf98e.js";const wo={computed:{mostrarMenuTresPontos(){return this.mostrarOpcaoMigrarFatura}},data(){return{titulo:{},tituloOriginal:{},detalhes:!1,contatos:{},documento:{},fatura:{},faturasAbertas:[],mostrarOpcaoMigrarFatura:!1,visibilidade:{botao:{remover:!1,editar:!1}},modalEditar:{visivel:!1,campos:{valorMulta:0},rules:[]},tema:["TituloCard","bg-white","rounded-borders"]}},emits:["executar"],methods:{irParaAtendimentoFatura(i){this.$router.push({name:"AtendimentoFatura",params:{id:i}})},async migrarFatura(i){try{await new Promise((o,d)=>{this.$q.dialog({message:"Esta a\xE7\xE3o ir\xE1 migrar esta venda para outra fatura.",noRefocus:!0,preventClose:!0,title:"Tem certeza?",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(()=>{o()}).onCancel(()=>{d()})})}catch{return}if(!i&&this.titulo.idContato&&this.titulo.idEmpresa){const o=await $erp().contato.get(this.titulo.idContato)||{};let d=await $erp().contatoEndereco.where({idContato:this.titulo.idContato}).toArray(),C=await $erp().contatoTelefone.where({idContato:this.titulo.idContato}).toArray();d=d.find(B=>(B.grupo||"").trim().toLowerCase()==="Principal")||d[0]||{},C=C.find(B=>(B.tipoTelefone||"").trim().toLowerCase()==="Principal")||C[0]||{};const a=await $erp().contato.get(this.titulo.idEmpresa)||{};let u=await $erp().contatoEndereco.where({idContato:this.titulo.idEmpresa}).toArray();u=u.find(B=>B.grupo.trim().toLowerCase()==="Principal")||u[0]||{},i=$db.fatura.criar({idEmpresa:a.id,idEmpresaEndereco:u.id||"",descricaoEmpresa:a.nome||"",numeroDocumentoEmpresa:a.numeroDocumentoNacional||"",inscricaoMunicipalEmpresa:a.numeroDocumentoMunicipal||"",optanteSimplesNacional:a.regime==="SimplesNacional"?"1":"0",idContato:o.id,idContatoEndereco:d.id||"",numeroDocumentoContato:o.numeroDocumentoNacional||"",descricaoContato:o.nome||"",descricaoContatoEndereco:"".concat(d.logradouro||"",", ",d.numero||""," ",d.complemento||""," - ",d.bairro||""," - ",d.cep||""," - ",d.municipio||"","/",d.uf||""),telefoneContato:C.telefone||"",emailContato:o.email||"",regimeContato:o.regime||"",observacaoFaturamento:""}),await $db.fatura.grava({fatura:i})}i.id?(await $db.financeiroTitulo.grava({atual:{id:this.titulo.id,idFatura:i.id},original:this.titulo}),localStorage.setItem("idFatura",i.id),this.titulo.idContato&&(this.$emit("executar","atualizar"),this.irParaAtendimentoFatura(this.titulo.idContato))):this.$q.notify("N\xE3o foi poss\xEDvel realizar a opera\xE7\xE3o")},async salvar(){if(this.titulo.valorDesconto===this.tituloOriginal.valorDesconto){this.modalEditar.visivel=!1;return}try{await $db.financeiroTitulo.grava({atual:this.titulo,original:this.tituloOriginal}),this.tituloOriginal=$utils.clonar(this.titulo),this.modalEditar.visivel=!1,this.$q.notifyPositive("T\xEDtulo salvo."),this.$emit("executar","recalcular")}catch{this.$q.notifyPositive("N\xE3o foi poss\xEDvel salvar o t\xEDtulo. Por favor, tente novamente.")}},editar(){const i=Number(this.titulo.diasEmAtraso)||0;let o=0;i>0&&(o=Number(this.titulo.valorMulta)||0),this.modalEditar={visivel:!0,campos:{valorMulta:o},rules:[]}},async permissaoEditar(){return await $db.permissao.objeto("Diretiva_Caixa_DescontoTitulo")},cancelarDesconto(){this.titulo=$utils.clonar(this.tituloOriginal),this.modalEditar.visivel=!1},async desconto(){const i=this.titulo.valorDesconto;let o=0,d=0,C=0,a=Number(this.titulo.diasEmAtraso)||0;const u=Number(this.titulo.valor)||0;if(a<0&&(a=0),a>0&&(d=Number(this.titulo.valorMulta)||0,o=Number(this.titulo.valorJuros)||0,C=$utils.arredondar(d+o*a)),await $db.permissao.objeto("PadraoNovo_Financeiro")&&(C=$utils.arredondar(u+d+o*a)),i<0||i>C){this.modalEditar.rules=[()=>"Desconto n\xE3o permitido"];return}this.modalEditar.rules=[()=>!0];const m=$utils.arredondar(u-i+d+o*a),b=$utils.arredondar(i*100/(u||1));this.titulo.valorTotal=m,this.titulo.valorARealizar=m,this.titulo.percentualDesconto=b},alternarDetalhes(){this.detalhes=!this.detalhes},async remover(){try{await new Promise((i,o)=>{this.$q.dialog({message:"Esta a\xE7\xE3o ir\xE1 remover este t\xEDtulo da fatura.",noRefocus:!0,preventClose:!0,title:"Tem certeza?",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-negative",textColor:"white",flat:!0}}).onOk(()=>{i()}).onCancel(()=>{o()})})}catch{return}this.titulo.idFatura="",await $db.financeiroTitulo.grava({atual:this.titulo,original:this.tituloOriginal}),this.visibilidade.botao.remover=!1,this.$q.notifyPositive("T\xEDtulo removido da fatura."),this.$emit("executar","remover")}},props:{dados:{required:!0,type:Object}},async mounted(){const i=new Date(this.dados.dataVencimento).setHours(0,0,0,0),o=new Date().setHours(0,0,0,0);i<o?this.tema.push("vencido"):this.tema=$lodash.remove(this.tema,C=>C!=="vencido"),this.tituloOriginal=$utils.clonar(this.dados),this.titulo=$utils.clonar(this.dados),this.titulo.documentoId&&(this.documento=await $db.hibrido.le({table:"documento",id:this.titulo.documentoId})),this.visibilidade.botao.remover=!1,this.permissaoEditar().then(C=>this.visibilidade.botao.editar=C&&!this.tituloOriginal.valorRealizado),this.contatos={};const d={};if(this.titulo.idContato){const C=await $db.contato.le({id:this.titulo.idContato});C&&(d[this.titulo.idContato]=C)}if(this.titulo.idEmpresa){const C=await $db.contato.le({id:this.titulo.idEmpresa});C&&(d[this.titulo.idEmpresa]=C)}this.contatos=d,this.mostrarOpcaoMigrarFatura=!0,this.titulo.idFatura&&$db.fatura.leV2({id:this.titulo.idFatura}).then(C=>{this.fatura=C,C.status==="Aberta"&&$db.contato.ler({filtros:{ativo:!0,empresas:!0}}).then(a=>{a.data.find(B=>B.id===this.titulo.idEmpresa)&&(this.visibilidade.botao.remover=!0)})})}},yo={class:"col-12 col-md-6 q-pl-none"},To={class:"col-4 col-md"},qo={key:0,class:"q-my-none"},Po={class:"q-my-none"},xo={class:"q-my-none"},ko={class:"col-4 col-md text-right"},Vo={class:"col-4 col-md text-right"},Mo={class:"col-12 col-md"},_o={class:"text-right text-h5 text-positive text-weight-bold q-my-none"},Io={class:"text-right text-weight-normal text-tertiary text-body2 q-my-none"},zo={class:"col-12 col-md-6"},Bo={class:"text-body2"},No={class:"col-12 col-md-6 text-right hideonmobile"},Ao={class:"col-12 text-right"},Oo={class:"col-12 col-md-6"},Ro={class:"text-body2 q-my-none q-mb-md"},So={class:"col-12 col-sm-4 col-md-2"},Lo={class:"text-left q-my-none"},jo={class:"col-6 col-md-1"},Uo={class:"text-left q-my-none"},Ho={class:"col-6 col-md-1"},Qo={class:"text-left q-my-none"},Jo={class:"col-12 col-sm-4 col-md-2 text-right"},Go={class:"q-ma-none"},Ko={class:"q-mt-xs"},Wo={class:"q-mt-xs"},Zo={class:"q-mt-lg text-right q-gutter-md"};function Xo(i,o,d,C,a,u){const B=G("avatar"),m=G("row"),b=G("campo");return c(),_("div",{class:co([a.tema,"extratoItem bg-white q-pa-sm no-shadow"])},[t(m,{class:"items-center q-mx-none q-px-none q-mb-sm text-tertiary"},{default:e(()=>{var $;return[F("div",yo,[t(va,{class:"q-pa-none"},{default:e(()=>[t(B,{imagem:(a.contatos[a.titulo.idContato]||{}).imagem,rotulo:(a.contatos[a.titulo.idContato]||{}).apelido,tamanho:"30"},null,8,["imagem","rotulo"]),t($a,null,{default:e(()=>[M(V((a.contatos[a.titulo.idContato]||{}).apelido)+" ",1),o[9]||(o[9]=F("br",null,null,-1))]),_:1}),a.titulo.parcela?(c(),y(ro,{key:0,rounded:"",color:"tertiary",small:""},{default:e(()=>[M(V(a.titulo.parcela),1)]),_:1})):P("",!0)]),_:1})]),F("div",To,[a.titulo.documentoCodigo?(c(),_("p",qo,V(a.titulo.documentoTipo)+" #"+V(($=a.documento)==null?void 0:$.numero),1)):P("",!0),F("p",Po,V(a.titulo.formaDePagamento),1),F("p",xo,V(a.titulo.descricaoPlanoConta),1)]),F("div",ko,[a.titulo.dataVencimentoOriginal?(c(),y(H,{key:0,name:"mdi-calendar-today"})):P("",!0),M(" "+V(i.$filters.data(a.titulo.dataVencimentoOriginal))+" ",1),t(ba,null,{default:e(()=>o[10]||(o[10]=[M("Vencimento original")])),_:1})]),F("div",Vo,[a.titulo.dataVencimento?(c(),y(H,{key:0,name:"mdi-calendar-check"})):P("",!0),M(" "+V(i.$filters.data(a.titulo.dataVencimento))+" ",1),t(ba,null,{default:e(()=>o[11]||(o[11]=[M("Vencimento")])),_:1})]),F("div",Mo,[F("p",_o,V(i.$filters.numero(a.titulo.valorTotal,2)),1),F("p",Io,V(i.$filters.numero(a.titulo.valor,2)),1)])]}),_:1}),t(m,{class:"items-center justify-end"},{default:e(()=>[F("div",zo,[F("div",Bo,V(a.titulo.descricao),1)]),F("div",No,[a.visibilidade.botao.remover?(c(),y(K,{key:0,onClick:u.remover,icon:"clear",color:"tertiary",round:"",dense:"",flat:""},{default:e(()=>[t(ba,null,{default:e(()=>[M(" Remover da Fatura #"+V(parseInt(a.fatura.numero)||(a.fatura.id||"").slice(-6)),1)]),_:1})]),_:1},8,["onClick"])):P("",!0),t(K,{onClick:u.alternarDetalhes,icon:`keyboard_arrow_${a.detalhes?"up":"down"}`,color:"tertiary",round:"",dense:"",flat:""},null,8,["onClick","icon"]),a.visibilidade.botao.editar?(c(),y(K,{key:1,onClick:u.editar,icon:"edit",color:"primary",round:"",dense:"",flat:""},null,8,["onClick"])):P("",!0),Ha(i.$slots,"default"),u.mostrarMenuTresPontos?(c(),y(K,{key:2,icon:"more_vert",color:"tertiary",rounded:"",dense:"",flat:""},{default:e(()=>[t(Pa,null,{default:e(()=>[ia((c(),y(ma,{link:"",separator:""},{default:e(()=>[a.mostrarOpcaoMigrarFatura?(c(),_(U,{key:0},[(c(!0),_(U,null,J(a.faturasAbertas,$=>(c(),y(W,{clickable:"",key:$.id,onClick:I=>u.migrarFatura($)},{default:e(()=>[t(z,{avatar:""},{default:e(()=>[t(H,{name:"mdi-folder-move"})]),_:1}),t(z,null,{default:e(()=>[t(Z,null,{default:e(()=>[M(V("Migrar para fatura #"+($.numero||$.id.slice(-6))),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),t(W,{clickable:"",onClick:o[0]||(o[0]=$=>u.migrarFatura())},{default:e(()=>[t(z,{avatar:""},{default:e(()=>[t(H,{name:"mdi-folder-move"})]),_:1}),t(z,null,{default:e(()=>[t(Z,null,{default:e(()=>o[12]||(o[12]=[M("Migrar para nova fatura")])),_:1})]),_:1})]),_:1})],64)):P("",!0)]),_:1})),[[na]])]),_:1})]),_:1})):P("",!0)])]),_:3}),t(Qa,{class:"hideondesktop q-mb-sm q-mt-xs"}),t(m,{class:"q-mx-none q-px-none hideondesktop"},{default:e(()=>[F("div",Ao,[a.visibilidade.botao.remover?(c(),y(K,{key:0,onClick:u.remover,icon:"clear",color:"tertiary",round:"",dense:"",flat:""},{default:e(()=>[t(ba,null,{default:e(()=>[M(" Remover da Fatura #"+V(parseInt(a.fatura.numero)||(a.fatura.id||"").slice(-6)),1)]),_:1})]),_:1},8,["onClick"])):P("",!0),t(K,{onClick:u.alternarDetalhes,round:"",dense:"",flat:"",color:"tertiary",icon:`keyboard_arrow_${a.detalhes?"up":"down"}`},null,8,["onClick","icon"]),a.visibilidade.botao.editar?(c(),y(K,{key:1,onClick:u.editar,icon:"edit",color:"primary",round:"",dense:"",flat:""},null,8,["onClick"])):P("",!0),Ha(i.$slots,"default"),u.mostrarMenuTresPontos?(c(),y(K,{key:2,round:"",dense:"",flat:"",icon:"more_vert",color:"tertiary"},{default:e(()=>[t(Pa,null,{default:e(()=>[ia((c(),y(ma,{link:"",separator:""},{default:e(()=>[a.mostrarOpcaoMigrarFatura?(c(),_(U,{key:0},[(c(!0),_(U,null,J(a.faturasAbertas,$=>(c(),y(W,{clickable:"",key:$.id,onClick:I=>u.migrarFatura($)},{default:e(()=>[t(z,{avatar:""},{default:e(()=>[t(H,{name:"mdi-folder-move"})]),_:1}),t(z,null,{default:e(()=>[t(Z,null,{default:e(()=>[M(V("Migrar para fatura #"+($.numero||$.id.slice(-6))),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),t(W,{clickable:"",onClick:o[1]||(o[1]=$=>u.migrarFatura())},{default:e(()=>[t(z,{avatar:""},{default:e(()=>[t(H,{name:"mdi-folder-move"})]),_:1}),t(z,null,{default:e(()=>[t(Z,null,{default:e(()=>o[13]||(o[13]=[M("Migrar para nova fatura")])),_:1})]),_:1})]),_:1})],64)):P("",!0)]),_:1})),[[na]])]),_:1})]),_:1})):P("",!0)])]),_:3}),a.detalhes?(c(),y(Qa,{key:0,class:"hideondesktop q-my-sm"})):P("",!0),a.detalhes?(c(),y(m,{key:1,class:"items-start q-mx-none q-px-none q-mt-md"},{default:e(()=>[F("div",Oo,[t(va,{class:"u-autoHeight q-pa-none",color:"none",dark:""},{default:e(()=>[t(H,{name:"business"}),t($a,null,{default:e(()=>[M(V((a.contatos[a.titulo.idEmpresa]||{}).apelido),1)]),_:1})]),_:1}),F("p",Ro,V(a.titulo.observacao),1)]),F("div",So,[F("p",Lo,V(a.titulo.descricaoCentroCusto),1)]),F("div",jo,[F("p",Uo,[a.titulo.dataEmissao?(c(),y(H,{key:0,name:"mdi-calendar-check"})):P("",!0),M(" "+V(i.$filters.data(a.titulo.dataEmissao))+" ",1),t(ba,null,{default:e(()=>o[14]||(o[14]=[M("Emiss\xE3o")])),_:1})])]),F("div",Ho,[F("p",Qo,[a.titulo.dataCompetencia?(c(),y(H,{key:0,name:"mdi-calendar-check"})):P("",!0),M(" "+V(i.$filters.data(a.titulo.dataCompetencia))+" ",1),t(ba,null,{default:e(()=>o[15]||(o[15]=[M("Compet\xEAncia")])),_:1})])]),F("div",Jo,[o[18]||(o[18]=F("p",{class:"text-subtitle1 text-weight-bold q-ma-none"}," Desconto ",-1)),F("p",Go,V(i.$filters.numero(a.titulo.valorDesconto||0,2)),1),a.titulo.diasEmAtraso?(c(),_(U,{key:0},[F("div",Ko,[o[16]||(o[16]=F("small",{class:"block text-caption"},"Multa",-1)),F("strong",null,V(i.$filters.numero(a.titulo.valorMulta||0,2))+" ("+V(i.$filters.numero(a.titulo.percentualMulta||0,2))+"%) ",1)]),F("div",Wo,[o[17]||(o[17]=F("small",{class:"block text-caption"},"Juros",-1)),F("strong",null,V(i.$filters.numero(a.titulo.valorTotalJuros||0,2))+" ("+V(i.$filters.numero(a.titulo.percentualJuros||0,2))+"% dia) ",1)])],64)):P("",!0)])]),_:1})):P("",!0),t(Na,{modelValue:a.modalEditar.visivel,"onUpdate:modelValue":o[8]||(o[8]=$=>a.modalEditar.visivel=$),onKeyup:Ba(u.cancelarDesconto,["esc"]),persistent:""},{default:e(()=>[t(so,{style:{"min-width":"30vw"}},{default:e(()=>[t(va,{class:"bg-primary text-white"},{default:e(()=>[t($a,null,{default:e(()=>o[19]||(o[19]=[M("Editar T\xEDtulo")])),_:1})]),_:1}),t(lo,null,{default:e(()=>[t(uo,{onSubmit:u.salvar,class:"q-pa-lg q-gutter-md"},{default:e(()=>[t(b,{modelValue:a.titulo.valor,"onUpdate:modelValue":o[2]||(o[2]=$=>a.titulo.valor=$),rotulo:"Valor",tipo:"decimal",decimals:"2","somente-leitura":"",outlined:""},null,8,["modelValue"]),t(b,{modelValue:a.titulo.diasEmAtraso,"onUpdate:modelValue":o[3]||(o[3]=$=>a.titulo.diasEmAtraso=$),rotulo:"Dias em Atraso",tipo:"decimal",decimals:"0",zerosDireita:"0",zeros:"","somente-leitura":"",outlined:""},null,8,["modelValue"]),t(b,{modelValue:a.modalEditar.campos.valorMulta,"onUpdate:modelValue":o[4]||(o[4]=$=>a.modalEditar.campos.valorMulta=$),ajuda:`Multa de R$ ${i.$filters.numero(a.titulo.valorMulta,2)}`,rotulo:"Multa",tipo:"decimal",decimals:"2","somente-leitura":"",outlined:""},null,8,["modelValue","ajuda"]),t(b,{modelValue:a.titulo.valorTotalJuros,"onUpdate:modelValue":o[5]||(o[5]=$=>a.titulo.valorTotalJuros=$),ajuda:`Juros ao ${a.titulo.tipoJuros} de R$ ${i.$filters.numero(a.titulo.valorJuros,2)}`,rotulo:"Juros",tipo:"decimal",decimals:"2","somente-leitura":"",outlined:""},null,8,["modelValue","ajuda"]),t(b,{modelValue:a.titulo.valorDesconto,"onUpdate:modelValue":[o[6]||(o[6]=$=>a.titulo.valorDesconto=$),u.desconto],rotulo:"Desconto",tipo:"decimal",decimals:"2",rules:a.modalEditar.rules,outlined:""},null,8,["modelValue","onUpdate:modelValue","rules"]),t(b,{modelValue:a.titulo.valorTotal,"onUpdate:modelValue":o[7]||(o[7]=$=>a.titulo.valorTotal=$),rotulo:"Total",tipo:"decimal",decimals:"2","somente-leitura":"",outlined:""},null,8,["modelValue"]),F("div",Zo,[t(K,{color:"tertiary",flat:"",unelevated:"",label:"Cancelar",onClick:u.cancelarDesconto},null,8,["onClick"]),t(K,{color:"primary",unelevated:"",label:"Salvar",type:"submit"})])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue","onKeyup"])],2)}var Yo=za(wo,[["render",Xo]]),at={async enviar(i,o){var d,C;try{const a=o.nome.replace("enviaemail.fatura.",""),u=(d=o.valor)!=null?d:"Impresso",B=(C=o.texto)!=null?C:`Voc\xEA est\xE1 recebendo o ${u} da empresa ${i.descricaoEmpresa}.`,m=await $db.contato.le({id:i.idContato}),b=await $utils.impressaoObterHtml(a,i),$={de:"Geeks Solu\xE7\xF5es <auto@geekssolucoes.com.br>",para:String(m==null?void 0:m.email).trim().toLowerCase(),assunto:`${u}`,mensagem:`${B}`},I=`${u} enviado para ${$.para}, com sucesso!.`,L=`Erro ao enviar e-mail. ${u} n\xE3o enviado.`;$q.loading.show({message:`Enviando ${u} por e-mail...`,html:!0,boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"});const A=[{name:`${u}.pdf`,content:b,method:"html2pdf"}],j={host:"smtp.gmail.com",port:587,ssl:!0,auth:{user:"auto@geekssolucoes.com.br",pass:"xpto@9@9"},from:$.de,to:$.para,subject:$.assunto,text:$.mensagem,attachments:A},n=await mo({baseURL:"https://api.b15.com.br",method:"post",url:"/email/v2",data:j});$q.notifyPositive((n==null?void 0:n.status)===200&&I?I:n.data.message)}catch(a){$q.notifyError(errorMsg||"Erro ao enviar e-mail",a)}finally{$q.loading.hide()}}},ot={async finalizar(i,o){var d,C,a,u,B,m,b,$,I,L,A,j;try{if($utils.verificarErro(this.erroCalculo,"Erro de c\xE1lculo encontrado."),!i)try{await new Promise((r,s)=>{$q.dialog({cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},message:"Esta a\xE7\xE3o ir\xE1 finalizar esta fatura",ok:{label:"Continuar",push:!0,class:"bg-primary",textColor:"white",flat:!0},title:"Tem certeza?"}).onOk(()=>{r()}).onCancel(()=>{s()})})}catch{return!1}this.$q.loading.show({message:"Processando..."});const n=$utils.clonar(this.fatura),X=$utils.clonar(this.vendas),k=$utils.clonar(this.documentosEnvelope),f=$utils.clonar(this.carnes),p=[...X,...k].map(r=>r.id),O=await $db.hibrido.lista({table:"documentoItem",whereIn:{idDocumento:p}}),l=$utils.clonar(O),N=$utils.arredondar((n.totalDesconto||0)+(n.totalBonus||0));if(f.length>0){const r=f.reduce((s,D)=>(D.idFinanceiroBoleto&&D.codigoFinanceiroTitulo&&(s+=String(D.codigoFinanceiroTitulo)+";"),s),"");if(r)try{$q.loading.show({message:"Baixando boletos..."});const s=`exec sp_Financeiro_BoletoBaixar '${r.slice(0,-1)}'`,D=await $utils.executarSql(s)}catch(s){$q.notifyError("N\xE3o foi poss\xEDvel baixar boletos",s);return}finally{$q.loading.hide()}}const v=i?n.dataHoraFinalizado:$utils.dataAtual(),R=v,T=await $db.hibrido.le({table:"documento",id:this.$refs.faturamento.idDocumentoCaixa}),Fa=await $db.formaPagamento.le();this.documentoStatus=[],await this.$refs.faturamento.validar();let aa=$lodash.orderBy(this.$refs.faturamento.condicaoPagamento.filter(r=>r.valor),["idFormaPagamento","autorizacao","dataVencimento"]);if($utils.verificarErro(X.some(r=>!r.dataHoraFinalizado),"Existe pedido de venda sem data de finaliza\xE7\xE3o."),n.tokenBonusUtilizado){const r=await $utils.geeksApi({utilizaBonus:{funcao:"1A130FC6-C9BA-4121-B9CF-069CEAEC36CB",tokenBonus:n.tokenBonusUtilizado,valorVenda:(n.subTotal||0)-(n.totalDesconto||0),cnpjEmissor:n.numeroDocumentoEmpresa,cpfCliente:n.numeroDocumentoContato,idDocumentoDestino:n.id,utiliza:!0}});$utils.verificarErro(((C=(d=r.data)==null?void 0:d.utilizaBonus)==null?void 0:C.status)!=="Utilizado","B\xF4nus inv\xE1lido"),$utils.verificarErro(!((u=(a=r.data)==null?void 0:a.utilizaBonus)!=null&&u.valor),"Valor do B\xF4nus inv\xE1lido")}const ra=$utils.arredondar(this.carnes.reduce((r,s)=>r+(s.valorARealizar||0),0)),sa=$utils.arredondar(aa.reduce((r,s)=>r+(s.valor||0),0));let ua=0;if(i&&(aa=aa.filter(r=>!this.$refs.faturamento.condicaoPagamentoOriginal.find(s=>s.id===r.id))),n.totalDocumento>=0){if(this.carnes.length){if(sa<ra)return this.$q.notify("Valor pago menor que a soma dos t\xEDtulos \xE0 faturar!"),!1;if(!await $db.permissao.objeto("Diretiva_Caixa_PagarCarneCartao")){const s=aa.reduce((D,E)=>{const q=`${E.autorizacao||""}${E.documento||""}${E.idFormaPagamento}`;return D[q]||(D[q]={parcelas:0,formaPagamento:E.formaPagamento}),D[q].parcelas++,D},{});for(const D in s)if(s[D].parcelas>this.carnes.length)return this.$q.notify(`Quantidade de parcelas da forma de pagamento ${s[D].formaPagamento} acima do permitido.`),!1}}sa<n.totalDocumento&&(ua=1)}let fa=ua===1?"Aguardando Pagamento":"Finalizada";if(!i){this.documentoStatus.push({id:$utils.uuid(),idDocumento:n.id,operacao:"Fatura",statusOriginal:n.status,statusFinalizado:fa,dataHoraEmissao:v,cpfUsuario:$db.usuario.logado.numeroDocumentoNacional,idDocumentoCaixa:T.id||""}),n.status=fa,n.dataHoraFinalizado=v,fa="Faturado";const r=parseInt(await $db.configuracoes.leValorComFiltroEmpresa("vendas.usaExpedicao",n.idEmpresa,0))||0;let s=0,D=k.filter(h=>h.status!=="Entregue").length,E=!1,q=!0;if(X.length>0&&r&&(this.$q.loading.hide(),await new Promise((h,w)=>{this.$q.dialog({cancel:{label:"N\xE3o",push:!0,color:"tertiary",flat:!0},ok:{label:"Sim",push:!0,class:"bg-primary",textColor:"white",flat:!0},message:"Gostaria de dar baixa na(s) venda(s), removendo-a(s) do processo de expedi\xE7\xE3o?",noRefocus:!0,preventClose:!0,persistent:!0,title:"Confirma?"}).onOk(()=>{q=!0,h()}).onCancel(()=>{q=!1,h()})}),this.$q.loading.show({message:"Processando..."})),D){let h="Nesta Fatura h\xE1 1 envelope aguardando entrega, deseja mudar o status deste para Entregue?";D>1&&(h=`Nesta Fatura h\xE1 ${D} envelopes aguardando entrega, deseja mudar o status destes para Entregue?`),this.$q.loading.hide();try{await new Promise((w,x)=>{this.$q.dialog({cancel:"N\xE3o",message:h,noRefocus:!0,ok:"Sim",preventClose:!0,title:"Confirma?"}).onOk(()=>{E=!0,w()}).onCancel(()=>{x()})})}catch{}this.$q.loading.show({message:"Processando..."})}let g=0;g=$utils.arredondar(l.reduce((h,w)=>(w.total>0&&(h+=w.total),h),g));for(const h of[...X,...k])h.tipo==="Envelope"&&E&&(this.documentoStatus.push({id:$utils.uuid(),idDocumento:h.id,operacao:h.operacao,statusOriginal:h.status,statusFinalizado:"Entregue",dataHoraEmissao:v,cpfUsuario:$db.usuario.logado.numeroDocumentoNacional,idDocumentoCaixa:this.$refs.faturamento.idDocumentoCaixa}),h.status="Entregue"),h.tipo==="Venda"&&q&&(this.documentoStatus.push({id:$utils.uuid(),idDocumento:h.id,operacao:h.operacao,statusOriginal:h.status,statusFinalizado:fa,dataHoraEmissao:v,cpfUsuario:$db.usuario.logado.numeroDocumentoNacional,idDocumentoCaixa:T.id||""}),h.status="Faturado");for(const h of l){const w=[...X,...k].find(x=>x.id===h.idDocumento);if(h.status=w.status,h.total>0){h.quantidade=h.quantidade||1,h.valorItem=h.valorItem||0,h.descontoItem=h.descontoItem||0,h.descontoTotalRateado=h.descontoTotalRateado||0;let x=(h.valorItem-h.descontoItem)*h.quantidade-h.descontoTotalRateado;const S=$utils.arredondar(N*x/(g||1)||0);h.descontoFaturaRateado=$utils.arredondar(S),h.valorRealTotal=$utils.arredondar(x-S),h.valorReal=$utils.arredondar(h.valorRealTotal/h.quantidade),s+=S}}if(this.documentosItem=l,this.documentosItemOriginal=O,N!==$utils.arredondar(s)){const h=$utils.arredondar(N-(s||0));let w,x=0;for(const S of l)S.total>x&&(x=S.total,w=S);if(w){const S=(w.descontoFaturaRateado||0)+(h||0),ea=((w.valorItem||0)-(w.descontoItem||0))*(w.quantidade||1)-(w.descontoTotalRateado||0)-(S||0),ga=(ea||0)/(w.quantidade||1);w.descontoFaturaRateado=$utils.arredondar(S),w.valorReal=$utils.arredondar(ga),w.valorRealTotal=$utils.arredondar(ea)}}}const xa=parseInt((await $db.configuracoes.le({nome:"financeiro.planocontas.renegociacao"}))[0].valor),Da=await $db.financeiroPlanoConta.le({codigoFinanceiroPlanoConta:xa}),Za=parseInt((await $db.configuracoes.le({nome:"financeiro.planocontas.duplicatareceber"}))[0].valor);let ha=await $db.financeiroPlanoConta.le({codigoFinanceiroPlanoConta:Za});const Xa=parseInt((await $db.configuracoes.le({nome:"financeiro.planocontas.duplicatapagar"}))[0].valor),Aa=await $db.financeiroPlanoConta.le({codigoFinanceiroPlanoConta:Xa}),Ya=parseInt((await $db.configuracoes.le({nome:"financeiro.planocontas.cheque"}))[0].valor),Oa=await $db.financeiroPlanoConta.le({codigoFinanceiroPlanoConta:Ya}),ao=parseInt((await $db.configuracoes.le({nome:"financeiro.planocontas.faturamentogeral"}))[0].valor),oa=await $db.financeiroPlanoConta.le({codigoFinanceiroPlanoConta:ao}),oo=parseInt((await $db.configuracoes.le({nome:"financeiro.planocontas.comprageral"}))[0].valor),Ra=await $db.financeiroPlanoConta.le({codigoFinanceiroPlanoConta:oo}),to=parseInt((await $db.configuracoes.le({nome:"financeiro.planocontas.frete"}))[0].valor),Sa=await $db.financeiroPlanoConta.le({codigoFinanceiroPlanoConta:to}),eo=parseInt((await $db.configuracoes.le({nome:"financeiro.planocontas.cmv"}))[0].valor),ya=await $db.financeiroPlanoConta.le({codigoFinanceiroPlanoConta:eo}),io=parseInt((await $db.configuracoes.le({nome:"financeiro.planocontas.creditoclientes"}))[0].valor),no=await $db.financeiroPlanoConta.le({codigoFinanceiroPlanoConta:io}),ka=(B=this.contatos[n.idContato])==null?void 0:B.descontoCondicionadoPercentual,Va=await $db.configuracoes.leValorNumerico("contabilidade.versao")!==2;let pa=X.reduce((r,s)=>r+s.totalDocumento,0);pa=pa+k.reduce((r,s)=>r+s.totalDocumento,0),pa=$utils.arredondar(pa-N);let ca=n.totalDocumento,ta=[];const Q=[],La=[],Ta=[],ja=[];let Ea=1,Ma="",qa=1,la="";for(const r of aa.filter(s=>!s.sinal)){r.sinal=r.sinal||ua;const s=Fa.filter(D=>D.id===r.idFormaPagamento)[0];if(ca<0)la=$utils.uuid(),Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:la,idContato:n.idContato,idEmpresa:n.idEmpresa,idFinanceiroPlanoConta:oa.id,dataEmissao:v,valorCredito:0,valorDebito:$utils.arredondar(ca*-1),descricao:oa.descricao,observacao:`Movimenta\xE7\xE3o de d\xE9bito da devolu\xE7\xE3o de clientes no(s) pedido(s) da fatura c\xF3digo (${n.id})`,automatico:0,liquidando:0,dataCompetencia:R,dataVencimento:r.dataVencimento,dataMovimento:r.dataVencimento,documentoTipo:"Fatura",documentoId:n.id,idDocumentoCaixa:T.id}),Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:la,idContato:n.idContato,idEmpresa:n.idEmpresa,idFinanceiroPlanoConta:no.id,dataEmissao:v,valorCredito:$utils.arredondar(ca*-1),valorDebito:0,descricao:`Cr\xE9dito proveniente de produtos devolvidos no(s) pedido(s) da fatura c\xF3digo (${n.id})`,observacao:"Movimenta\xE7\xE3o de cr\xE9dito na conta de clientes",automatico:0,liquidando:0,dataCompetencia:R,dataVencimento:r.dataVencimento,dataMovimento:r.dataVencimento,documentoTipo:"Fatura",documentoId:n.id,idDocumentoCaixa:T.id});else{if(Ma!==r.idFormaPagamento+r.autorizacao&&(Ma=r.idFormaPagamento+r.autorizacao,Ea=1,qa=aa.reduce((D,E)=>E.idFormaPagamento+E.autorizacao===Ma?D+1:D,0)),s.tipoFinanceiro==="T\xEDtulo Liquidado"&&(la=$utils.uuid()),ra>0){const D=$utils.uuid(),E=$utils.arredondar(r.valor*(ra/ca));let q=0,g=0,h=0,w=0;if(s.tipo===5){let x=(await $erp().financeiroBanco.toArray()).find(S=>S.codigoBanco===122);x&&(g=x.percentualMulta||0,w=x.percentualJuros||0,q=$utils.arredondar(g/100*E),h=$utils.arredondar(w/100*E))}ta.push({id:D,idFinanceiroPlanoConta:Da.id,idContato:n.idContato,dataEmissao:v,dataCompetencia:R,dataVencimento:r.dataVencimento,dataVencimentoOriginal:r.dataVencimento,valor:E,valorTotal:E,valorARealizar:E,valorMulta:q,percentualMulta:g,valorJuros:h,percentualJuros:w,documentoId:n.id,documentoTipo:"Fatura",parcela:Ea+"/"+qa,descricao:"Fatura de Venda Mercadoria",observacao:`${n.observacaoFaturamento||""} ${r.observacao||""}`.trim(),documentoVinculado:1,receberPagar:1,valorDesconto:0,percentualDesconto:0,idEmpresa:n.idEmpresa,formaDePagamento:s.descricao,carne:s.tipo===5?1:0,dataEmissaoCarne:s.tipo===5?v:"",idDocumentoCaixa:T.id,idFinanceiroMovimentacaoAgrupamento:s.tipoFinanceiro==="T\xEDtulo Liquidado"?la:""}),r.idFinanceiroTitulo=D,s.tipo===2&&Ta.push({idTitulo:D,idDocumentoCondicaoPagamento:r.id,valor:E,dataVencimento:r.dataVencimento,idBanco:r.idBanco,agencia:r.agencia,conta:r.conta,numeroCheque:r.numeroCheque,formaPagamento:s}),ja.push({idTitulo:D,valor:E,desconto:0})}if(pa>0){const D=$utils.uuid(),E=$utils.arredondar(r.valor*(pa/ca));let q=0,g=0,h=0,w=0;if(s.tipo===5){let x=(await $erp().financeiroBanco.toArray()).find(S=>S.codigoBanco===122);x&&(g=x.percentualMulta||0,w=x.percentualJuros||0,q=$utils.arredondar(g/100*E),h=$utils.arredondar(w/100*E))}ta.push({id:D,idFinanceiroPlanoConta:oa.id,idContato:n.idContato,dataEmissao:v,dataCompetencia:R,dataVencimento:r.dataVencimento,dataVencimentoOriginal:r.dataVencimento,valor:E,valorTotal:E,valorARealizar:E,valorMulta:q,percentualMulta:g,valorJuros:h,percentualJuros:w,documentoId:n.id,documentoTipo:"Fatura",parcela:Ea+"/"+qa,descricao:"Fatura de Venda Mercadoria",observacao:`${n.observacaoFaturamento||""} ${r.observacao||""}`.trim(),documentoVinculado:1,receberPagar:1,valorDesconto:0,percentualDesconto:0,idEmpresa:n.idEmpresa,formaDePagamento:s.descricao,carne:s.tipo===5?1:0,dataEmissaoCarne:s.tipo===5?v:"",idDocumentoCaixa:T.id,idFinanceiroMovimentacaoAgrupamento:s.tipoFinanceiro==="T\xEDtulo Liquidado"?la:"",descontoCondicionadoValor:ka>0?ka/100*E:0,descontoCondicionadoPercentual:ka}),r.idFinanceiroTitulo=D,s.tipo===2&&Ta.push({idTitulo:D,idDocumentoCondicaoPagamento:r.id,valor:E,dataVencimento:r.dataVencimento,idBanco:r.idBanco,agencia:r.agencia,conta:r.conta,numeroCheque:r.numeroCheque,formaPagamento:s})}if(s.tipoFinanceiro==="T\xEDtulo Liquidado"&&pa>=0){Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:la,idEmpresa:n.idEmpresa,idContato:n.idContato,idFinanceiroPlanoConta:ha.id,idFinanceiroTitulo:r.idFinanceiroTitulo,dataEmissao:v,valorCredito:r.valor,valorDebito:0,descricao:String(ha.descricao).trim(),observacao:`Liquida\xE7\xE3o referente t\xEDtulo fatura (${n.id}) - contabiliza\xE7\xE3o autom\xE1tica`,automatico:0,liquidando:0,dataCompetencia:R,dataVencimento:r.dataVencimento,dataMovimento:r.dataVencimento,documentoTipo:"Fatura",documentoId:n.id,idDocumentoCaixa:T.id});let D=s.idFinanceiroPlanoConta;s.tipo===1&&(T||{}).idFinanceiroPlanoContaCaixa&&(D=T.idFinanceiroPlanoContaCaixa);let E=await $db.financeiroPlanoConta.le({id:D}),q="";[3,4].includes(s.tipo)&&(q=($=(b=(m=ta[0])==null?void 0:m.observacao)==null?void 0:b.match(/Autorização\s(\d+)/))==null?void 0:$[1],q&&(q=` (Autoriza\xE7\xE3o ${q})`)),Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:la,idEmpresa:n.idEmpresa,idContato:n.idContato,idFinanceiroPlanoConta:E.id,idFinanceiroTitulo:r.idFinanceiroTitulo,dataEmissao:v,valorCredito:0,valorDebito:r.valor,descricao:String(E.descricao+q).trim(),observacao:`Liquida\xE7\xE3o referente t\xEDtulo fatura (${n.id}) - contabiliza\xE7\xE3o autom\xE1tica`,automatico:0,liquidando:0,dataCompetencia:R,dataVencimento:r.dataVencimento,dataMovimento:r.dataVencimento,documentoTipo:"Fatura",documentoId:n.id,idDocumentoCaixa:T.id});for(const g of ta)g.idFinanceiroMovimentacaoAgrupamento===la&&(g.valorRealizado=g.valorARealizar,g.dataPagamento=r.dataVencimento,g.dataMovimento=r.dataVencimento,g.idDocumentoCaixaLiquidacao=T.id)}if(s.aliquota){const D=$utils.uuid(),E=$utils.arredondar(r.valor*(s.aliquota/100));if(ta.push({id:D,idFinanceiroPlanoConta:s.idFinanceiroPlanoContaAliquota,idContato:s.idContatoOperadoraCartao,dataEmissao:v,dataCompetencia:R,dataVencimento:r.dataVencimento,dataVencimentoOriginal:r.dataVencimento,valor:E,valorTotal:E,valorARealizar:E,valorMulta:0,percentualJuros:0,documentoId:n.id,documentoTipo:"Fatura",parcela:Ea+"/"+qa,descricao:`T\xEDtulo referente a al\xEDquota da forma de pagamento: ${s.descricao}`,observacao:`T\xEDtulo referente a al\xEDquota. ${n.observacaoFaturamento||""} ${r.observacao||""}`.trim(),documentoVinculado:1,receberPagar:0,valorDesconto:0,percentualDesconto:0,idEmpresa:n.idEmpresa,formaDePagamento:s.descricao,idDocumentoCaixa:T.id}),r.idFinanceiroTituloPagar=D,s.tipoFinanceiro==="T\xEDtulo Liquidado"){const q=$utils.uuid();Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:q,idEmpresa:n.idEmpresa,idFinanceiroPlanoConta:Aa.id,dataEmissao:v,valorCredito:0,valorDebito:E,descricao:Aa.descricao,observacao:`Liquida\xE7\xE3o al\xEDquota cart\xE3o referente fatura (${n.id}) - contabiliza\xE7\xE3o autom\xE1tica`,automatico:0,liquidando:0,dataCompetencia:R,dataVencimento:r.dataVencimento,dataMovimento:r.dataVencimento,documentoTipo:"Fatura",documentoId:n.id,idFinanceiroTitulo:D,idContato:s.idContatoOperadoraCartao,idDocumentoCaixa:T.id});let g=s.idFinanceiroPlanoConta;s.tipo===1&&(T||{}).idFinanceiroPlanoContaCaixa&&(g=T.idFinanceiroPlanoContaCaixa);let h=await $db.financeiroPlanoConta.le({id:g});Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:q,idEmpresa:n.idEmpresa,idFinanceiroPlanoConta:h.id,dataEmissao:v,valorCredito:E,valorDebito:0,descricao:h.descricao,observacao:`Liquida\xE7\xE3o al\xEDquota cart\xE3o referente fatura (${n.id}) - contabiliza\xE7\xE3o autom\xE1tica`,automatico:0,liquidando:0,dataCompetencia:R,dataVencimento:r.dataVencimento,dataMovimento:r.dataVencimento,documentoTipo:"Fatura",documentoId:n.id,idFinanceiroTitulo:D,idContato:s.idContatoOperadoraCartao,idDocumentoCaixa:T.id});for(const w of ta)w.id===D&&(w.idFinanceiroMovimentacaoAgrupamento=q,w.valorRealizado=E,w.dataPagamento=r.dataVencimento,w.dataMovimento=r.dataVencimento,w.idDocumentoCaixaLiquidacao=T.id)}}Ea++}}const Ua=[];for(const r of Ta){const s=$utils.uuid(),D=$utils.uuid();for(const q of ta)q.id===r.idTitulo&&(q.idFinanceiroMovimentacaoAgrupamento=D,q.valorRealizado=q.valorARealizar,q.dataPagamento=v,q.dataMovimento=v,q.dataVencimento=v,q.dataVencimentoOriginal=v,q.idDocumentoCaixaLiquidacao=T.id);if(Ua.includes(r.idDocumentoCondicaoPagamento))continue;Ua.push(r.idDocumentoCondicaoPagamento);const E=$utils.arredondar(Ta.reduce((q,g)=>g.idDocumentoCondicaoPagamento===r.idDocumentoCondicaoPagamento?q+(g.valor||0):q,0));ta.push({id:s,idFinanceiroPlanoConta:Oa.id,idContato:n.idContato,dataEmissao:v,dataCompetencia:R,dataVencimento:r.dataVencimento,dataVencimentoOriginal:r.dataVencimento,valor:E,valorTotal:E,valorARealizar:E,valorMulta:0,percentualJuros:0,receberPagar:1,valorDesconto:0,percentualDesconto:0,documentoId:n.id,documentoTipo:"Fatura",idEmpresa:n.idEmpresa,formaDePagamento:r.formaPagamento.descricao,idDocumentoCaixa:T.id,cheque:1,idBanco:r.idBanco,agencia:r.agencia,conta:r.conta,numeroCheque:r.numeroCheque,observacao:`Liquida\xE7\xE3o de Cheques da Fatura #${n.id} - C\xF3digoN #${D}`,descricao:"Cheque"}),Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:D,idEmpresa:n.idEmpresa,idContato:n.idContato,idFinanceiroPlanoConta:Oa.id,idFinanceiroTitulo:s,dataEmissao:v,valorCredito:0,valorDebito:E,descricao:"Cheque - Cr\xE9dito de t\xEDtulos a receber",observacao:"Cr\xE9dito de t\xEDtulos a receber",automatico:0,liquidando:0,dataCompetencia:R,dataVencimento:v,dataMovimento:v,idFinanceiroCheque:s,idDocumentoCaixa:T.id,documentoId:n.id}),Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:D,idEmpresa:n.idEmpresa,idContato:n.idContato,idFinanceiroPlanoConta:ha.id,idFinanceiroTitulo:s,dataEmissao:v,valorCredito:E,valorDebito:0,descricao:ha.descricao,observacao:"Contabiliza\xE7\xE3o autom\xE1tica",automatico:0,liquidando:0,dataCompetencia:R,dataVencimento:v,dataMovimento:v,idFinanceiroCheque:s,idDocumentoCaixa:T.id,documentoId:n.id})}if(ra>0){const r=$utils.uuid();Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:r,idEmpresa:n.idEmpresa,idContato:n.idContato,idFinanceiroPlanoConta:ha.id,dataEmissao:v,valorCredito:ra,valorDebito:0,descricao:ha.descricao,observacao:"Contabiliza\xE7\xE3o autom\xE1tica",automatico:1,liquidando:0,dataCompetencia:R,dataVencimento:v,dataMovimento:v,idDocumentoCaixa:T.id}),Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:r,idEmpresa:n.idEmpresa,idContato:n.idContato,idFinanceiroPlanoConta:Da.id,dataEmissao:v,valorCredito:0,valorDebito:ra,descricao:Da.descricao,observacao:"Contabiliza\xE7\xE3o autom\xE1tica - Complemento",automatico:0,liquidando:0,dataCompetencia:R,dataVencimento:v,dataMovimento:v,documentoTipo:"Renegocia\xE7\xE3o",documentoId:r,idDocumentoCaixa:T.id});for(const s of ja)La.push({idFinanceiroMovimentacaoN:r,idFinanceiroTitulo:s.idTitulo,dataVencimento:v,valorOriginal:s.valor,valorDesconto:s.desconto,valorTotal:$utils.arredondar(s.valor-s.desconto)});for(const s of f){if(s.idFinanceiroMovimentacaoAgrupamento=r,s.idDocumentoCaixaLiquidacao=T.id,s.dataPagamento=v,s.dataMovimento=v,s.renegociado=1,s.cheque===1){s.valorRealizado=s.valor;continue}if(!s.valorARealizar){s.valorRealizado=s.valorTotal;continue}s.valorRealizado=s.valorARealizar}ta=ta.concat(f)}if(ua===0){let r=$utils.uuid();const s=n.valorFrete||0;let D=0,E=0;const q=[];if(s>0&&(Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:r,idEmpresa:n.idEmpresa,idFinanceiroPlanoConta:oa.id,dataEmissao:v,valorCredito:0,valorDebito:s,descricao:oa.descricao,observacao:`Lan\xE7amento frete da fatura (${n.id}) - contabiliza\xE7\xE3o autom\xE1tica`,automatico:0,liquidando:0,dataCompetencia:R,dataVencimento:v,dataMovimento:v,documentoTipo:"Fatura",documentoId:n.id,idDocumentoCaixa:T.id}),Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:r,idEmpresa:n.idEmpresa,idFinanceiroPlanoConta:Sa.id,dataEmissao:v,valorCredito:s,valorDebito:0,descricao:Sa.descricao,observacao:`Lan\xE7amento frete da fatura (${n.id}) - contabiliza\xE7\xE3o autom\xE1tica`,automatico:0,liquidando:0,dataCompetencia:R,dataVencimento:v,dataMovimento:v,documentoTipo:"Fatura",documentoId:n.id,idDocumentoCaixa:T.id})),!i){r=$utils.uuid();for(const g of l){let h="",w={},x="",S={},ea="",ga={};const Ca=await $db.item.leNew({id:g.idItem});if(h=g.idPlanoContaEstoque,!h){const Y=await $db.perfilContabilItem.le({idPerfilContabil:Ca.idPerfilContabil,idCfop:g.idCfop,and:{idPerfilContabil:Ca.idPerfilContabil,idCfop:g.idCfop}});Y.length&&Y[0].idPlanoContaEstoque&&(h=Y[0].idPlanoContaEstoque)}if(!h&&Ra.id&&(h=Ra.id),!h&&g.idCfop&&(h=(await $db.cfop.le({id:g.idCfop})).idPlanoContaEstoque),w=await $db.financeiroPlanoConta.le({id:h}),!w.id){this.$q.notify("N\xE3o foi poss\xEDvel localizar Conta de Estoque.");return}if(x="",!x){const Y=await $db.perfilContabilItem.le({idPerfilContabil:Ca.idPerfilContabil,idCfop:g.idCfop,and:{idPerfilContabil:Ca.idPerfilContabil,idCfop:g.idCfop}});Y.length&&Y[0].idPlanoContaDespesa&&(x=Y[0].idPlanoContaDespesa)}if(!x&&ya.id&&(x=ya.id),!x&&g.idCfop&&(x=(await $db.cfop.le({id:g.idCfop})).idPlanoContaDestino),S=await $db.financeiroPlanoConta.le({id:x}),!S.id){this.$q.notify("N\xE3o foi poss\xEDvel localizar Conta de Despesa.");return}const _a=$utils.arredondar(g.total-(g.descontoTotalRateado||0)-(g.descontoFaturaRateado||0)),wa=$utils.arredondar(g.valorCustoMedio*g.quantidade);if(wa){if(Va&&(g.operacaoFator<0?(Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:r,idEmpresa:n.idEmpresa,idFinanceiroPlanoConta:w.id,dataEmissao:g.dataHoraFinalizado||v,valorCredito:wa,valorDebito:0,descricao:w.descricao,observacao:`Movimenta\xE7\xF5es de CMV referente fatura (${n.id}) e item (${g.idItem}) - contabiliza\xE7\xE3o autom\xE1tica`,automatico:0,liquidando:0,dataCompetencia:R,dataVencimento:v,dataMovimento:v,documentoTipo:n.tipo,documentoId:n.id,idDocumentoCaixa:T.id}),Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:r,idEmpresa:n.idEmpresa,idFinanceiroPlanoConta:S.id,dataEmissao:g.dataHoraFinalizado||v,valorCredito:0,valorDebito:wa,descricao:S.descricao,observacao:`Movimenta\xE7\xF5es de CMV referente fatura (${n.id}) e item (${g.idItem}) - contabiliza\xE7\xE3o autom\xE1tica`,automatico:0,liquidando:0,dataCompetencia:R,dataVencimento:v,dataMovimento:v,documentoTipo:n.tipo,documentoId:n.id,idDocumentoCaixa:T.id})):(Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:r,idEmpresa:n.idEmpresa,idFinanceiroPlanoConta:w.id,dataEmissao:g.dataHoraFinalizado||v,valorCredito:0,valorDebito:wa,descricao:w.descricao,observacao:`Movimenta\xE7\xF5es de CMV referente fatura (${n.id}) e item (${g.idItem}) - contabiliza\xE7\xE3o autom\xE1tica`,automatico:0,liquidando:0,dataCompetencia:R,dataVencimento:v,dataMovimento:v,documentoTipo:n.tipo,documentoId:n.id,idDocumentoCaixa:T.id}),Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:r,idEmpresa:n.idEmpresa,idFinanceiroPlanoConta:S.id,dataEmissao:g.dataHoraFinalizado||v,valorCredito:wa,valorDebito:0,descricao:S.descricao,observacao:`Movimenta\xE7\xF5es de CMV referente fatura (${n.id}) e item (${g.idItem}) - contabiliza\xE7\xE3o autom\xE1tica`,automatico:0,liquidando:0,dataCompetencia:R,dataVencimento:v,dataMovimento:v,documentoTipo:n.tipo,documentoId:n.id,idDocumentoCaixa:T.id}))),ea=g.idPlanoContaDestino,!ea){const da=await $db.perfilContabilItem.le({idPerfilContabil:Ca.idPerfilContabil,idCfop:g.idCfop,and:{idPerfilContabil:Ca.idPerfilContabil,idCfop:g.idCfop}});da.length&&da[0].idPlanoContaDespesa&&(ea=da[0].idPlanoContaDespesa)}if(!ea&&ya.id&&(ea=ya.id),!ea&&g.idCfop&&(ea=(await $db.cfop.le({id:g.idCfop})).idPlanoContaDestino),ga=await $db.financeiroPlanoConta.le({id:ea}),!ga.id){this.$q.notify("N\xE3o foi poss\xEDvel localizar Conta de Receita.");return}let Y=!0;for(const da of q)if(da.idPlanoContaDestino===ga.id&&da.idPlanoContaEstoque===w.id){da.valor=$utils.arredondar(da.valor+_a),Y=!1;break}Y&&q.push({idPlanoContaDestino:ga.id,idPlanoContaEstoque:w.id,valor:_a}),D+=_a}}for(const g of q)g.valor<0&&(E+=g.valor);for(const g of q)if(g.valor>0){const h=await $db.financeiroPlanoConta.le({id:g.idPlanoContaDestino}),w=$utils.arredondar(E*(g.valor/(D||1)));if(w>0){if(Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:r,idEmpresa:n.idEmpresa,idFinanceiroPlanoConta:oa.id,dataEmissao:v,valorCredito:0,valorDebito:w,descricao:oa.descricao,observacao:`Lan\xE7amento entrada faturamento geral da devolu\xE7\xE3o referente fatura (${n.id}) - contabiliza\xE7\xE3o autom\xE1tica`,automatico:0,liquidando:0,dataCompetencia:R,dataVencimento:v,dataMovimento:v,documentoTipo:"Fatura",documentoId:n.id,idDocumentoCaixa:T.id}),Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:r,idEmpresa:n.idEmpresa,idFinanceiroPlanoConta:h.id,dataEmissao:v,valorCredito:w,valorDebito:0,descricao:h.descricao,observacao:`Lan\xE7amento sa\xEDda na conta de destino referente fatura (${n.id}) - contabiliza\xE7\xE3o autom\xE1tica`,automatico:0,liquidando:0,dataCompetencia:R,dataVencimento:v,dataMovimento:v,documentoTipo:"Fatura",documentoId:n.id,idDocumentoCaixa:T.id}),Va)for(const x of aa)Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:r,idEmpresa:n.idEmpresa,idFinanceiroPlanoConta:oa.id,dataEmissao:v,valorCredito:0,valorDebito:$utils.arredondar((g.valor-w)*(x.valor/(ca||1))),descricao:oa.descricao,observacao:`Lan\xE7amento sa\xEDda na conta de faturamento geral referente fatura (${n.id}) - contabiliza\xE7\xE3o autom\xE1tica`,automatico:0,liquidando:0,dataCompetencia:R,dataVencimento:x.dataVencimento,dataMovimento:x.dataVencimento,documentoTipo:"Fatura",documentoId:n.id,idDocumentoCaixa:T.id}),Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:r,idEmpresa:n.idEmpresa,idFinanceiroPlanoConta:h.id,dataEmissao:v,valorCredito:$utils.arredondar((g.valor-w)*(x.valor/(ca||1))),valorDebito:0,descricao:h.descricao,observacao:`Lan\xE7amento entrada na conta de venda do produto referente fatura (${n.id}) - contabiliza\xE7\xE3o autom\xE1tica`,automatico:0,liquidando:0,dataCompetencia:R,dataVencimento:x.dataVencimento,dataMovimento:x.dataVencimento,documentoTipo:"Fatura",documentoId:n.id,idDocumentoCaixa:T.id})}else if(Va)for(const x of aa){const S=$utils.arredondar(g.valor*(x.valor/(ca||1)));Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:r,idEmpresa:n.idEmpresa,idFinanceiroPlanoConta:oa.id,dataEmissao:v,valorCredito:0,valorDebito:S,descricao:oa.descricao,observacao:`Lan\xE7amento sa\xEDda na conta de faturamento geral referente fatura (${n.id}) - contabiliza\xE7\xE3o autom\xE1tica`,automatico:0,liquidando:0,dataCompetencia:R,dataVencimento:x.dataVencimento,dataMovimento:x.dataVencimento,documentoTipo:"Fatura",documentoId:n.id,idDocumentoCaixa:T.id}),Q.push({id:$utils.uuid(),idFinanceiroMovimentacaoN:r,idEmpresa:n.idEmpresa,idFinanceiroPlanoConta:h.id,dataEmissao:v,valorCredito:S,valorDebito:0,descricao:h.descricao,observacao:`Lan\xE7amento entrada na conta de venda do produto referente fatura (${n.id}) - contabiliza\xE7\xE3o autom\xE1tica`,automatico:0,liquidando:0,dataCompetencia:R,dataVencimento:x.dataVencimento,dataMovimento:x.dataVencimento,documentoTipo:"Fatura",documentoId:n.id,idDocumentoCaixa:T.id})}}}}if(this.financeiroTitulo=ta,this.financeiroMovimentacao=Q,this.financeiroRenegociacao=La,this.fatura=n,this.vendas=X,this.documentosEnvelope=k,this.carnes=f,!i){await this.salvarFatura(),$utils.emitter.emit("desativarBotoesFaturaModal");try{let s,D,E,q;if(s=await $db.configuracoes.porNome("integracao.bten.business"),D=(L=(I=s[0])==null?void 0:I.valor)!=null?L:!1,s=await $db.configuracoes.porNome("integracao.bten.authorization"),E=(j=(A=s[0])==null?void 0:A.valor)!=null?j:!1,q=D&&E,q){const g=[],h=this.contatos[n.idContato],w=await $api.bten.send(h,n);for(let x=0;x<w.length;x++){const S=w[x];S.status?g.push(S.telefone):this.$q.notifyError(`Falha ao enviar NPS para ${S.telefone}!`)}g.length&&this.$q.notifyPositive(`NPS enviado para ${g.join(",")}!`)}}catch(s){s.name==="GeeksException"&&this.$q.notifyAlert(`N\xE3o foi poss\xEDvel enviar NPS: ${s.message}`),s.name!=="GeeksException"&&this.$q.notifyError("N\xE3o foi possivel enviar NPS para o contato.",s)}let r;if(T!=null&&T.idCaixa){const s=await $erp().caixa.get(T==null?void 0:T.idCaixa);s!=null&&s.id&&(r=$db.caixa.tiposCaixa[Number(s.tipo)])}if([...X,...k].length&&~["SAT","NFCe"].indexOf(r))try{await this.$refs.documentosFiscais.emitirCupom(this.fatura.id)}catch{}if(this.$q.notifyPositive("Fatura finalizada"),this.fatura.status==="Finalizada"){$db.bonus.gera(n).then(E=>{E&&$q.notifyPositive("B\xF4nus gerado com sucesso!")});const s=await $db.configuracoes.le({prefixoNome:"enviaemail.fatura"});let D=s.find(E=>E.idEmpresa===this.fatura.idEmpresa);D||(D=s.find(E=>!E.idEmpresa)),D&&await at.enviar(this.fatura,D)}}return!0}catch(n){this.$q.notifyError("N\xE3o foi poss\xEDvel finalizar a fatura",n)}finally{this.$q.loading.hide()}}};const tt={components:{DocumentoCodigo:fo,DocumentoMetas:po,DocumentosFiscais:bo,Faturamento:vo,TituloCard:Yo,VendaCard:Do,EnvelopeCard:Eo},computed:{config(){return $db.configuracoes.valores},descontoSomenteLeitura(){let i=!1;return i=this.fatura.status==="Aberta",i||(i=this.fatura.status==="Aguardando Pagamento"&&this.permissaoDescontoFaturaSinal),!i},bonusSomenteLeitura(){return this.fatura.status!=="Aberta"}},data(){return{contatos:{},faturaOriginal:{},fatura:{totalDocumento:0,subTotal:0,totalDesconto:0,totalPercentualDesconto:0,totalBonus:0,tokenBonusUtilizado:""},vendas:[],vendasOriginal:[],documentosEnvelope:[],documentosEnvelopeOriginal:[],documentosItem:[],documentosItemOriginal:[],carnes:[],carnesOriginal:[],documentoStatus:[],faturaTitulos:[],faturaMovimentacoes:[],livroDiario:{},erroCalculo:!1,erroCalculoMsg:"",erroCalculoBonusMsg:"",erroTokenBonusMsg:"",sistemaPai:"",impressaoVisivel:!1,configImpressaoCarne:[],configImpressaoConvenio:[],configImpressaoFatura:[],configImpressaoEnvelope:[],permissaoDesconto:!1,permissaoDescontoFaturaSinal:!1,permissaoBonus:!1,pesoTotal:null,pesoBrutoTotal:null,metroCubicoTotal:null}},emits:["executar"],mixins:[Fo],methods:{async executarRecebimentoMultiplos(i){console.log(i)},async calcularPesoTotal(){var u,B;const i=await $db.hibrido.lista({table:"documento",where:{idFatura:this.fatura.id}}),o=[],d={};let C=0,a=0;for(const m of i){const b=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:m.id}});for(const $ of b)o.push($)}for(const m of o)if(m.operacaoFator===-1){if(m.idItem&&!d[m.idItem]){const b=await $erp().item.get(m.idItem);b&&(d[m.idItem]=b)}C+=(((u=d[m.idItem])==null?void 0:u.peso)||0)*(m.quantidade||0),a+=(((B=d[m.idItem])==null?void 0:B.pesoBruto)||0)*(m.quantidade||0)}C=$utils.arredondar(C,4),a=$utils.arredondar(a,4),this.pesoTotal=C?$filters.numeroZerosDireita(C,4,2):null,this.pesoBrutoTotal=a?$filters.numeroZerosDireita(a,4,2):null},async calcularMetroCubicoTotal(){var a,u,B;const i=await $db.hibrido.lista({table:"documento",where:{idFatura:this.fatura.id}}),o=[],d={};let C=0;for(const m of i){const b=await $db.hibrido.lista({table:"documentoItem",where:{idDocumento:m.id}});for(const $ of b)o.push($)}for(const m of o){if(m.operacaoFator!==-1||m.tipoItem!=="Produto")continue;if(m.idItem&&!d[m.idItem]){const I=await $erp().item.get(m.idItem);I&&(d[m.idItem]=I)}const b=((a=d[m.idItem])==null?void 0:a.altura)*((u=d[m.idItem])==null?void 0:u.largura)*((B=d[m.idItem])==null?void 0:B.comprimento)||0,$=m.quantidade||0;C+=b>0?b*$:0}C=$utils.arredondar(C,4),this.metroCubicoTotal=C?$filters.numeroZerosDireita(C,4,2):null},atualizarDocumentoMetas(){!this.$refs.documentoMetas||(this.$refs.documentoMetas.documento=$utils.clonarV2(this.fatura))},...ot,async atualizar(){let i=!1;if(this.permissaoDesconto=await $db.permissao.objeto("Diretiva_Caixa_DescontoFatura"),this.permissaoDescontoFaturaSinal=await $db.permissao.objeto("Diretiva_Caixa_DescontoFatura_Sinal"),this.permissaoBonus=await $db.permissao.objetoClienteSistema("configuracoes/bonus"),this.vendas=[],this.vendasOriginal=[],this.documentosEnvelope=[],this.documentosEnvelopeOriginal=[],this.documentosItem=[],this.documentosItemOriginal=[],this.carnes=[],this.carnesOriginal=[],this.documentoStatus=[],this.contatos={},this.erroCalculo=!1,this.erroCalculoMsg="",this.erroCalculoBonusMsg="",this.erroTokenBonusMsg="",this.prop.id){const o=await $db.fatura.leCompleto(this.prop.id);this.faturaOriginal=$utils.clonar(o.fatura),this.fatura=o.fatura,this.$refs.faturamento&&(this.$refs.faturamento.condicaoPagamentoOriginal=$utils.clonar(o.condicaoPagamento),this.$refs.faturamento.condicaoPagamento=o.condicaoPagamento),this.vendasOriginal=$utils.clonar(o.vendas),this.vendas=o.vendas.sort((a,u)=>new Date(a.dataHoraFinalizado)<new Date(u.dataHoraFinalizado)?-1:1);const d=o.documentosEnvelope.sort((a,u)=>new Date(a.dataHoraFinalizado)<new Date(u.dataHoraFinalizado)?-1:1);if(this.documentosEnvelopeOriginal=$utils.clonar(d),this.documentosEnvelope=$utils.clonar(d),typeof this.receberTitulo.id!="object"&&this.receberTitulo.id&&!o.carnes.find(a=>a.id===this.receberTitulo.id)&&(o.carnes.push(await $db.financeiroTitulo.le({id:this.receberTitulo.id})),i=!0),typeof this.receberTitulo.id=="object")for(let a of this.receberTitulo.id)a&&!o.carnes.find(u=>u.id===a)&&(o.carnes.push(await $db.financeiroTitulo.le({id:a})),i=!0);this.carnesOriginal=$utils.clonar(o.carnes),this.carnes=o.carnes.sort((a,u)=>new Date(a.dataVencimento)<new Date(u.dataVencimento)?-1:1);const C={};if(o.fatura.idContato){const a=o.fatura.idContato;C[a]||(C[a]=await $db.contato.le({id:a}))}this.configuraImpressaoCarne(o.fatura.idEmpresa),this.configuraImpressaoConvenio(o.fatura.idEmpresa),this.configuraImpressaoEnvelope(o.fatura.idEmpresa),this.configuraImpressaoFatura(o.fatura.idEmpresa),this.contatos=C,await this.atualizarDocumentoMetas(),await this.calculaTotais(),await this.calcularPesoTotal(),await this.calcularMetroCubicoTotal();try{i&&await this.salvarFatura()}catch(a){console.error(a)}}},async executar(i){if(i==="recalcular"){if(this.prop.id){const o=await $db.fatura.leCompleto(this.prop.id);this.carnesOriginal=$utils.clonar(o.carnes),this.carnes=o.carnes,await this.calculaTotais()}}else i==="salvarFatura"?(await this.salvarFatura(),await this.atualizar(),this.$emit("executar","atualizarSemFechar")):(await this.atualizar(),this.$emit("executar",i))},async calculaTotais(i){const o=$utils.arredondar(this.vendas.reduce((a,u)=>a+u.totalDocumento||0,0)),d=$utils.arredondar(this.documentosEnvelope.reduce((a,u)=>a+u.totalDocumento||0,0)),C=$utils.arredondar(this.carnes.reduce((a,u)=>a+u.valorARealizar||0,0));if(i||(this.fatura.subTotal=$utils.arredondar(o+d+C),i="desconto"),i==="descontoPercentual"&&(this.fatura.totalDesconto=$utils.arredondar((this.fatura.totalPercentualDesconto||0)/100*this.fatura.subTotal)),i==="desconto"&&(this.fatura.totalPercentualDesconto=$utils.arredondar((this.fatura.totalDesconto||0)/this.fatura.subTotal*100)),await this.checarTokenBonus(),this.fatura.totalDocumento=$utils.arredondar(this.fatura.subTotal-(this.fatura.totalDesconto||0)-(this.fatura.totalBonus||0)),this.erroCalculo=!1,this.erroCalculoMsg="",this.erroCalculoBonusMsg="",this.fatura.totalDesconto!==0){const a=o+d;a===0&&(this.erroCalculo=!0,this.erroCalculoMsg="Desconto n\xE3o permitido para fatura sem venda"),a>0&&this.fatura.totalDesconto>a&&(this.erroCalculo=!0,this.erroCalculoMsg="Desconto maior que o total das vendas")}if(this.fatura.totalDesconto!==0&&this.fatura.totalDocumento>this.fatura.subTotal&&(this.erroCalculo=!0),this.fatura.totalBonus!==0){const a=o+d;a===0&&(this.erroCalculoBonusMsg="B\xF4nus n\xE3o permitido para fatura sem venda"),a>0&&this.fatura.totalBonus>a&&(this.erroCalculoBonusMsg="B\xF4nus maior que o total das vendas")}this.fatura.totalBonus!==0&&this.fatura.totalDocumento>this.fatura.subTotal&&(this.erroCalculoBonus="B\xF4nus com valor Inv\xE1lido");try{await this.$refs.faturamento.resumeCondicaoPagamento(),await this.$refs.faturamento.atualizaValorRestante(),await this.$refs.faturamento.redefinirCampos()}catch{}},async checarTokenBonus(){var i,o,d,C,a,u,B;if(!(this.ultimoTokenBonusVerificado===this.fatura.tokenBonusUtilizado&&this.ultimoDescontoVerificado===this.fatura.totalDesconto&&this.ultimoPercentualDescontoVerificado===this.fatura.totalPercentualDesconto)){if(!this.fatura.tokenBonusUtilizado){this.fatura.totalBonus=0,this.erroTokenBonusMsg="";return}try{this.ultimoTokenBonusVerificado=this.fatura.tokenBonusUtilizado,this.ultimoDescontoVerificado=this.fatura.totalDesconto,this.ultimoPercentualDescontoVerificado=this.fatura.totalPercentualDesconto;const m=$utils.arredondar(this.vendas.reduce((L,A)=>L+A.totalDocumento||0,0)),b=$utils.arredondar(this.documentosEnvelope.reduce((L,A)=>L+A.totalDocumento||0,0)),$=m+b-(this.fatura.totalDesconto||0),I=await $utils.geeksApi({verificaBonus:{funcao:"1A130FC6-C9BA-4121-B9CF-069CEAEC36CB",tokenBonus:this.fatura.tokenBonusUtilizado,valorVenda:$,cnpjEmissor:this.fatura.numeroDocumentoEmpresa,cpfCliente:this.fatura.numeroDocumentoContato,idDocumentoDestino:this.fatura.id,utiliza:!1}});$utils.verificarErro(!["Ativo","Utilizado"].includes((o=(i=I.data)==null?void 0:i.verificaBonus)==null?void 0:o.status),"B\xF4nus inv\xE1lido"),$utils.verificarErro(!((C=(d=I.data)==null?void 0:d.verificaBonus)!=null&&C.valor),"Valor do B\xF4nus inv\xE1lido"),this.fatura.totalBonus=(B=(u=(a=I.data)==null?void 0:a.verificaBonus)==null?void 0:u.valor)!=null?B:0,this.erroTokenBonusMsg=""}catch(m){this.fatura.totalBonus=0,this.erroTokenBonusMsg=m.message}}},async configuraImpressaoConvenio(i){const o=await $db.configuracoes.porNome("impressao.convenio",i);this.configImpressaoConvenio=[...o.length?o.map(d=>({texto:"Imprimir Conv\xEAnio",...d})):[{valor:"convenio",texto:"Imprimir Conv\xEAnio"}]]},async configuraImpressaoCarne(i){const o=await $db.configuracoes.porNome("impressao.carne",i);this.configImpressaoCarne=[...o.length?o.map(d=>({texto:"Imprimir Carn\xEA",...d})):[{valor:"carne-crediario",texto:"Reimprimir carn\xEA e notas promiss\xF3rias da fatura"}]]},async configuraImpressaoEnvelope(i){const o=await $db.configuracoes.porNome("impressao.envelope",i);this.configImpressaoEnvelope=[...o.length?o.map(d=>({texto:"Imprimir Envelope",...d})):[{valor:"envelope",texto:"Imprimir Envelope"},{valor:"envelopeMini",texto:"Imprimir Envelope Mini"}]]},async configuraImpressaoFatura(i){const o=await $db.configuracoes.porNome("impressao.fatura",i),d=[{valor:"invoice",texto:"Fatura (Invoice)"},{valor:"fatura-recibo",texto:"Recibo"}];this.sistemaPai==="optisoul"&&d.push({valor:"termoGarantia",texto:"Termo de Garantia"}),this.configImpressaoFatura=[...o.length?o.map(C=>({texto:"Imprimir Fatura",...C})):d]},async reabrir(i){var o;if(!((o=this.fatura)!=null&&o.id)){this.$q.notifyError("N\xE3o foi poss\xEDvel encontrar o ID da fatura");return}if(!i)try{$q.loading.show(),await ho({idDocumento:this.fatura.id})}catch(d){this.$q.notifyError(d.message);return}finally{$q.loading.hide()}if(!i)try{await new Promise((d,C)=>{$q.dialog({message:"Esta a\xE7\xE3o ir\xE1 reabrir esta fatura",title:"Tem certeza?",cancel:{label:"CANCELAR",push:!0,color:"tertiary",flat:!0},ok:{label:"CONTINUAR",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(()=>{d()}).onCancel(()=>{C()})})}catch{return}try{this.$q.loading.show({message:"Processando..."});const d=$utils.clonar(this.fatura),C=$utils.clonar(this.vendas),a=$utils.clonar(this.documentosEnvelope),u=$utils.clonar(this.documentosItem),B=this.$refs.faturamento.condicaoPagamento.filter(I=>I.valor);if(!i){const I=[];B.reduce((L,A)=>(A.idDocumentoCaixa&&!L[A.idDocumentoCaixa]&&(L[A.idDocumentoCaixa]=!0,I.push($db.hibrido.le({table:"documento",id:A.idDocumentoCaixa}))),L),{});for await(const L of I)if(L.status!=="Aberto")return this.$q.notify({message:"N\xE3o \xE9 poss\xEDvel reabrir fatura de caixas fechados!"}),!1}try{await $db.fatura.checarTitulosLiquidados({condicoesPagamento:this.$refs.faturamento.condicaoPagamentoOriginal})}catch(I){$q.notifyError(I.message);return}let m=[],b=[],$=[];if(!i){m=await $db.financeiroTitulo.le({documentoId:d.id});for(const f of m)if(f.idFinanceiroBoleto){const p=await $erp().financeiroBoleto.get(f.idFinanceiroBoleto),O=await $db.financeiroBanco.le({id:p.idFinanceiroBanco}),l=await $db.banco.le({id:O.idBanco}),N=p.revisao,v=l.baixa,R=l.registro;if(p.remessaOperacao!==v){const T=f.idFinanceiroBoleto,Fa=$utils.uuid(),aa={id:Fa,idFinanceiroBanco:p.idFinanceiroBanco,nossoNumero:p.nossoNumero,nossoNumeroDv:p.nossoNumeroDv,revisao:N+1,idEmpresa:p.idEmpresa,idContato:p.idContato,empresaNome:p.empresaNome,empresaNumeroDocumento:p.empresaNumeroDocumento,contatoNome:p.contatoNome,contatoNumeroDocumento:p.contatoNumeroDocumento,contatoLogradouro:p.contatoLogradouro,contatoCEP:p.contatoCEP,contatoBairro:p.contatoBairro,contatoCidade:p.contatoCidade,contatoUF:p.contatoUF,dataEmissao:$utils.dataAtual(),dataVencimento:p.dataVencimento,dataImpressao:p.dataImpressao,valor:p.valor,valorJuros:p.valorJuros,tipoJuros:p.tipoJuros,valorMulta:p.valorMulta,valorDesconto:p.valorDesconto,valorTotal:p.valorTotal,codigoBarras:p.codigoBarras,linhaDigitavel:p.linhaDigitavel,mensagem1:p.mensagem1,mensagem2:p.mensagem2,mensagem3:p.mensagem3,mensagem4:p.mensagem4,mensagem5:p.mensagem5,gerarRemessa:1,remessaOperacao:v};await $db.financeiroBoleto.grava({atual:aa});let ra=[];T&&(ra=await $db.financeiroTitulo.le({idFinanceiroBoleto:T}));for(const sa of ra){const ua=$utils.clonar(sa);sa.idFinanceiroBoleto=Fa;let fa=[];T&&(fa=await $db.financeiroBoletoTitulo.le({idFinanceiroBoleto:T}));for(const xa of fa){const Da={id:$utils.uuid(),idFinanceiroBoleto:Fa,idFinanceiroTitulo:xa.idFinanceiroTitulo};await $db.financeiroBoletoTitulo.grava({atual:Da})}await $db.financeiroTitulo.grava({atual:sa,original:ua})}if(p.remessaOperacao===R&&p.gerarRemessa===1)for(const sa of[p,aa]){const ua={...sa,gerarRemessa:0};await $db.financeiroBoleto.grava({original:sa,atual:ua})}}}let I=[];this.$refs.faturamento.idDocumentoCaixa&&(I=await $db.financeiroMovimentacao.le({idDocumentoCaixa:this.$refs.faturamento.idDocumentoCaixa})),m=await $db.financeiroTitulo.le({idFatura:d.id});let L=await $db.financeiroTitulo.le({idFatura:d.id});for(const f of $utils.clonar(m)){if(!f.idFinanceiroMovimentacaoAgrupamento)continue;const p=await $db.financeiroRenegociacao.le({idFinanceiroMovimentacaoN:f.idFinanceiroMovimentacaoAgrupamento});for(const O of p){const l=await $db.financeiroTitulo.le({id:O.idFinanceiroTitulo});l.idDocumentoCaixa===this.$refs.faturamento.idDocumentoCaixa&&(m=m.concat(l))}}let A=!1;for(const f of B){const p=await $db.financeiroTitulo.le({id:f.idFinanceiroTitulo});if(Object.keys(p).length){let O=[];O=I.filter(l=>l.idFinanceiroMovimentacaoN===p.idFinanceiroMovimentacaoAgrupamento),b=b.concat(O),O=I.filter(l=>l.idFinanceiroTitulo===p.id),b=b.concat(O),O=I.filter(l=>l.idFinanceiroCheque===p.id),b=b.concat(O),m=m.concat(p)}f.idFinanceiroTitulo="",f.sinal===1&&(A=!0)}L=await $db.financeiroTitulo.le({idFatura:d.id,idDocumentoCaixa:this.$refs.faturamento.idDocumentoCaixa});for(const f of L){if(!f.idFinanceiroMovimentacaoAgrupamento)continue;const p=await $db.financeiroMovimentacao.le({idFinanceiroMovimentacaoN:f.idFinanceiroMovimentacaoAgrupamento});b=b.concat(p);const O=await $db.financeiroRenegociacao.le({idFinanceiroMovimentacaoN:f.idFinanceiroMovimentacaoAgrupamento});$=$.concat(O)}if(L=await $db.financeiroTitulo.le({idDocumentoCaixa:this.$refs.faturamento.idDocumentoCaixa,documentoId:d.id}),m=m.concat(L),d.id){let f=await $db.financeiroMovimentacao.lerV2({documentoTipo:"Devolu\xE7\xE3o",documentoId:d.id});b=b.concat(f),f=await $db.financeiroMovimentacao.lerV2({idDocumentoCaixa:this.$refs.faturamento.idDocumentoCaixa,documentoId:d.id}),b=b.concat(f),f=await $db.financeiroMovimentacao.lerV2({documentoId:d.id});for(const p of f)(await $db.financeiroTitulo.le({id:p.idFinanceiroTitulo})).id||(b=b.concat(p))}const j=await $db.hibrido.lista({table:"documento",where:{idFatura:d.id}});for(const f of j){const p=await $db.financeiroMovimentacao.le({idDocumentoCaixa:this.$refs.faturamento.idDocumentoCaixa,documentoId:f.id});b=b.concat(p)}let n=[];for(const f in m){const p=m[f].id;n.includes(p)?delete m[f]:n.push(p)}m=m.filter(f=>f),n=[];for(const f in b){const p=b[f].id;n.includes(p)?delete b[f]:n.push(p)}b=b.filter(f=>f),n=[];for(const f in $){const p=$[f].id;n.includes(p)?delete $[f]:n.push(p)}$=$.filter(f=>f);let X=$utils.dataAtual(),k=A?"Aguardando Pagamento":"Aberta";this.documentoStatus=[{id:$utils.uuid(),idDocumento:d.id,operacao:"Fatura",statusOriginal:d.status,statusFinalizado:k,dataHoraEmissao:X,cpfUsuario:$db.usuario.logado.numeroDocumentoNacional,idDocumentoCaixa:this.$refs.faturamento.idDocumentoCaixa}],d.status=k,k==="Aberta"&&(d.dataHoraFinalizado=""),k=A?"Aguardando Pagamento":"Aguardando Faturamento";for(const f of C)this.documentoStatus.push({id:$utils.uuid(),idDocumento:f.id,operacao:"Venda de Mercadoria",statusOriginal:f.status,statusFinalizado:k,dataHoraEmissao:X,cpfUsuario:$db.usuario.logado.numeroDocumentoNacional,idDocumentoCaixa:this.$refs.faturamento.idDocumentoCaixa}),f.status=k;for(const f of a)this.documentoStatus.push({id:$utils.uuid(),idDocumento:f.id,operacao:"Envelope",statusOriginal:f.status,statusFinalizado:f.status,dataHoraEmissao:X,cpfUsuario:$db.usuario.logado.numeroDocumentoNacional,idDocumentoCaixa:this.$refs.faturamento.idDocumentoCaixa});for(const f of u)f.status=k;this.fatura=d,this.vendas=C,this.documentosEnvelope=a,this.documentosItem=u}if(this.$q.loading.hide(),i&&await this.finalizar(i),this.$q.loading.show({message:"Processando..."}),i){let I=[],L=[],A=[],j=[],n=[],X=[];I=this.$refs.faturamento.condicaoPagamento.map(k=>k.id),L=this.$refs.faturamento.condicaoPagamentoOriginal.filter(k=>!I.includes(k.id));for(const k of L)if(k.idFinanceiroTitulo&&A.push(k.idFinanceiroTitulo),k.idFormaPagamento){let f;f=await $erp().formaPagamento.get(k.idFormaPagamento),(f||{}).aliquota&&(k.idFinanceiroTituloPagar?A.push(k.idFinanceiroTituloPagar):this.$q.notify("N\xE3o foi poss\xEDvel excluir as movimenta\xE7\xF5es referentes \xE0 aliquota. Exclua-as manualmente."))}for(const k of A){let f;if(f=await $erp().financeiroTitulo.get(k),f.id&&j.push(f),f.idFinanceiroMovimentacaoAgrupamento){let p,O;if(p=await $db.hibrido.lista({table:"financeiroMovimentacao",where:{idFinanceiroMovimentacaoN:f.idFinanceiroMovimentacaoAgrupamento}}),O=(p.find(l=>l.idFinanceiroCheque)||{}).idFinanceiroCheque,O){let l=await $erp().financeiroTitulo.get(O);l.id&&j.push(l)}n.push(...p)}}for(let k of this.carnes){if(!k.id||(k=await $erp().financeiroTitulo.get(k.id),!(k||{}).idFinanceiroMovimentacaoAgrupamento))continue;let f,p;f=await $db.hibrido.lista({table:"financeiroMovimentacao",where:{idFinanceiroMovimentacaoN:k.idFinanceiroMovimentacaoAgrupamento}}),p=await $db.hibrido.lista({table:"financeiroRenegociacao",where:{idFinanceiroMovimentacaoN:k.idFinanceiroMovimentacaoAgrupamento}}),n.push(...f),X.push(...p)}await $db.financeiroTitulo.remove(j),await $db.financeiroMovimentacao.remove(n),await $db.financeiroRenegociacao.remove(X)}else{await $db.financeiroTitulo.remove(m.filter(I=>!(I.carne&&I.idFatura===d.id))),await $db.financeiroMovimentacao.remove(b),await $db.financeiroRenegociacao.remove($);for(const I of m.filter(L=>L.carne&&L.idFatura===d.id))await $db.financeiroTitulo.grava({original:I,atual:{valorRealizado:0,receberPagar:1,dataPagamento:""}})}return this.fatura.tokenBonusGerado&&!i&&($db.bonus.cancela(this.fatura),this.fatura.tokenBonusGerado=""),await this.salvarFatura(),await this.atualizar(),i?this.$q.notifyPositive("Fatura corrigida."):this.$q.notifyPositive("Fatura reaberta."),!0}catch{this.$q.notify("N\xE3o foi poss\xEDvel reabrir a fatura."),this.$q.loading.hide()}finally{this.$q.loading.hide()}},async corrigir(){let i,o,d,C;if(i=this.$refs.faturamento.condicaoPagamentoOriginal,o=this.$refs.faturamento.condicaoPagamento,C=$utils.arredondar(this.fatura.totalDocumento||0),d=$utils.arredondar(o.reduce((a,u)=>a+u.valor||0,0)),d!==C){this.$q.notify("Total das condi\xE7\xF5es de pagamento difere do total da fatura");return}if(i.length){let a=!1;o.length||(a=!0);for(const u of o)if(!i.find(B=>B.id===u.id)){a=!0;break}if(!a){this.$q.notify("N\xE3o h\xE1 corre\xE7\xE3o a ser realizada");return}}try{return await new Promise((a,u)=>{$q.dialog({message:"Esta a\xE7\xE3o ir\xE1 corrigir esta fatura",title:"Tem certeza?",cancel:{label:"CANCELAR",push:!0,color:"tertiary",flat:!0},ok:{label:"CONTINUAR",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(()=>{a()}).onCancel(()=>{u()})}),await this.reabrir(!0),!0}catch{return!1}},async salvarFatura(){var i,o,d,C,a;try{this.$q.loading.show({message:"Processando..."});let u=$utils.clonar(((d=(o=(i=this==null?void 0:this.$refs)==null?void 0:i.faturamento)==null?void 0:o.condicaoPagamento)==null?void 0:d.filter(m=>m==null?void 0:m.valor))||{});for(let m in u)delete u[m].idDocumentoCondicaoPagamento,delete u[m].parcelas,delete u[m].formaPagamento,delete u[m].edicao,delete u[m].codigoDocumento,delete u[m].codigoDocumentoCaixa;const B=(this.carnesOriginal||[]).filter(m=>(this.financeiroTitulo||[]).find(b=>b.id===m.id));if(await $db.fatura.grava({faturaOriginal:this.faturaOriginal,fatura:this.fatura,vendasOriginal:this.vendasOriginal,vendas:this.vendas,documentosEnvelope:this.documentosEnvelope,documentosEnvelopeOriginal:this.documentosEnvelopeOriginal,documentosItemOriginal:this.documentosItemOriginal,documentosItem:this.documentosItem,condicaoPagamentoOriginal:((a=(C=this.$refs)==null?void 0:C.faturamento)==null?void 0:a.condicaoPagamentoOriginal)||{},condicaoPagamento:u,documentoStatus:this.documentoStatus,financeiroTitulo:this.financeiroTitulo,financeiroTituloOriginal:B,financeiroMovimentacao:this.financeiroMovimentacao,financeiroRenegociacao:this.financeiroRenegociacao}),this.receberTitulo.id&&typeof this.receberTitulo.id!="object"){let m=this.carnes.find(b=>b.id===this.receberTitulo.id);m.id&&await $db.financeiroTitulo.grava({original:m,atual:{idFatura:this.fatura.id}}),delete this.receberTitulo.id,await this.atualizar()}if(this.receberTitulo.id&&typeof this.receberTitulo.id=="object"){for(let m of this.receberTitulo.id){let b=this.carnes.find($=>$.id===m);b.id&&await $db.financeiroTitulo.grava({original:b,atual:{idFatura:this.fatura.id}})}delete this.receberTitulo.id,await this.atualizar()}}catch{this.$q.notify("N\xE3o foi poss\xEDvel salvar a fatura."),this.$q.loading.hide()}finally{this.$q.loading.hide()}},async dialogImpressao(){if(this.carnes.length>0&&(this.fatura.status==="Finalizada"||this.fatura.status!=="Aguardando Pagamento"&&this.fatura.dataHoraFinalizado))return this.impressaoVisivel=!0,new Promise(i=>{this.resolveDialogImpressao=i})},async showContabilidade(){this.faturaTitulos=await $db.hibrido.lista({table:"financeiroTitulo",where:{documentoId:this.fatura.id}}),this.faturaMovimentacoes=await $db.hibrido.lista({table:"financeiroMovimentacao",where:{documentoId:this.fatura.id}});const i={};for(const o of this.faturaMovimentacoes){const d=o.idFinanceiroMovimentacaoN||o.id;i[d]||(i[d]={data:o.dataCompetencia,agrupamento:o.codigoFinanceiroMovimentacaoN,automatico:o.automatico,debito:[],credito:[]}),o.valorCredito?i[d].credito.push(o):i[d].debito.push(o)}this.livroDiario=i},fecharDialogImpressao(){this.impressaoVisivel=!1,this.resolveDialogImpressao()},async reenviarBonus(i){try{$q.loading.show();const d=(await $utils.geeksApi({reenviaWhatsAppBonus:{funcao:"9F17EED5-57F2-4FFD-99B5-5D0C1757DFB7",idFatura:i}})).data.reenviaWhatsAppBonus;d.mensagem.includes("Falha ao enviar mensagem")?$q.notifyError(d.mensagem):$q.notifyPositive(d.mensagem),console.log("REENVIAR BONUS RESP: ",d.mensagem)}catch(o){$q.notifyError("Erro ao reenviar b\xF4nus pelo WhatsApp.",o)}finally{$q.loading.hide()}}},props:{prop:{default:()=>({}),required:!0,type:Object},receberTitulo:{default:()=>({}),type:Object}},mounted(){this.sistemaPai=$utils.sistemaPai(),this.atualizar()}},et={class:"Fatura round-borders bg-grey-2 q-pb-sm"},it={class:"row items-center"},nt={class:"col q-ma-sm q-title"},rt={class:"bg-grey-2"},st={class:"q-ma-sm"},lt={key:0,class:"q-item-label",style:{color:"#0c0c0c"}},dt={key:1,class:"q-item-label q-mt-md",style:{color:"#0c0c0c"}},ut={class:"col-12 col-md-6 border-1 q-ma-md"},ct={class:"col-8 text-right"},mt={class:"col-4"},ft={class:"col-4"},pt={class:"col-4"},vt={class:"col-4 q-mt-sm text-right"},ht={class:"col-8 q-mt-sm text-right"},gt={class:"col-8 q-mt-sm text-right"},Ct={class:"col-8 q-mt-sm text-right"},bt={class:"col-8 q-mt-sm text-right"},$t={class:"Fatura-faturamento round-borders q-ma-sm q-pa-md"},Ft={class:"round-borders q-ma-sm q-pa-md"};function Dt(i,o,d,C,a,u){const B=G("avatar"),m=G("documento-codigo"),b=G("documento-metas"),$=G("VendaCard"),I=G("EnvelopeCard"),L=G("titulo-card"),A=G("row"),j=G("campo"),n=G("faturamento"),X=G("documentos-fiscais"),k=G("g-label"),f=G("g-col"),p=G("nomeValor"),O=G("g-row");return c(),_(U,null,[F("div",et,[t(va,{class:"Fatura-barra bg-grey-2 q-py-md",color:"black",dark:""},{default:e(()=>[t($a,null,{default:e(()=>[F("div",it,[t(B,{imagem:(a.contatos[a.fatura.idContato]||{}).imagem,rotulo:a.fatura.descricaoContato,tamanho:"60"},null,8,["imagem","rotulo"]),F("div",nt,V(a.fatura.descricaoContato),1)])]),_:1}),a.fatura.id?(c(),y(m,{key:0,documento:a.fatura,class:"q-mx-sm"},null,8,["documento"])):P("",!0),a.fatura.status==="Finalizada"||a.fatura.status!=="Aguardando Pagamento"&&a.fatura.dataHoraFinalizado?(c(),y(K,{key:1,icon:"print",size:"md",color:"primary",round:"",flat:""},{default:e(()=>[t(Pa,null,{default:e(()=>[ia((c(),y(ma,{link:"",separator:""},{default:e(()=>[(c(!0),_(U,null,J(a.configImpressaoFatura,l=>(c(),y(W,{clickable:"",key:l.valor,onClick:N=>i.$imprimir(l.valor,(a.fatura||{}).id||"0")},{default:e(()=>[t(z,{avatar:""},{default:e(()=>[t(H,{name:"print"})]),_:1}),t(z,null,{default:e(()=>[t(Z,null,{default:e(()=>[M(V(l.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),a.sistemaPai==="optisoul"?(c(!0),_(U,{key:0},J(a.configImpressaoEnvelope,l=>(c(),y(W,{clickable:"",key:l.valor,onClick:N=>i.$imprimir(l.valor,(a.fatura||{}).id||"0")},{default:e(()=>[t(z,{avatar:""},{default:e(()=>[t(H,{name:"print"})]),_:1}),t(z,null,{default:e(()=>[t(Z,null,{default:e(()=>[M(V(l.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):P("",!0),(c(!0),_(U,null,J(a.configImpressaoCarne,l=>(c(),y(W,{clickable:"",key:l.valor,onClick:N=>i.$imprimir(l.valor,(a.fatura||{}).id||"0")},{default:e(()=>[t(z,{avatar:""},{default:e(()=>[t(H,{name:"print"})]),_:1}),t(z,null,{default:e(()=>[t(Z,null,{default:e(()=>[M(V(l.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),(c(!0),_(U,null,J(a.configImpressaoConvenio,l=>(c(),y(W,{clickable:"",key:l.valor,onClick:N=>i.$imprimir(l.valor,(a.fatura||{}).id||"0")},{default:e(()=>[t(z,{avatar:""},{default:e(()=>[t(H,{name:"print"})]),_:1}),t(z,null,{default:e(()=>[t(Z,null,{default:e(()=>[M(V(l.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})),[[na]])]),_:1})]),_:1})):P("",!0),t(K,{icon:"more_vert",size:"md",color:"tertiary",flat:"",round:""},{default:e(()=>[t(Pa,null,{default:e(()=>[t(ma,{link:"",separator:""},{default:e(()=>{var l;return[a.fatura.id&&!!((l=a.fatura)!=null&&l.tokenBonusGerado)?ia((c(),y(W,{key:0,onClick:o[0]||(o[0]=N=>u.reenviarBonus(a.fatura.id)),clickable:""},{default:e(()=>[t(z,{avatar:""},{default:e(()=>[t(H,{name:"card_giftcard"})]),_:1}),t(z,null,{default:e(()=>[t(Z,null,{default:e(()=>o[13]||(o[13]=[M("Reenviar o B\xF4nus")])),_:1})]),_:1})]),_:1})),[[na]]):P("",!0),a.fatura.id?ia((c(),y(W,{key:1,clickable:"",onClick:o[1]||(o[1]=N=>i.$refs.documentosFiscais.emitirCupom(a.fatura.id))},{default:e(()=>[t(z,{avatar:""},{default:e(()=>[t(H,{name:"account_balance"})]),_:1}),t(z,null,{default:e(()=>[t(Z,null,{default:e(()=>o[14]||(o[14]=[M("Emitir cupom")])),_:1})]),_:1})]),_:1})),[[na]]):P("",!0),a.fatura.id&&i.$utils.mapearStatus(a.fatura).permiteNota?(c(),_(U,{key:2},[ia((c(),y(W,{clickable:"",onClick:o[2]||(o[2]=N=>i.emitirNFeV2({idFatura:a.fatura.id},1,"Venda"))},{default:e(()=>[t(z,{avatar:""},{default:e(()=>[t(H,{name:"account_balance"})]),_:1}),t(z,null,{default:e(()=>[t(Z,null,{default:e(()=>o[15]||(o[15]=[M("NFe de Sa\xEDda/Venda")])),_:1})]),_:1})]),_:1})),[[na]]),ia((c(),y(W,{onClick:o[3]||(o[3]=N=>i.emitirNFeV2({idFatura:a.fatura.id},0,"Devolu\xE7\xE3o")),clickable:""},{default:e(()=>[t(z,{avatar:""},{default:e(()=>[t(H,{name:"account_balance"})]),_:1}),t(z,null,{default:e(()=>[t(Z,null,{default:e(()=>o[16]||(o[16]=[M("NFe de Entrada/Devolu\xE7\xE3o")])),_:1})]),_:1})]),_:1})),[[na]]),ia((c(),y(W,{onClick:o[4]||(o[4]=N=>i.emitirNFeV2({idFatura:a.fatura.id},1,"Remessa")),clickable:""},{default:e(()=>[t(z,{avatar:""},{default:e(()=>[t(H,{name:"account_balance"})]),_:1}),t(z,null,{default:e(()=>[t(Z,null,{default:e(()=>o[17]||(o[17]=[M("NFe de Remessa")])),_:1})]),_:1})]),_:1})),[[na]])],64)):P("",!0),a.fatura.id?ia((c(),y(W,{key:3,clickable:"",onClick:o[5]||(o[5]=N=>i.$db.log.show({documentoTipo:"Fatura",documentoId:a.fatura.id}))},{default:e(()=>[t(z,{avatar:""},{default:e(()=>[t(H,{name:"description"})]),_:1}),t(z,null,{default:e(()=>[t(Z,null,{default:e(()=>o[18]||(o[18]=[M("Ver Log")])),_:1})]),_:1})]),_:1})),[[na]]):P("",!0)]}),_:1})]),_:1})]),_:1})]),_:1}),F("div",rt,[t(b,{ref:"documentoMetas"},null,512)]),F("div",st,[a.vendas.length>0?(c(),_("p",lt,[t(H,{name:"shopping_cart",class:"q-mr-md",size:"24px",style:{color:"#737373"}}),o[19]||(o[19]=M(" Vendas "))])):P("",!0),(c(!0),_(U,null,J(a.vendas,l=>(c(),_("div",{key:l.id,class:"bg-white q-mt-sm round-borders"},[t($,{id:l.id,onAtualizar:u.atualizar,onExecutar:u.executar},null,8,["id","onAtualizar","onExecutar"])]))),128)),(c(!0),_(U,null,J(a.documentosEnvelope,l=>(c(),_("div",{key:l.id,class:"bg-white q-mt-sm round-borders"},[t(I,{id:l.id,onExecutar:u.executar},null,8,["id","onExecutar"])]))),128)),a.carnes.length>0?(c(),_("p",dt,[t(H,{name:"attach_money",class:"q-mr-md",size:"24px",style:{color:"#737373"}}),o[20]||(o[20]=M(" Titulos (Carn\xEAs/Boletos) "))])):P("",!0),(c(!0),_(U,null,J(a.carnes,l=>(c(),_("div",{key:l.id,class:"bg-white q-mt-sm round-borders"},[t(L,{dados:l,class:"q-mt-md",onExecutar:u.executar},null,8,["dados","onExecutar"])]))),128))]),t(A,{class:"justify-end"},{default:e(()=>[F("div",ut,[t(A,{class:"q-mb-sm"},{default:e(()=>[o[21]||(o[21]=F("div",{class:"col-4 col-lg-3",style:{"line-height":"35px"}},"Subtotal",-1)),F("strong",ct,V(i.$filters.numero(a.fatura.subTotal,2)),1)]),_:1}),a.permissaoDesconto?(c(),y(A,{key:0},{default:e(()=>[o[22]||(o[22]=F("div",{class:"col-4 col-lg-3",style:{"line-height":"50px"}},"Desconto",-1)),F("div",mt,[t(j,{modelValue:a.fatura.totalPercentualDesconto,"onUpdate:modelValue":[o[6]||(o[6]=l=>a.fatura.totalPercentualDesconto=l),o[7]||(o[7]=l=>u.calculaTotais("descontoPercentual"))],tipo:"decimal",decimals:"2",suffix:"%","somente-leitura":u.descontoSomenteLeitura,debounce:500,error:a.erroCalculo},null,8,["modelValue","somente-leitura","error"])]),F("div",ft,[t(j,{modelValue:a.fatura.totalDesconto,"onUpdate:modelValue":[o[8]||(o[8]=l=>a.fatura.totalDesconto=l),o[9]||(o[9]=l=>u.calculaTotais("desconto"))],tipo:"decimal",decimals:"2","somente-leitura":u.descontoSomenteLeitura,debounce:500,error:a.erroCalculo,errorMessage:a.erroCalculoMsg},null,8,["modelValue","somente-leitura","error","errorMessage"])])]),_:1})):P("",!0),a.permissaoBonus?(c(),y(A,{key:1},{default:e(()=>[o[23]||(o[23]=F("div",{class:"col-4 col-lg-3",style:{"line-height":"50px"}},"B\xF4nus",-1)),F("div",pt,[t(j,{modelValue:a.fatura.tokenBonusUtilizado,"onUpdate:modelValue":[o[10]||(o[10]=l=>a.fatura.tokenBonusUtilizado=l),o[11]||(o[11]=l=>u.calculaTotais("bonus"))],"rotulo-fixo":"Token do B\xF4nus","somente-leitura":u.bonusSomenteLeitura,debounce:500,mask:"NNNN-NNNN",error:!!a.erroTokenBonusMsg,errorMessage:a.erroTokenBonusMsg},null,8,["modelValue","somente-leitura","error","errorMessage"])]),F("strong",vt,V(i.$filters.numero(a.fatura.totalBonus,2)),1)]),_:1})):P("",!0),t(A,{class:"q-col-gutter-x-sm q-mt-sm"},{default:e(()=>[o[24]||(o[24]=F("div",{class:"col-4 col-lg-3",style:{"line-height":"35px"}},"Total",-1)),F("strong",ht,V(i.$filters.numero(a.fatura.totalDocumento,2)),1)]),_:1}),a.pesoTotal?(c(),y(A,{key:2,class:"q-col-gutter-x-sm q-mt-sm"},{default:e(()=>[o[25]||(o[25]=F("div",{class:"col-4 col-lg-3",style:{"line-height":"35px"}},"Peso Total",-1)),F("span",gt,V(a.pesoTotal),1)]),_:1})):P("",!0),a.pesoBrutoTotal?(c(),y(A,{key:3,class:"q-col-gutter-x-sm q-mt-sm"},{default:e(()=>[o[26]||(o[26]=F("div",{class:"col-4 col-lg-3",style:{"line-height":"35px"}},"Peso Bruto Total",-1)),F("span",Ct,V(a.pesoBrutoTotal),1)]),_:1})):P("",!0),a.metroCubicoTotal?(c(),y(A,{key:4,class:"q-col-gutter-x-sm q-mt-sm"},{default:e(()=>[o[27]||(o[27]=F("div",{class:"col-4 col-lg-3",style:{"line-height":"35px"}},"Metro C\xFAbico Total",-1)),F("span",bt,V(a.metroCubicoTotal),1)]),_:1})):P("",!0)])]),_:1}),F("div",$t,[t(n,{documento:a.fatura,ref:"faturamento",onExecutar:u.executar,onSalvarFatura:u.salvarFatura},null,8,["documento","onExecutar","onSalvarFatura"])]),F("div",Ft,[t(X,{ref:"documentosFiscais",idFatura:a.fatura.id},null,8,["idFatura"])]),i.$db.usuario.desenvolvedor()?(c(),y(O,{key:0,gutter:"md",mg:"md",bg:"bg-yellow"},{default:e(()=>[t(Ia,{"header-class":"q-px-sm",class:"g-col col-12",onShow:u.showContabilidade},{header:e(()=>[t(f,{col:"12"},{default:e(()=>[t(k,{text:"sub1 medium",icon:"credit_card sm tertiary left"},{default:e(()=>o[28]||(o[28]=[M("Contabilidade (apenas desenvolvedor)")])),_:1})]),_:1})]),default:e(()=>[t(f,{col:"12"},{default:e(()=>[a.faturaTitulos.length?(c(),y(k,{key:0,text:"sub1 medium"},{default:e(()=>o[29]||(o[29]=[M("Titulos")])),_:1})):P("",!0),t(ma,{highlight:"",class:"q-pa-none"},{default:e(()=>[(c(!0),_(U,null,J(a.faturaTitulos,l=>(c(),y(O,{key:l.id,gutter:"sm",items:"center"},{default:e(()=>[t(Ia,{"header-class":"q-px-sm",class:"g-col col-12"},{header:e(()=>[t(f,{col:"sm2"},{default:e(()=>[t(j,{modelValue:l.dataVencimento,"somente-leitura":"",rotulo:"Data vencimento",tipo:"data",dense:""},null,8,["modelValue"])]),_:2},1024),t(f,{col:"sm2"},{default:e(()=>[t(j,{modelValue:l.dataPagamento||"A pagar","somente-leitura":"",rotulo:"Data pagamento",tipo:l.dataPagamento?"data":"texto",dense:""},null,8,["modelValue","tipo"])]),_:2},1024),t(f,{col:"sm2"},{default:e(()=>[t(j,{modelValue:l.valor,"somente-leitura":"",align:"left",rotulo:"Valor",decimals:"2",tipo:"decimal"},null,8,["modelValue"])]),_:2},1024),t(f,{col:"sm2"},{default:e(()=>[t(j,{modelValue:l.parcela,"somente-leitura":"",align:"left",rotulo:"Parcela"},null,8,["modelValue"])]),_:2},1024),t(f,{col:"sm2"},{default:e(()=>[t(j,{modelValue:l.formaDePagamento,"somente-leitura":"",rotulo:"Forma de pagamento"},null,8,["modelValue"])]),_:2},1024),t(f,{col:"sm2"},{default:e(()=>[t(j,{modelValue:l.observacao,"somente-leitura":"",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue"])]),_:2},1024)]),default:e(()=>[t(O,{class:"q-pl-xl bg-white"},{default:e(()=>[(c(!0),_(U,null,J(l,(N,v)=>(c(),_("div",{key:v},[t(p,{nome:v,valor:String(N)},null,8,["nome","valor"])]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(f,{col:"12"},{default:e(()=>[a.faturaMovimentacoes.length?(c(),y(k,{key:0,text:"sub1 medium"},{default:e(()=>o[30]||(o[30]=[M("Movimenta\xE7\xF4es")])),_:1})):P("",!0),t(ma,{highlight:"",class:"q-pa-none"},{default:e(()=>[(c(!0),_(U,null,J(a.faturaMovimentacoes,l=>(c(),y(O,{key:l.id,gutter:"sm",mg:"sm-y",items:"center"},{default:e(()=>[t(Ia,{"header-class":"q-px-sm",class:"g-col col-12"},{header:e(()=>[t(f,{col:"xs-grow"},{default:e(()=>[t(j,{modelValue:l.descricao,"somente-leitura":"",rotulo:"Descri\xE7\xE3o"},null,8,["modelValue"])]),_:2},1024),l.valorCredito?(c(),y(f,{key:0,col:"xs6 md2"},{default:e(()=>[t(j,{modelValue:l.valorCredito,"somente-leitura":"",align:"left",rotulo:"Valor Credito",decimals:"2",tipo:"decimal"},null,8,["modelValue"])]),_:2},1024)):P("",!0),l.valorDebito?(c(),y(f,{key:1,col:"xs6 md2"},{default:e(()=>[t(j,{modelValue:l.valorDebito,"somente-leitura":"",align:"left",rotulo:"Valor Debito",decimals:"2",tipo:"decimal"},null,8,["modelValue"])]),_:2},1024)):P("",!0),t(f,{col:"xs6 md-shrink"},{default:e(()=>[t(j,{modelValue:l.dataCompetencia,"somente-leitura":"",rotulo:"Data competencia",tipo:"data",dense:""},null,8,["modelValue"])]),_:2},1024),t(f,{col:"xs-grow"},{default:e(()=>[t(j,{modelValue:l.observacao,"somente-leitura":"",rotulo:"Observa\xE7\xE3o"},null,8,["modelValue"])]),_:2},1024)]),default:e(()=>[t(O,{class:"q-pl-xl bg-white"},{default:e(()=>[(c(!0),_(U,null,J(l,(N,v)=>(c(),_("div",{key:v},[t(p,{nome:v,valor:String(N)},null,8,["nome","valor"])]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),t(f,{col:"12"},{default:e(()=>[Object.keys(a.livroDiario).length?(c(),y(k,{key:0,text:"sub1 medium"},{default:e(()=>o[31]||(o[31]=[M("Livro Di\xE1rio - Movimenta\xE7\xE3oN")])),_:1})):P("",!0),t(ma,{highlight:"",class:"q-pa-none"},{default:e(()=>[(c(!0),_(U,null,J(a.livroDiario,l=>(c(),_("div",{key:l.id},[t(O,{class:"q-pl-lg q-pt-md"},{default:e(()=>[t(p,{nome:"Data",valor:i.$filters.data(l.data)},null,8,["valor"]),t(p,{nome:"Hora",valor:i.$filters.hora(l.data)},null,8,["valor"]),t(p,{nome:"Autom\xE1tico",valor:l.automatico?"Sim":"N\xE3o"},null,8,["valor"]),t(p,{nome:"C\xF3digo agrupamento",valor:l.agrupamento},null,8,["valor"])]),_:2},1024),t(O,{class:"q-pl-xl q-pt-sm"},{default:e(()=>[(c(!0),_(U,null,J(l.debito,N=>(c(),_("div",{key:N.id},[t(p,{nome:"Debito",valor:N.descricao},null,8,["valor"]),t(p,{nome:"Valor",valor:N.valorDebito},null,8,["valor"]),t(p,{nome:"",valor:N.observacao},null,8,["valor"])]))),128))]),_:2},1024),t(O,{class:"q-pl-xl q-py-sm"},{default:e(()=>[(c(!0),_(U,null,J(l.credito,N=>(c(),_("div",{key:N.id},[t(p,{nome:"Credito",valor:N.descricao},null,8,["valor"]),t(p,{nome:"Valor",valor:N.valorCredito},null,8,["valor"]),t(p,{nome:"",valor:N.observacao},null,8,["valor"])]))),128))]),_:2},1024)]))),128))]),_:1})]),_:1})]),_:1},8,["onShow"])]),_:1})):P("",!0)]),t(Na,{modelValue:a.impressaoVisivel,"onUpdate:modelValue":o[12]||(o[12]=l=>a.impressaoVisivel=l),onKeyup:Ba(u.fecharDialogImpressao,["esc"]),persistent:""},{default:e(()=>[t(Ja,{container:"",view:"hHh LpR fFf",class:"bg-white rounded-borders",style:{height:"100%","max-height":"350px","max-width":"400px"}},{default:e(()=>[t(Ga,null,{default:e(()=>[t(va,null,{default:e(()=>[t(K,{icon:"arrow_back",flat:"",round:"",dense:"",onClick:u.fecharDialogImpressao},null,8,["onClick"]),t($a,null,{default:e(()=>o[32]||(o[32]=[M("Imprimir")])),_:1})]),_:1})]),_:1}),t(Ka,null,{default:e(()=>[t(Wa,null,{default:e(()=>[t(ma,{link:"",separator:""},{default:e(()=>[(c(!0),_(U,null,J(a.configImpressaoFatura,l=>(c(),y(W,{clickable:"",key:l.valor,onClick:N=>i.$imprimir(l.valor,(a.fatura||{}).id||"0")},{default:e(()=>[t(z,{avatar:""},{default:e(()=>[t(H,{name:"print"})]),_:1}),t(z,null,{default:e(()=>[t(Z,null,{default:e(()=>[M(V(l.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),a.sistemaPai==="optisoul"?(c(!0),_(U,{key:0},J(a.configImpressaoEnvelope,l=>(c(),y(W,{clickable:"",key:l.valor,onClick:N=>i.$imprimir(l.valor,(a.fatura||{}).id||"0")},{default:e(()=>[t(z,{avatar:""},{default:e(()=>[t(H,{name:"print"})]),_:1}),t(z,null,{default:e(()=>[t(Z,null,{default:e(()=>[M(V(l.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):P("",!0),(c(!0),_(U,null,J(a.configImpressaoCarne,l=>(c(),y(W,{clickable:"",key:l.valor,onClick:N=>i.$imprimir(l.valor,(a.fatura||{}).id||"0")},{default:e(()=>[t(z,{avatar:""},{default:e(()=>[t(H,{name:"print"})]),_:1}),t(z,null,{default:e(()=>[t(Z,null,{default:e(()=>[M(V(l.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),(c(!0),_(U,null,J(a.configImpressaoConvenio,l=>(c(),y(W,{clickable:"",key:l.valor,onClick:N=>i.$imprimir(l.valor,(a.fatura||{}).id||"0")},{default:e(()=>[t(z,{avatar:""},{default:e(()=>[t(H,{name:"print"})]),_:1}),t(z,null,{default:e(()=>[t(Z,null,{default:e(()=>[M(V(l.texto),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onKeyup"])],64)}var Et=za(tt,[["render",Dt]]);const wt={components:{CpfCnpjNoCupom:$o,Fatura:Et},data(){return{fatura:{},cpfCnpjNoCupom:{visivel:!1,incluirCpfCnpjNoCupom:!1,idEmpresa:"",cpfCnpj:"",nomeCliente:"",tipoCaixa:""},visivel:!1,visibilidade:{botao:{finalizar:!1,reabrir:!1,corrigir:!1}},temPermissaoCorrigir:!1}},emits:["executar"],methods:{async atualizar(){let i;try{i=setTimeout(()=>{$q.loading.show({message:"Carregando informa\xE7\xF5es...",boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"})},500);let o=await $db.hibrido.le({table:"documento",id:this.id});this.fatura=o,await this.verificarPermissoes(),this.desativarBotoes(),o.status==="Aberta"&&(this.visibilidade.botao.salvar=!0),o.status==="Finalizada"||o.status!=="Aguardando Pagamento"&&o.dataHoraFinalizado?this.visibilidade.botao.reabrir=!0:this.visibilidade.botao.finalizar=!0,await $db.contato.exibirCondutaObservacao(o.idContato,$q.notify)}finally{clearTimeout(i),$q.loading.hide()}},desativarBotoes(){this.visibilidade.botao.finalizar=!1,this.visibilidade.botao.reabrir=!1,this.visibilidade.botao.salvar=!1},desativarEsc(){this.lockEsc=!0},reativarEsc(){this.lockEsc=!1},async reabrir(){await this.$refs.fatura.reabrir(),await this.atualizar(),this.runOnHide.push(()=>$utils.emitter.emit("atualizarAtendimentoFatura"))},voltar(i){i.stopPropagation(),!this.lockEsc&&this.fechar()},async finalizar(i){const d={cpfCnpjNoCupom:this.cpfCnpjNoCupom};if(this.lockEsc=!0,!await this.$refs.fatura.finalizar(!1,d)){this.lockEsc=!1;return}await this.$refs.fatura.atualizar(),await this.atualizar(),await this.$refs.fatura.dialogImpressao(),this.$emit("executar","finalizar"),this.fechar()},async executar(i){switch(i){case"finalizar":if(!await this.$refs.fatura.finalizar())return;break;case"retornarOrcamento":case"remover":await this.atualizar(),this.runOnHide.push(()=>$utils.emitter.emit("atualizarAtendimentoFatura"));return}if(i==="atualizarSemFechar"){await this.atualizar(),this.runOnHide.push(()=>this.$emit("executar","atualizar")),await this.$forceUpdate();return}this.$emit("executar",i),this.fechar()},fechar(){this.visivel=!1},async executarRecebimentoMultiplos(i){return await this.$refs.fatura.executarRecebimentoMultiplos(i)},async mostrar(i={}){this.id=i.id,await this.atualizar(),this.visivel=!0},onHide(){this.fatura={},this.visibilidade={botao:{finalizar:!1,reabrir:!1,corrigir:!1}},this.temPermissaoCorrigir=!1,this.runOnHide.forEach(i=>i()),this.runOnHide=[]},async salvar(){try{await new Promise((i,o)=>{$q.dialog({message:"Esta a\xE7\xE3o ir\xE1 salvar esta fatura",title:"Tem certeza?",cancel:{label:"Cancelar",push:!0,color:"tertiary",flat:!0},ok:{label:"Continuar",push:!0,class:"bg-primary",textColor:"white",flat:!0}}).onOk(()=>{i()}).onCancel(()=>{o()})})}catch{return}await this.$refs.fatura.salvarFatura(),this.$emit("executar","atualizar"),this.fechar()},corrigir(){this.$refs.fatura.corrigir().then(()=>{this.$emit("executar","atualizar"),this.fechar()})},async verificarPermissoes(){this.temPermissaoCorrigir=await $db.permissao.objeto("caixa/tesouraria")}},props:{receberTitulo:{default:()=>({}),type:Object}},created(){this.runOnHide=[]},mounted(){$utils.emitter.on("desativarBotoesFaturaModal",this.desativarBotoes),$utils.emitter.on("desativarVoltarEscModal",this.desativarEsc),$utils.emitter.on("reativarVoltarEscModal",this.reativarEsc)},beforeUnmount(){$utils.emitter.off("desativarBotoesFaturaModal",this.desativarBotoes),$utils.emitter.off("desativarVoltarEscModal",this.desativarEsc),$utils.emitter.off("reativarVoltarEscModal",this.reativarEsc)}};function yt(i,o,d,C,a,u){const B=G("fatura"),m=G("CpfCnpjNoCupom");return c(),_("div",null,[t(Na,{modelValue:a.visivel,"onUpdate:modelValue":o[0]||(o[0]=b=>a.visivel=b),onKeyup:Ba(u.voltar,["esc"]),onHide:u.onHide,maximized:"",persistent:""},{default:e(()=>[t(Ja,{view:"hHh LpR fFf",container:"",class:"bg-grey-4"},{default:e(()=>[t(Ga,null,{default:e(()=>[t(va,null,{default:e(()=>[ia(t(K,{icon:"arrow_back",round:"",flat:"",dense:""},null,512),[[na]]),t($a,null,{default:e(()=>o[3]||(o[3]=[M("Fatura")])),_:1}),a.visibilidade.botao.salvar?(c(),y(K,{key:0,onClick:u.salvar,label:"Salvar",color:"white","text-color":"primary",unelevated:""},null,8,["onClick"])):P("",!0),a.visibilidade.botao.reabrir&&a.temPermissaoCorrigir?(c(),y(K,{key:1,onClick:u.corrigir,label:"Corrigir",color:"white","text-color":"negative",unelevated:""},null,8,["onClick"])):P("",!0)]),_:1})]),_:1}),t(Ka,null,{default:e(()=>[t(Wa,{class:"u-container q-py-md"},{default:e(()=>[a.fatura.id?(c(),y(B,{key:0,onExecutar:u.executar,prop:{id:a.fatura.id},receberTitulo:d.receberTitulo,ref:"fatura"},null,8,["onExecutar","prop","receberTitulo"])):P("",!0)]),_:1})]),_:1}),t(go,{class:"bg-light",bordered:""},{default:e(()=>[t(va,{class:"q-pa-sm u-container"},{default:e(()=>[t(Co),a.visibilidade.botao.reabrir?(c(),y(K,{key:0,onClick:u.reabrir,label:"Reabrir",color:"negative",flat:"",class:"q-ml-sm"},null,8,["onClick"])):P("",!0),a.visibilidade.botao.reabrir?ia((c(),y(K,{key:1,label:"Fechar",color:"tertiary",flat:"",class:"q-ml-sm"},null,512)),[[na]]):P("",!0),a.visibilidade.botao.reabrir?P("",!0):(c(),y(K,{key:2,onClick:u.finalizar,disabled:!a.visibilidade.botao.finalizar,label:"Finalizar",color:"primary",dark:"",unelevated:"",class:"q-ml-sm"},null,8,["onClick","disabled"]))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onKeyup","onHide"]),t(m,{modelValue:a.cpfCnpjNoCupom.visivel,"onUpdate:modelValue":o[1]||(o[1]=b=>a.cpfCnpjNoCupom.visivel=b),onConfirmar:o[2]||(o[2]=b=>u.finalizar()),dados:a.cpfCnpjNoCupom},null,8,["modelValue","dados"])])}var Vt=za(wt,[["render",yt]]);export{Vt as F,Yo as T};
